(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();const s_={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class r_ extends Error{constructor(t){const e=s_[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const Xg=r_;class o_{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Yi=o_,Lr={PROPERTYCHANGE:"propertychange"};class a_{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const jc=a_;function l_(r,t,e){let n,i;e=e||Gs;let s=0,o=r.length,a=!1;for(;s<o;)n=s+(o-s>>1),i=+e(r[n],t),i<0?s=n+1:(o=n,a=!i);return a?s:~s}function Gs(r,t){return r>t?1:r<t?-1:0}function Zc(r,t,e){const n=r.length;if(r[0]<=t)return 0;if(t<=r[n-1])return n-1;{let i;if(e>0){for(i=1;i<n;++i)if(r[i]<t)return i-1}else if(e<0){for(i=1;i<n;++i)if(r[i]<=t)return i}else for(i=1;i<n;++i){if(r[i]==t)return i;if(r[i]<t)return typeof e=="function"?e(t,r[i-1],r[i])>0?i-1:i:r[i-1]-t<t-r[i]?i-1:i}return n-1}}function c_(r,t,e){for(;t<e;){const n=r[t];r[t]=r[e],r[e]=n,++t,--e}}function Oi(r,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let i=0;i<n;i++)r[r.length]=e[i]}function js(r,t){const e=r.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function h_(r,t,e){const n=t||Gs;return r.every(function(i,s){if(s===0)return!0;const o=n(r[s-1],i);return!(o>0||e&&o===0)})}function oo(){return!0}function rl(){return!1}function ks(){}function u_(r){let t=!1,e,n,i;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==i||!js(s,n))&&(t=!0,i=this,n=s,e=r.apply(this,arguments)),e}}function Po(r){for(const t in r)delete r[t]}function br(r){let t;for(t in r)return!1;return!t}class g_ extends jc{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const s=e?new Yi(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let c=0,h=i.length;c<h;++c)if("handleEvent"in i[c]?l=i[c].handleEvent(s):l=i[c].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let c=a[n];for(delete a[n];c--;)this.removeEventListener(n,ks);delete o[n]}return l}disposeInternal(){this.listeners_&&Po(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){const n=this.listeners_&&this.listeners_[t];if(n){const i=n.indexOf(e);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=ks,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}}}const al=g_,ft={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function wt(r,t,e,n,i){if(n&&n!==r&&(e=e.bind(n)),i){const o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function Sa(r,t,e,n){return wt(r,t,e,n,!0)}function Zt(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),Po(r))}class ll extends al{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ft.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=wt(this,t[s],e);return i}else return wt(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Sa(this,t[s],e)}else n=Sa(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)d_(n);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}ll.prototype.on;ll.prototype.once;ll.prototype.un;function d_(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)Zt(r[t]);else Zt(r)}const Wg=ll;function at(){throw new Error("Unimplemented abstract method.")}let f_=0;function bt(r){return r.ol_uid||(r.ol_uid=String(++f_))}class Wu extends Yi{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class m_ extends Wg{constructor(t){super(),this.on,this.once,this.un,bt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Wu(n,t,e)),n=Lr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Wu(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const i=this.values_||(this.values_={});if(n)i[t]=e;else{const s=i[t];i[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],br(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const mi=m_,Qe={ADD:"add",REMOVE:"remove"},Bu={LENGTH:"length"};class oa extends Yi{constructor(t,e,n){super(t),this.element=e,this.index=n}}let __=class extends mi{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,i=this.array_.length;n<i;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,i=e.length;n<i;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Bu.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new oa(Qe.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,i=e.length;n<i;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new oa(Qe.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new oa(Qe.REMOVE,i,t)),this.dispatchEvent(new oa(Qe.ADD,e,t))}updateLength_(){this.set(Bu.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,i=this.array_.length;n<i;++n)if(this.array_[n]===t&&n!==e)throw new Xg(58)}};const ri=__;function Et(r,t){if(!r)throw new Xg(t)}class Uc extends mi{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Uc(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Zt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=wt(t,ft.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?p_(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function p_(r){if(typeof r=="function")return r;{let t;return Array.isArray(r)?t=r:(Et(typeof r.getZIndex=="function",41),t=[r]),function(){return t}}}const _c=Uc,cs=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",y_=cs.includes("firefox"),x_=cs.includes("safari")&&!cs.includes("chrom");x_&&(cs.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(cs));const E_=cs.includes("webkit")&&!cs.includes("edge"),I_=cs.includes("macintosh"),Bg=typeof devicePixelRatio<"u"?devicePixelRatio:1,Hc=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,C_=typeof Image<"u"&&Image.prototype.decode,jg=function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r}();new Array(6);function kn(){return[1,0,0,1,0,0]}function R_(r,t,e,n,i,s,o){return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r[4]=s,r[5]=o,r}function w_(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function ue(r,t){const e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function T_(r,t,e){return R_(r,t,0,0,e,0,0)}function Di(r,t,e,n,i,s,o,a){const l=Math.sin(s),c=Math.cos(s);return r[0]=n*c,r[1]=i*l,r[2]=-n*l,r[3]=i*c,r[4]=o*n*c-a*n*l+t,r[5]=o*i*l+a*i*c+e,r}function Vc(r,t){const e=N_(t);Et(e!==0,32);const n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-i/e,r[2]=-s/e,r[3]=n/e,r[4]=(s*l-o*a)/e,r[5]=-(n*l-i*a)/e,r}function N_(r){return r[0]*r[3]-r[1]*r[2]}let ju;function Zg(r){const t="matrix("+r.join(", ")+")";if(Hc)return t;const e=ju||(ju=document.createElement("div"));return e.style.transform=t,e.style.transform}const Ee={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Zu(r){const t=Tn();for(let e=0,n=r.length;e<n;++e)eo(t,r[e]);return t}function S_(r,t,e){const n=Math.min.apply(null,r),i=Math.min.apply(null,t),s=Math.max.apply(null,r),o=Math.max.apply(null,t);return gi(n,i,s,o,e)}function qc(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function Ug(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function Zs(r,t,e){let n,i;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?i=r[1]-e:r[3]<e?i=e-r[3]:i=0,n*n+i*i}function cl(r,t){return Kc(r,t[0],t[1])}function dr(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function Kc(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function pc(r,t){const e=r[0],n=r[1],i=r[2],s=r[3],o=t[0],a=t[1];let l=Ee.UNKNOWN;return o<e?l=l|Ee.LEFT:o>i&&(l=l|Ee.RIGHT),a<n?l=l|Ee.BELOW:a>s&&(l=l|Ee.ABOVE),l===Ee.UNKNOWN&&(l=Ee.INTERSECTING),l}function Tn(){return[1/0,1/0,-1/0,-1/0]}function gi(r,t,e,n,i){return i?(i[0]=r,i[1]=t,i[2]=e,i[3]=n,i):[r,t,e,n]}function Ao(r){return gi(1/0,1/0,-1/0,-1/0,r)}function L_(r,t){const e=r[0],n=r[1];return gi(e,n,e,n,t)}function Hg(r,t,e,n,i){const s=Ao(i);return qg(s,r,t,e,n)}function ao(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function Vg(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function eo(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function qg(r,t,e,n,i){for(;e<n;e+=i)b_(r,t[e],t[e+1]);return r}function b_(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Kg(r,t){let e;return e=t(hl(r)),e||(e=t(ul(r)),e)||(e=t(gl(r)),e)||(e=t(Us(r)),e)?e:!1}function yc(r){let t=0;return Jc(r)||(t=Wt(r)*zn(r)),t}function hl(r){return[r[0],r[1]]}function ul(r){return[r[2],r[1]]}function Ys(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function v_(r,t){let e;return t==="bottom-left"?e=hl(r):t==="bottom-right"?e=ul(r):t==="top-left"?e=Us(r):t==="top-right"?e=gl(r):Et(!1,13),e}function xc(r,t,e,n,i){const[s,o,a,l,c,h,u,d]=Ec(r,t,e,n);return gi(Math.min(s,a,c,u),Math.min(o,l,h,d),Math.max(s,a,c,u),Math.max(o,l,h,d),i)}function Ec(r,t,e,n){const i=t*n[0]/2,s=t*n[1]/2,o=Math.cos(e),a=Math.sin(e),l=i*o,c=i*a,h=s*o,u=s*a,d=r[0],f=r[1];return[d-l+u,f-c-h,d-l-u,f-c+h,d+l-u,f+c+h,d+l+u,f+c-h,d-l+u,f-c-h]}function zn(r){return r[3]-r[1]}function no(r,t,e){const n=e||Tn();return tn(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):Ao(n),n}function Us(r){return[r[0],r[3]]}function gl(r){return[r[2],r[3]]}function Wt(r){return r[2]-r[0]}function tn(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function Jc(r){return r[2]<r[0]||r[3]<r[1]}function M_(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function O_(r,t,e){let n=!1;const i=pc(r,t),s=pc(r,e);if(i===Ee.INTERSECTING||s===Ee.INTERSECTING)n=!0;else{const o=r[0],a=r[1],l=r[2],c=r[3],h=t[0],u=t[1],d=e[0],f=e[1],p=(f-u)/(d-h);let m,I;s&Ee.ABOVE&&!(i&Ee.ABOVE)&&(m=d-(f-c)/p,n=m>=o&&m<=l),!n&&s&Ee.RIGHT&&!(i&Ee.RIGHT)&&(I=f-(d-l)*p,n=I>=a&&I<=c),!n&&s&Ee.BELOW&&!(i&Ee.BELOW)&&(m=d-(f-a)/p,n=m>=o&&m<=l),!n&&s&Ee.LEFT&&!(i&Ee.LEFT)&&(I=f-(d-o)*p,n=I>=a&&I<=c)}return n}function P_(r,t,e,n){let i=[];if(n>1){const a=r[2]-r[0],l=r[3]-r[1];for(let c=0;c<n;++c)i.push(r[0]+a*c/n,r[1],r[2],r[1]+l*c/n,r[2]-a*c/n,r[3],r[0],r[3]-l*c/n)}else i=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];t(i,i,2);const s=[],o=[];for(let a=0,l=i.length;a<l;a+=2)s.push(i[a]),o.push(i[a+1]);return S_(s,o,e)}function Jg(r,t){const e=t.getExtent(),n=Ys(r);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const i=Wt(e),o=Math.floor((n[0]-e[0])/i)*i;r[0]-=o,r[2]-=o}return r}function A_(r,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];Jg(r,t);const n=Wt(e);if(Wt(r)>n)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+n,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-n,r[3]]]}return[r]}const lo={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class D_{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||lo[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const $g=D_,Do=6378137,fr=Math.PI*Do,F_=[-fr,-fr,fr,fr],G_=[-180,-85,180,85],aa=Do*Math.log(Math.tan(Math.PI/2));class sr extends $g{constructor(t){super({code:t,units:"m",extent:F_,global:!0,worldExtent:G_,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Do)}})}}const Uu=[new sr("EPSG:3857"),new sr("EPSG:102100"),new sr("EPSG:102113"),new sr("EPSG:900913"),new sr("http://www.opengis.net/def/crs/EPSG/0/3857"),new sr("http://www.opengis.net/gml/srs/epsg.xml#3857")];function k_(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e){t[i]=fr*r[i]/180;let s=Do*Math.log(Math.tan(Math.PI*(+r[i+1]+90)/360));s>aa?s=aa:s<-aa&&(s=-aa),t[i+1]=s}return t}function Y_(r,t,e){const n=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(n));for(let i=0;i<n;i+=e)t[i]=180*r[i]/fr,t[i+1]=360*Math.atan(Math.exp(r[i+1]/Do))/Math.PI-90;return t}const z_=6378137,Hu=[-180,-90,180,90],X_=Math.PI*z_/180;class Is extends $g{constructor(t,e){super({code:t,units:"degrees",extent:Hu,axisOrientation:e,global:!0,metersPerUnit:X_,worldExtent:Hu})}}const Vu=[new Is("CRS:84"),new Is("EPSG:4326","neu"),new Is("urn:ogc:def:crs:OGC:1.3:CRS84"),new Is("urn:ogc:def:crs:OGC:2:84"),new Is("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Is("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Is("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ic={};function W_(r){return Ic[r]||Ic[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function B_(r,t){Ic[r]=t}let pr={};function La(r,t,e){const n=r.getCode(),i=t.getCode();n in pr||(pr[n]={}),pr[n][i]=e}function j_(r,t){let e;return r in pr&&t in pr[r]&&(e=pr[r][t]),e}function ce(r,t,e){return Math.min(Math.max(r,t),e)}function Z_(r,t,e,n,i,s){const o=i-e,a=s-n;if(o!==0||a!==0){const l=((r-e)*o+(t-n)*a)/(o*o+a*a);l>1?(e=i,n=s):l>0&&(e+=o*l,n+=a*l)}return As(r,t,e,n)}function As(r,t,e,n){const i=e-r,s=n-t;return i*i+s*s}function U_(r){const t=r.length;for(let n=0;n<t;n++){let i=n,s=Math.abs(r[n][n]);for(let a=n+1;a<t;a++){const l=Math.abs(r[a][n]);l>s&&(s=l,i=a)}if(s===0)return null;const o=r[i];r[i]=r[n],r[n]=o;for(let a=n+1;a<t;a++){const l=-r[a][n]/r[n][n];for(let c=n;c<t+1;c++)n==c?r[a][c]=0:r[a][c]+=l*r[n][c]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=r[n][t]/r[n][n];for(let i=n-1;i>=0;i--)r[i][t]-=r[i][n]*e[n]}return e}function Ca(r){return r*Math.PI/180}function yr(r,t){const e=r%t;return e*t<0?e+t:e}function vi(r,t,e){return r+e*(t-r)}function Qg(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function la(r,t){return Math.floor(Qg(r,t))}function ca(r,t){return Math.ceil(Qg(r,t))}function H_(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function ba(r,t){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function $c(r,t){const e=Math.cos(t),n=Math.sin(t),i=r[0]*e-r[1]*n,s=r[1]*e+r[0]*n;return r[0]=i,r[1]=s,r}function V_(r,t){return r[0]*=t,r[1]*=t,r}function q_(r,t){const e=r[0]-t[0],n=r[1]-t[1];return e*e+n*n}function td(r,t){if(t.canWrapX()){const e=Wt(t.getExtent()),n=K_(r,t,e);n&&(r[0]-=n*e)}return r}function K_(r,t,e){const n=t.getExtent();let i=0;return t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(e=e||Wt(n),i=Math.floor((r[0]-n[0])/e)),i}const J_=63710088e-1;function qu(r,t,e){e=e||J_;const n=Ca(r[1]),i=Ca(t[1]),s=(i-n)/2,o=Ca(t[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(i);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}let Cc=!0;function $_(r){Cc=!(r===void 0?!0:r)}function Qc(r,t,e){if(t!==void 0){for(let n=0,i=r.length;n<i;++n)t[n]=r[n];t=t}else t=r.slice();return t}function ed(r,t,e){if(t!==void 0&&r!==t){for(let n=0,i=r.length;n<i;++n)t[n]=r[n];r=t}return r}function Q_(r){B_(r.getCode(),r),La(r,r,Qc)}function tp(r){r.forEach(Q_)}function _e(r){return typeof r=="string"?W_(r):r||null}function Ku(r,t,e,n){r=_e(r);let i;const s=r.getPointResolutionFunc();if(s){if(i=s(t,e),n&&n!==r.getUnits()){const o=r.getMetersPerUnit();o&&(i=i*o/lo[n])}}else{const o=r.getUnits();if(o=="degrees"&&!n||n=="degrees")i=t;else{const a=eh(r,_e("EPSG:4326"));if(a===ed&&o!=="degrees")i=t*r.getMetersPerUnit();else{let c=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];c=a(c,c,2);const h=qu(c.slice(0,2),c.slice(2,4)),u=qu(c.slice(4,6),c.slice(6,8));i=(h+u)/2}const l=n?lo[n]:r.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function Ju(r){tp(r),r.forEach(function(t){r.forEach(function(e){t!==e&&La(t,e,Qc)})})}function ep(r,t,e,n){r.forEach(function(i){t.forEach(function(s){La(i,s,e),La(s,i,n)})})}function th(r,t){return r?typeof r=="string"?_e(r):r:_e(t)}function Ts(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||eh(r,t)===Qc)&&e}function eh(r,t){const e=r.getCode(),n=t.getCode();let i=j_(e,n);return i||(i=ed),i}function co(r,t){const e=_e(r),n=_e(t);return eh(e,n)}function va(r,t,e){return co(t,e)(r,void 0,r.length)}function np(r,t,e,n){const i=co(t,e);return P_(r,i,void 0,n)}function Rc(r,t){return r}function Si(r,t){return Cc&&!ba(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(Cc=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r}function dl(r,t){return r}function ns(r,t){return r}function ip(r,t){return r}function sp(){Ju(Uu),Ju(Vu),ep(Vu,Uu,k_,Y_)}sp();function Pi(r,t,e,n,i,s){s=s||[];let o=0;for(let a=t;a<e;a+=n){const l=r[a],c=r[a+1];s[o++]=i[0]*l+i[2]*c+i[4],s[o++]=i[1]*l+i[3]*c+i[5]}return s&&s.length!=o&&(s.length=o),s}function nd(r,t,e,n,i,s,o){o=o||[];const a=Math.cos(i),l=Math.sin(i),c=s[0],h=s[1];let u=0;for(let d=t;d<e;d+=n){const f=r[d]-c,p=r[d+1]-h;o[u++]=c+f*a-p*l,o[u++]=h+f*l+p*a;for(let m=d+2;m<d+n;++m)o[u++]=r[m]}return o&&o.length!=u&&(o.length=u),o}function rp(r,t,e,n,i,s,o,a){a=a||[];const l=o[0],c=o[1];let h=0;for(let u=t;u<e;u+=n){const d=r[u]-l,f=r[u+1]-c;a[h++]=l+i*d,a[h++]=c+s*f;for(let p=u+2;p<u+n;++p)a[h++]=r[p]}return a&&a.length!=h&&(a.length=h),a}function op(r,t,e,n,i,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=n){o[a++]=r[l]+i,o[a++]=r[l+1]+s;for(let c=l+2;c<l+n;++c)o[a++]=r[c]}return o&&o.length!=a&&(o.length=a),o}const $u=kn();let ap=class extends mi{constructor(){super(),this.extent_=Tn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=u_(function(t,e,n){if(!n)return this.getSimplifiedGeometry(e);const i=this.clone();return i.applyTransform(n),i.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return at()}closestPointXY(t,e,n,i){return at()}containsXY(t,e){const n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return at()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ao(e),this.extentRevision_=this.getRevision()}return M_(this.extent_,t)}rotate(t,e){at()}scale(t,e,n){at()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return at()}getType(){return at()}applyTransform(t){at()}intersectsExtent(t){return at()}translate(t,e){at()}transform(t,e){const n=_e(t),i=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),c=n.getWorldExtent(),h=zn(c)/zn(l);return Di($u,c[0],c[3],h,-h,0,0,0),Pi(s,0,s.length,a,$u,o),co(n,e)(s,o,a)}:co(n,e);return this.applyTransform(i),this}};const id=ap;class lp extends id{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return Hg(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return at()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Qu(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){at()}setLayout(t,e,n){let i;if(t)i=Qu(t);else{for(let s=0;s<n;++s)if(e.length===0){this.layout="XY",this.stride=2;return}else e=e[0];i=e.length,t=cp(i)}this.layout=t,this.stride=i}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();nd(n,0,n.length,i,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Ys(this.getExtent()));const i=this.getFlatCoordinates();if(i){const s=this.getStride();rp(i,0,i.length,s,t,e,n,i),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const i=this.getStride();op(n,0,n.length,i,t,e,n),this.changed()}}}function cp(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function Qu(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function hp(r,t,e){const n=r.getFlatCoordinates();if(n){const i=r.getStride();return Pi(n,0,n.length,i,t,e)}else return null}const Hs=lp;function tg(r,t,e,n,i,s,o){const a=r[t],l=r[t+1],c=r[e]-a,h=r[e+1]-l;let u;if(c===0&&h===0)u=t;else{const d=((i-a)*c+(s-l)*h)/(c*c+h*h);if(d>1)u=e;else if(d>0){for(let f=0;f<n;++f)o[f]=vi(r[t+f],r[e+f],d);o.length=n;return}else u=t}for(let d=0;d<n;++d)o[d]=r[u+d];o.length=n}function nh(r,t,e,n,i){let s=r[t],o=r[t+1];for(t+=n;t<e;t+=n){const a=r[t],l=r[t+1],c=As(s,o,a,l);c>i&&(i=c),s=a,o=l}return i}function ih(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=nh(r,t,a,n,i),t=a}return i}function up(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];i=ih(r,t,a,n,i),t=a[a.length-1]}return i}function sh(r,t,e,n,i,s,o,a,l,c,h){if(t==e)return c;let u,d;if(i===0)if(d=As(o,a,r[t],r[t+1]),d<c){for(u=0;u<n;++u)l[u]=r[t+u];return l.length=n,d}else return c;h=h||[NaN,NaN];let f=t+n;for(;f<e;)if(tg(r,f-n,f,n,o,a,h),d=As(o,a,h[0],h[1]),d<c){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n,f+=n}else f+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/i|0,1);if(s&&(tg(r,e-n,t,n,o,a,h),d=As(o,a,h[0],h[1]),d<c)){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n}return c}function rh(r,t,e,n,i,s,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];c=sh(r,t,f,n,i,s,o,a,l,c,h),t=f}return c}function gp(r,t,e,n,i,s,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=e.length;u<d;++u){const f=e[u];c=rh(r,t,f,n,i,s,o,a,l,c,h),t=f[f.length-1]}return c}function dp(r,t,e,n){for(let i=0,s=e.length;i<s;++i)r[t++]=e[i];return t}function fl(r,t,e,n){for(let i=0,s=e.length;i<s;++i){const o=e[i];for(let a=0;a<n;++a)r[t++]=o[a]}return t}function oh(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=fl(r,t,e[o],n);i[s++]=l,t=l}return i.length=s,i}function fp(r,t,e,n,i){i=i||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=oh(r,t,e[o],n,i[s]);l.length===0&&(l[0]=t),i[s++]=l,t=l[l.length-1]}return i.length=s,i}function ah(r,t,e,n,i,s,o){const a=(e-t)/n;if(a<3){for(;t<e;t+=n)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[t,e-n];let h=0;for(;c.length>0;){const u=c.pop(),d=c.pop();let f=0;const p=r[d],m=r[d+1],I=r[u],x=r[u+1];for(let E=d+n;E<u;E+=n){const R=r[E],T=r[E+1],N=Z_(R,T,p,m,I,x);N>f&&(h=E,f=N)}f>i&&(l[(h-t)/n]=1,d+n<h&&c.push(d,h),h+n<u&&c.push(h,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=r[t+u*n],s[o++]=r[t+u*n+1]);return o}function mp(r,t,e,n,i,s,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l];o=ah(r,t,h,n,i,s,o),a.push(o),t=h}return o}function ws(r,t){return t*Math.round(r/t)}function _p(r,t,e,n,i,s,o){if(t==e)return o;let a=ws(r[t],i),l=ws(r[t+1],i);t+=n,s[o++]=a,s[o++]=l;let c,h;do if(c=ws(r[t],i),h=ws(r[t+1],i),t+=n,t==e)return s[o++]=c,s[o++]=h,o;while(c==a&&h==l);for(;t<e;){const u=ws(r[t],i),d=ws(r[t+1],i);if(t+=n,u==c&&d==h)continue;const f=c-a,p=h-l,m=u-a,I=d-l;if(f*I==p*m&&(f<0&&m<f||f==m||f>0&&m>f)&&(p<0&&I<p||p==I||p>0&&I>p)){c=u,h=d;continue}s[o++]=c,s[o++]=h,a=c,l=h,c=u,h=d}return s[o++]=c,s[o++]=h,o}function sd(r,t,e,n,i,s,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l];o=_p(r,t,h,n,i,s,o),a.push(o),t=h}return o}function pp(r,t,e,n,i,s,o,a){for(let l=0,c=e.length;l<c;++l){const h=e[l],u=[];o=sd(r,t,h,n,i,s,o,u),a.push(u),t=h[h.length-1]}return o}function is(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=t;o<e;o+=n)i[s++]=r.slice(o,o+n);return i.length=s,i}function ho(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=is(r,t,l,n,i[s]),t=l}return i.length=s,i}function wc(r,t,e,n,i){i=i!==void 0?i:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];i[s++]=l.length===1&&l[0]===t?[]:ho(r,t,l,n,i[s]),t=l[l.length-1]}return i.length=s,i}function rd(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=o*a-s*l,s=a,o=l}return i/2}function od(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=rd(r,t,a,n),t=a}return i}function yp(r,t,e,n){let i=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];i+=od(r,t,a,n),t=a[a.length-1]}return i}let xp=class Tc extends Hs{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Tc(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,i){return i<Zs(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,i))}getArea(){return rd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return is(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=ah(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Tc(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fl(this.flatCoordinates,0,t,this.stride),this.changed()}};const vr=xp;let Ep=class ad extends Hs{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ad(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){const s=this.flatCoordinates,o=As(t,e,s[0],s[1]);if(o<i){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}else return i}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return L_(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Kc(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=dp(this.flatCoordinates,0,t,this.stride),this.changed()}};const Fe=Ep;function Ip(r,t,e,n,i){return!Kg(i,function(o){return!Ls(r,t,e,n,o[0],o[1])})}function Ls(r,t,e,n,i,s){let o=0,a=r[e-n],l=r[e-n+1];for(;t<e;t+=n){const c=r[t],h=r[t+1];l<=s?h>s&&(c-a)*(s-l)-(i-a)*(h-l)>0&&o++:h<=s&&(c-a)*(s-l)-(i-a)*(h-l)<0&&o--,a=c,l=h}return o!==0}function lh(r,t,e,n,i,s){if(e.length===0||!Ls(r,t,e[0],n,i,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Ls(r,e[o-1],e[o],n,i,s))return!1;return!0}function Cp(r,t,e,n,i,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(lh(r,t,l,n,i,s))return!0;t=l[l.length-1]}return!1}function ld(r,t,e,n,i,s,o){let a,l,c,h,u,d,f;const p=i[s+1],m=[];for(let E=0,R=e.length;E<R;++E){const T=e[E];for(h=r[T-n],d=r[T-n+1],a=t;a<T;a+=n)u=r[a],f=r[a+1],(p<=d&&f<=p||d<=p&&p<=f)&&(c=(p-d)/(f-d)*(u-h)+h,m.push(c)),h=u,d=f}let I=NaN,x=-1/0;for(m.sort(Gs),h=m[0],a=1,l=m.length;a<l;++a){u=m[a];const E=Math.abs(u-h);E>x&&(c=(h+u)/2,lh(r,t,e,n,c,p)&&(I=c,x=E)),h=u}return isNaN(I)&&(I=i[s]),o?(o.push(I,p,x),o):[I,p,x]}function Rp(r,t,e,n,i){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=ld(r,t,l,n,i,2*o,s),t=l[l.length-1]}return s}function cd(r,t,e,n,i){let s;for(t+=n;t<e;t+=n)if(s=i(r.slice(t-n,t),r.slice(t,t+n)),s)return s;return!1}function ml(r,t,e,n,i){const s=qg(Tn(),r,t,e,n);return tn(i,s)?dr(i,s)||s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:cd(r,t,e,n,function(o,a){return O_(i,o,a)}):!1}function wp(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){if(ml(r,t,e[s],n,i))return!0;t=e[s]}return!1}function hd(r,t,e,n,i){return!!(ml(r,t,e,n,i)||Ls(r,t,e,n,i[0],i[1])||Ls(r,t,e,n,i[0],i[3])||Ls(r,t,e,n,i[2],i[1])||Ls(r,t,e,n,i[2],i[3]))}function ud(r,t,e,n,i){if(!hd(r,t,e[0],n,i))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(Ip(r,e[s-1],e[s],n,i)&&!ml(r,e[s-1],e[s],n,i))return!1;return!0}function Tp(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(ud(r,t,a,n,i))return!0;t=a[a.length-1]}return!1}function Np(r,t,e,n){for(;t<e-n;){for(let i=0;i<n;++i){const s=r[t+i];r[t+i]=r[e-n+i],r[e-n+i]=s}t+=n,e-=n}}function gd(r,t,e,n){let i=0,s=r[e-n],o=r[e-n+1];for(;t<e;t+=n){const a=r[t],l=r[t+1];i+=(a-s)*(l+o),s=a,o=l}return i===0?void 0:i>0}function dd(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=gd(r,t,a,n);if(s===0){if(i&&l||!i&&!l)return!1}else if(i&&!l||!i&&l)return!1;t=a}return!0}function Sp(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!dd(r,t,a,n,i))return!1;a.length&&(t=a[a.length-1])}return!0}function Nc(r,t,e,n,i){i=i!==void 0?i:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=gd(r,t,a,n);(s===0?i&&l||!i&&!l:i&&!l||!i&&l)&&Np(r,t,a,n),t=a}return t}function eg(r,t,e,n,i){for(let s=0,o=e.length;s<o;++s)t=Nc(r,t,e[s],n,i);return t}let fd=class Sc extends Hs{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Oi(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Sc(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zs(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ih(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),rh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return lh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return od(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Nc(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ho(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Ys(this.getExtent());this.flatInteriorPoint_=ld(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Fe(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new vr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],c=new vr(e.slice(s,l),t);i.push(c),s=l}return i}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;dd(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Nc(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=sd(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Sc(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return ud(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=oh(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}};const de=fd;function ng(r){const t=r[0],e=r[1],n=r[2],i=r[3],s=[t,e,t,i,n,i,n,e,t,e];return new fd(s,"XY",[s.length])}const os={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class ch{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new ch({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const us=ch;function md(r,t,e,n,i,s,o){let a,l;const c=(e-t)/n;if(c===1)a=t;else if(c===2)a=t,l=i;else if(c!==0){let h=r[t],u=r[t+1],d=0;const f=[0];for(let I=t+n;I<e;I+=n){const x=r[I],E=r[I+1];d+=Math.sqrt((x-h)*(x-h)+(E-u)*(E-u)),f.push(d),h=x,u=E}const p=i*d,m=l_(f,p);m<0?(l=(p-f[-m-2])/(f[-m-1]-f[-m-2]),a=t+(-m-2)*n):a=t+m*n}o=o>1?o:2,s=s||new Array(o);for(let h=0;h<o;++h)s[h]=a===void 0?NaN:l===void 0?r[a+h]:vi(r[a+h],r[a+n+h],l);return s}function Lc(r,t,e,n,i,s){if(e==t)return null;let o;if(i<r[t+n-1])return s?(o=r.slice(t,t+n),o[n-1]=i,o):null;if(r[e-1]<i)return s?(o=r.slice(e-n,e),o[n-1]=i,o):null;if(i==r[t+n-1])return r.slice(t,t+n);let a=t/n,l=e/n;for(;a<l;){const d=a+l>>1;i<r[(d+1)*n-1]?l=d:a=d+1}const c=r[a*n-1];if(i==c)return r.slice((a-1)*n,(a-1)*n+n);const h=r[(a+1)*n-1],u=(i-c)/(h-c);o=[];for(let d=0;d<n-1;++d)o.push(vi(r[(a-1)*n+d],r[a*n+d],u));return o.push(i),o}function Lp(r,t,e,n,i,s,o){if(o)return Lc(r,t,e[e.length-1],n,i,s);let a;if(i<r[n-1])return s?(a=r.slice(0,n),a[n-1]=i,a):null;if(r[r.length-1]<i)return s?(a=r.slice(r.length-n),a[n-1]=i,a):null;for(let l=0,c=e.length;l<c;++l){const h=e[l];if(t!=h){if(i<r[t+n-1])return null;if(i<=r[h-1])return Lc(r,t,h,n,i,!1);t=h}}return null}function _d(r,t,e,n){let i=r[t],s=r[t+1],o=0;for(let a=t+n;a<e;a+=n){const l=r[a],c=r[a+1];o+=Math.sqrt((l-i)*(l-i)+(c-s)*(c-s)),i=l,s=c}return o}let bp=class bc extends Hs{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){this.flatCoordinates?Oi(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new bc(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zs(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,i))}forEachSegment(t){return cd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Lc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return is(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return md(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return _d(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ah(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new bc(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ml(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fl(this.flatCoordinates,0,t,this.stride),this.changed()}};const Rn=bp;class hh{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new hh({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}const hs=hh,me={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ig(r){return r[0]>0&&r[1]>0}function vp(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function hn(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class uh{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=hn(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new uh({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return at()}getImage(t){return at()}getHitDetectionImage(){return at()}getPixelRatio(t){return 1}getImageState(){return at()}getImageSize(){return at()}getOrigin(){return at()}getSize(){return at()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=hn(t)}listenImageChange(t){at()}load(){at()}unlistenImageChange(t){at()}}const pd=uh,Mp=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Op=/^([a-z]*)$|^hsla?\(.*\)$/i;function yd(r){return typeof r=="string"?r:xd(r)}function Pp(r){const t=document.createElement("div");if(t.style.color=r,t.style.color!==""){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}else return""}const Ap=function(){const t={};let e=0;return function(n){let i;if(t.hasOwnProperty(n))i=t[n];else{if(e>=1024){let s=0;for(const o in t)s++&3||(delete t[o],--e)}i=Dp(n),t[n]=i,++e}return i}}();function Ma(r){return Array.isArray(r)?r:Ap(r)}function Dp(r){let t,e,n,i,s;if(Op.exec(r)&&(r=Pp(r)),Mp.exec(r)){const o=r.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;t=parseInt(r.substr(1+0*a,a),16),e=parseInt(r.substr(1+1*a,a),16),n=parseInt(r.substr(1+2*a,a),16),l?i=parseInt(r.substr(1+3*a,a),16):i=255,a==1&&(t=(t<<4)+t,e=(e<<4)+e,n=(n<<4)+n,l&&(i=(i<<4)+i)),s=[t,e,n,i/255]}else r.startsWith("rgba(")?(s=r.slice(5,-1).split(",").map(Number),sg(s)):r.startsWith("rgb(")?(s=r.slice(4,-1).split(",").map(Number),s.push(1),sg(s)):Et(!1,14);return s}function sg(r){return r[0]=ce(r[0]+.5|0,0,255),r[1]=ce(r[1]+.5|0,0,255),r[2]=ce(r[2]+.5|0,0,255),r[3]=ce(r[3],0,1),r}function xd(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);const i=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+t+","+e+","+n+","+i+")"}function oi(r){return Array.isArray(r)?xd(r):r}function fn(r,t,e,n){let i;return e&&e.length?i=e.shift():Hc?i=new OffscreenCanvas(r||300,t||300):i=document.createElement("canvas"),r&&(i.width=r),t&&(i.height=t),i.getContext("2d",n)}function Ed(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}function rg(r,t){const e=t.parentNode;e&&e.replaceChild(r,t)}function vc(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function Fp(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function Gp(r,t){const e=r.childNodes;for(let n=0;;++n){const i=e[n],s=t[n];if(!i&&!s)break;if(i!==s){if(!i){r.appendChild(s);continue}if(!s){r.removeChild(i),--n;continue}r.insertBefore(s,i)}}}const ha="ol-hidden",_l="ol-unselectable",gh="ol-control",og="ol-collapsed",kp=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),ag=["style","variant","weight","size","lineHeight","family"],Id=function(r){const t=r.match(kp);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,i=ag.length;n<i;++n){const s=t[n+1];s!==void 0&&(e[ag[n]]=s)}return e.families=e.family.split(/,\s?/),e},Cd="10px sans-serif",Ai="#000",Oa="round",uo=[],go=0,Mr="round",fo=10,mo="#000",_o="center",Pa="middle",bs=[0,0,0,0],po=1,Li=new mi;let cr=null,Mc;const Oc={},Yp=function(){const t="32px ",e=["monospace","serif"],n=e.length,i="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(c,h,u){let d=!0;for(let f=0;f<n;++f){const p=e[f];if(o=Aa(c+" "+h+" "+t+p,i),u!=p){const m=Aa(c+" "+h+" "+t+u+","+p,i);d=d&&m!=o}}return!!d}function l(){let c=!0;const h=Li.getKeys();for(let u=0,d=h.length;u<d;++u){const f=h[u];Li.get(f)<100&&(a.apply(this,f.split(`
`))?(Po(Oc),cr=null,Mc=void 0,Li.set(f,100)):(Li.set(f,Li.get(f)+1,!0),c=!1))}c&&(clearInterval(s),s=void 0)}return function(c){const h=Id(c);if(!h)return;const u=h.families;for(let d=0,f=u.length;d<f;++d){const p=u[d],m=h.style+`
`+h.weight+`
`+p;Li.get(m)===void 0&&(Li.set(m,100,!0),a(h.style,h.weight,p)||(Li.set(m,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),zp=function(){let r;return function(t){let e=Oc[t];if(e==null){if(Hc){const n=Id(t),i=Rd(t,"g");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);Oc[t]=e}return e}}();function Rd(r,t){return cr||(cr=fn(1,1)),r!=Mc&&(cr.font=r,Mc=cr.font),cr.measureText(t)}function Aa(r,t){return Rd(r,t).width}function lg(r,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((i,s)=>Math.max(i,Aa(r,s)),0);return e[t]=n,n}function Xp(r,t){const e=[],n=[],i=[];let s=0,o=0,a=0,l=0;for(let c=0,h=t.length;c<=h;c+=2){const u=t[c];if(u===`
`||c===h){s=Math.max(s,o),i.push(o),o=0,a+=l;continue}const d=t[c+1]||r.font,f=Aa(d,u);e.push(f),o+=f;const p=zp(d);n.push(p),l=Math.max(l,p)}return{width:s,height:a,widths:e,heights:n,lineWidths:i}}function Wp(r,t,e,n,i,s,o,a,l,c,h){r.save(),e!==1&&(r.globalAlpha*=e),t&&r.setTransform.apply(r,t),n.contextInstructions?(r.translate(l,c),r.scale(h[0],h[1]),Bp(n,r)):h[0]<0||h[1]<0?(r.translate(l,c),r.scale(h[0],h[1]),r.drawImage(n,i,s,o,a,0,0,o,a)):r.drawImage(n,i,s,o,a,l,c,o*h[0],a*h[1]),r.restore()}function Bp(r,t){const e=r.contextInstructions;for(let n=0,i=e.length;n<i;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class dh extends pd{constructor(t){const e=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:e,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new dh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const n=this.renderOptions_,i=fn(n.size*t,n.size*t);this.draw_(n,i,t),e=i.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return me.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let i=this.radius_,s=this.radius2_===void 0?i:this.radius2_;if(i<s){const S=i;i=s,s=S}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),c=Math.sqrt(s*s-l*l),h=i-c,u=Math.sqrt(l*l+h*h),d=u/l;if(t==="miter"&&d<=n)return d*e;const f=e/2/d,p=e/2*(h/u),I=Math.sqrt((i+f)*(i+f)+p*p)-i;if(this.radius2_===void 0||t==="bevel")return I*2;const x=i*Math.sin(a),E=Math.sqrt(i*i-x*x),R=s-E,N=Math.sqrt(x*x+R*R)/x;if(N<=n){const S=N*e/2-s-i;return 2*Math.max(I,S)}return I*2}createRenderOptions(){let t=Mr,e=0,n=null,i=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=mo),s=oi(s),o=this.stroke_.getWidth(),o===void 0&&(o=po),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=Mr),e=this.stroke_.getMiterLimit(),e===void 0&&(e=fo));const a=this.calculateLineJoinSize_(t,o,e),l=Math.max(this.radius_,this.radius2_||0),c=Math.ceil(2*l+a);return{strokeStyle:s,strokeWidth:o,size:c,lineDash:n,lineDashOffset:i,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let i=this.fill_.getColor();i===null&&(i=Ai),e.fillStyle=oi(i),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),n=0;if(typeof e=="string"&&(e=Ma(e)),e===null?n=1:Array.isArray(e)&&(n=e.length===4?e[3]:1),n===0){const i=fn(t.size,t.size);this.hitDetectionCanvas_=i.canvas,this.drawHitDetectionCanvas_(t,i)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const i=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,c=a%2===0?n:i;t.lineTo(c*Math.cos(l),c*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Ai,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}const fh=dh;class mh extends fh{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new mh({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const wd=mh;class pl{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=cg,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new pl({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=cg,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function jp(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(Et(typeof r.getZIndex=="function",41),e=[r]),t=function(){return e}}return t}let Ql=null;function Zp(r,t){if(!Ql){const e=new us({color:"rgba(255,255,255,0.4)"}),n=new hs({color:"#3399CC",width:1.25});Ql=[new pl({image:new wd({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return Ql}function cg(r){return r.getGeometry()}const Xn=pl,Up="#333";let Hp=class Td{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=hn(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new us({color:Up}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new Td({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=hn(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}};const Nd=Hp,Dt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Vp extends mi{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Dt.OPACITY]=t.opacity!==void 0?t.opacity:1,Et(typeof e[Dt.OPACITY]=="number",64),e[Dt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Dt.Z_INDEX]=t.zIndex,e[Dt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Dt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Dt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Dt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=ce(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return at()}getLayerStatesArray(t){return at()}getExtent(){return this.get(Dt.EXTENT)}getMaxResolution(){return this.get(Dt.MAX_RESOLUTION)}getMinResolution(){return this.get(Dt.MIN_RESOLUTION)}getMinZoom(){return this.get(Dt.MIN_ZOOM)}getMaxZoom(){return this.get(Dt.MAX_ZOOM)}getOpacity(){return this.get(Dt.OPACITY)}getSourceState(){return at()}getVisible(){return this.get(Dt.VISIBLE)}getZIndex(){return this.get(Dt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Dt.EXTENT,t)}setMaxResolution(t){this.set(Dt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Dt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Dt.MAX_ZOOM,t)}setMinZoom(t){this.set(Dt.MIN_ZOOM,t)}setOpacity(t){Et(typeof t=="number",64),this.set(Dt.OPACITY,t)}setVisible(t){this.set(Dt.VISIBLE,t)}setZIndex(t){this.set(Dt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Sd=Vp;class qp extends Sd{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Dt.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Dt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Zt(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=wt(t,ft.CHANGE,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}render(t,e){const n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(Dt.MAP,t)}getMapInternal(){return this.get(Dt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Zt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Zt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=wt(t,os.PRECOMPOSE,function(e){const i=e.frameState.layerStatesArray,s=this.getLayerState(!1);Et(!i.some(function(o){return o.layer===s.layer}),67),i.push(s)},this),this.mapRenderKey_=wt(this,ft.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Dt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function _h(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}const Fo=qp;function Kp(r,t,e,n,i){Ld(r,t,e||0,n||r.length-1,i||Jp)}function Ld(r,t,e,n,i){for(;n>e;){if(n-e>600){var s=n-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),h=Math.max(e,Math.floor(t-o*l/s+c)),u=Math.min(n,Math.floor(t+(s-o)*l/s+c));Ld(r,t,h,u,i)}var d=r[t],f=e,p=n;for(qr(r,e,t),i(r[n],d)>0&&qr(r,e,n);f<p;){for(qr(r,f,p),f++,p--;i(r[f],d)<0;)f++;for(;i(r[p],d)>0;)p--}i(r[e],d)===0?qr(r,e,p):(p++,qr(r,p,n)),p<=t&&(e=p+1),t<=p&&(n=p-1)}}function qr(r,t,e){var n=r[t];r[t]=r[e],r[e]=n}function Jp(r,t){return r<t?-1:r>t?1:0}let bd=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!ga(t,e))return n;const i=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?i(a):a;ga(t,l)&&(e.leaf?n.push(a):ec(t,l)?this._all(a,n):s.push(a))}e=s.pop()}return n}collides(t){let e=this.data;if(!ga(t,e))return!1;const n=[];for(;e;){for(let i=0;i<e.children.length;i++){const s=e.children[i],o=e.leaf?this.toBBox(s):s;if(ga(t,o)){if(e.leaf||ec(t,o))return!0;n.push(s)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=hr([]),this}remove(t,e){if(!t)return this;let n=this.data;const i=this.toBBox(t),s=[],o=[];let a,l,c;for(;n||s.length;){if(n||(n=s.pop(),l=s[s.length-1],a=o.pop(),c=!0),n.leaf){const h=$p(t,n.children,e);if(h!==-1)return n.children.splice(h,1),s.push(n),this._condense(s),this}!c&&!n.leaf&&ec(n,i)?(s.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],c=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,i){const s=n-e+1;let o=this._maxEntries,a;if(s<=o)return a=hr(t.slice(e,n+1)),rr(a,this.toBBox),a;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),a=hr([]),a.leaf=!1,a.height=i;const l=Math.ceil(s/o),c=l*Math.ceil(Math.sqrt(o));hg(t,e,n,c,this.compareMinX);for(let h=e;h<=n;h+=c){const u=Math.min(h+c-1,n);hg(t,h,u,l,this.compareMinY);for(let d=h;d<=u;d+=l){const f=Math.min(d+l-1,u);a.children.push(this._build(t,d,f,i-1))}}return rr(a,this.toBBox),a}_chooseSubtree(t,e,n,i){for(;i.push(e),!(e.leaf||i.length-1===n);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const c=e.children[l],h=tc(c),u=ey(t,c)-h;u<o?(o=u,s=h<s?h:s,a=c):u===o&&h<s&&(s=h,a=c)}e=a||e.children[0]}return e}_insert(t,e,n){const i=n?t:this.toBBox(t),s=[],o=this._chooseSubtree(i,this.data,e,s);for(o.children.push(t),to(o,i);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(i,s,e)}_split(t,e){const n=t[e],i=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,i);const o=this._chooseSplitIndex(n,s,i),a=hr(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,rr(n,this.toBBox),rr(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,e){this.data=hr([t,e]),this.data.height=t.height+1,this.data.leaf=!1,rr(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let i,s=1/0,o=1/0;for(let a=e;a<=n-e;a++){const l=Qr(t,0,a,this.toBBox),c=Qr(t,a,n,this.toBBox),h=ny(l,c),u=tc(l)+tc(c);h<s?(s=h,i=a,o=u<o?u:o):h===s&&u<o&&(o=u,i=a)}return i||n-e}_chooseSplitAxis(t,e,n){const i=t.leaf?this.compareMinX:Qp,s=t.leaf?this.compareMinY:ty,o=this._allDistMargin(t,e,n,i),a=this._allDistMargin(t,e,n,s);o<a&&t.children.sort(i)}_allDistMargin(t,e,n,i){t.children.sort(i);const s=this.toBBox,o=Qr(t,0,e,s),a=Qr(t,n-e,n,s);let l=ua(o)+ua(a);for(let c=e;c<n-e;c++){const h=t.children[c];to(o,t.leaf?s(h):h),l+=ua(o)}for(let c=n-e-1;c>=e;c--){const h=t.children[c];to(a,t.leaf?s(h):h),l+=ua(a)}return l}_adjustParentBBoxes(t,e,n){for(let i=n;i>=0;i--)to(e[i],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():rr(t[e],this.toBBox)}};function $p(r,t,e){if(!e)return t.indexOf(r);for(let n=0;n<t.length;n++)if(e(r,t[n]))return n;return-1}function rr(r,t){Qr(r,0,r.children.length,t,r)}function Qr(r,t,e,n,i){i||(i=hr(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<e;s++){const o=r.children[s];to(i,r.leaf?n(o):o)}return i}function to(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function Qp(r,t){return r.minX-t.minX}function ty(r,t){return r.minY-t.minY}function tc(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function ua(r){return r.maxX-r.minX+(r.maxY-r.minY)}function ey(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function ny(r,t){const e=Math.max(r.minX,t.minX),n=Math.max(r.minY,t.minY),i=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,s-n)}function ec(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function ga(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function hr(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hg(r,t,e,n,i){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=n)continue;const o=t+Math.ceil((e-t)/n/2)*n;Kp(r,o,t,e,i),s.push(t,o,o,e)}}class iy{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];!(t++&3)&&!n.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,n){const i=ug(t,e,n);return i in this.cache_?this.cache_[i]:null}set(t,e,n,i){const s=ug(t,e,n);this.cache_[s]=i,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function ug(r,t,e){const n=e?yd(e):"null";return t+":"+r+":"+n}const Da=new iy;function vd(r,t,e){const n=r;let i=!0,s=!1,o=!1;const a=[Sa(n,ft.LOAD,function(){o=!0,s||t()})];return n.src&&C_?(s=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(o?t():e())})):a.push(Sa(n,ft.ERROR,e)),function(){i=!1,a.forEach(Zt)}}let Kr=null;class sy extends al{constructor(t,e,n,i,s,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=s,this.size_=n,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===me.LOADED){Kr||(Kr=fn(1,1)),Kr.drawImage(this.image_,0,0);try{Kr.getImageData(0,0,1,1),this.tainted_=!1}catch{Kr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ft.CHANGE)}handleImageError_(){this.imageState_=me.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=me.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=fn(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===me.IDLE){this.image_||this.initializeImage_(),this.imageState_=me.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=vd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==me.LOADED)return;const e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*t),n.height=Math.ceil(e.height*t);const i=n.getContext("2d");i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=yd(this.color_),i.fillRect(0,0,n.width/t,n.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=n}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function ry(r,t,e,n,i,s){let o=Da.get(t,n,s);return o||(o=new sy(r,t,e,n,i,s),Da.set(t,n,s,o)),o}class ph extends pd{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,i=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:i,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let a=t.src;Et(!(a!==void 0&&o),4),Et(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||bt(o)),Et(a!==void 0&&a.length>0,6);const l=t.src!==void 0?me.IDLE:me.LOADED;this.color_=t.color!==void 0?Ma(t.color):null,this.iconImage_=ry(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null}clone(){const t=this.getScale();return new ph({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const i=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=i[0]),this.anchorYUnits_=="fraction"&&(t[1]*=i[1])}if(this.anchorOrigin_!="top-left"){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+i[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+i[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(ft.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(ft.CHANGE,t)}}const Go=ph;function gg(r){return new Xn({fill:yo(r,""),stroke:xo(r,""),text:oy(r),image:ay(r)})}function yo(r,t){const e=r[t+"fill-color"];if(e)return new us({color:e})}function xo(r,t){const e=r[t+"stroke-width"],n=r[t+"stroke-color"];if(!(!e&&!n))return new hs({width:e,color:n,lineCap:r[t+"stroke-line-cap"],lineJoin:r[t+"stroke-line-join"],lineDash:r[t+"stroke-line-dash"],lineDashOffset:r[t+"stroke-line-dash-offset"],miterLimit:r[t+"stroke-miter-limit"]})}function oy(r){const t=r["text-value"];return t?new Nd({text:t,font:r["text-font"],maxAngle:r["text-max-angle"],offsetX:r["text-offset-x"],offsetY:r["text-offset-y"],overflow:r["text-overflow"],placement:r["text-placement"],scale:r["text-scale"],rotateWithView:r["text-rotate-with-view"],rotation:r["text-rotation"],textAlign:r["text-align"],justify:r["text-justify"],textBaseline:r["text-baseline"],padding:r["text-padding"],fill:yo(r,"text-"),backgroundFill:yo(r,"text-background-"),stroke:xo(r,"text-"),backgroundStroke:xo(r,"text-background-")}):void 0}function ay(r){const t=r["icon-src"],e=r["icon-img"];if(t||e)return new Go({src:t,img:e,imgSize:r["icon-img-size"],anchor:r["icon-anchor"],anchorOrigin:r["icon-anchor-origin"],anchorXUnits:r["icon-anchor-x-units"],anchorYUnits:r["icon-anchor-y-units"],color:r["icon-color"],crossOrigin:r["icon-cross-origin"],offset:r["icon-offset"],displacement:r["icon-displacement"],opacity:r["icon-opacity"],scale:r["icon-scale"],rotation:r["icon-rotation"],rotateWithView:r["icon-rotate-with-view"],size:r["icon-size"],declutterMode:r["icon-declutter-mode"]});const n=r["shape-points"];if(n){const s="shape-";return new fh({points:n,fill:yo(r,s),stroke:xo(r,s),radius:r["shape-radius"],radius1:r["shape-radius1"],radius2:r["shape-radius2"],angle:r["shape-angle"],displacement:r["shape-displacement"],rotation:r["shape-rotation"],rotateWithView:r["shape-rotate-with-view"],scale:r["shape-scale"],declutterMode:r["shape-declutter-mode"]})}const i=r["circle-radius"];if(i){const s="circle-";return new wd({radius:i,fill:yo(r,s),stroke:xo(r,s),displacement:r["circle-displacement"],scale:r["circle-scale"],rotation:r["circle-rotation"],rotateWithView:r["circle-rotate-with-view"],declutterMode:r["circle-declutter-mode"]})}}const dg={RENDER_ORDER:"renderOrder"};class ly extends Fo{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter!==void 0?t.declutter:!1,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(dg.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new bd(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(dg.RENDER_ORDER,t)}setStyle(t){let e;if(t===void 0)e=Zp;else if(t===null)e=null;else if(typeof t=="function")e=t;else if(t instanceof Xn)e=t;else if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let s=0;s<n;++s){const o=t[s];o instanceof Xn?i[s]=o:i[s]=gg(o)}e=i}else e=gg(t);this.style_=e,this.styleFunction_=t===null?void 0:jp(this.style_),this.changed()}}const cy=ly,ko={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},da=[ko.FILL],ss=[ko.STROKE],vs=[ko.BEGIN_PATH],fg=[ko.CLOSE_PATH],rt=ko;class hy{drawCustom(t,e,n,i){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const Md=hy;class uy extends Md{constructor(t,e,n,i){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)i[0]=t[a],i[1]=t[a+1],cl(n,i)&&(s[o++]=i[0],s[o++]=i[1]);return o}appendFlatLineCoordinates(t,e,n,i,s,o){const a=this.coordinates;let l=a.length;const c=this.getBufferedMaxExtent();o&&(e+=i);let h=t[e],u=t[e+1];const d=this.tmpCoordinate_;let f=!0,p,m,I;for(p=e+i;p<n;p+=i)d[0]=t[p],d[1]=t[p+1],I=pc(c,d),I!==m?(f&&(a[l++]=h,a[l++]=u,f=!1),a[l++]=d[0],a[l++]=d[1]):I===Ee.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,h=d[0],u=d[1],m=I;return(s&&f||p===e+i)&&(a[l++]=h,a[l++]=u),l}drawCustomCoordinates_(t,e,n,i,s){for(let o=0,a=n.length;o<a;++o){const l=n[o],c=this.appendFlatLineCoordinates(t,e,l,i,!1,!1);s.push(c),e=l}return e}drawCustom(t,e,n,i){this.beginGeometry(t,e);const s=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,c,h,u,d;switch(s){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),u=[];const f=t.getEndss();d=0;for(let p=0,m=f.length;p<m;++p){const I=[];d=this.drawCustomCoordinates_(l,d,f[p],o,I),u.push(I)}this.instructions.push([rt.CUSTOM,a,u,t,n,wc]),this.hitDetectionInstructions.push([rt.CUSTOM,a,u,t,i||n,wc]);break;case"Polygon":case"MultiLineString":h=[],l=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,t.getEnds(),o,h),this.instructions.push([rt.CUSTOM,a,h,t,n,ho]),this.hitDetectionInstructions.push([rt.CUSTOM,a,h,t,i||n,ho]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([rt.CUSTOM,a,c,t,n,is]),this.hitDetectionInstructions.push([rt.CUSTOM,a,c,t,i||n,is]);break;case"MultiPoint":l=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(l,o),c>a&&(this.instructions.push([rt.CUSTOM,a,c,t,n,is]),this.hitDetectionInstructions.push([rt.CUSTOM,a,c,t,i||n,is]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),c=this.coordinates.length,this.instructions.push([rt.CUSTOM,a,c,t,n]),this.hitDetectionInstructions.push([rt.CUSTOM,a,c,t,i||n]);break}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[rt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[rt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let i,s,o=-1;for(e=0;e<n;++e)i=t[e],s=i[0],s==rt.END_GEOMETRY?o=e:s==rt.BEGIN_GEOMETRY&&(i[2]=e,c_(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const n=this.state;if(t){const i=t.getColor();n.fillStyle=oi(i||Ai)}else n.fillStyle=void 0;if(e){const i=e.getColor();n.strokeStyle=oi(i||mo);const s=e.getLineCap();n.lineCap=s!==void 0?s:Oa;const o=e.getLineDash();n.lineDash=o?o.slice():uo;const a=e.getLineDashOffset();n.lineDashOffset=a||go;const l=e.getLineJoin();n.lineJoin=l!==void 0?l:Mr;const c=e.getWidth();n.lineWidth=c!==void 0?c:po;const h=e.getMiterLimit();n.miterLimit=h!==void 0?h:fo,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(t){const e=t.fillStyle,n=[rt.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(!0),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[rt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,i=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=i||s!=t.currentLineDash&&!js(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=i,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[rt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ug(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;qc(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const Yo=uy;class gy extends Yo{constructor(t,e,n,i){super(t,e,n,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const n=t.getFlatCoordinates(),i=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,i);this.instructions.push([rt.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const n=t.getFlatCoordinates(),i=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(n,i);this.instructions.push([rt.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),i=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const dy=gy;class fy extends Yo{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinates_(t,e,n,i){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,n,i,!1,!1),a=[rt.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(t,e){const n=this.state,i=n.strokeStyle,s=n.lineWidth;if(i===void 0||s===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,uo,go],vs);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ss),this.endGeometry(e)}drawMultiLineString(t,e){const n=this.state,i=n.strokeStyle,s=n.lineWidth;if(i===void 0||s===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],vs);const o=t.getEnds(),a=t.getFlatCoordinates(),l=t.getStride();let c=0;for(let h=0,u=o.length;h<u;++h)c=this.drawFlatCoordinates_(a,c,o[h],l);this.hitDetectionInstructions.push(ss),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ss),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ss),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(vs)}}const my=fy;class _y extends Yo{constructor(t,e,n,i){super(t,e,n,i)}drawFlatCoordinatess_(t,e,n,i){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=n.length;this.instructions.push(vs),this.hitDetectionInstructions.push(vs);for(let c=0;c<l;++c){const h=n[c],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,h,i,!0,!a),f=[rt.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(fg),this.hitDetectionInstructions.push(fg)),e=h}return o&&(this.instructions.push(da),this.hitDetectionInstructions.push(da)),a&&(this.instructions.push(ss),this.hitDetectionInstructions.push(ss)),e}drawCircle(t,e){const n=this.state,i=n.fillStyle,s=n.strokeStyle;if(i===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Ai]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const c=[rt.CIRCLE,l];this.instructions.push(vs,c),this.hitDetectionInstructions.push(vs,c),n.fillStyle!==void 0&&(this.instructions.push(da),this.hitDetectionInstructions.push(da)),n.strokeStyle!==void 0&&(this.instructions.push(ss),this.hitDetectionInstructions.push(ss)),this.endGeometry(e)}drawPolygon(t,e){const n=this.state,i=n.fillStyle,s=n.strokeStyle;if(i===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Ai]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e){const n=this.state,i=n.fillStyle,s=n.strokeStyle;if(i===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,Ai]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let c=0;for(let h=0,u=o.length;h<u;++h)c=this.drawFlatCoordinatess_(a,c,o[h],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,i=e.length;n<i;++n)e[n]=ws(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const mg=_y;function py(r,t,e,n,i){let s=e,o=e,a=0,l=0,c=e,h,u,d,f,p,m,I,x,E,R;for(u=e;u<n;u+=i){const T=t[u],N=t[u+1];p!==void 0&&(E=T-p,R=N-m,f=Math.sqrt(E*E+R*R),I!==void 0&&(l+=d,h=Math.acos((I*E+x*R)/(d*f)),h>r&&(l>a&&(a=l,s=c,o=u),l=0,c=u-i)),d=f,I=E,x=R),p=T,m=N}return l+=f,l>a?[c,u]:[s,o]}const io={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class yy extends Yo{constructor(t,e,n,i){super(t,e,n,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const n=this.textFillState_,i=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!n&&!i)return;const o=this.coordinates;let a=o.length;const l=t.getType();let c=null,h=t.getStride();if(s.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!tn(this.getBufferedMaxExtent(),t.getExtent()))return;let u;if(c=t.getFlatCoordinates(),l=="LineString")u=[c.length];else if(l=="MultiLineString")u=t.getEnds();else if(l=="Polygon")u=t.getEnds().slice(0,1);else if(l=="MultiPolygon"){const m=t.getEndss();u=[];for(let I=0,x=m.length;I<x;++I)u.push(m[I][0])}this.beginGeometry(t,e);const d=s.textAlign;let f=0,p;for(let m=0,I=u.length;m<I;++m){if(d==null){const E=py(s.maxAngle,c,f,u[m],h);f=E[0],p=E[1]}else p=u[m];for(let E=f;E<p;E+=h)o.push(c[E],c[E+1]);const x=o.length;f=u[m],this.drawChars_(a,x),a=x}this.endGeometry(e)}else{let u=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),h=2;break;case"Polygon":c=t.getFlatInteriorPoint(),s.overflow||u.push(c[2]/this.resolution),h=3;break;case"MultiPolygon":const I=t.getFlatInteriorPoints();c=[];for(let x=0,E=I.length;x<E;x+=3)s.overflow||u.push(I[x+2]/this.resolution),c.push(I[x],I[x+1]);if(c.length===0)return;h=2;break}const d=this.appendFlatPointCoordinates(c,h);if(d===a)return;if(u&&(d-a)/2!==c.length/h){let I=a/2;u=u.filter((x,E)=>{const R=o[(I+E)*2]===c[E*h]&&o[(I+E)*2+1]===c[E*h+1];return R||--I,R})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let f=s.padding;if(f!=bs&&(s.scale[0]<0||s.scale[1]<0)){let I=s.padding[0],x=s.padding[1],E=s.padding[2],R=s.padding[3];s.scale[0]<0&&(x=-x,R=-R),s.scale[1]<0&&(I=-I,E=-E),f=[I,x,E,R]}const p=this.pixelRatio;this.instructions.push([rt.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,f==bs?bs:f.map(function(I){return I*p}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const m=1/p;this.hitDetectionInstructions.push([rt.DRAW_IMAGE,a,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[m,m],NaN,void 0,this.declutterImageWithText_,f,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||_o,justify:e.justify,textBaseline:e.textBaseline||Pa,scale:e.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,i=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,c=io[i.textBaseline],h=this.textOffsetY_*l,u=this.text_,d=n?n.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([rt.DRAW_CHARS,t,e,c,i.overflow,a,i.maxAngle,l,h,s,d*l,u,o,1]),this.hitDetectionInstructions.push([rt.DRAW_CHARS,t,e,c,i.overflow,a,i.maxAngle,1,h,s,d,u,o,1/l])}setTextStyle(t,e){let n,i,s;if(!t)this.text_="";else{const o=t.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=oi(o.getColor()||Ai)):(i=null,this.textFillState_=i);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const p=a.getLineDash(),m=a.getLineDashOffset(),I=a.getWidth(),x=a.getMiterLimit();s.lineCap=a.getLineCap()||Oa,s.lineDash=p?p.slice():uo,s.lineDashOffset=m===void 0?go:m,s.lineJoin=a.getLineJoin()||Mr,s.lineWidth=I===void 0?po:I,s.miterLimit=x===void 0?fo:x,s.strokeStyle=oi(a.getColor()||mo)}n=this.textState_;const l=t.getFont()||Cd;Yp(l);const c=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||Pa,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||bs,n.scale=c===void 0?[1,1]:c;const h=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:bt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=i?typeof i.fillStyle=="string"?i.fillStyle:"|"+bt(i.fillStyle):""}this.declutterImageWithText_=e}}const xy={Circle:mg,Default:Yo,Image:dy,LineString:my,Polygon:mg,Text:yy};class Ey{constructor(t,e,n,i){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const i in n){const s=n[i].finish();t[e][i]=s}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let i=this.buildersByZIndex_[n];i===void 0&&(i={},this.buildersByZIndex_[n]=i);let s=i[e];if(s===void 0){const o=xy[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=s}return s}}const _g=Ey;class Iy extends Wg{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return at()}getData(t){return null}prepareFrame(t){return at()}renderFrame(t,e){return at()}loadedTileCallback(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n}createLoadedTileFinder(t,e,n){return function(i,s){const o=this.loadedTileCallback.bind(this,n,i);return t.forEachLoadedTile(e,i,s,o)}.bind(this)}forEachFeatureAtCoordinate(t,e,n,i,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===me.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=me.LOADED&&e!=me.ERROR&&t.addEventListener(ft.CHANGE,this.boundHandleImageChange_),e==me.IDLE&&(t.load(),e=t.getState()),e==me.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Od=Iy;class Cy extends Yi{constructor(t,e,n,i){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=i}}const Pd=Cy,pg=[];let ur=null;function Ry(){const r=document.createElement("canvas");r.width=1,r.height=1,ur=r.getContext("2d")}class wy extends Od{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=kn(),this.pixelTransform=kn(),this.inversePixelTransform=kn(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){ur||Ry(),ur.clearRect(0,0,1,1);let i;try{ur.drawImage(t,e,n,1,1,0,0,1,1),i=ur.getImageData(0,0,1,1).data}catch{return ur=null,null}return i}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const i=this.getLayer().getClassName();let s,o;if(t&&t.className===i&&(!n||t&&t.style.backgroundColor&&js(Ma(t.style.backgroundColor),Ma(n)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement("div"),s.className=i;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=fn();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const i=Us(n),s=gl(n),o=ul(n),a=hl(n);ue(e.coordinateToPixelTransform,i),ue(e.coordinateToPixelTransform,s),ue(e.coordinateToPixelTransform,o),ue(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;ue(l,i),ue(l,s),ue(l,o),ue(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,n){const i=this.getLayer();if(i.hasListener(t)){const s=new Pd(t,this.inversePixelTransform,n,e);i.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(os.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(os.POSTRENDER,t,e)}getRenderTransform(t,e,n,i,s,o,a){const l=s/2,c=o/2,h=i/e,u=-h,d=-t[0]+a,f=-t[1];return Di(this.tempTransform,l,c,h,u,-n,d,f)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const Ad=wy;function Ty(r,t,e,n,i,s,o,a,l,c,h,u){let d=r[t],f=r[t+1],p=0,m=0,I=0,x=0;function E(){p=d,m=f,t+=n,d=r[t],f=r[t+1],x+=I,I=Math.sqrt((d-p)*(d-p)+(f-m)*(f-m))}do E();while(t<e-n&&x+I<s);let R=I===0?0:(s-x)/I;const T=vi(p,d,R),N=vi(m,f,R),S=t-n,M=x,L=s+a*l(c,i,h);for(;t<e-n&&x+I<L;)E();R=I===0?0:(L-x)/I;const D=vi(p,d,R),Y=vi(m,f,R);let W;if(u){const V=[T,N,D,Y];nd(V,0,4,2,u,V,V),W=V[0]>V[2]}else W=T>D;const B=Math.PI,$=[],it=S+n===t;t=S,I=0,x=M,d=r[t],f=r[t+1];let Z;if(it){E(),Z=Math.atan2(f-m,d-p),W&&(Z+=Z>0?-B:B);const V=(D+T)/2,X=(Y+N)/2;return $[0]=[V,X,(L-s)/2,Z,i],$}i=i.replace(/\n/g," ");for(let V=0,X=i.length;V<X;){E();let st=Math.atan2(f-m,d-p);if(W&&(st+=st>0?-B:B),Z!==void 0){let ot=st-Z;if(ot+=ot>B?-2*B:ot<-B?2*B:0,Math.abs(ot)>o)return null}Z=st;const xt=V;let _t=0;for(;V<X;++V){const ot=W?X-V-1:V,ut=a*l(c,i[ot],h);if(t+n<e&&x+I<s+_t+ut/2)break;_t+=ut}if(V===xt)continue;const Mt=W?i.substring(X-xt,X-V):i.substring(xt,V);R=I===0?0:(s+_t/2-x)/I;const k=vi(p,d,R),ke=vi(m,f,R);$.push([k,ke,_t/2,st,Mt]),s+=_t}return $}const or=Tn(),ji=[],Ti=[],Ni=[],Zi=[];function yg(r){return r[3].declutterBox}const Ny=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function xg(r,t){return(t==="start"||t==="end")&&!Ny.test(r)&&(t=t==="start"?"left":"right"),io[t]}function Sy(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class Ly{constructor(t,e,n,i){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=kn(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,n,i){const s=t+e+n+i;if(this.labels_[s])return this.labels_[s];const o=i?this.strokeStates[i]:null,a=n?this.fillStates[n]:null,l=this.textStates[e],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],u=Array.isArray(t),d=l.justify?io[l.justify]:xg(Array.isArray(t)?t[0]:t,l.textAlign||_o),f=i&&o.lineWidth?o.lineWidth:0,p=u?t:t.split(`
`).reduce(Sy,[]),{width:m,height:I,widths:x,heights:E,lineWidths:R}=Xp(l,p),T=m+f,N=[],S=(T+2)*h[0],M=(I+f)*h[1],L={width:S<0?Math.floor(S):Math.ceil(S),height:M<0?Math.floor(M):Math.ceil(M),contextInstructions:N};(h[0]!=1||h[1]!=1)&&N.push("scale",h),i&&(N.push("strokeStyle",o.strokeStyle),N.push("lineWidth",f),N.push("lineCap",o.lineCap),N.push("lineJoin",o.lineJoin),N.push("miterLimit",o.miterLimit),N.push("setLineDash",[o.lineDash]),N.push("lineDashOffset",o.lineDashOffset)),n&&N.push("fillStyle",a.fillStyle),N.push("textBaseline","middle"),N.push("textAlign","center");const D=.5-d;let Y=d*T+D*f;const W=[],B=[];let $=0,it=0,Z=0,V=0,X;for(let st=0,xt=p.length;st<xt;st+=2){const _t=p[st];if(_t===`
`){it+=$,$=0,Y=d*T+D*f,++V;continue}const Mt=p[st+1]||l.font;Mt!==X&&(i&&W.push("font",Mt),n&&B.push("font",Mt),X=Mt),$=Math.max($,E[Z]);const k=[_t,Y+D*x[Z]+d*(x[Z]-R[V]),.5*(f+$)+it];Y+=x[Z],i&&W.push("strokeText",k),n&&B.push("fillText",k),++Z}return Array.prototype.push.apply(N,W),Array.prototype.push.apply(N,B),this.labels_[s]=L,L}replayTextBackground_(t,e,n,i,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,i,s,o,a,l,c,h,u,d,f,p,m,I){a*=d[0],l*=d[1];let x=n-a,E=i-l;const R=s+c>t?t-c:s,T=o+h>e?e-h:o,N=p[3]+R*d[0]+p[1],S=p[0]+T*d[1]+p[2],M=x-p[3],L=E-p[0];(m||u!==0)&&(ji[0]=M,Zi[0]=M,ji[1]=L,Ti[1]=L,Ti[0]=M+N,Ni[0]=Ti[0],Ni[1]=L+S,Zi[1]=Ni[1]);let D;return u!==0?(D=Di(kn(),n,i,1,1,u,-n,-i),ue(D,ji),ue(D,Ti),ue(D,Ni),ue(D,Zi),gi(Math.min(ji[0],Ti[0],Ni[0],Zi[0]),Math.min(ji[1],Ti[1],Ni[1],Zi[1]),Math.max(ji[0],Ti[0],Ni[0],Zi[0]),Math.max(ji[1],Ti[1],Ni[1],Zi[1]),or)):gi(Math.min(M,M+N),Math.min(L,L+S),Math.max(M,M+N),Math.max(L,L+S),or),f&&(x=Math.round(x),E=Math.round(E)),{drawImageX:x,drawImageY:E,drawImageW:R,drawImageH:T,originX:c,originY:h,declutterBox:{minX:or[0],minY:or[1],maxX:or[2],maxY:or[3],value:I},canvasTransform:D,scale:d}}replayImageOrLabel_(t,e,n,i,s,o,a){const l=!!(o||a),c=i.declutterBox,h=t.canvas,u=a?a[2]*i.scale[0]/2:0;return c.minX-u<=h.width/e&&c.maxX+u>=0&&c.minY-u<=h.height/e&&c.maxY+u>=0&&(l&&this.replayTextBackground_(t,ji,Ti,Ni,Zi,o,a),Wp(t,i.canvasTransform,s,n,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){if(this.alignFill_){const e=ue(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(e[0]%n,e[1]%n),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,i){const s=this.textStates[e],o=this.createLabel(t,e,i,n),a=this.strokeStates[n],l=this.pixelRatio,c=xg(Array.isArray(t)?t[0]:t,s.textAlign||_o),h=io[s.textBaseline||Pa],u=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*s.scale[0],f=c*d+2*(.5-c)*u,p=h*o.height/l+2*(.5-h)*u;return{label:o,anchorX:f,anchorY:p}}execute_(t,e,n,i,s,o,a,l){let c;this.pixelCoordinates_&&js(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Pi(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),w_(this.renderedTransform_,n));let h=0;const u=i.length;let d=0,f,p,m,I,x,E,R,T,N,S,M,L,D=0,Y=0,W=null,B=null;const $=this.coordinateCache_,it=this.viewRotation_,Z=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,V={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:it},X=this.instructions!=i||this.overlaps?0:200;let st,xt,_t,Mt;for(;h<u;){const k=i[h];switch(k[0]){case rt.BEGIN_GEOMETRY:st=k[1],Mt=k[3],st.getGeometry()?a!==void 0&&!tn(a,Mt.getExtent())?h=k[2]+1:++h:h=k[2];break;case rt.BEGIN_PATH:D>X&&(this.fill_(t),D=0),Y>X&&(t.stroke(),Y=0),!D&&!Y&&(t.beginPath(),I=NaN,x=NaN),++h;break;case rt.CIRCLE:d=k[1];const ot=c[d],ut=c[d+1],lt=c[d+2],It=c[d+3],Yt=lt-ot,pe=It-ut,Vt=Math.sqrt(Yt*Yt+pe*pe);t.moveTo(ot+Vt,ut),t.arc(ot,ut,Vt,0,2*Math.PI,!0),++h;break;case rt.CLOSE_PATH:t.closePath(),++h;break;case rt.CUSTOM:d=k[1],f=k[2];const gt=k[3],Q=k[4],he=k.length==6?k[5]:void 0;V.geometry=gt,V.feature=st,h in $||($[h]=[]);const we=$[h];he?he(c,d,f,2,we):(we[0]=c[d],we[1]=c[d+1],we.length=2),Q(we,V),++h;break;case rt.DRAW_IMAGE:d=k[1],f=k[2],T=k[3],p=k[4],m=k[5];let fe=k[6];const He=k[7],Ve=k[8],jn=k[9],qe=k[10];let mn=k[11];const pi=k[12];let yt=k[13];const Ht=k[14],ne=k[15];if(!T&&k.length>=20){N=k[19],S=k[20],M=k[21],L=k[22];const re=this.drawLabelWithPointPlacement_(N,S,M,L);T=re.label,k[3]=T;const Xi=k[23];p=(re.anchorX-Xi)*this.pixelRatio,k[4]=p;const Ye=k[24];m=(re.anchorY-Ye)*this.pixelRatio,k[5]=m,fe=T.height,k[6]=fe,yt=T.width,k[13]=yt}let ye;k.length>25&&(ye=k[25]);let Ke,on,Te;k.length>17?(Ke=k[16],on=k[17],Te=k[18]):(Ke=bs,on=!1,Te=!1),qe&&Z?mn+=it:!qe&&!Z&&(mn-=it);let ie=0;for(;d<f;d+=2){if(ye&&ye[ie++]<yt/this.pixelRatio)continue;const re=this.calculateImageOrLabelDimensions_(T.width,T.height,c[d],c[d+1],yt,fe,p,m,Ve,jn,mn,pi,s,Ke,on||Te,st),Xi=[t,e,T,re,He,on?W:null,Te?B:null];if(l){if(Ht==="none")continue;if(Ht==="obstacle"){l.insert(re.declutterBox);continue}else{let Ye,yn;if(ne){const xe=f-d;if(!ne[xe]){ne[xe]=Xi;continue}if(Ye=ne[xe],delete ne[xe],yn=yg(Ye),l.collides(yn))continue}if(l.collides(re.declutterBox))continue;Ye&&(l.insert(yn),this.replayImageOrLabel_.apply(this,Ye)),l.insert(re.declutterBox)}}this.replayImageOrLabel_.apply(this,Xi)}++h;break;case rt.DRAW_CHARS:const _n=k[1],se=k[2],yi=k[3],pn=k[4];L=k[5];const xi=k[6],Ei=k[7],Zn=k[8];M=k[9];const fs=k[10];N=k[11],S=k[12];const ms=[k[13],k[13]],Un=this.textStates[S],Ii=Un.font,zi=[Un.scale[0]*Ei,Un.scale[1]*Ei];let Hn;Ii in this.widths_?Hn=this.widths_[Ii]:(Hn={},this.widths_[Ii]=Hn);const Ne=_d(c,_n,se,2),Zo=Math.abs(zi[0])*lg(Ii,N,Hn);if(pn||Zo<=Ne){const re=this.textStates[S].textAlign,Xi=(Ne-Zo)*io[re],Ye=Ty(c,_n,se,2,N,Xi,xi,Math.abs(zi[0]),lg,Ii,Hn,Z?0:this.viewRotation_);t:if(Ye){const yn=[];let xe,_s,$s,Se,Je;if(M)for(xe=0,_s=Ye.length;xe<_s;++xe){Je=Ye[xe],$s=Je[4],Se=this.createLabel($s,S,"",M),p=Je[2]+(zi[0]<0?-fs:fs),m=yi*Se.height+(.5-yi)*2*fs*zi[1]/zi[0]-Zn;const xn=this.calculateImageOrLabelDimensions_(Se.width,Se.height,Je[0],Je[1],Se.width,Se.height,p,m,0,0,Je[3],ms,!1,bs,!1,st);if(l&&l.collides(xn.declutterBox))break t;yn.push([t,e,Se,xn,1,null,null])}if(L)for(xe=0,_s=Ye.length;xe<_s;++xe){Je=Ye[xe],$s=Je[4],Se=this.createLabel($s,S,L,""),p=Je[2],m=yi*Se.height-Zn;const xn=this.calculateImageOrLabelDimensions_(Se.width,Se.height,Je[0],Je[1],Se.width,Se.height,p,m,0,0,Je[3],ms,!1,bs,!1,st);if(l&&l.collides(xn.declutterBox))break t;yn.push([t,e,Se,xn,1,null,null])}l&&l.load(yn.map(yg));for(let xn=0,zl=yn.length;xn<zl;++xn)this.replayImageOrLabel_.apply(this,yn[xn])}}++h;break;case rt.END_GEOMETRY:if(o!==void 0){st=k[1];const re=o(st,Mt);if(re)return re}++h;break;case rt.FILL:X?D++:this.fill_(t),++h;break;case rt.MOVE_TO_LINE_TO:for(d=k[1],f=k[2],xt=c[d],_t=c[d+1],E=xt+.5|0,R=_t+.5|0,(E!==I||R!==x)&&(t.moveTo(xt,_t),I=E,x=R),d+=2;d<f;d+=2)xt=c[d],_t=c[d+1],E=xt+.5|0,R=_t+.5|0,(d==f-2||E!==I||R!==x)&&(t.lineTo(xt,_t),I=E,x=R);++h;break;case rt.SET_FILL_STYLE:W=k,this.alignFill_=k[2],D&&(this.fill_(t),D=0,Y&&(t.stroke(),Y=0)),t.fillStyle=k[1],++h;break;case rt.SET_STROKE_STYLE:B=k,Y&&(t.stroke(),Y=0),this.setStrokeStyle_(t,k),++h;break;case rt.STROKE:X?Y++:t.stroke(),++h;break;default:++h;break}}D&&this.fill_(t),Y&&t.stroke()}execute(t,e,n,i,s,o){this.viewRotation_=i,this.execute_(t,e,n,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,n,i,s){return this.viewRotation_=n,this.execute_(t,1,e,this.hitDetectionInstructions,!0,i,s)}}const by=Ly,nc=["Polygon","Circle","LineString","Image","Text","Default"];class vy{constructor(t,e,n,i,s,o){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=kn(),this.createExecutors_(s)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t){for(const e in t){let n=this.executorsByZIndex_[e];n===void 0&&(n={},this.executorsByZIndex_[e]=n);const i=t[e];for(const s in i){const o=i[s];n[s]=new by(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let i=0,s=t.length;i<s;++i)if(t[i]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,i,s,o){i=Math.round(i);const a=i*2+1,l=Di(this.hitDetectionTransform_,i+.5,i+.5,1/e,-1/e,-n,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=fn(a,a));const h=this.hitDetectionContext_;h.canvas.width!==a||h.canvas.height!==a?(h.canvas.width=a,h.canvas.height=a):c||h.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Tn(),eo(u,t),qc(u,e*(this.renderBuffer_+i),u));const d=My(i);let f;function p(N,S){const M=h.getImageData(0,0,a,a).data;for(let L=0,D=d.length;L<D;L++)if(M[d[L]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(N)){const Y=(d[L]-3)/4,W=i-Y%a,B=i-(Y/a|0),$=s(N,S,W*W+B*B);if($)return $}h.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(Gs);let I,x,E,R,T;for(I=m.length-1;I>=0;--I){const N=m[I].toString();for(E=this.executorsByZIndex_[N],x=nc.length-1;x>=0;--x)if(f=nc[x],R=E[f],R!==void 0&&(T=R.executeHitDetection(h,l,n,p,u),T))return T}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],i=e[1],s=e[2],o=e[3],a=[n,i,n,o,s,o,s,i];return Pi(a,0,8,2,t,a),a}isEmpty(){return br(this.executorsByZIndex_)}execute(t,e,n,i,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(Gs),this.maxExtent_&&(t.save(),this.clip(t,n)),o=o||nc;let c,h,u,d,f,p;for(a&&l.reverse(),c=0,h=l.length;c<h;++c){const m=l[c].toString();for(f=this.executorsByZIndex_[m],u=0,d=o.length;u<d;++u){const I=o[u];p=f[I],p!==void 0&&p.execute(t,e,n,i,s,a)}}this.maxExtent_&&t.restore()}}const ic={};function My(r){if(ic[r]!==void 0)return ic[r];const t=r*2+1,e=r*r,n=new Array(e+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>e)break;let l=n[a];l||(l=[],n[a]=l),l.push(((r+s)*t+(r+o))*4+3),s>0&&l.push(((r-s)*t+(r+o))*4+3),o>0&&(l.push(((r+s)*t+(r-o))*4+3),s>0&&l.push(((r-s)*t+(r-o))*4+3))}const i=[];for(let s=0,o=n.length;s<o;++s)n[s]&&i.push(...n[s]);return ic[r]=i,i}const Eg=vy,Ie={ANIMATING:0,INTERACTING:1};class Oy extends Md{constructor(t,e,n,i,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=i,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=kn()}drawImages_(t,e,n,i){if(!this.image_)return;const s=Pi(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=s.length;h<u;h+=2){const d=s[h]-this.imageAnchorX_,f=s[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,m=f+this.imageAnchorY_;Di(a,p,m,1,1,c,-p,-m),o.setTransform.apply(o,a),o.translate(p,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,n,i){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Pi(t,e,n,i,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<n;e+=i){const l=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,c-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,c),this.textFillState_&&o.fillText(this.text_,l,c))}}moveToLineTo_(t,e,n,i,s){const o=this.context_,a=Pi(t,e,n,i,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let c=2;c<l;c+=2)o.lineTo(a[c],a[c+1]);return s&&o.closePath(),n}drawRings_(t,e,n,i){for(let s=0,o=n.length;s<o;++s)e=this.moveToLineTo_(t,e,n[s],i,!0);return e}drawCircle(t){if(tn(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=hp(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],i=e[3]-e[1],s=Math.sqrt(n*n+i*i),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);!n||!tn(this.extent_,n.getExtent())||(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,i=e.length;n<i;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tn(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(tn(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,i=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();n.beginPath();for(let l=0,c=o.length;l<c;++l)s=this.moveToLineTo_(i,s,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tn(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!tn(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let i=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const c=s[a];i=this.drawRings_(n,i,c,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),js(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,i=t.textAlign?t.textAlign:_o;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=i&&(n.textAlign=i,e.textAlign=i),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=i,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:i,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:oi(n||Ai)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),i=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),h=s||uo;this.strokeState_={lineCap:i!==void 0?i:Oa,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(o||go)*this.pixelRatio_,lineJoin:a!==void 0?a:Mr,lineWidth:(l!==void 0?l:po)*this.pixelRatio_,miterLimit:c!==void 0?c:fo,strokeStyle:oi(n||mo)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),i=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=i[0]*n,this.imageAnchorY_=i[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:oi(f||Ai)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const f=n.getColor(),p=n.getLineCap(),m=n.getLineDash(),I=n.getLineDashOffset(),x=n.getLineJoin(),E=n.getWidth(),R=n.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Oa,lineDash:m||uo,lineDashOffset:I||go,lineJoin:x!==void 0?x:Mr,lineWidth:E!==void 0?E:po,miterLimit:R!==void 0?R:fo,strokeStyle:oi(f||mo)}}const i=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:i!==void 0?i:Cd,textAlign:u!==void 0?u:_o,textBaseline:d!==void 0?d:Pa},this.text_=h!==void 0?Array.isArray(h)?h.reduce((f,p,m)=>f+=m%2?" ":p,""):h:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const Py=Oy,ii=.5;function Ay(r,t,e,n,i,s,o){const a=r[0]*ii,l=r[1]*ii,c=fn(a,l);c.imageSmoothingEnabled=!1;const h=c.canvas,u=new Py(c,ii,i,null,o),d=e.length,f=Math.floor((256*256*256-1)/d),p={};for(let I=1;I<=d;++I){const x=e[I-1],E=x.getStyleFunction()||n;if(!n)continue;let R=E(x,s);if(!R)continue;Array.isArray(R)||(R=[R]);const N="#"+("000000"+(I*f).toString(16)).slice(-6);for(let S=0,M=R.length;S<M;++S){const L=R[S],D=L.getGeometryFunction()(x);if(!D||!tn(i,D.getExtent()))continue;const Y=L.clone(),W=Y.getFill();W&&W.setColor(N);const B=Y.getStroke();B&&(B.setColor(N),B.setLineDash(null)),Y.setText(void 0);const $=L.getImage();if($&&$.getOpacity()!==0){const V=$.getImageSize();if(!V)continue;const X=fn(V[0],V[1],void 0,{alpha:!1}),st=X.canvas;X.fillStyle=N,X.fillRect(0,0,st.width,st.height),Y.setImage(new Go({img:st,imgSize:V,anchor:$.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:$.getOrigin(),opacity:1,size:$.getSize(),scale:$.getScale(),rotation:$.getRotation(),rotateWithView:$.getRotateWithView()}))}const it=Y.getZIndex()||0;let Z=p[it];Z||(Z={},p[it]=Z,Z.Polygon=[],Z.Circle=[],Z.LineString=[],Z.Point=[]),Z[D.getType().replace("Multi","")].push(D,Y)}}const m=Object.keys(p).map(Number).sort(Gs);for(let I=0,x=m.length;I<x;++I){const E=p[m[I]];for(const R in E){const T=E[R];for(let N=0,S=T.length;N<S;N+=2){u.setStyle(T[N+1]);for(let M=0,L=t.length;M<L;++M)u.setTransform(t[M]),u.drawGeometry(T[N])}}}return c.getImageData(0,0,h.width,h.height)}function Dy(r,t,e){const n=[];if(e){const i=Math.floor(Math.round(r[0])*ii),s=Math.floor(Math.round(r[1])*ii),o=(ce(i,0,e.width-1)+ce(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&n.push(t[h/u-1])}return n}const Fy=.5,Dd={Point:jy,LineString:Xy,Polygon:Uy,MultiPoint:Zy,MultiLineString:Wy,MultiPolygon:By,GeometryCollection:zy,Circle:ky};function yh(r,t){return parseInt(bt(r),10)-parseInt(bt(t),10)}function Gy(r,t){const e=Pc(r,t);return e*e}function Pc(r,t){return Fy*r/t}function ky(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,n)}const a=e.getText();if(a&&a.getText()){const l=(i||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function Ig(r,t,e,n,i,s,o){let a=!1;const l=e.getImage();if(l){const c=l.getImageState();c==me.LOADED||c==me.ERROR?l.unlistenImageChange(i):(c==me.IDLE&&l.load(),l.listenImageChange(i),a=!0)}return Yy(r,t,e,n,s,o),a}function Yy(r,t,e,n,i,s){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(n,i);if(e.getRenderer())Fd(r,a,e,t);else{const c=Dd[a.getType()];c(r,a,e,t,s)}}function Fd(r,t,e,n){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let o=0,a=s.length;o<a;++o)Fd(r,s[o],e,n);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer())}function zy(r,t,e,n,i){const s=t.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o){const l=Dd[s[o].getType()];l(r,s[o],e,n,i)}}function Xy(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,n)}const o=e.getText();if(o&&o.getText()){const a=(i||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}}function Wy(r,t,e,n,i){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,n)}const o=e.getText();if(o&&o.getText()){const a=(i||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,n)}}function By(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(o||s){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,n)}const a=e.getText();if(a&&a.getText()){const l=(i||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}function jy(r,t,e,n,i){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=me.LOADED)return;let l=r;if(i){const h=s.getDeclutterMode();if(h!=="none")if(l=i,h==="obstacle"){const u=r.getBuilder(e.getZIndex(),"Image");u.setImageStyle(s,a),u.drawPoint(t,n)}else o&&o.getText()&&(a={})}const c=l.getBuilder(e.getZIndex(),"Image");c.setImageStyle(s,a),c.drawPoint(t,n)}if(o&&o.getText()){let l=r;i&&(l=i);const c=l.getBuilder(e.getZIndex(),"Text");c.setTextStyle(o,a),c.drawText(t,n)}}function Zy(r,t,e,n,i){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=me.LOADED)return;let l=r;if(i){const h=s.getDeclutterMode();if(h!=="none")if(l=i,h==="obstacle"){const u=r.getBuilder(e.getZIndex(),"Image");u.setImageStyle(s,a),u.drawMultiPoint(t,n)}else o&&o.getText()&&(a={})}const c=l.getBuilder(e.getZIndex(),"Image");c.setImageStyle(s,a),c.drawMultiPoint(t,n)}if(o&&o.getText()){let l=r;i&&(l=i);const c=l.getBuilder(e.getZIndex(),"Text");c.setTextStyle(o,a),c.drawText(t,n)}}function Uy(r,t,e,n,i){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,n)}const a=e.getText();if(a&&a.getText()){const l=(i||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,n)}}class Hy extends Ad{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Tn(),this.wrappedRenderedExtent_=Tn(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,n){const i=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,c=s.rotation,h=l.getExtent(),u=this.getLayer().getSource(),d=e.pixelRatio,f=e.viewHints,p=!(f[Ie.ANIMATING]||f[Ie.INTERACTING]),m=this.compositionContext_,I=Math.round(e.size[0]*d),x=Math.round(e.size[1]*d),E=u.getWrapX()&&l.canWrapX(),R=E?Wt(h):null,T=E?Math.ceil((i[2]-h[2])/R)+1:1;let N=E?Math.floor((i[0]-h[0])/R):0;do{const S=this.getRenderTransform(o,a,c,d,I,x,N*R);t.execute(m,1,S,c,p,void 0,n)}while(++N<T)}setupCompositionContext_(){if(this.opacity_!==1){const t=fn(this.context.canvas.width,this.context.canvas.height,pg);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Ed(this.compositionContext_),pg.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const n=t.pixelRatio,i=t.layerStatesArray[t.layerIndex];T_(this.pixelTransform,1/n,1/n),Vc(this.inversePixelTransform,this.pixelTransform);const s=Zg(this.pixelTransform);this.useContainer(e,s,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_,c=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!c||c.isEmpty()))return null;const h=Math.round(t.size[0]*n),u=Math.round(t.size[1]*n);a.width!=h||a.height!=u?(a.width=h,a.height=u,a.style.transform!==s&&(a.style.transform=s)):this.containerReused||o.clearRect(0,0,h,u),this.preRender(o,t);const d=t.viewState;d.projection,this.opacity_=i.opacity,this.setupCompositionContext_();let f=!1,p=!0;if(i.extent&&this.clipping){const m=ns(i.extent);p=tn(m,t.extent),f=p&&!dr(m,t.extent),f&&this.clipUnrotated(this.compositionContext_,t,m)}return p&&this.renderWorlds(l,t),f&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=[this.context.canvas.width,this.context.canvas.height];ue(this.pixelTransform,n);const i=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=n[0]*ii,d=n[1]*ii;h.push(this.getRenderTransform(i,s,o,ii,u,d,0).slice());const f=c.getSource(),p=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!dr(p,l)){let m=l[0];const I=Wt(p);let x=0,E;for(;m<p[0];)--x,E=I*x,h.push(this.getRenderTransform(i,s,o,ii,u,d,E).slice()),m+=I;for(x=0,m=l[2];m>p[2];)++x,E=I*x,h.push(this.getRenderTransform(i,s,o,ii,u,d,E).slice()),m-=I}this.hitDetectionImageData_=Ay(n,h,this.renderedFeatures_,c.getStyleFunction(),l,s,o)}e(Dy(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))}forEachFeatureAtCoordinate(t,e,n,i,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),c={},h=function(f,p,m){const I=bt(f),x=c[I];if(x){if(x!==!0&&m<x.distanceSq){if(m===0)return c[I]=!0,s.splice(s.lastIndexOf(x),1),i(f,l,p);x.geometry=p,x.distanceSq=m}}else{if(m===0)return c[I]=!0,i(f,l,p);s.push(c[I]={feature:f,layer:l,geometry:p,distanceSq:m,callback:i})}};let u;const d=[this.replayGroup_];return this.declutterExecutorGroup&&d.push(this.declutterExecutorGroup),d.some(f=>u=f.forEachFeatureAtCoordinate(t,o,a,n,h,f===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(p=>p.value):null)),u}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const i=t.viewHints[Ie.ANIMATING],s=t.viewHints[Ie.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&i||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,c=t.viewState,h=c.projection,u=c.resolution,d=t.pixelRatio,f=e.getRevision(),p=e.getRenderBuffer();let m=e.getRenderOrder();m===void 0&&(m=yh);const I=c.center.slice(),x=qc(l,p*u),E=x.slice(),R=[x.slice()],T=h.getExtent();if(n.getWrapX()&&h.canWrapX()&&!dr(T,t.extent)){const Z=Wt(T),V=Math.max(Wt(x)/2,Z);x[0]=T[0]-V,x[2]=T[2]+V,td(I,h);const X=Jg(R[0],h);X[0]<T[0]&&X[2]<T[2]?R.push([X[0]+Z,X[1],X[2]+Z,X[3]]):X[0]>T[0]&&X[2]>T[2]&&R.push([X[0]-Z,X[1],X[2]-Z,X[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&dr(this.wrappedRenderedExtent_,x))return js(this.renderedExtent_,E)||(this.hitDetectionImageData_=null,this.renderedExtent_=E),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const N=new _g(Pc(u,d),x,u,d);let S;this.getLayer().getDeclutter()&&(S=new _g(Pc(u,d),x,u,d));let M;for(let Z=0,V=R.length;Z<V;++Z)n.loadFeatures(R[Z],u,h);const L=Gy(u,d);let D=!0;const Y=function(Z){let V;const X=Z.getStyleFunction()||e.getStyleFunction();if(X&&(V=X(Z,u)),V){const st=this.renderFeature(Z,L,V,N,M,S);D=D&&!st}}.bind(this),W=dl(x),B=n.getFeaturesInExtent(W);m&&B.sort(m);for(let Z=0,V=B.length;Z<V;++Z)Y(B[Z]);this.renderedFeatures_=B,this.ready=D;const $=N.finish(),it=new Eg(x,u,d,n.getOverlaps(),$,e.getRenderBuffer());return S&&(this.declutterExecutorGroup=new Eg(x,u,d,n.getOverlaps(),S.finish(),e.getRenderBuffer())),this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedExtent_=E,this.wrappedRenderedExtent_=x,this.renderedCenter_=I,this.renderedProjection_=h,this.replayGroup_=it,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,i,s,o){if(!n)return!1;let a=!1;if(Array.isArray(n))for(let l=0,c=n.length;l<c;++l)a=Ig(i,t,n[l],e,this.boundHandleStyleImageChange_,s,o)||a;else a=Ig(i,t,n,e,this.boundHandleStyleImageChange_,s,o);return a}}const Vy=Hy;class qy extends cy{constructor(t){super(t)}createRenderer(){return new Vy(this)}}const Gd=qy;class Ky{constructor(t){this.rbush_=new bd(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[bt(e)]=n}load(t,e){const n=new Array(e.length);for(let i=0,s=e.length;i<s;i++){const o=t[i],a=e[i],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[i]=l,this.items_[bt(a)]=l}this.rbush_.load(n)}remove(t){const e=bt(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[bt(e)],i=[n.minX,n.minY,n.maxX,n.maxY];ao(i,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(i){return i.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let i=0,s=t.length;i<s;i++)if(n=e(t[i]),n)return n;return n}isEmpty(){return br(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return gi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Cg=Ky;class Jy extends mi{constructor(t){super(),this.projection=_e(t.projection),this.attributions_=Rg(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,i){e.viewResolver=n,e.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return at()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Rg(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Rg(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const kd=Jy,En={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function $y(r,t){return[[-1/0,-1/0,1/0,1/0]]}function Qy(r){return function(t,e,n){const i=r.getZForResolution(ip(e)),s=r.getTileRangeForExtentAndZ(ns(t),i),o=[],a=[i,0,0];for(a[1]=s.minX;a[1]<=s.maxX;++a[1])for(a[2]=s.minY;a[2]<=s.maxY;++a[2])o.push(dl(r.getTileCoordExtent(a)));return o}}let t0=!1;function e0(r,t,e,n,i,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(e,n,i):r,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=t0,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const c=t.getType();let h;c=="json"||c=="text"?h=a.responseText:c=="xml"?(h=a.responseXML,h||(h=new DOMParser().parseFromString(a.responseText,"application/xml"))):c=="arraybuffer"&&(h=a.response),h?s(t.readFeatures(h,{extent:e,featureProjection:i}),t.readProjection(h)):o()}else o()},a.onerror=o,a.send()}function wg(r,t){return function(e,n,i,s,o){const a=this;e0(r,t,e,n,i,function(l,c){a.addFeatures(l),s!==void 0&&s(l)},o||ks)}}class Ui extends Yi{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class n0 extends kd{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=ks,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Et(this.format_,7),this.loader_=wg(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:$y;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Cg:null,this.loadedExtentsRtree_=new Cg,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,i;Array.isArray(t.features)?i=t.features:t.features&&(n=t.features,i=n.getArray()),!e&&n===void 0&&(n=new ri(i)),i!==void 0&&this.addFeaturesInternal(i),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=bt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const i=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Ui(En.ADDFEATURE,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[wt(e,ft.CHANGE,this.handleFeatureChange_,this),wt(e,Lr.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,e){let n=!0;const i=e.getId();return i!==void 0&&(i.toString()in this.idIndex_?n=!1:this.idIndex_[i.toString()]=e),n&&(Et(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],i=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=bt(a);this.addToIndex_(l,a)&&n.push(a)}for(let s=0,o=n.length;s<o;s++){const a=n[s],l=bt(a);this.setupChangeEvents_(l,a);const c=a.getGeometry();if(c){const h=c.getExtent();e.push(h),i.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,i),this.hasListener(En.ADDFEATURE))for(let s=0,o=n.length;s<o;s++)this.dispatchEvent(new Ui(En.ADDFEATURE,n[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(En.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(En.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(Qe.ADD,function(n){e||(e=!0,this.addFeature(n.element),e=!1)}.bind(this)),t.addEventListener(Qe.REMOVE,function(n){e||(e=!0,this.removeFeature(n.element),e=!1)}.bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Zt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const n=function(i){this.removeFeatureInternal(i)}.bind(this);this.featuresRtree_.forEach(n);for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Ui(En.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(i){if(i.getGeometry().intersectsCoordinate(t))return e(i)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){if(n.getGeometry().intersectsExtent(t)){const s=e(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),br(this.nullGeometryFeatures_)||Oi(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=A_(t,e);return[].concat(...i.map(s=>this.featuresRtree_.getInExtent(s)))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],i=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||oo,this.featuresRtree_.forEachInExtent(l,function(c){if(e(c)){const h=c.getGeometry(),u=a;if(a=h.closestPointXY(n,i,o,a),a<u){s=c;const d=Math.sqrt(a);l[0]=n-d,l[1]=i-d,l[2]=n+d,l[3]=i+d}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=bt(e),i=e.getGeometry();if(!i)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const o=i.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Ui(En.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:bt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&br(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const i=this.loadedExtentsRtree_,s=this.strategy_(t,e,n);for(let o=0,a=s.length;o<a;++o){const l=s[o];i.forEachInExtent(l,function(h){return dr(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Ui(En.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,function(h){--this.loadingExtentsCount_,this.dispatchEvent(new Ui(En.FEATURESLOADEND,void 0,h))}.bind(this),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Ui(En.FEATURESLOADERROR))}.bind(this)),i.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let n;e.forEachInExtent(t,function(i){if(ao(i.extent,t))return n=i,!0}),n&&e.remove(n)}removeFeature(t){if(!t)return;const e=bt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=bt(t),n=this.featureChangeKeys_[e];if(!n)return;n.forEach(Zt),delete this.featureChangeKeys_[e];const i=t.getId();return i!==void 0&&delete this.idIndex_[i.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Ui(En.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){Et(this.format_,7),this.url_=t,this.setLoader(wg(t,this.format_))}}const Eo=n0,tt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Yd(r){return Math.pow(r,3)}function kr(r){return 1-Yd(1-r)}function i0(r){return 3*r*r-2*r*r*r}function s0(r){return r}class r0 extends al{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ft.CHANGE)}release(){this.state===tt.ERROR&&this.setState(tt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==tt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==tt.LOADED){t.interimTile=null;break}else t.getState()==tt.LOADING?e=t:t.getState()==tt.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==tt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){at()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const i=e-n+1e3/60;return i>=this.transition_?1:Yd(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}const zd=r0;class o0 extends zd{constructor(t,e,n,i,s,o){super(t,e,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=tt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=tt.ERROR,this.unlistenImage_(),this.image_=a0(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=tt.LOADED:this.state=tt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==tt.ERROR&&(this.state=tt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==tt.IDLE&&(this.state=tt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=vd(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function a0(){const r=fn(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const Xd=o0;class l0{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const i=this.points_[e+2]-this.points_[n+2];if(i<1e3/60)return!1;const s=this.points_[e]-this.points_[n],o=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/i,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const c0=l0;class h0 extends jc{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){at()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,i=t.pixelToCoordinateTransform;Di(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Vc(i,n)}forEachFeatureAtCoordinate(t,e,n,i,s,o,a,l){let c;const h=e.viewState;function u(T,N,S,M){return s.call(o,N,T?S:null,M)}const d=h.projection,f=td(t.slice(),d),p=[[0,0]];if(d.canWrapX()&&i){const T=d.getExtent(),N=Wt(T);p.push([-N,0],[N,0])}const m=e.layerStatesArray,I=m.length,x=[],E=[];for(let T=0;T<p.length;T++)for(let N=I-1;N>=0;--N){const S=m[N],M=S.layer;if(M.hasRenderer()&&_h(S,h)&&a.call(l,M)){const L=M.getRenderer(),D=M.getSource();if(L&&D){const Y=D.getWrapX()?f:t,W=u.bind(null,S.managed);E[0]=Y[0]+p[T][0],E[1]=Y[1]+p[T][1],c=L.forEachFeatureAtCoordinate(E,e,n,W,x)}if(c)return c}}if(x.length===0)return;const R=1/x.length;return x.forEach((T,N)=>T.distanceSq+=N*R),x.sort((T,N)=>T.distanceSq-N.distanceSq),x.some(T=>c=T.callback(T.feature,T.layer,T.geometry)),c}hasFeatureAtCoordinate(t,e,n,i,s,o){return this.forEachFeatureAtCoordinate(t,e,n,i,oo,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){at()}scheduleExpireIconCache(t){Da.canExpireCache()&&t.postRenderFunctions.push(u0)}}function u0(r,t){Da.expire()}const g0=h0;class d0 extends g0{constructor(t){super(t),this.fontChangeListenerKey_=wt(Li,Lr.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=_l+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const i=new Pd(t,void 0,e);n.dispatchEvent(i)}}disposeInternal(){Zt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(os.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),n=t.viewState;this.children_.length=0;const i=[];let s=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const c=l.layer,h=c.getSourceState();if(!_h(l,n)||h!="ready"&&h!="undefined"){c.unrender();continue}const u=c.render(t,s);u&&(u!==s&&(this.children_.push(u),s=u),"getDeclutter"in c&&i.push(c))}for(let o=i.length-1;o>=0;--o)i[o].renderDeclutter(t);Gp(this.element_,this.children_),this.dispatchRenderEvent(os.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}const f0=d0;class Ji extends Yi{constructor(t,e){super(t),this.layer=e}}const sc={LAYERS:"layers"};class xh extends Sd{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(sc.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new ri(n.slice(),{unique:!0}):Et(typeof n.getArray=="function",43):n=new ri(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Zt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(wt(t,Qe.ADD,this.handleLayersAdd_,this),wt(t,Qe.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Zt);Po(this.listenerKeys_);const e=t.getArray();for(let n=0,i=e.length;n<i;n++){const s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new Ji("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[wt(t,Lr.PROPERTYCHANGE,this.handleLayerChange_,this),wt(t,ft.CHANGE,this.handleLayerChange_,this)];t instanceof xh&&e.push(wt(t,"addlayer",this.handleLayerGroupAdd_,this),wt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[bt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Ji("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Ji("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Ji("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=bt(e);this.listenerKeys_[n].forEach(Zt),delete this.listenerKeys_[n],this.dispatchEvent(new Ji("removelayer",e)),this.changed()}getLayers(){return this.get(sc.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let i=0,s=n.length;i<s;++i)this.dispatchEvent(new Ji("removelayer",n[i]))}this.set(sc.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const i=this.getLayerState();let s=i.zIndex;!t&&i.zIndex===void 0&&(s=0);for(let o=n,a=e.length;o<a;o++){const l=e[o];l.opacity*=i.opacity,l.visible=l.visible&&i.visible,l.maxResolution=Math.min(l.maxResolution,i.maxResolution),l.minResolution=Math.max(l.minResolution,i.minResolution),l.minZoom=Math.max(l.minZoom,i.minZoom),l.maxZoom=Math.min(l.maxZoom,i.maxZoom),i.extent!==void 0&&(l.extent!==void 0?l.extent=no(l.extent,i.extent):l.extent=i.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}const yl=xh;class m0 extends Yi{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}const gr=m0;class _0 extends gr{constructor(t,e,n,i,s,o){super(t,e,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=i!==void 0?i:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const qi=_0,$t={SINGLECLICK:"singleclick",CLICK:ft.CLICK,DBLCLICK:ft.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Ac={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class p0 extends al{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=wt(n,Ac.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=wt(n,Ac.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ft.TOUCHMOVE,this.boundHandleTouchMove_,jg?{passive:!1}:!1)}emulateClick_(t){let e=new qi($t.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new qi($t.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;const n=new qi($t.SINGLECLICK,this.map_,t);this.dispatchEvent(n)}.bind(this),250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==$t.POINTERUP||e.type==$t.POINTERCANCEL){delete this.trackedTouches_[n];for(const i in this.trackedTouches_)if(this.trackedTouches_[i].target!==e.target){delete this.trackedTouches_[i];break}}else(e.type==$t.POINTERDOWN||e.type==$t.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new qi($t.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Zt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new qi($t.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const n in t){const i=t[n];this.down_[n]=typeof i=="function"?ks:i}if(this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(wt(n,$t.POINTERMOVE,this.handlePointerMove_,this),wt(n,$t.POINTERUP,this.handlePointerUp_,this),wt(this.element_,$t.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(wt(this.element_.getRootNode(),$t.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new qi($t.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new qi($t.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Zt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ft.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Zt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Zt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const y0=p0,Ki={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Pe={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Fa=1/0;let x0=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Po(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const i=this.keyFunction_(n);return delete this.queuedElements_[i],n}enqueue(t){Et(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=Fa?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,i=e.length,s=e[t],o=n[t],a=t;for(;t<i>>1;){const l=this.getLeftChildIndex_(t),c=this.getRightChildIndex_(t),h=c<i&&n[c]<n[l]?c:l;e[t]=e[h],n[t]=n[h],t=h}e[t]=s,n[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const n=this.elements_,i=this.priorities_,s=n[e],o=i[e];for(;e>t;){const a=this.getParentIndex_(e);if(i[a]>o)n[e]=n[a],i[e]=i[a],e=a;else break}n[e]=s,i[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let i=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==Fa?delete this.queuedElements_[this.keyFunction_(o)]:(n[i]=l,e[i++]=o);e.length=i,n.length=i,this.heapify_()}};const E0=x0;class I0 extends E0{constructor(t,e){super(function(n){return t.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(ft.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===tt.LOADED||n===tt.ERROR||n===tt.EMPTY){n!==tt.ERROR&&e.removeEventListener(ft.CHANGE,this.boundHandleTileChange_);const i=e.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0,i,s,o;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),i=s.getState(),i===tt.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}const C0=I0;function R0(r,t,e,n,i){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return Fa;const s=r.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(i)+Math.sqrt(o*o+a*a)/i}const bn={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},w0=42,Eh=256;function Tg(r,t,e){return function(n,i,s,o,a){if(!n)return;if(!i&&!t)return n;const l=t?0:s[0]*i,c=t?0:s[1]*i,h=a?a[0]:0,u=a?a[1]:0;let d=r[0]+l/2+h,f=r[2]-l/2+h,p=r[1]+c/2+u,m=r[3]-c/2+u;d>f&&(d=(f+d)/2,f=d),p>m&&(p=(m+p)/2,m=p);let I=ce(n[0],d,f),x=ce(n[1],p,m);if(o&&e&&i){const E=30*i;I+=-E*Math.log(1+Math.max(0,d-n[0])/E)+E*Math.log(1+Math.max(0,n[0]-f)/E),x+=-E*Math.log(1+Math.max(0,p-n[1])/E)+E*Math.log(1+Math.max(0,n[1]-m)/E)}return[I,x]}}function T0(r){return r}function Ih(r,t,e,n){const i=Wt(t)/e[0],s=zn(t)/e[1];return n?Math.min(r,Math.max(i,s)):Math.min(r,Math.min(i,s))}function Ch(r,t,e){let n=Math.min(r,t);const i=50;return n*=Math.log(1+i*Math.max(0,r/t-1))/i+1,e&&(n=Math.max(n,e),n/=Math.log(1+i*Math.max(0,e/r-1))/i+1),ce(n,e/2,t*2)}function N0(r,t,e,n){return t=t!==void 0?t:!0,function(i,s,o,a){if(i!==void 0){const l=r[0],c=r[r.length-1],h=e?Ih(l,e,o,n):l;if(a)return t?Ch(i,h,c):ce(i,c,h);const u=Math.min(h,i),d=Math.floor(Zc(r,u,s));return r[d]>h&&d<r.length-1?r[d+1]:r[d]}else return}}function S0(r,t,e,n,i,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(o,a,l,c){if(o!==void 0){const h=i?Ih(t,i,l,s):t;if(c)return n?Ch(o,h,e):ce(o,e,h);const u=1e-9,d=Math.ceil(Math.log(t/h)/Math.log(r)-u),f=-a*(.5-u)+.5,p=Math.min(h,o),m=Math.floor(Math.log(t/p)/Math.log(r)+f),I=Math.max(d,m),x=t/Math.pow(r,I);return ce(x,e,h)}else return}}function Ng(r,t,e,n,i){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const c=n?Ih(r,n,a,i):r;return!e||!l?ce(s,t,c):Ch(s,c,t)}else return}}function Rh(r){if(r!==void 0)return 0}function Sg(r){if(r!==void 0)return r}function L0(r){const t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function b0(r){return r=r||Ca(5),function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}const rc=0;class v0 extends mi{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=th(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&$_(),t.center&&(t.center=Si(t.center,this.projection_)),t.extent&&(t.extent=ns(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in bn)delete e[a];this.setProperties(e,!0);const n=O0(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const i=M0(t),s=n.constraint,o=P0(t);this.constraints_={center:i,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenter();if(n){const i=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(i[3]-e[3]+e[1]-i[1]),a=s/2*(i[0]-e[0]+e[2]-i[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let i=arguments[n];i.center&&(i=Object.assign({},i),i.center=Si(i.center,this.getProjection())),i.anchor&&(i=Object.assign({},i),i.anchor=Si(i.anchor,this.getProjection())),e[n]=i}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let i=0;for(;i<e&&!this.isDef();++i){const h=arguments[i];h.center&&this.setCenterInternal(h.center),h.zoom!==void 0?this.setZoom(h.zoom):h.resolution&&this.setResolution(h.resolution),h.rotation!==void 0&&this.setRotation(h.rotation)}if(i===e){n&&fa(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const c=[];for(;i<e;++i){const h=arguments[i],u={start:s,complete:!1,anchor:h.anchor,duration:h.duration!==void 0?h.duration:1e3,easing:h.easing||i0,callback:n};if(h.center&&(u.sourceCenter=o,u.targetCenter=h.center.slice(),o=u.targetCenter),h.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(h.zoom),a=u.targetResolution):h.resolution&&(u.sourceResolution=a,u.targetResolution=h.resolution,a=u.targetResolution),h.rotation!==void 0){u.sourceRotation=l;const d=yr(h.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+d,l=u.targetRotation}A0(u)?u.complete=!0:s+=u.duration,c.push(u)}this.animations_.push(c),this.setHint(Ie.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ie.ANIMATING]>0}getInteracting(){return this.hints_[Ie.INTERACTING]>0}cancelAnimations(){this.setHint(Ie.ANIMATING,-this.hints_[Ie.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const i=this.animations_[e];if(i[0].callback&&fa(i[0].callback,!1),!t)for(let s=0,o=i.length;s<o;++s){const a=i[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const i=this.animations_[n];let s=!0;for(let o=0,a=i.length;o<a;++o){const l=i[o];if(l.complete)continue;const c=t-l.start;let h=l.duration>0?c/l.duration:1;h>=1?(l.complete=!0,h=1):s=!1;const u=l.easing(h);if(l.sourceCenter){const d=l.sourceCenter[0],f=l.sourceCenter[1],p=l.targetCenter[0],m=l.targetCenter[1];this.nextCenter_=l.targetCenter;const I=d+u*(p-d),x=f+u*(m-f);this.targetCenter_=[I,x]}if(l.sourceResolution&&l.targetResolution){const d=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const f=this.getViewportSize_(this.getRotation()),p=this.constraints_.resolution(d,0,f,!0);this.targetCenter_=this.calculateCenterZoom(p,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=d,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const d=u===1?yr(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const f=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(f,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=d}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Ie.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=i[0].callback;o&&fa(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const i=this.getCenterInternal();return i!==void 0&&(n=[i[0]-e[0],i[1]-e[1]],$c(n,t-this.getRotation()),H_(n,e)),n}calculateCenterZoom(t,e){let n;const i=this.getCenterInternal(),s=this.getResolution();if(i!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-i[0])/s,a=e[1]-t*(e[1]-i[1])/s;n=[o,a]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],i=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(i*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(i*Math.cos(t))]}else return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Rc(t,this.getProjection())}getCenterInternal(){return this.get(bn.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return dl(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Et(e,1);const n=this.getResolution();Et(n!==void 0,2);const i=this.getRotation();return Et(i!==void 0,3),xc(e,n,i,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(bn.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(ns(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=Wt(t)/e[0],i=zn(t)/e[1];return Math.max(n,i)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(t);return function(s){return e/Math.pow(t,s*i)}}getRotation(){return this.get(bn.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(n/i)/e;return function(o){return Math.log(n/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let i=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();i=oc(i,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,n)}return{center:i.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,i;if(this.resolutions_){const s=Zc(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?i=2:i=n/this.resolutions_[s+1]}else n=this.maxResolution_,i=this.zoomFactor_;return e+Math.log(n/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=ce(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,ce(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(Et(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){Et(!Jc(t),25);const i=ns(t,this.getProjection());n=ng(i)}else if(t.getType()==="Circle"){const i=ns(t.getExtent(),this.getProjection());n=ng(i),n.rotate(this.getRotation(),Ys(i))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),i=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,c=-1/0,h=-1/0;for(let u=0,d=s.length;u<d;u+=o){const f=s[u]*n-s[u+1]*i,p=s[u]*i+s[u+1]*n;a=Math.min(a,f),l=Math.min(l,p),c=Math.max(c,f),h=Math.max(h,p)}return[a,l,c,h]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const i=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[n[0]-i[1]-i[3],n[1]-i[0]-i[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const c=this.getRotation(),h=Math.sin(c),u=Math.cos(c),d=Ys(a);d[0]+=(i[1]-i[3])/2*l,d[1]+=(i[0]-i[2])/2*l;const f=d[0]*u-d[1]*h,p=d[1]*u+d[0]*h,m=this.getConstrainedCenter([f,p],l),I=e.callback?e.callback:ks;e.duration!==void 0?this.animateInternal({resolution:l,center:m,duration:e.duration,easing:e.easing},I):(this.targetResolution_=l,this.targetCenter_=m,this.applyTargetState_(!1,!0),fa(I,!0))}centerOn(t,e,n){this.centerOnInternal(Si(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(oc(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,i){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-n),l=oc(t,i,[a[0]/2+o[3],a[1]/2+o[0]],e,n);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Rc(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Si(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,i,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Si(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),i=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(i,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Si(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,i=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(i),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,i,s));this.get(bn.ROTATION)!==i&&this.set(bn.ROTATION,i),this.get(bn.RESOLUTION)!==o&&(this.set(bn.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(bn.CENTER)||!ba(this.get(bn.CENTER),a))&&this.set(bn.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const i=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,i,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!ba(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:kr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ie.INTERACTING,1)}endInteraction(t,e,n){n=n&&Si(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.setHint(Ie.INTERACTING,-1),this.resolveConstraints(t,e,n)}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function fa(r,t){setTimeout(function(){r(t)},0)}function M0(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return Tg(r.extent,r.constrainOnlyCenter,e)}const t=th(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Tg(e,!1,!1)}return T0}function O0(r){let t,e,n,o=r.minZoom!==void 0?r.minZoom:rc,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,c=r.multiWorld!==void 0?r.multiWorld:!1,h=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,u=r.showFullExtent!==void 0?r.showFullExtent:!1,d=th(r.projection,"EPSG:3857"),f=d.getExtent();let p=r.constrainOnlyCenter,m=r.extent;if(!c&&!m&&d.isGlobal()&&(p=!1,m=f),r.resolutions!==void 0){const I=r.resolutions;e=I[o],n=I[a]!==void 0?I[a]:I[I.length-1],r.constrainResolution?t=N0(I,h,!p&&m,u):t=Ng(e,n,h,!p&&m,u)}else{const x=(f?Math.max(Wt(f),zn(f)):360*lo.degrees/d.getMetersPerUnit())/Eh/Math.pow(2,rc),E=x/Math.pow(2,28-rc);e=r.maxResolution,e!==void 0?o=0:e=x/Math.pow(l,o),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(l,a):n=x/Math.pow(l,a):n=E),a=o+Math.floor(Math.log(e/n)/Math.log(l)),n=e/Math.pow(l,a-o),r.constrainResolution?t=S0(l,e,n,h,!p&&m,u):t=Ng(e,n,h,!p&&m,u)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:o,zoomFactor:l}}function P0(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const e=r.constrainRotation;return e===void 0||e===!0?b0():e===!1?Sg:typeof e=="number"?L0(e):Sg}else return Rh}function A0(r){return!(r.sourceCenter&&r.targetCenter&&!ba(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function oc(r,t,e,n,i){const s=Math.cos(-i);let o=Math.sin(-i),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,o=-o;const c=a*s-l*o,h=l*s+a*o;return[c,h]}const ts=v0;class D0 extends mi{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){vc(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&vc(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)Zt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==ks&&this.listenerKeys.push(wt(t,Ki.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}const wh=D0;class F0 extends wh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",i=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=i):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ft.CLICK,this.handleClick_.bind(this),!1);const c=e+" "+_l+" "+gh+(this.collapsed_&&this.collapsible_?" "+og:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=c,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},n=[];let i=!0;const s=t.layerStatesArray;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(!_h(l,t.viewState))continue;const c=l.layer.getSource();if(!c)continue;const h=c.getAttributions();if(!h)continue;const u=h(t);if(u)if(i=i&&c.getAttributionsCollapsible()!==!1,Array.isArray(u))for(let d=0,f=u.length;d<f;++d)u[d]in e||(n.push(u[d]),e[u[d]]=!0);else u in e||(n.push(u),e[u]=!0)}return this.overrideCollapsible_||this.setCollapsible(i),n}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!js(e,this.renderedAttributions_)){Fp(this.ulElement_);for(let i=0,s=e.length;i<s;++i){const o=document.createElement("li");o.innerHTML=e[i],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(og),this.collapsed_?rg(this.collapseLabel_,this.label_):rg(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const G0=F0;class k0 extends wh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"",i=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=i,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(i));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(ft.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+_l+" "+gh,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ha)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:kr}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const i="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(ha);!s&&n===0?this.element.classList.add(ha):s&&n!==0&&this.element.classList.remove(ha)}this.label_.style.transform=i}this.rotation_=n}}const Y0=k0;class z0 extends wh{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,i=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",c=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=i,h.setAttribute("type","button"),h.title=l,h.appendChild(typeof o=="string"?document.createTextNode(o):o),h.addEventListener(ft.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=c,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(ft.CLICK,this.handleClick_.bind(this,-n),!1);const d=e+" "+_l+" "+gh,f=this.element;f.className=d,f.appendChild(h),f.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const i=n.getZoom();if(i!==void 0){const s=n.getConstrainedZoom(i+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:kr})):n.setZoom(s)}}}const X0=z0;function W0(r){r=r||{};const t=new ri;return(r.zoom!==void 0?r.zoom:!0)&&t.push(new X0(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&t.push(new Y0(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&t.push(new G0(r.attributionOptions)),t}const Lg={ACTIVE:"active"};class B0 extends mi{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Lg.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Lg.ACTIVE,t)}setMap(t){this.map_=t}}function j0(r,t,e){const n=r.getCenterInternal();if(n){const i=[n[0]+t[0],n[1]+t[1]];r.animateInternal({duration:e!==void 0?e:250,easing:s0,center:r.getConstrainedCenter(i)})}}function Th(r,t,e,n){const i=r.getZoom();if(i===void 0)return;const s=r.getConstrainedZoom(i+t),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:e,duration:n!==void 0?n:250,easing:kr})}const zo=B0;class Z0 extends zo{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==$t.DBLCLICK){const n=t.originalEvent,i=t.map,s=t.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=i.getView();Th(a,o,s,this.duration_),n.preventDefault(),e=!0}return!e}}const U0=Z0;class H0 extends zo{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==$t.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==$t.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==$t.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==$t.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Nh(r){const t=r.length;let e=0,n=0;for(let i=0;i<t;i++)e+=r[i].clientX,n+=r[i].clientY;return[e/t,n/t]}const Xo=H0;function Dc(r){const t=arguments;return function(e){let n=!0;for(let i=0,s=t.length;i<s&&(n=n&&t[i](e),!!n);++i);return n}}const V0=function(r){const t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},q0=function(r){const t=r.map.getTargetElement(),e=r.map.getOwnerDocument().activeElement;return t.contains(e)},Wd=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?q0(r):!0},K0=oo,Bd=function(r){const t=r.originalEvent;return t.button==0&&!(E_&&I_&&t.ctrlKey)},jd=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},J0=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Zd=function(r){const t=r.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},ac=function(r){const t=r.originalEvent;return Et(t!==void 0,56),t.pointerType=="mouse"},$0=function(r){const t=r.originalEvent;return Et(t!==void 0,56),t.isPrimary&&t.button===0};class Q0 extends Xo{constructor(t){super({stopDown:rl}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Dc(jd,$0);this.condition_=t.onFocusOnly?Dc(Wd,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,n=Nh(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const i=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],o=t.map.getView();V_(i,o.getResolution()),$c(i,o.getRotation()),o.adjustCenterInternal(i)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const i=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-i*Math.cos(s),a[1]-i*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:kr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1}}const tx=Q0;class ex extends Xo{constructor(t){t=t||{},super({stopDown:rl}),this.condition_=t.condition?t.condition:V0,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!ac(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===Rh)return;const i=e.getSize(),s=t.pixel,o=Math.atan2(i[1]/2-s[1],s[0]-i[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return ac(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return ac(t)&&Bd(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const nx=ex;class ix extends jc{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",i=this.element_.style;i.left=Math.min(t[0],e[0])+n,i.top=Math.min(t[1],e[1])+n,i.width=Math.abs(e[0]-t[0])+n,i.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new de([i])}getGeometry(){return this.geometry_}}const sx=ix,ma={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class lc extends Yi{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class rx extends Xo{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new sx(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Bd,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const i=n[0]-e[0],s=n[1]-e[1];return i*i+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new lc(ma.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new lc(e?ma.BOXEND:ma.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new lc(ma.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}const ox=rx;class ax extends ox{constructor(t){t=t||{};const e=t.condition?t.condition:J0;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let i=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(i),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;i=i.clone(),i.scale(a*a)}n.fitInternal(i,{duration:this.duration_,easing:kr})}}const lx=ax,Cs={LEFT:37,UP:38,RIGHT:39,DOWN:40};class cx extends zo{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return jd(e)&&Zd(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==ft.KEYDOWN){const n=t.originalEvent,i=n.keyCode;if(this.condition_(t)&&(i==Cs.DOWN||i==Cs.LEFT||i==Cs.RIGHT||i==Cs.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,c=0;i==Cs.DOWN?c=-a:i==Cs.LEFT?l=-a:i==Cs.RIGHT?l=a:c=a;const h=[l,c];$c(h,o.getRotation()),j0(o,h,this.duration_),n.preventDefault(),e=!0}}return!e}}const hx=cx;class ux extends zo{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:Zd,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==ft.KEYDOWN||t.type==ft.KEYPRESS){const n=t.originalEvent,i=n.charCode;if(this.condition_(t)&&(i=="+".charCodeAt(0)||i=="-".charCodeAt(0))){const s=t.map,o=i=="+".charCodeAt(0)?this.delta_:-this.delta_,a=s.getView();Th(a,o,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}const gx=ux;class dx extends zo{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:K0;this.condition_=t.onFocusOnly?Dc(Wd,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==ft.WHEEL)return!0;const n=t.map,i=t.originalEvent;i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let s;if(t.type==ft.WHEEL&&(s=i.deltaY,y_&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Bg),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-ce(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Th(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const fx=dx;class mx extends Xo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=rl),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],i=this.targetPointers[1],s=Math.atan2(i.clientY-n.clientY,i.clientX-n.clientX);if(this.lastAngle_!==void 0){const h=s-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=h}this.lastAngle_=s;const o=t.map,a=o.getView();if(a.getConstraints().rotation===Rh)return;const l=o.getViewport().getBoundingClientRect(),c=Nh(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(c),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}const _x=mx;class px extends Xo{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=rl),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],i=this.targetPointers[1],s=n.clientX-i.clientX,o=n.clientY-i.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,c=l.getView();e!=1&&(this.lastScaleDelta_=e);const h=l.getViewport().getBoundingClientRect(),u=Nh(this.targetPointers);u[0]-=h.left,u[1]-=h.top,this.anchor_=l.getCoordinateFromPixelInternal(u),l.render(),c.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,i),!1}else return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}const yx=px;function xx(r){r=r||{};const t=new ri,e=new c0(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&t.push(new nx),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&t.push(new U0({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&t.push(new tx({onFocusOnly:r.onFocusOnly,kinetic:e})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&t.push(new _x),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&t.push(new yx({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(t.push(new hx),t.push(new gx({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&t.push(new fx({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&t.push(new lx({duration:r.zoomDuration})),t}function Ud(r){if(r instanceof Fo){r.setMapInternal(null);return}r instanceof yl&&r.getLayers().forEach(Ud)}function Hd(r,t){if(r instanceof Fo){r.setMapInternal(t);return}if(r instanceof yl){const e=r.getLayers().getArray();for(let n=0,i=e.length;n<i;++n)Hd(e[n],t)}}let Ex=class extends mi{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Ix(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Bg,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=kn(),this.pixelToCoordinateTransform_=kn(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||W0(),this.interactions=e.interactions||xx({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new C0(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Pe.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Pe.VIEW,this.handleViewChanged_),this.addChangeListener(Pe.SIZE,this.handleSizeChanged_),this.addChangeListener(Pe.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof ts)&&t.view.then(function(i){n.setView(new ts(i))}),this.controls.addEventListener(Qe.ADD,function(i){i.element.setMap(this)}.bind(this)),this.controls.addEventListener(Qe.REMOVE,function(i){i.element.setMap(null)}.bind(this)),this.interactions.addEventListener(Qe.ADD,function(i){i.element.setMap(this)}.bind(this)),this.interactions.addEventListener(Qe.REMOVE,function(i){i.element.setMap(null)}.bind(this)),this.overlays_.addEventListener(Qe.ADD,function(i){this.addOverlayInternal_(i.element)}.bind(this)),this.overlays_.addEventListener(Qe.REMOVE,function(i){const s=i.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],i.element.setMap(null)}.bind(this)),this.controls.forEach(function(i){i.setMap(this)}.bind(this)),this.interactions.forEach(function(i){i.setMap(this)}.bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Hd(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const i=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:oo,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(i,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(i){n.push(i)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(i){i instanceof yl?e(i.getLayers()):t.push(i)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const i=e.layerFilter!==void 0?e.layerFilter:oo,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,i,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),n="changedTouches"in t?t.changedTouches[0]:t;return[n.clientX-e.left,n.clientY-e.top]}getTarget(){return this.get(Pe.TARGET)}getTargetElement(){const t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null}getCoordinateFromPixel(t){return Rc(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?ue(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Pe.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof ri){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const i=t[e];if(!i.visible)continue;const s=i.layer.getRenderer();if(s&&!s.ready)return!0;const o=i.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Si(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?ue(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Pe.SIZE)}getView(){return this.get(Pe.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,i){return R0(this.frameState_,t,e,n,i)}handleBrowserEvent(t,e){e=e||t.type;const n=new qi(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===Ac.POINTERDOWN||n===ft.WHEEL||n===ft.KEYDOWN){const i=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():i,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===i?i.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const i=this.getInteractions().getArray().slice();for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,s=i;if(t){const o=t.viewHints;if(o[Ie.ANIMATING]||o[Ie.INTERACTING]){const a=Date.now()-t.time>8;i=a?0:8,s=a?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(os.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(os.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new gr(Ki.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new gr(Ki.LOADSTART,this,t))));const n=this.postRenderFunctions_;for(let i=0,s=n.length;i<s;++i)n[i](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,n=this.targetChangeHandlerKeys_.length;e<n;++e)Zt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ft.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ft.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,vc(this.viewport_)}const t=this.getTargetElement();if(!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new f0(this)),this.mapBrowserEventHandler_=new y0(this,this.moveTolerance_);for(const i in $t)this.mapBrowserEventHandler_.addEventListener($t[i],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ft.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ft.WHEEL,this.boundHandleBrowserEvent_,jg?{passive:!1}:!1);const e=this.getOwnerDocument().defaultView,n=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[wt(n,ft.KEYDOWN,this.handleBrowserEvent,this),wt(n,ft.KEYPRESS,this.handleBrowserEvent,this),wt(e,ft.RESIZE,this.updateSize,this)]}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Zt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Zt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=wt(t,Lr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=wt(t,ft.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Zt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Ji("addlayer",t)),this.layerGroupPropertyListenerKeys_=[wt(t,Lr.PROPERTYCHANGE,this.render,this),wt(t,ft.CHANGE,this.render,this),wt(t,"addlayer",this.handleLayerAdd_,this),wt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const i=t[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Ud(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),i=this.frameState_;let s=null;if(e!==void 0&&ig(e)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:xc(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:bt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=xc(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),i&&(!this.previousExtent_||!Jc(this.previousExtent_)&&!ao(s.extent,this.previousExtent_))&&(this.dispatchEvent(new gr(Ki.MOVESTART,this,i)),this.previousExtent_=Ao(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Ie.ANIMATING]&&!s.viewHints[Ie.INTERACTING]&&!ao(s.extent,this.previousExtent_)&&(this.dispatchEvent(new gr(Ki.MOVEEND,this,s)),Ug(s.extent,this.previousExtent_))),this.dispatchEvent(new gr(Ki.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Ki.LOADSTART)||this.hasListener(Ki.LOADEND)||this.hasListener(os.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Ji("removelayer",e)),this.set(Pe.LAYERGROUP,t)}setSize(t){this.set(Pe.SIZE,t)}setTarget(t){this.set(Pe.TARGET,t)}setView(t){if(!t||t instanceof ts){this.set(Pe.VIEW,t);return}this.set(Pe.VIEW,new ts);const e=this;t.then(function(n){e.setView(new ts(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const n=getComputedStyle(t),i=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(i)&&!isNaN(s)&&(e=[i,s],!ig(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const n=getComputedStyle(this.viewport_);n.width&&n.height&&(e=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(e)}}};function Ix(r){let t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const e={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new yl({layers:r.layers});e[Pe.LAYERGROUP]=n,e[Pe.TARGET]=r.target,e[Pe.VIEW]=r.view instanceof ts?r.view:new ts;let i;r.controls!==void 0&&(Array.isArray(r.controls)?i=new ri(r.controls.slice()):(Et(typeof r.controls.getArray=="function",47),i=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new ri(r.interactions.slice()):(Et(typeof r.interactions.getArray=="function",48),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new ri(r.overlays.slice()):(Et(typeof r.overlays.getArray=="function",49),o=r.overlays):o=new ri,{controls:i,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}const Cx=Ex;class Rx{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return Et(n!==void 0,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return Et(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){Et(!(t in this.entries_),16);const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}const wx=Rx;function bg(r,t,e,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function xl(r,t,e){return r+"/"+t+"/"+e}function Vd(r){return xl(r[0],r[1],r[2])}function Tx(r){return r.split("/").map(Number)}function Nx(r){return(r[1]<<r[0])+r[2]}function Sx(r,t){const e=r[0],n=r[1],i=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(n,i):!0}class Lx extends wx{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),n=Tx(t)[0];this.forEach(function(i){i.tileCoord[0]!==n&&(this.remove(Vd(i.tileCoord)),i.release())}.bind(this))}}const qd=Lx;class Kd{constructor(t,e,n,i){this.minX=t,this.maxX=e,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function ar(r,t,e,n,i){return i!==void 0?(i.minX=r,i.maxX=t,i.minY=e,i.maxY=n,i):new Kd(r,t,e,n)}const Jd=Kd,_a={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class bx extends Fo{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(_a.PRELOAD)}setPreload(t){this.set(_a.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(_a.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(_a.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}const vx=bx,Mx=.5,Ox=10,vg=.25;class Px{constructor(t,e,n,i,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=co(this.targetProj_,this.sourceProj_);this.transformInv_=function(E){const R=E[0]+"/"+E[1];return a[R]||(a[R]=l(E)),a[R]},this.maxSourceExtent_=i,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&Wt(i)==Wt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Wt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Wt(this.targetProj_.getExtent()):null;const c=Us(n),h=gl(n),u=ul(n),d=hl(n),f=this.transformInv_(c),p=this.transformInv_(h),m=this.transformInv_(u),I=this.transformInv_(d),x=Ox+(o?Math.max(0,Math.ceil(Math.log2(yc(n)/(o*o*256*256)))):0);if(this.addQuad_(c,h,u,d,f,p,m,I,x),this.wrapsXInSource_){let E=1/0;this.triangles_.forEach(function(R,T,N){E=Math.min(E,R.source[0][0],R.source[1][0],R.source[2][0])}),this.triangles_.forEach(function(R){if(Math.max(R.source[0][0],R.source[1][0],R.source[2][0])-E>this.sourceWorldWidth_/2){const T=[[R.source[0][0],R.source[0][1]],[R.source[1][0],R.source[1][1]],[R.source[2][0],R.source[2][1]]];T[0][0]-E>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-E>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-E>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);const N=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-N<this.sourceWorldWidth_/2&&(R.source=T)}}.bind(this))}a={}}addTriangle_(t,e,n,i,s,o){this.triangles_.push({source:[i,s,o],target:[t,e,n]})}addQuad_(t,e,n,i,s,o,a,l,c){const h=Zu([s,o,a,l]),u=this.sourceWorldWidth_?Wt(h)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,f=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const I=Zu([t,e,n,i]);p=Wt(I)/this.targetWorldWidth_>vg||p}!f&&this.sourceProj_.isGlobal()&&u&&(p=u>vg||p)}if(!p&&this.maxSourceExtent_&&isFinite(h[0])&&isFinite(h[1])&&isFinite(h[2])&&isFinite(h[3])&&!tn(h,this.maxSourceExtent_))return;let m=0;if(!p&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(c>0)p=!0;else if(m=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),m!=1&&m!=2&&m!=4&&m!=8)return}if(c>0){if(!p){const I=[(t[0]+n[0])/2,(t[1]+n[1])/2],x=this.transformInv_(I);let E;f?E=(yr(s[0],d)+yr(a[0],d))/2-yr(x[0],d):E=(s[0]+a[0])/2-x[0];const R=(s[1]+a[1])/2-x[1];p=E*E+R*R>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const I=[(e[0]+n[0])/2,(e[1]+n[1])/2],x=this.transformInv_(I),E=[(i[0]+t[0])/2,(i[1]+t[1])/2],R=this.transformInv_(E);this.addQuad_(t,e,I,E,s,o,x,R,c-1),this.addQuad_(E,I,n,i,R,x,a,l,c-1)}else{const I=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(I),E=[(n[0]+i[0])/2,(n[1]+i[1])/2],R=this.transformInv_(E);this.addQuad_(t,I,E,i,s,x,R,l,c-1),this.addQuad_(I,e,n,E,x,o,a,R,c-1)}return}}if(f){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}m&11||this.addTriangle_(t,n,i,s,a,l),m&14||this.addTriangle_(t,n,e,s,a,o),m&&(m&13||this.addTriangle_(e,i,t,o,l,s),m&7||this.addTriangle_(e,i,n,o,l,a))}calculateSourceExtent(){const t=Tn();return this.triangles_.forEach(function(e,n,i){const s=e.source;eo(t,s[0]),eo(t,s[1]),eo(t,s[2])}),t}getTriangles(){return this.triangles_}}const Ax=Px;let cc;const $d=[];function Mg(r,t,e,n,i){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(n,i),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,n)+1,Math.max(e,i)),r.restore()}function hc(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function Dx(){if(cc===void 0){const r=document.createElement("canvas").getContext("2d");r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Mg(r,4,5,4,0),Mg(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;cc=hc(t,0)||hc(t,4)||hc(t,8)}return cc}function Og(r,t,e,n){const i=va(e,t,r);let s=Ku(t,n,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||cl(l,i)){const c=Ku(r,s,i)/s;isFinite(c)&&c>0&&(s/=c)}return s}function Fx(r,t,e,n){const i=Ys(e);let s=Og(r,t,i,n);return(!isFinite(s)||s<=0)&&Kg(e,function(o){return s=Og(r,t,o,n),isFinite(s)&&s>0}),s}function Gx(r,t,e,n,i,s,o,a,l,c,h,u){const d=fn(Math.round(e*r),Math.round(e*t),$d);if(u||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(e,e);function f(T){return Math.round(T*e)/e}d.globalCompositeOperation="lighter";const p=Tn();l.forEach(function(T,N,S){Vg(p,T.extent)});const m=Wt(p),I=zn(p),x=fn(Math.round(e*m/n),Math.round(e*I/n));u||(x.imageSmoothingEnabled=!1);const E=e/n;l.forEach(function(T,N,S){const M=T.extent[0]-p[0],L=-(T.extent[3]-p[3]),D=Wt(T.extent),Y=zn(T.extent);T.image.width>0&&T.image.height>0&&x.drawImage(T.image,c,c,T.image.width-2*c,T.image.height-2*c,M*E,L*E,D*E,Y*E)});const R=Us(o);return a.getTriangles().forEach(function(T,N,S){const M=T.source,L=T.target;let D=M[0][0],Y=M[0][1],W=M[1][0],B=M[1][1],$=M[2][0],it=M[2][1];const Z=f((L[0][0]-R[0])/s),V=f(-(L[0][1]-R[1])/s),X=f((L[1][0]-R[0])/s),st=f(-(L[1][1]-R[1])/s),xt=f((L[2][0]-R[0])/s),_t=f(-(L[2][1]-R[1])/s),Mt=D,k=Y;D=0,Y=0,W-=Mt,B-=k,$-=Mt,it-=k;const ke=[[W,B,0,0,X-Z],[$,it,0,0,xt-Z],[0,0,W,B,st-V],[0,0,$,it,_t-V]],ot=U_(ke);if(ot){if(d.save(),d.beginPath(),Dx()||!u){d.moveTo(X,st);const ut=4,lt=Z-X,It=V-st;for(let Yt=0;Yt<ut;Yt++)d.lineTo(X+f((Yt+1)*lt/ut),st+f(Yt*It/(ut-1))),Yt!=ut-1&&d.lineTo(X+f((Yt+1)*lt/ut),st+f((Yt+1)*It/(ut-1)));d.lineTo(xt,_t)}else d.moveTo(X,st),d.lineTo(Z,V),d.lineTo(xt,_t);d.clip(),d.transform(ot[0],ot[2],ot[1],ot[3],Z,V),d.translate(p[0]-Mt,p[3]-k),d.scale(n/e,-n/e),d.drawImage(x.canvas,0,0),d.restore()}}),h&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,a.getTriangles().forEach(function(T,N,S){const M=T.target,L=(M[0][0]-R[0])/s,D=-(M[0][1]-R[1])/s,Y=(M[1][0]-R[0])/s,W=-(M[1][1]-R[1])/s,B=(M[2][0]-R[0])/s,$=-(M[2][1]-R[1])/s;d.beginPath(),d.moveTo(Y,W),d.lineTo(L,D),d.lineTo(B,$),d.closePath(),d.stroke()}),d.restore()),d.canvas}class kx extends zd{constructor(t,e,n,i,s,o,a,l,c,h,u,d){super(s,tt.IDLE,{interpolate:!!d}),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=i,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const f=i.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let m=this.sourceTileGrid_.getExtent();const I=p?no(f,p):f;if(yc(I)===0){this.state=tt.EMPTY;return}const x=t.getExtent();x&&(m?m=no(m,x):m=x);const E=i.getResolution(this.wrappedTileCoord_[0]),R=Fx(t,n,I,E);if(!isFinite(R)||R<=0){this.state=tt.EMPTY;return}const T=h!==void 0?h:Mx;if(this.triangulation_=new Ax(t,n,I,m,R*T,E),this.triangulation_.getTriangles().length===0){this.state=tt.EMPTY;return}this.sourceZ_=e.getZForResolution(R);let N=this.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(N[1]=ce(N[1],m[1],m[3]),N[3]=ce(N[3],m[1],m[3])):N=no(N,m)),!yc(N))this.state=tt.EMPTY;else{const S=e.getTileRangeForExtentAndZ(N,this.sourceZ_);for(let M=S.minX;M<=S.maxX;M++)for(let L=S.minY;L<=S.maxY;L++){const D=c(this.sourceZ_,M,L,a);D&&this.sourceTiles_.push(D)}this.sourceTiles_.length===0&&(this.state=tt.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,n,i){e&&e.getState()==tt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=tt.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Gx(i,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=tt.LOADED}this.changed()}load(){if(this.state==tt.IDLE){this.state=tt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,i){const s=e.getState();if(s==tt.IDLE||s==tt.LOADING){t++;const o=wt(e,ft.CHANGE,function(a){const l=e.getState();(l==tt.LOADED||l==tt.ERROR||l==tt.EMPTY)&&(Zt(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,i){e.getState()==tt.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Zt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ed(this.canvas_.getContext("2d")),$d.push(this.canvas_),this.canvas_=null),super.release()}}const Fc=kx;class Yx extends Ad{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Tn(),this.tmpTileRange_=new Jd(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),n=t.getState(),i=e.getUseInterimTilesOnError();return n==tt.LOADED||n==tt.EMPTY||n==tt.ERROR&&!i}getTile(t,e,n,i){const s=i.pixelRatio,o=i.viewState.projection,a=this.getLayer();let c=a.getSource().getTile(t,e,n,s,o);return c.getState()==tt.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(c)||(c=c.getInterimTile()),c}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),i=ue(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!cl(s,i))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,c=n.getRenderSource(),h=c.getTileGridForProjection(l.projection),u=c.getTilePixelRatio(e.pixelRatio);for(let d=h.getZForResolution(l.resolution);d>=h.getMinZoom();--d){const f=h.getTileCoordForCoordAndZ(i,d),p=c.getTile(d,f[1],f[2],o,a);if(!(p instanceof Xd||p instanceof Fc)||p instanceof Fc&&p.getState()===tt.EMPTY)return null;if(p.getState()!==tt.LOADED)continue;const m=h.getOrigin(d),I=hn(h.getTileSize(d)),x=h.getResolution(d),E=Math.floor(u*((i[0]-m[0])/x-f[1]*I[0])),R=Math.floor(u*((m[1]-i[1])/x-f[2]*I[1])),T=Math.round(u*c.getGutterForProjection(l.projection));return this.getImageData(p.getImage(),E+T,R+T)}return null}loadedTileCallback(t,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(t,e,n):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],i=t.viewState,s=i.projection,o=i.resolution,a=i.center,l=i.rotation,c=t.pixelRatio,h=this.getLayer(),u=h.getSource(),d=u.getRevision(),f=u.getTileGridForProjection(s),p=f.getZForResolution(o,u.zDirection),m=f.getResolution(p);let I=t.extent;const x=t.viewState.resolution,E=u.getTilePixelRatio(c),R=Math.round(Wt(I)/x*c),T=Math.round(zn(I)/x*c),N=n.extent&&ns(n.extent);N&&(I=no(I,ns(n.extent)));const S=m*R/2/E,M=m*T/2/E,L=[a[0]-S,a[1]-M,a[0]+S,a[1]+M],D=f.getTileRangeForExtentAndZ(I,p),Y={};Y[p]={};const W=this.createLoadedTileFinder(u,s,Y),B=this.tmpExtent,$=this.tmpTileRange_;this.newTiles_=!1;const it=l?Ec(i.center,x,l,t.size):void 0;for(let ke=D.minX;ke<=D.maxX;++ke)for(let ot=D.minY;ot<=D.maxY;++ot){if(l&&!f.tileCoordIntersectsViewport([p,ke,ot],it))continue;const ut=this.getTile(p,ke,ot,t);if(this.isDrawableTile(ut)){const Yt=bt(this);if(ut.getState()==tt.LOADED){Y[p][ut.tileCoord.toString()]=ut;let pe=ut.inTransition(Yt);pe&&n.opacity!==1&&(ut.endTransition(Yt),pe=!1),!this.newTiles_&&(pe||!this.renderedTiles.includes(ut))&&(this.newTiles_=!0)}if(ut.getAlpha(Yt,t.time)===1)continue}const lt=f.getTileCoordChildTileRange(ut.tileCoord,$,B);let It=!1;lt&&(It=W(p+1,lt)),It||f.forEachTileCoordParentTileRange(ut.tileCoord,W,$,B)}const Z=m/o*c/E;Di(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/c,1/c,l,-R/2,-T/2);const V=Zg(this.pixelTransform);this.useContainer(e,V,this.getBackground(t));const X=this.context,st=X.canvas;Vc(this.inversePixelTransform,this.pixelTransform),Di(this.tempTransform,R/2,T/2,Z,Z,0,-R/2,-T/2),st.width!=R||st.height!=T?(st.width=R,st.height=T):this.containerReused||X.clearRect(0,0,R,T),N&&this.clipUnrotated(X,t,N),u.getInterpolate()||(X.imageSmoothingEnabled=!1),this.preRender(X,t),this.renderedTiles.length=0;let xt=Object.keys(Y).map(Number);xt.sort(Gs);let _t,Mt,k;n.opacity===1&&(!this.containerReused||u.getOpaque(t.viewState.projection))?xt=xt.reverse():(_t=[],Mt=[]);for(let ke=xt.length-1;ke>=0;--ke){const ot=xt[ke],ut=u.getTilePixelSize(ot,c,s),It=f.getResolution(ot)/m,Yt=ut[0]*It*Z,pe=ut[1]*It*Z,Vt=f.getTileCoordForCoordAndZ(Us(L),ot),gt=f.getTileCoordExtent(Vt),Q=ue(this.tempTransform,[E*(gt[0]-L[0])/m,E*(L[3]-gt[3])/m]),he=E*u.getGutterForProjection(s),we=Y[ot];for(const fe in we){const He=we[fe],Ve=He.tileCoord,jn=Vt[1]-Ve[1],qe=Math.round(Q[0]-(jn-1)*Yt),mn=Vt[2]-Ve[2],pi=Math.round(Q[1]-(mn-1)*pe),yt=Math.round(Q[0]-jn*Yt),Ht=Math.round(Q[1]-mn*pe),ne=qe-yt,ye=pi-Ht,Ke=p===ot,on=Ke&&He.getAlpha(bt(this),t.time)!==1;let Te=!1;if(!on)if(_t){k=[yt,Ht,yt+ne,Ht,yt+ne,Ht+ye,yt,Ht+ye];for(let ie=0,_n=_t.length;ie<_n;++ie)if(p!==ot&&ot<Mt[ie]){const se=_t[ie];tn([yt,Ht,yt+ne,Ht+ye],[se[0],se[3],se[4],se[7]])&&(Te||(X.save(),Te=!0),X.beginPath(),X.moveTo(k[0],k[1]),X.lineTo(k[2],k[3]),X.lineTo(k[4],k[5]),X.lineTo(k[6],k[7]),X.moveTo(se[6],se[7]),X.lineTo(se[4],se[5]),X.lineTo(se[2],se[3]),X.lineTo(se[0],se[1]),X.clip())}_t.push(k),Mt.push(ot)}else X.clearRect(yt,Ht,ne,ye);this.drawTileImage(He,t,yt,Ht,ne,ye,he,Ke),_t&&!on?(Te&&X.restore(),this.renderedTiles.unshift(He)):this.renderedTiles.push(He),this.updateUsedTiles(t.usedTiles,u,He)}}return this.renderedRevision=d,this.renderedResolution=m,this.extentChanged=!this.renderedExtent_||!ao(this.renderedExtent_,L),this.renderedExtent_=L,this.renderedPixelRatio=c,this.renderedProjection=s,this.manageTilePyramid(t,u,f,c,s,I,p,h.getPreload()),this.scheduleExpireCache(t,u),this.postRender(X,t),n.extent&&X.restore(),X.imageSmoothingEnabled=!0,V!==st.style.transform&&(st.style.transform=V),this.container}drawTileImage(t,e,n,i,s,o,a,l){const c=this.getTileImage(t);if(!c)return;const h=bt(this),u=e.layerStatesArray[e.layerIndex],d=u.opacity*(l?t.getAlpha(h,e.time):1),f=d!==this.context.globalAlpha;f&&(this.context.save(),this.context.globalAlpha=d),this.context.drawImage(c,a,a,c.width-2*a,c.height-2*a,n,i,s,o),f&&this.context.restore(),d!==u.opacity?e.animate=!0:l&&t.endTransition(h)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const n=function(i,s,o){const a=bt(i);a in o.usedTiles&&i.expireCache(o.viewState.projection,o.usedTiles[a])}.bind(null,e);t.postRenderFunctions.push(n)}}updateUsedTiles(t,e,n){const i=bt(e);i in t||(t[i]={}),t[i][n.getKey()]=!0}manageTilePyramid(t,e,n,i,s,o,a,l,c){const h=bt(e);h in t.wantedTiles||(t.wantedTiles[h]={});const u=t.wantedTiles[h],d=t.tileQueue,f=n.getMinZoom(),p=t.viewState.rotation,m=p?Ec(t.viewState.center,t.viewState.resolution,p,t.size):void 0;let I=0,x,E,R,T,N,S;for(S=f;S<=a;++S)for(E=n.getTileRangeForExtentAndZ(o,S,E),R=n.getResolution(S),T=E.minX;T<=E.maxX;++T)for(N=E.minY;N<=E.maxY;++N)p&&!n.tileCoordIntersectsViewport([S,T,N],m)||(a-S<=l?(++I,x=e.getTile(S,T,N,i,s),x.getState()==tt.IDLE&&(u[x.getKey()]=!0,d.isKeyQueued(x.getKey())||d.enqueue([x,h,n.getTileCoordCenter(x.tileCoord),R])),c!==void 0&&c(x)):e.useTile(S,T,N,s));e.updateCacheSize(I,s)}}const zx=Yx;class Xx extends vx{constructor(t){super(t)}createRenderer(){return new zx(this)}}const Wx=Xx,uc={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Bx=[0,0,0],Hi=5;class jx{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Et(h_(this.resolutions_,function(i,s){return s-i},!0),17);let e;if(!t.origins){for(let i=0,s=this.resolutions_.length-1;i<s;++i)if(!e)e=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Et(this.origins_.length==this.resolutions_.length,20));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Us(n)),Et(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Et(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Eh,Et(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(i,s){const o=new Jd(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const i=this.getTileRangeForExtentAndZ(t,e);for(let s=i.minX,o=i.maxX;s<=o;++s)for(let a=i.minY,l=i.maxY;a<=l;++a)n([e,s,a])}forEachTileCoordParentTileRange(t,e,n,i){let s,o,a,l=null,c=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,i);c>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=ar(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,c,n),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return ar(s,s+1,o,o+1,e)}const i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const i=t[0],s=t[1],o=t[2];if(e===i)return ar(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-i),c=Math.floor(s*l),h=Math.floor(o*l);if(e<i)return ar(c,c,h,h,n);const u=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return ar(c,u,h,d,n)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,n)}getTileRangeExtent(t,e,n){const i=this.getOrigin(t),s=this.getResolution(t),o=hn(this.getTileSize(t),this.tmpSize_),a=i[0]+e.minX*o[0]*s,l=i[0]+(e.maxX+1)*o[0]*s,c=i[1]+e.minY*o[1]*s,h=i[1]+(e.maxY+1)*o[1]*s;return gi(a,c,l,h,n)}getTileRangeForExtentAndZ(t,e,n){const i=Bx;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,i);const s=i[1],o=i[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,i),ar(s,i[1],o,i[2],n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=hn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*i[0]*n,e[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=hn(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*i,a=n[1]-(t[2]+1)*s[1]*i,l=o+s[0]*i,c=a+s[1]*i;return gi(o,a,l,c,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,i,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),c=hn(this.getTileSize(o),this.tmpSize_);let h=a*(t-l[0])/n/c[0],u=a*(l[1]-e)/n/c[1];return i?(h=ca(h,Hi)-1,u=ca(u,Hi)-1):(h=la(h,Hi),u=la(u,Hi)),bg(o,h,u,s)}getTileCoordForXYAndZ_(t,e,n,i,s){const o=this.getOrigin(n),a=this.getResolution(n),l=hn(this.getTileSize(n),this.tmpSize_);let c=(t-o[0])/a/l[0],h=(o[1]-e)/a/l[1];return i?(c=ca(c,Hi)-1,h=ca(h,Hi)-1):(c=la(c,Hi),h=la(h,Hi)),bg(n,c,h,s)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Zc(this.resolutions_,t,e||0);return ce(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return hd(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let i=this.minZoom;i<e;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}}const Qd=jx;function tf(r){let t=r.getDefaultTileGrid();return t||(t=Hx(r),r.setDefaultTileGrid(t)),t}function Zx(r,t,e){const n=t[0],i=r.getTileCoordCenter(t),s=Sh(e);if(cl(s,i))return t;{const o=Wt(s),a=Math.ceil((s[0]-i[0])/o);return i[0]+=o*a,r.getTileCoordForCoordAndZ(i,n)}}function Ux(r,t,e,n){n=n!==void 0?n:"top-left";const i=nf(r,t,e);return new Qd({extent:r,origin:v_(r,n),resolutions:i,tileSize:e})}function ef(r){const t=r||{},e=t.extent||_e("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:nf(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Qd(n)}function nf(r,t,e,n){t=t!==void 0?t:w0,e=hn(e!==void 0?e:Eh);const i=zn(r),s=Wt(r);n=n>0?n:Math.max(s/e[0],i/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function Hx(r,t,e,n){const i=Sh(r);return Ux(i,t,e,n)}function Sh(r){r=_e(r);let t=r.getExtent();if(!t){const e=180*lo.degrees/r.getMetersPerUnit();t=gi(-e,-e,e,e)}return t}class Vx extends kd{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&hn(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new qd(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const n=this.getTileCacheForProjection(t);n&&n.expireCache(e)}forEachLoadedTile(t,e,n,i){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,c;for(let h=n.minX;h<=n.maxX;++h)for(let u=n.minY;u<=n.maxY;++u)l=xl(e,h,u),c=!1,s.containsKey(l)&&(a=s.get(l),c=a.getState()===tt.LOADED,c&&(c=i(a)!==!1)),c||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,n,i,s){return at()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:tf(t)}getTileCacheForProjection(t){const e=this.getProjection();return Et(e===null||Ts(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),o=hn(i.getTileSize(t),this.tmpSize);return s==1?o:vp(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Zx(n,t,e)),Sx(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,e,n,i){}}class qx extends Yi{constructor(t,e){super(t),this.tile=e}}const Kx=Vx;function Jx(r,t){const e=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(e,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(s,function(){const c=o[0],h=t.getFullTileRange(c);return Et(h,55),(h.getHeight()-o[2]-1).toString()})}}function $x(r,t){const e=r.length,n=new Array(e);for(let i=0;i<e;++i)n[i]=Jx(r[i],t);return Qx(n)}function Qx(r){return r.length===1?r[0]:function(t,e,n){if(t){const i=Nx(t),s=yr(i,r.length);return r[s](t,e,n)}else return}}function tE(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const n=e[1].charCodeAt(0),i=e[2].charCodeAt(0);let s;for(s=n;s<=i;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const n=parseInt(e[2],10);for(let i=parseInt(e[1],10);i<=n;i++)t.push(r.replace(e[0],i.toString()));return t}return t.push(r),t}class Lh extends Kx{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Lh.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=bt(e),i=e.getState();let s;i==tt.LOADING?(this.tileLoadingKeys_[n]=!0,s=uc.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==tt.ERROR?uc.TILELOADERROR:i==tt.LOADED?uc.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new qx(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=tE(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction($x(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}useTile(t,e,n){const i=xl(t,e,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const eE=Lh;class nE extends eE{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:iE,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Xd,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(const i in this.tileCacheForProjection){const s=this.tileCacheForProjection[i];s.expireCache(s==n?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!Ts(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!Ts(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ts(e,t)))return this.tileGrid;{const n=bt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=tf(t)),this.tileGridForProjection[n]}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||Ts(e,t))return this.tileCache;{const n=bt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new qd(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}}createTile_(t,e,n,i,s,o){const a=[t,e,n],l=this.getTileCoordForTileUrlFunction(a,s),c=l?this.tileUrlFunction(l,i,s):void 0,h=new this.tileClass(a,c!==void 0?tt.IDLE:tt.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return h.key=o,h.addEventListener(ft.CHANGE,this.handleTileChange.bind(this)),h}getTile(t,e,n,i,s){const o=this.getProjection();if(!o||!s||Ts(o,s))return this.getTileInternal(t,e,n,i,o||s);{const a=this.getTileCacheForProjection(s),l=[t,e,n];let c;const h=Vd(l);a.containsKey(h)&&(c=a.get(h));const u=this.getKey();if(c&&c.key==u)return c;{const d=this.getTileGridForProjection(o),f=this.getTileGridForProjection(s),p=this.getTileCoordForTileUrlFunction(l,s),m=new Fc(o,d,s,f,l,p,this.getTilePixelRatio(i),this.getGutter(),function(I,x,E,R){return this.getTileInternal(I,x,E,R,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return m.key=u,c?(m.interimTile=c,m.refreshInterimChain(),a.replace(h,m)):a.set(h,m),m}}}getTileInternal(t,e,n,i,s){let o=null;const a=xl(t,e,n),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,n,i,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const c=o;o=this.createTile_(t,e,n,i,s,l),c.getState()==tt.IDLE?o.interimTile=c.interimTile:o.interimTile=c,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const n=_e(t);if(n){const i=bt(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function iE(r,t){r.getImage().src=t}const sE=nE;class rE extends sE{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:ef({extent:Sh(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const oE=rE,aE='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class lE extends oE{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[aE];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",i=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:i,wrapX:t.wrapX,zDirection:t.zDirection})}}const cE=lE;let hE=class Gc extends id{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Zt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(wt(this.geometries_[t],ft.CHANGE,this.changed,this))}clone(){const t=new Gc(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Zs(this.getExtent(),t,e))return i;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)i=s[o].closestPointXY(t,e,n,i);return i}containsXY(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)if(n[i].containsXY(t,e))return!0;return!1}computeExtent(t){Ao(t);const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)Vg(t,e[n].getExtent());return t}getGeometries(){return Pg(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let i=!1;for(let s=0,o=n.length;s<o;++s){const a=n[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(i=!0)}if(i){const s=new Gc(null);return s.setGeometriesArray(e),s}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Ys(this.getExtent()));const i=this.geometries_;for(let s=0,o=i.length;s<o;++s)i[s].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(Pg(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,i=e.length;n<i;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let i=0,s=n.length;i<s;++i)n[i].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function Pg(r){const t=[];for(let e=0,n=r.length;e<n;++e)t.push(r[e].clone());return t}const uE=hE;let gE=class kc extends Hs{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{let i=this.getLayout();const s=t,o=[],a=[];for(let l=0,c=s.length;l<c;++l){const h=s[l];l===0&&(i=h.getLayout()),Oi(o,h.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(i,o),this.ends_=a}}appendLineString(t){this.flatCoordinates?Oi(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new kc(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,i){return i<Zs(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ih(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),rh(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,i))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Lp(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return ho(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Rn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,i=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],c=new Rn(t.slice(s,l),n);i.push(c),s=l}return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const i=this.ends_,s=this.stride;for(let o=0,a=i.length;o<a;++o){const l=i[o],c=md(e,n,l,s,.5);Oi(t,c),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=mp(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new kc(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return wp(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=oh(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}};const rs=gE;let dE=class sf extends Hs{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?Oi(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new sf(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,i){if(i<Zs(this.getExtent(),t,e))return i;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const c=As(t,e,s[a],s[a+1]);if(c<i){i=c;for(let h=0;h<o;++h)n[h]=s[a+h];n.length=o}}return i}getCoordinates(){return is(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Fe(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,i=[];for(let s=0,o=t.length;s<o;s+=n){const a=new Fe(t.slice(s,s+n),e);i.push(a)}return i}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let i=0,s=e.length;i<s;i+=n){const o=e[i],a=e[i+1];if(Kc(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fl(this.flatCoordinates,0,t,this.stride),this.changed()}};const Yr=dE;function fE(r,t,e,n){const i=[];let s=Tn();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Hg(r,t,l[0],n),i.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return i}let mE=class Yc extends Hs{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){let i=this.getLayout();const s=t,o=[],a=[];for(let l=0,c=s.length;l<c;++l){const h=s[l];l===0&&(i=h.getLayout());const u=o.length,d=h.getEnds();for(let f=0,p=d.length;f<p;++f)d[f]+=u;Oi(o,h.getFlatCoordinates()),a.push(d)}e=i,t=o,n=a}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;Oi(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let i=0,s=e.length;i<s;++i)e[i]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const n=new Yc(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,i){return i<Zs(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(up(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,i))}containsXY(t,e){return Cp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return yp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),eg(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,wc(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=fE(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Rp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Yr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Sp(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=eg(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=pp(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Yc(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const n=this.endss_[t].slice(),i=n[n.length-1];if(e!==0)for(let s=0,o=n.length;s<o;++s)n[s]-=e;return new de(this.flatCoordinates.slice(e,i),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,i=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o].slice(),c=l[l.length-1];if(s!==0)for(let u=0,d=l.length;u<d;++u)l[u]-=s;const h=new de(e.slice(s,c),t,l);i.push(h),s=c}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return Tp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=fp(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const i=n[n.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}};const De=mE;class _E{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?_e(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=_e(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return at()}readFeature(t,e){return at()}readFeatures(t,e){return at()}readGeometry(t,e){return at()}readProjection(t){return at()}writeFeature(t,e){return at()}writeFeatures(t,e){return at()}writeGeometry(t,e){return at()}}function rf(r,t,e){const n=e?_e(e.featureProjection):null,i=e?_e(e.dataProjection):null;let s;if(n&&i&&!Ts(n,i)?s=(t?r.clone():r).transform(t?n:i,t?i:n):s=r,t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let c=0,h=l.length;c<h;++c)l[c]=Math.round(l[c]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}class pE extends _E{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(pa(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(pa(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return at()}readFeaturesFromObject(t,e){return at()}readGeometry(t,e){return this.readGeometryFromObject(pa(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return at()}readProjection(t){return this.readProjectionFromObject(pa(t))}readProjectionFromObject(t){return at()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return at()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return at()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return at()}}function pa(r){if(typeof r=="string"){const t=JSON.parse(r);return t||null}else return r!==null?r:null}const yE=pE;class xE extends yE{constructor(t){t=t||{},super(),this.dataProjection=_e(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=_e(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const i=zc(n.geometry,e),s=new _c;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&s.setGeometryName(n.geometry_name),s.setGeometry(i),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(t,e){const n=t;let i=null;if(n.type==="FeatureCollection"){const s=t;i=[];const o=s.features;for(let a=0,l=o.length;a<l;++a)i.push(this.readFeatureFromObject(o[a],e))}else i=[this.readFeatureFromObject(t,e)];return i}readGeometryFromObject(t,e){return zc(t,e)}readProjectionFromObject(t){const e=t.crs;let n;return e?e.type=="name"?n=_e(e.properties.name):e.type==="EPSG"?n=_e("EPSG:"+e.properties.code):Et(!1,36):n=this.dataProjection,n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},i=t.getId();if(i!==void 0&&(n.id=i),!t.hasProperties())return n;const s=t.getProperties(),o=t.getGeometry();return o&&(n.geometry=Xc(o,e),delete s[t.getGeometryName()]),br(s)||(n.properties=s),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let i=0,s=t.length;i<s;++i)n.push(this.writeFeatureObject(t[i],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Xc(t,this.adaptOptions(e))}}function zc(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=IE(r);break}case"LineString":{e=CE(r);break}case"Polygon":{e=NE(r);break}case"MultiPoint":{e=wE(r);break}case"MultiLineString":{e=RE(r);break}case"MultiPolygon":{e=TE(r);break}case"GeometryCollection":{e=EE(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return rf(e,!1,t)}function EE(r,t){const e=r.geometries.map(function(n){return zc(n,t)});return new uE(e)}function IE(r){return new Fe(r.coordinates)}function CE(r){return new Rn(r.coordinates)}function RE(r){return new rs(r.coordinates)}function wE(r){return new Yr(r.coordinates)}function TE(r){return new De(r.coordinates)}function NE(r){return new de(r.coordinates)}function Xc(r,t){r=rf(r,!0,t);const e=r.getType();let n;switch(e){case"Point":{n=OE(r);break}case"LineString":{n=LE(r);break}case"Polygon":{n=PE(r,t);break}case"MultiPoint":{n=vE(r);break}case"MultiLineString":{n=bE(r);break}case"MultiPolygon":{n=ME(r,t);break}case"GeometryCollection":{n=SE(r,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function SE(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return Xc(n,t)})}}function LE(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function bE(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function vE(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function ME(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function OE(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function PE(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}const of=xE;var Jr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function AE(r){if(r.__esModule)return r;var t=r.default;if(typeof t=="function"){var e=function n(){if(this instanceof n){var i=[null];i.push.apply(i,arguments);var s=Function.bind.apply(t,i);return new s}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),e}var Ga={},DE={get exports(){return Ga},set exports(r){Ga=r}};class FE{constructor(t=[],e=GE){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const s=t-1>>1,o=e[s];if(n(i,o)>=0)break;e[t]=o,t=s}e[t]=i}_down(t){const{data:e,compare:n}=this,i=this.length>>1,s=e[t];for(;t<i;){let o=(t<<1)+1,a=e[o];const l=o+1;if(l<this.length&&n(e[l],a)<0&&(o=l,a=e[l]),n(a,s)>=0)break;e[t]=a,t=o}e[t]=s}}function GE(r,t){return r<t?-1:r>t?1:0}const kE=Object.freeze(Object.defineProperty({__proto__:null,default:FE},Symbol.toStringTag,{value:"Module"})),YE=AE(kE);var Ra=YE;Ra.default&&(Ra=Ra.default);DE.exports=af;Ga.default=af;function af(r,t,e){t=t||1;for(var n,i,s,o,a=0;a<r[0].length;a++){var l=r[0][a];(!a||l[0]<n)&&(n=l[0]),(!a||l[1]<i)&&(i=l[1]),(!a||l[0]>s)&&(s=l[0]),(!a||l[1]>o)&&(o=l[1])}var c=s-n,h=o-i,u=Math.min(c,h),d=u/2;if(u===0){var f=[n,i];return f.distance=0,f}for(var p=new Ra(void 0,zE),m=n;m<s;m+=u)for(var I=i;I<o;I+=u)p.push(new $i(m+d,I+d,d,r));var x=WE(r),E=new $i(n+c/2,i+h/2,0,r);E.d>x.d&&(x=E);for(var R=p.length;p.length;){var T=p.pop();T.d>x.d&&(x=T,e&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,R)),!(T.max-x.d<=t)&&(d=T.h/2,p.push(new $i(T.x-d,T.y-d,d,r)),p.push(new $i(T.x+d,T.y-d,d,r)),p.push(new $i(T.x-d,T.y+d,d,r)),p.push(new $i(T.x+d,T.y+d,d,r)),R+=4)}e&&(console.log("num probes: "+R),console.log("best distance: "+x.d));var N=[x.x,x.y];return N.distance=x.d,N}function zE(r,t){return t.max-r.max}function $i(r,t,e,n){this.x=r,this.y=t,this.h=e,this.d=XE(r,t,n),this.max=this.d+this.h*Math.SQRT2}function XE(r,t,e){for(var n=!1,i=1/0,s=0;s<e.length;s++)for(var o=e[s],a=0,l=o.length,c=l-1;a<l;c=a++){var h=o[a],u=o[c];h[1]>t!=u[1]>t&&r<(u[0]-h[0])*(t-h[1])/(u[1]-h[1])+h[0]&&(n=!n),i=Math.min(i,BE(r,t,h,u))}return i===0?0:(n?1:-1)*Math.sqrt(i)}function WE(r){for(var t=0,e=0,n=0,i=r[0],s=0,o=i.length,a=o-1;s<o;a=s++){var l=i[s],c=i[a],h=l[0]*c[1]-c[0]*l[1];e+=(l[0]+c[0])*h,n+=(l[1]+c[1])*h,t+=h*3}return t===0?new $i(i[0][0],i[0][1],0,r):new $i(e/t,n/t,0,r)}function BE(r,t,e,n){var i=e[0],s=e[1],o=n[0]-i,a=n[1]-s;if(o!==0||a!==0){var l=((r-i)*o+(t-s)*a)/(o*o+a*a);l>1?(i=n[0],s=n[1]):l>0&&(i+=o*l,s+=a*l)}return o=r-i,a=t-s,o*o+a*a}function H(r,t){return r.interfaces_&&r.interfaces_.indexOf(t)>-1}class Ns{constructor(t,e){this.low=e||0,this.high=t||0}static toBinaryString(t){let e,n="";for(e=2147483648;e>0;e>>>=1)n+=(t.high&e)===e?"1":"0";for(e=2147483648;e>0;e>>>=1)n+=(t.low&e)===e?"1":"0";return n}}function j(){}j.isNaN=r=>Number.isNaN(r);j.isInfinite=r=>!Number.isFinite(r);j.MAX_VALUE=Number.MAX_VALUE;typeof Float64Array=="function"&&typeof Int32Array=="function"?function(){const e=new Float64Array(1),n=new Int32Array(e.buffer);j.doubleToLongBits=function(i){e[0]=i;let s=n[0]|0,o=n[1]|0;return(o&2146435072)===2146435072&&o&1048575&&s!==0&&(s=0,o=2146959360),new Ns(o,s)},j.longBitsToDouble=function(i){return n[0]=i.low,n[1]=i.high,e[0]}}():function(){const t=Math.log2,e=Math.floor,n=Math.pow,i=function(){for(let s=53;s>0;s--){const o=n(2,s)-1;if(e(t(o))+1===s)return o}return 0}();j.doubleToLongBits=function(s){let o,a,l,c,h,u,d,f,p;if(s<0||1/s===Number.NEGATIVE_INFINITY?(u=1<<31,s=-s):u=0,s===0)return p=0,f=u,new Ns(f,p);if(s===1/0)return p=0,f=u|2146435072,new Ns(f,p);if(s!==s)return p=0,f=2146959360,new Ns(f,p);if(c=0,p=0,o=e(s),o>1)if(o<=i)c=e(t(o)),c<=20?(p=0,f=o<<20-c&1048575):(l=c-20,a=n(2,l),p=o%a<<32-l,f=o/a&1048575);else for(l=o,p=0;a=l/2,l=e(a),l!==0;)c++,p>>>=1,p|=(f&1)<<31,f>>>=1,a!==l&&(f|=524288);if(d=c+1023,h=o===0,o=s-o,c<52&&o!==0)for(l=0;;){if(a=o*2,a>=1?(o=a-1,h?(d--,h=!1):(l<<=1,l|=1,c++)):(o=a,h?--d===0&&(c++,h=!1):(l<<=1,c++)),c===20)f|=l,l=0;else if(c===52){p|=l;break}if(a===1){c<20?f|=l<<20-c:c<52&&(p|=l<<52-c);break}}return f|=d<<20,f|=u,new Ns(f,p)},j.longBitsToDouble=function(s){let o,a,l,c;const h=s.high,u=s.low,d=h&1<<31?-1:1;for(l=((h&2146435072)>>20)-1023,c=0,a=1<<19,o=1;o<=20;o++)h&a&&(c+=n(2,-o)),a>>>=1;for(a=1<<31,o=21;o<=52;o++)u&a&&(c+=n(2,-o)),a>>>=1;if(l===-1023){if(c===0)return d*0;l=-1022}else{if(l===1023+1)return c===0?d/0:NaN;c+=1}return d*c*n(2,l)}}();function zr(){}class Rt{getM(t){if(this.hasM()){const e=this.getDimension()-this.getMeasures();return this.getOrdinate(t,e)}else return j.NaN}setOrdinate(t,e,n){}getZ(t){return this.hasZ()?this.getOrdinate(t,2):j.NaN}size(){}getOrdinate(t,e){}getCoordinate(){}getCoordinateCopy(t){}createCoordinate(){}getDimension(){}hasM(){return this.getMeasures()>0}getX(t){}hasZ(){return this.getDimension()-this.getMeasures()>2}getMeasures(){return 0}expandEnvelope(t){}copy(){}getY(t){}toCoordinateArray(){}get interfaces_(){return[zr]}}Rt.X=0;Rt.Y=1;Rt.Z=2;Rt.M=3;class lf{create(){if(arguments.length===1)arguments[0]instanceof Array||H(arguments[0],Rt);else if(arguments.length!==2){if(arguments.length===3){const t=arguments[0],e=arguments[1];return this.create(t,e)}}}}class gn{constructor(t){this.message=t}toString(){return this.message}}class ht extends gn{}class Xr{filter(t){}}function sn(){}function rn(){}class gc{static equalsWithTolerance(t,e,n){return Math.abs(t-e)<=n}}function gs(){}class ai extends gn{}class ya extends ai{}class et{static shouldNeverReachHere(){if(arguments.length===0)et.shouldNeverReachHere(null);else if(arguments.length===1){const t=arguments[0];throw new ya("Should never reach here"+(t!==null?": "+t:""))}}static isTrue(){if(arguments.length===1){const t=arguments[0];et.isTrue(t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(!t)throw e===null?new ya:new ya(e)}}static equals(){if(arguments.length===2){const t=arguments[0],e=arguments[1];et.equals(t,e,null)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(!e.equals(t))throw new ya("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))}}}const cf=new ArrayBuffer(8),jE=new Float64Array(cf),Ag=new Int32Array(cf);class w{constructor(){w.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)w.constructor_.call(this,0,0);else if(arguments.length===1){const t=arguments[0];w.constructor_.call(this,t.x,t.y,t.getZ())}else if(arguments.length===2){const t=arguments[0],e=arguments[1];w.constructor_.call(this,t,e,w.NULL_ORDINATE)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this.x=t,this.y=e,this.z=n}}static hashCode(t){return jE[0]=t,Ag[0]^Ag[1]}getM(){return j.NaN}setOrdinate(t,e){switch(t){case w.X:this.x=e;break;case w.Y:this.y=e;break;case w.Z:this.setZ(e);break;default:throw new ht("Invalid ordinate index: "+t)}}equals2D(){if(arguments.length===1){const t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return!(!gc.equalsWithTolerance(this.x,t.x,e)||!gc.equalsWithTolerance(this.y,t.y,e))}}setM(t){throw new ht("Invalid ordinate index: "+w.M)}getZ(){return this.z}getOrdinate(t){switch(t){case w.X:return this.x;case w.Y:return this.y;case w.Z:return this.getZ()}throw new ht("Invalid ordinate index: "+t)}equals3D(t){return this.x===t.x&&this.y===t.y&&(this.getZ()===t.getZ()||j.isNaN(this.getZ())&&j.isNaN(t.getZ()))}equals(t){return t instanceof w?this.equals2D(t):!1}equalInZ(t,e){return gc.equalsWithTolerance(this.getZ(),t.getZ(),e)}setX(t){this.x=t}compareTo(t){const e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}getX(){return this.x}setZ(t){this.z=t}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return et.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}finally{}}copy(){return new w(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}distance3D(t){const e=this.x-t.x,n=this.y-t.y,i=this.getZ()-t.getZ();return Math.sqrt(e*e+n*n+i*i)}getY(){return this.y}setY(t){this.y=t}distance(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}hashCode(){let t=17;return t=37*t+w.hashCode(this.x),t=37*t+w.hashCode(this.y),t}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}get interfaces_(){return[sn,zr,rn]}}class Ss{constructor(){Ss.constructor_.apply(this,arguments)}static constructor_(){if(this._dimensionsToTest=2,arguments.length===0)Ss.constructor_.call(this,2);else if(arguments.length===1){const t=arguments[0];if(t!==2&&t!==3)throw new ht("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}}static compare(t,e){return t<e?-1:t>e?1:j.isNaN(t)?j.isNaN(e)?0:-1:j.isNaN(e)?1:0}compare(t,e){const n=Ss.compare(t.x,e.x);if(n!==0)return n;const i=Ss.compare(t.y,e.y);return i!==0?i:this._dimensionsToTest<=2?0:Ss.compare(t.getZ(),e.getZ())}get interfaces_(){return[gs]}}w.DimensionalComparator=Ss;w.NULL_ORDINATE=j.NaN;w.X=0;w.Y=1;w.Z=2;w.M=3;class ct{constructor(){ct.constructor_.apply(this,arguments)}static constructor_(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof w){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof ct){const t=arguments[0];this.init(t)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.init(t,e,n,i)}}static intersects(){if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];let s=Math.min(n.x,i.x),o=Math.max(n.x,i.x),a=Math.min(t.x,e.x),l=Math.max(t.x,e.x);return!(a>o||l<s||(s=Math.min(n.y,i.y),o=Math.max(n.y,i.y),a=Math.min(t.y,e.y),l=Math.max(t.y,e.y),a>o)||l<s)}}getArea(){return this.getWidth()*this.getHeight()}equals(t){if(!(t instanceof ct))return!1;const e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()}intersection(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new ct;const e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,i=this._maxx<t._maxx?this._maxx:t._maxx,s=this._maxy<t._maxy?this._maxy:t._maxy;return new ct(e,i,n,s)}isNull(){return this._maxx<this._minx}getMaxX(){return this._maxx}covers(){if(arguments.length===1){if(arguments[0]instanceof w){const t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof ct){const t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.isNull()?!1:t>=this._minx&&t<=this._maxx&&e>=this._miny&&e<=this._maxy}}intersects(){if(arguments.length===1){if(arguments[0]instanceof ct){const t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof w){const t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){if(arguments[0]instanceof w&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1];return!(this.isNull()||(t.x<e.x?t.x:e.x)>this._maxx||(t.x>e.x?t.x:e.x)<this._minx||(t.y<e.y?t.y:e.y)>this._maxy||(t.y>e.y?t.y:e.y)<this._miny)}else if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];return this.isNull()?!1:!(t>this._maxx||t<this._minx||e>this._maxy||e<this._miny)}}}getMinY(){return this._miny}getDiameter(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return Math.sqrt(t*t+e*e)}getMinX(){return this._minx}expandToInclude(){if(arguments.length===1){if(arguments[0]instanceof w){const t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof ct){const t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.isNull()?(this._minx=t,this._maxx=t,this._miny=e,this._maxy=e):(t<this._minx&&(this._minx=t),t>this._maxx&&(this._maxx=t),e<this._miny&&(this._miny=e),e>this._maxy&&(this._maxy=e))}}minExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t<e?t:e}getWidth(){return this.isNull()?0:this._maxx-this._minx}compareTo(t){const e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0}translate(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)}copy(){return new ct(this)}toString(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}setToNull(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}disjoint(t){return this.isNull()||t.isNull()?!0:t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny}getHeight(){return this.isNull()?0:this._maxy-this._miny}maxExtent(){if(this.isNull())return 0;const t=this.getWidth(),e=this.getHeight();return t>e?t:e}expandBy(){if(arguments.length===1){const t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=e,this._maxy+=e,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}contains(){if(arguments.length===1){if(arguments[0]instanceof ct){const t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof w){const t=arguments[0];return this.covers(t)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.covers(t,e)}}centre(){return this.isNull()?null:new w((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}init(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof w){const t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof ct){const t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t.x,e.x,t.y,e.y)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];t<e?(this._minx=t,this._maxx=e):(this._minx=e,this._maxx=t),n<i?(this._miny=n,this._maxy=i):(this._miny=i,this._maxy=n)}}getMaxY(){return this._maxy}distance(t){if(this.intersects(t))return 0;let e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);let n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)}hashCode(){let t=17;return t=37*t+w.hashCode(this._minx),t=37*t+w.hashCode(this._maxx),t=37*t+w.hashCode(this._miny),t=37*t+w.hashCode(this._maxy),t}get interfaces_(){return[sn,rn]}}class A{constructor(){A.constructor_.apply(this,arguments)}isGeometryCollection(){return this.getTypeCode()===A.TYPECODE_GEOMETRYCOLLECTION}getFactory(){return this._factory}getGeometryN(t){return this}getArea(){return 0}isRectangle(){return!1}equalsExact(t){return this===t||this.equalsExact(t,0)}geometryChanged(){this.apply(A.geometryChangedFilter)}geometryChangedAction(){this._envelope=null}equalsNorm(t){return t===null?!1:this.norm().equalsExact(t.norm())}getLength(){return 0}getNumGeometries(){return 1}compareTo(){let t;if(arguments.length===1){const e=arguments[0];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){const e=arguments[0],n=arguments[1];return t=e,this.getTypeCode()!==t.getTypeCode()?this.getTypeCode()-t.getTypeCode():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e,n)}}getUserData(){return this._userData}getSRID(){return this._SRID}getEnvelope(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}checkNotGeometryCollection(t){if(t.getTypeCode()===A.TYPECODE_GEOMETRYCOLLECTION)throw new ht("This method does not support GeometryCollection arguments")}equal(t,e,n){return n===0?t.equals(e):t.distance(e)<=n}norm(){const t=this.copy();return t.normalize(),t}reverse(){const t=this.reverseInternal();return this.envelope!=null&&(t.envelope=this.envelope.copy()),t.setSRID(this.getSRID()),t}copy(){const t=this.copyInternal();return t.envelope=this._envelope==null?null:this._envelope.copy(),t._SRID=this._SRID,t._userData=this._userData,t}getPrecisionModel(){return this._factory.getPrecisionModel()}getEnvelopeInternal(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ct(this._envelope)}setSRID(t){this._SRID=t}setUserData(t){this._userData=t}compare(t,e){const n=t.iterator(),i=e.iterator();for(;n.hasNext()&&i.hasNext();){const s=n.next(),o=i.next(),a=s.compareTo(o);if(a!==0)return a}return n.hasNext()?1:i.hasNext()?-1:0}hashCode(){return this.getEnvelopeInternal().hashCode()}isEquivalentClass(t){return this.getClass()===t.getClass()}isGeometryCollectionOrDerived(){return this.getTypeCode()===A.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===A.TYPECODE_MULTIPOINT||this.getTypeCode()===A.TYPECODE_MULTILINESTRING||this.getTypeCode()===A.TYPECODE_MULTIPOLYGON}get interfaces_(){return[zr,sn,rn]}getClass(){return A}static hasNonEmptyElements(t){for(let e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1}static hasNullElements(t){for(let e=0;e<t.length;e++)if(t[e]===null)return!0;return!1}}A.constructor_=function(r){r&&(this._envelope=null,this._userData=null,this._factory=r,this._SRID=r.getSRID())};A.TYPECODE_POINT=0;A.TYPECODE_MULTIPOINT=1;A.TYPECODE_LINESTRING=2;A.TYPECODE_LINEARRING=3;A.TYPECODE_MULTILINESTRING=4;A.TYPECODE_POLYGON=5;A.TYPECODE_MULTIPOLYGON=6;A.TYPECODE_GEOMETRYCOLLECTION=7;A.TYPENAME_POINT="Point";A.TYPENAME_MULTIPOINT="MultiPoint";A.TYPENAME_LINESTRING="LineString";A.TYPENAME_LINEARRING="LinearRing";A.TYPENAME_MULTILINESTRING="MultiLineString";A.TYPENAME_POLYGON="Polygon";A.TYPENAME_MULTIPOLYGON="MultiPolygon";A.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection";A.geometryChangedFilter={get interfaces_(){return[Xr]},filter(r){r.geometryChangedAction()}};class Wr{filter(t){}}class ZE{static ofLine(t){const e=t.size();if(e<=1)return 0;let n=0;const i=new w;t.getCoordinate(0,i);let s=i.x,o=i.y;for(let a=1;a<e;a++){t.getCoordinate(a,i);const l=i.x,c=i.y,h=l-s,u=c-o;n+=Math.sqrt(h*h+u*u),s=l,o=c}return n}}class hf{}class ae{static copyCoord(t,e,n,i){const s=Math.min(t.getDimension(),n.getDimension());for(let o=0;o<s;o++)n.setOrdinate(i,o,t.getOrdinate(e,o))}static isRing(t){const e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,Rt.X)===t.getOrdinate(e-1,Rt.X)&&t.getOrdinate(0,Rt.Y)===t.getOrdinate(e-1,Rt.Y)}static scroll(){if(arguments.length===2){if(H(arguments[0],Rt)&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];ae.scroll(t,e,ae.isRing(t))}else if(H(arguments[0],Rt)&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1],n=ae.indexOf(e,t);if(n<=0)return null;ae.scroll(t,n)}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(e<=0)return null;const s=t.copy(),o=n?t.size()-1:t.size();for(let a=0;a<o;a++)for(let l=0;l<t.getDimension();l++)t.setOrdinate(a,l,s.getOrdinate((e+a)%o,l));if(n)for(let a=0;a<t.getDimension();a++)t.setOrdinate(o,a,t.getOrdinate(0,a))}}static isEqual(t,e){const n=t.size(),i=e.size();if(n!==i)return!1;const s=Math.min(t.getDimension(),e.getDimension());for(let o=0;o<n;o++)for(let a=0;a<s;a++){const l=t.getOrdinate(o,a),c=e.getOrdinate(o,a);if(t.getOrdinate(o,a)!==e.getOrdinate(o,a)&&!(j.isNaN(l)&&j.isNaN(c)))return!1}return!0}static minCoordinateIndex(){if(arguments.length===1){const t=arguments[0];return ae.minCoordinateIndex(t,0,t.size()-1)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];let i=-1,s=null;for(let o=e;o<=n;o++){const a=t.getCoordinate(o);(s===null||s.compareTo(a)>0)&&(s=a,i=o)}return i}}static extend(t,e,n){const i=t.create(n,e.getDimension()),s=e.size();if(ae.copy(e,0,i,0,s),s>0)for(let o=s;o<n;o++)ae.copy(e,s-1,i,o,1);return i}static reverse(t){const e=t.size()-1,n=Math.trunc(e/2);for(let i=0;i<=n;i++)ae.swap(t,i,e-i)}static swap(t,e,n){if(e===n)return null;for(let i=0;i<t.getDimension();i++){const s=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,s)}}static copy(t,e,n,i,s){for(let o=0;o<s;o++)ae.copyCoord(t,e+o,n,i+o)}static ensureValidRing(t,e){const n=e.size();return n===0?e:n<=3?ae.createClosedRing(t,e,4):e.getOrdinate(0,Rt.X)===e.getOrdinate(n-1,Rt.X)&&e.getOrdinate(0,Rt.Y)===e.getOrdinate(n-1,Rt.Y)?e:ae.createClosedRing(t,e,n+1)}static indexOf(t,e){for(let n=0;n<e.size();n++)if(t.x===e.getOrdinate(n,Rt.X)&&t.y===e.getOrdinate(n,Rt.Y))return n;return-1}static createClosedRing(t,e,n){const i=t.create(n,e.getDimension()),s=e.size();ae.copy(e,0,i,0,s);for(let o=s;o<n;o++)ae.copy(e,0,i,o,1);return i}static minCoordinate(t){let e=null;for(let n=0;n<t.size();n++){const i=t.getCoordinate(n);(e===null||e.compareTo(i)>0)&&(e=i)}return e}}class _i extends gn{}class Wc{static isWhitespace(t){return t<=32&&t>=0||t===127}static toUpperCase(t){return t.toUpperCase()}}class O{static toDimensionSymbol(t){switch(t){case O.FALSE:return O.SYM_FALSE;case O.TRUE:return O.SYM_TRUE;case O.DONTCARE:return O.SYM_DONTCARE;case O.P:return O.SYM_P;case O.L:return O.SYM_L;case O.A:return O.SYM_A}throw new ht("Unknown dimension value: "+t)}static toDimensionValue(t){switch(Wc.toUpperCase(t)){case O.SYM_FALSE:return O.FALSE;case O.SYM_TRUE:return O.TRUE;case O.SYM_DONTCARE:return O.DONTCARE;case O.SYM_P:return O.P;case O.SYM_L:return O.L;case O.SYM_A:return O.A}throw new ht("Unknown dimension symbol: "+t)}}O.P=0;O.L=1;O.A=2;O.FALSE=-1;O.TRUE=-2;O.DONTCARE=-3;O.SYM_FALSE="F";O.SYM_TRUE="T";O.SYM_DONTCARE="*";O.SYM_P="0";O.SYM_L="1";O.SYM_A="2";class ds{filter(t){}}class Vs{filter(t,e){}isDone(){}isGeometryChanged(){}}class vt extends A{constructor(){super(),vt.constructor_.apply(this,arguments)}static constructor_(){if(this._points=null,arguments.length!==0){if(arguments.length===2){const t=arguments[0],e=arguments[1];A.constructor_.call(this,e),this.init(t)}}}computeEnvelopeInternal(){return this.isEmpty()?new ct:this._points.expandEnvelope(new ct)}isRing(){return this.isClosed()&&this.isSimple()}getCoordinates(){return this._points.toCoordinateArray()}copyInternal(){return new vt(this._points.copy(),this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const n=t;if(this._points.size()!==n._points.size())return!1;for(let i=0;i<this._points.size();i++)if(!this.equal(this._points.getCoordinate(i),n._points.getCoordinate(i),e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}normalize(){for(let t=0;t<Math.trunc(this._points.size()/2);t++){const e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e))){if(this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0){const n=this._points.copy();ae.reverse(n),this._points=n}return null}}}getCoordinate(){return this.isEmpty()?null:this._points.getCoordinate(0)}getBoundaryDimension(){return this.isClosed()?O.FALSE:0}isClosed(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}reverseInternal(){const t=this._points.copy();return ae.reverse(t),this.getFactory().createLineString(t)}getEndPoint(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}getTypeCode(){return A.TYPECODE_LINESTRING}getDimension(){return 1}getLength(){return ZE.ofLine(this._points)}getNumPoints(){return this._points.size()}compareToSameClass(){if(arguments.length===1){const e=arguments[0];let n=0,i=0;for(;n<this._points.size()&&i<e._points.size();){const s=this._points.getCoordinate(n).compareTo(e._points.getCoordinate(i));if(s!==0)return s;n++,i++}return n<this._points.size()?1:i<e._points.size()?-1:0}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t;return e.compare(this._points,n._points)}}apply(){if(H(arguments[0],Wr)){const t=arguments[0];for(let e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e))}else if(H(arguments[0],Vs)){const t=arguments[0];if(this._points.size()===0)return null;for(let e=0;e<this._points.size()&&(t.filter(this._points,e),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else H(arguments[0],ds)?arguments[0].filter(this):H(arguments[0],Xr)&&arguments[0].filter(this)}getBoundary(){throw new _i}isEquivalentClass(t){return t instanceof vt}getCoordinateN(t){return this._points.getCoordinate(t)}getGeometryType(){return A.TYPENAME_LINESTRING}getCoordinateSequence(){return this._points}isEmpty(){return this._points.size()===0}init(t){if(t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),t.size()===1)throw new ht("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t}isCoordinate(t){for(let e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1}getStartPoint(){return this.isEmpty()?null:this.getPointN(0)}getPointN(t){return this.getFactory().createPoint(this._points.getCoordinate(t))}get interfaces_(){return[hf]}}class uf{}class ee extends A{constructor(){super(),ee.constructor_.apply(this,arguments)}static constructor_(){this._coordinates=null;const t=arguments[0],e=arguments[1];A.constructor_.call(this,e),this.init(t)}computeEnvelopeInternal(){if(this.isEmpty())return new ct;const t=new ct;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t}getCoordinates(){return this.isEmpty()?[]:[this.getCoordinate()]}copyInternal(){return new ee(this._coordinates.copy(),this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?this.isEmpty()&&t.isEmpty()?!0:this.isEmpty()!==t.isEmpty()?!1:this.equal(t.getCoordinate(),this.getCoordinate(),e):!1}else return super.equalsExact.apply(this,arguments)}normalize(){}getCoordinate(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}getBoundaryDimension(){return O.FALSE}reverseInternal(){return this.getFactory().createPoint(this._coordinates.copy())}getTypeCode(){return A.TYPECODE_POINT}getDimension(){return 0}getNumPoints(){return this.isEmpty()?0:1}getX(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}compareToSameClass(){if(arguments.length===1){const e=arguments[0];return this.getCoordinate().compareTo(e.getCoordinate())}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t;return e.compare(this._coordinates,n._coordinates)}}apply(){if(H(arguments[0],Wr)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(H(arguments[0],Vs)){const t=arguments[0];if(this.isEmpty())return null;t.filter(this._coordinates,0),t.isGeometryChanged()&&this.geometryChanged()}else H(arguments[0],ds)?arguments[0].filter(this):H(arguments[0],Xr)&&arguments[0].filter(this)}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return A.TYPENAME_POINT}getCoordinateSequence(){return this._coordinates}getY(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}isEmpty(){return this._coordinates.size()===0}init(t){t===null&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t}isSimple(){return!0}get interfaces_(){return[uf]}}class Io{static ofRing(){if(arguments[0]instanceof Array){const t=arguments[0];return Math.abs(Io.ofRingSigned(t))}else if(H(arguments[0],Rt)){const t=arguments[0];return Math.abs(Io.ofRingSigned(t))}}static ofRingSigned(){if(arguments[0]instanceof Array){const t=arguments[0];if(t.length<3)return 0;let e=0;const n=t[0].x;for(let i=1;i<t.length-1;i++){const s=t[i].x-n,o=t[i+1].y,a=t[i-1].y;e+=s*(a-o)}return e/2}else if(H(arguments[0],Rt)){const t=arguments[0],e=t.size();if(e<3)return 0;const n=new w,i=new w,s=new w;t.getCoordinate(0,i),t.getCoordinate(1,s);const o=i.x;s.x-=o;let a=0;for(let l=1;l<e-1;l++)n.y=i.y,i.x=s.x,i.y=s.y,t.getCoordinate(l+1,s),s.x-=o,a+=i.x*(n.y-s.y);return a/2}}}class le{add(){}addAll(){}isEmpty(){}iterator(){}size(){}toArray(){}remove(){}}class gf extends gn{}class dn extends le{get(){}set(){}isEmpty(){}}class El extends gn{}class F extends dn{constructor(t){super(),this.array=[],t instanceof le&&this.addAll(t)}get interfaces_(){return[dn,le]}ensureCapacity(){}add(t){return arguments.length===1?this.array.push(t):this.array.splice(arguments[0],0,arguments[1]),!0}clear(){this.array=[]}addAll(t){for(const e of t)this.array.push(e)}set(t,e){const n=this.array[t];return this.array[t]=e,n}iterator(){return new UE(this)}get(t){if(t<0||t>=this.size())throw new gf;return this.array[t]}isEmpty(){return this.array.length===0}sort(t){t?this.array.sort((e,n)=>t.compare(e,n)):this.array.sort()}size(){return this.array.length}toArray(){return this.array.slice()}remove(t){for(let e=0,n=this.array.length;e<n;e++)if(this.array[e]===t)return!!this.array.splice(e,1);return!1}[Symbol.iterator](){return this.array.values()}}let UE=class{constructor(t){this.arrayList=t,this.position=0}next(){if(this.position===this.arrayList.size())throw new El;return this.arrayList.get(this.position++)}hasNext(){return this.position<this.arrayList.size()}set(t){return this.arrayList.set(this.position-1,t)}remove(){this.arrayList.remove(this.arrayList.get(this.position))}};class as{static sort(){const t=arguments[0];if(arguments.length===1)t.sort((e,n)=>e.compareTo(n));else if(arguments.length===2)t.sort((e,n)=>arguments[1].compare(e,n));else if(arguments.length===3){const e=t.slice(arguments[1],arguments[2]);e.sort();const n=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const i of n)t.push(i)}else if(arguments.length===4){const e=t.slice(arguments[1],arguments[2]);e.sort((i,s)=>arguments[3].compare(i,s));const n=t.slice(0,arguments[1]).concat(e,t.slice(arguments[2],t.length));t.splice(0,t.length);for(const i of n)t.push(i)}}static asList(t){const e=new F;for(const n of t)e.add(n);return e}static copyOf(t,e){return t.slice(0,e)}}class Co{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class Or{constructor(t){this.value=t}intValue(){return this.value}compareTo(t){return this.value<t?-1:this.value>t?1:0}static compare(t,e){return t<e?-1:t>e?1:0}static isNan(t){return Number.isNaN(t)}static valueOf(t){return new Or(t)}}class v{constructor(){v.constructor_.apply(this,arguments)}static constructor_(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){const t=arguments[0];this.init(t)}else if(arguments[0]instanceof v){const t=arguments[0];this.init(t)}else if(typeof arguments[0]=="string"){const t=arguments[0];v.constructor_.call(this,v.parse(t))}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.init(t,e)}}static determinant(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return v.determinant(v.valueOf(t),v.valueOf(e),v.valueOf(n),v.valueOf(i))}else if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return t.multiply(i).selfSubtract(e.multiply(n))}}static sqr(t){return v.valueOf(t).selfMultiply(t)}static valueOf(){if(typeof arguments[0]=="string"){const t=arguments[0];return v.parse(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return new v(t)}}static sqrt(t){return v.valueOf(t).sqrt()}static parse(t){let e=0;const n=t.length;for(;Wc.isWhitespace(t.charAt(e));)e++;let i=!1;if(e<n){const d=t.charAt(e);(d==="-"||d==="+")&&(e++,d==="-"&&(i=!0))}const s=new v;let o=0,a=0,l=0,c=!1;for(;!(e>=n);){const d=t.charAt(e);if(e++,Wc.isDigit(d)){const f=d-"0";s.selfMultiply(v.TEN),s.selfAdd(f),o++;continue}if(d==="."){a=o,c=!0;continue}if(d==="e"||d==="E"){const f=t.substring(e);try{l=Or.parseInt(f)}catch(p){throw p instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+f+" in string "+t):p}finally{}break}throw new NumberFormatException("Unexpected character '"+d+"' at position "+e+" in string "+t)}let h=s;c||(a=o);const u=o-a-l;if(u===0)h=s;else if(u>0){const d=v.TEN.pow(u);h=s.divide(d)}else if(u<0){const d=v.TEN.pow(-u);h=s.multiply(d)}return i?h.negate():h}static createNaN(){return new v(j.NaN,j.NaN)}static copy(t){return new v(t)}static magnitude(t){const e=Math.abs(t),n=Math.log(e)/Math.log(10);let i=Math.trunc(Math.floor(n));return Math.pow(10,i)*10<=e&&(i+=1),i}static stringOfChar(t,e){const n=new Co;for(let i=0;i<e;i++)n.append(t);return n.toString()}le(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<=t._lo}extractSignificantDigits(t,e){let n=this.abs(),i=v.magnitude(n._hi);const s=v.TEN.pow(i);n=n.divide(s),n.gt(v.TEN)?(n=n.divide(v.TEN),i+=1):n.lt(v.ONE)&&(n=n.multiply(v.TEN),i-=1);const o=i+1,a=new Co,l=v.MAX_PRINT_DIGITS-1;for(let c=0;c<=l;c++){t&&c===o&&a.append(".");const h=Math.trunc(n._hi);if(h<0)break;let u=!1,d=0;h>9?(u=!0,d="9"):d="0"+h,a.append(d),n=n.subtract(v.valueOf(h)).multiply(v.TEN),u&&n.selfAdd(v.TEN);let f=!0;const p=v.magnitude(n._hi);if(p<0&&Math.abs(p)>=l-c&&(f=!1),!f)break}return e[0]=i,a.toString()}sqr(){return this.multiply(this)}doubleValue(){return this._hi+this._lo}subtract(){if(arguments[0]instanceof v){const t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.add(-t)}}equals(){if(arguments.length===1&&arguments[0]instanceof v){const t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}}isZero(){return this._hi===0&&this._lo===0}selfSubtract(){if(arguments[0]instanceof v){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}}getSpecialNumberString(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}min(t){return this.le(t)?this:t}selfDivide(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let n=null,i=null,s=null,o=null,a=null,l=null,c=null,h=null;return a=this._hi/t,l=v.SPLIT*a,n=l-a,h=v.SPLIT*t,n=l-n,i=a-n,s=h-t,c=a*t,s=h-s,o=t-s,h=n*s-c+n*o+i*s+i*o,l=(this._hi-c-h+this._lo-a*e)/t,h=a+l,this._hi=h,this._lo=a-h+l,this}}dump(){return"DD<"+this._hi+", "+this._lo+">"}divide(){if(arguments[0]instanceof v){const t=arguments[0];let e=null,n=null,i=null,s=null,o=null,a=null,l=null,c=null;o=this._hi/t._hi,a=v.SPLIT*o,e=a-o,c=v.SPLIT*t._hi,e=a-e,n=o-e,i=c-t._hi,l=o*t._hi,i=c-i,s=t._hi-i,c=e*i-l+e*s+n*i+n*s,a=(this._hi-l-c+this._lo-o*t._lo)/t._hi,c=o+a;const h=c,u=o-c+a;return new v(h,u)}else if(typeof arguments[0]=="number"){const t=arguments[0];return j.isNaN(t)?v.createNaN():v.copy(this).selfDivide(t,0)}}ge(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>=t._lo}pow(t){if(t===0)return v.valueOf(1);let e=new v(this),n=v.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(e),i/=2,i>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n}ceil(){if(this.isNaN())return v.NaN;const t=Math.ceil(this._hi);let e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new v(t,e)}compareTo(t){const e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0}rint(){return this.isNaN()?this:this.add(.5).floor()}setValue(){if(arguments[0]instanceof v){const t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.init(t),this}}max(t){return this.ge(t)?this:t}sqrt(){if(this.isZero())return v.valueOf(0);if(this.isNegative())return v.NaN;const t=1/Math.sqrt(this._hi),e=this._hi*t,n=v.valueOf(e),s=this.subtract(n.sqr())._hi*(t*.5);return n.add(s)}selfAdd(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];let e=null,n=null,i=null,s=null,o=null,a=null;return i=this._hi+t,o=i-this._hi,s=i-o,s=t-o+(this._hi-s),a=s+this._lo,e=i+a,n=a+(i-e),this._hi=e+n,this._lo=n+(e-this._hi),this}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let n=null,i=null,s=null,o=null,a=null,l=null,c=null,h=null;a=this._hi+t,s=this._lo+e,c=a-this._hi,h=s-this._lo,l=a-c,o=s-h,l=t-c+(this._hi-l),o=e-h+(this._lo-o),c=l+s,n=a+c,i=c+(a-n),c=o+i;const u=n+c,d=c+(n-u);return this._hi=u,this._lo=d,this}}selfMultiply(){if(arguments.length===1){if(arguments[0]instanceof v){const t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){const t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];let n=null,i=null,s=null,o=null,a=null,l=null;a=v.SPLIT*this._hi,n=a-this._hi,l=v.SPLIT*t,n=a-n,i=this._hi-n,s=l-t,a=this._hi*t,s=l-s,o=t-s,l=n*s-a+n*o+i*s+i*o+(this._hi*e+this._lo*t);const c=a+l;n=a-c;const h=l+n;return this._hi=c,this._lo=h,this}}selfSqr(){return this.selfMultiply(this)}floor(){if(this.isNaN())return v.NaN;const t=Math.floor(this._hi);let e=0;return t===this._hi&&(e=Math.floor(this._lo)),new v(t,e)}negate(){return this.isNaN()?this:new v(-this._hi,-this._lo)}clone(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}finally{}}multiply(){if(arguments[0]instanceof v){const t=arguments[0];return t.isNaN()?v.createNaN():v.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return j.isNaN(t)?v.createNaN():v.copy(this).selfMultiply(t,0)}}isNaN(){return j.isNaN(this._hi)}intValue(){return Math.trunc(this._hi)}toString(){const t=v.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()}toStandardNotation(){const t=this.getSpecialNumberString();if(t!==null)return t;const e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),i=e[0]+1;let s=n;if(n.charAt(0)===".")s="0"+n;else if(i<0)s="0."+v.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){const o=i-n.length,a=v.stringOfChar("0",o);s=n+a+".0"}return this.isNegative()?"-"+s:s}reciprocal(){let t=null,e=null,n=null,i=null,s=null,o=null,a=null,l=null;s=1/this._hi,o=v.SPLIT*s,t=o-s,l=v.SPLIT*this._hi,t=o-t,e=s-t,n=l-this._hi,a=s*this._hi,n=l-n,i=this._hi-n,l=t*n-a+t*i+e*n+e*i,o=(1-a-l-s*this._lo)/this._hi;const c=s+o,h=s-c+o;return new v(c,h)}toSciNotation(){if(this.isZero())return v.SCI_NOT_ZERO;const t=this.getSpecialNumberString();if(t!==null)return t;const e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),i=v.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+n);let s="";n.length>1&&(s=n.substring(1));const o=n.charAt(0)+"."+s;return this.isNegative()?"-"+o+i:o+i}abs(){return this.isNaN()?v.NaN:this.isNegative()?this.negate():new v(this)}isPositive(){return this._hi>0||this._hi===0&&this._lo>0}lt(t){return this._hi<t._hi||this._hi===t._hi&&this._lo<t._lo}add(){if(arguments[0]instanceof v){const t=arguments[0];return v.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){const t=arguments[0];return v.copy(this).selfAdd(t)}}init(){if(arguments.length===1){if(typeof arguments[0]=="number"){const t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof v){const t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._hi=t,this._lo=e}}gt(t){return this._hi>t._hi||this._hi===t._hi&&this._lo>t._lo}isNegative(){return this._hi<0||this._hi===0&&this._lo<0}trunc(){return this.isNaN()?v.NaN:this.isPositive()?this.floor():this.ceil()}signum(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}get interfaces_(){return[rn,sn,zr]}}v.PI=new v(3.141592653589793,12246467991473532e-32);v.TWO_PI=new v(6.283185307179586,24492935982947064e-32);v.PI_2=new v(1.5707963267948966,6123233995736766e-32);v.E=new v(2.718281828459045,14456468917292502e-32);v.NaN=new v(j.NaN,j.NaN);v.EPS=123259516440783e-46;v.SPLIT=134217729;v.MAX_PRINT_DIGITS=32;v.TEN=v.valueOf(10);v.ONE=v.valueOf(1);v.SCI_NOT_EXPONENT_CHAR="E";v.SCI_NOT_ZERO="0.0E0";class ni{static orientationIndex(t,e,n){const i=ni.orientationIndexFilter(t,e,n);if(i<=1)return i;const s=v.valueOf(e.x).selfAdd(-t.x),o=v.valueOf(e.y).selfAdd(-t.y),a=v.valueOf(n.x).selfAdd(-e.x),l=v.valueOf(n.y).selfAdd(-e.y);return s.selfMultiply(l).selfSubtract(o.selfMultiply(a)).signum()}static signOfDet2x2(){if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return t.multiply(i).selfSubtract(e.multiply(n)).signum()}else if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=v.valueOf(t),o=v.valueOf(e),a=v.valueOf(n),l=v.valueOf(i);return s.multiply(l).selfSubtract(o.multiply(a)).signum()}}static intersection(t,e,n,i){const s=new v(t.y).selfSubtract(e.y),o=new v(e.x).selfSubtract(t.x),a=new v(t.x).selfMultiply(e.y).selfSubtract(new v(e.x).selfMultiply(t.y)),l=new v(n.y).selfSubtract(i.y),c=new v(i.x).selfSubtract(n.x),h=new v(n.x).selfMultiply(i.y).selfSubtract(new v(i.x).selfMultiply(n.y)),u=o.multiply(h).selfSubtract(c.multiply(a)),d=l.multiply(a).selfSubtract(s.multiply(h)),f=s.multiply(c).selfSubtract(l.multiply(o)),p=u.selfDivide(f).doubleValue(),m=d.selfDivide(f).doubleValue();return j.isNaN(p)||j.isInfinite(p)||j.isNaN(m)||j.isInfinite(m)?null:new w(p,m)}static orientationIndexFilter(t,e,n){let i=null;const s=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),a=s-o;if(s>0){if(o<=0)return ni.signum(a);i=s+o}else if(s<0){if(o>=0)return ni.signum(a);i=-s-o}else return ni.signum(a);const l=ni.DP_SAFE_EPSILON*i;return a>=l||-a>=l?ni.signum(a):2}static signum(t){return t>0?1:t<0?-1:0}}ni.DP_SAFE_EPSILON=1e-15;class J{static index(t,e,n){return ni.orientationIndex(t,e,n)}static isCCW(){if(arguments[0]instanceof Array){const t=arguments[0],e=t.length-1;if(e<3)throw new ht("Ring has fewer than 4 points, so orientation cannot be determined");let n=t[0],i=0;for(let u=1;u<=e;u++){const d=t[u];d.y>n.y&&(n=d,i=u)}let s=i;do s=s-1,s<0&&(s=e);while(t[s].equals2D(n)&&s!==i);let o=i;do o=(o+1)%e;while(t[o].equals2D(n)&&o!==i);const a=t[s],l=t[o];if(a.equals2D(n)||l.equals2D(n)||a.equals2D(l))return!1;const c=J.index(a,n,l);let h=null;return c===0?h=a.x>l.x:h=c>0,h}else if(H(arguments[0],Rt)){const t=arguments[0],e=t.size()-1;if(e<3)throw new ht("Ring has fewer than 4 points, so orientation cannot be determined");let n=t.getCoordinate(0),i=0;for(let u=1;u<=e;u++){const d=t.getCoordinate(u);d.y>n.y&&(n=d,i=u)}let s=null,o=i;do o=o-1,o<0&&(o=e),s=t.getCoordinate(o);while(s.equals2D(n)&&o!==i);let a=null,l=i;do l=(l+1)%e,a=t.getCoordinate(l);while(a.equals2D(n)&&l!==i);if(s.equals2D(n)||a.equals2D(n)||s.equals2D(a))return!1;const c=J.index(s,n,a);let h=null;return c===0?h=s.x>a.x:h=c>0,h}}}J.CLOCKWISE=-1;J.RIGHT=J.CLOCKWISE;J.COUNTERCLOCKWISE=1;J.LEFT=J.COUNTERCLOCKWISE;J.COLLINEAR=0;J.STRAIGHT=J.COLLINEAR;class qs{}class jt extends A{constructor(){super(),jt.constructor_.apply(this,arguments)}static constructor_(){this._shell=null,this._holes=null;let t=arguments[0],e=arguments[1],n=arguments[2];if(A.constructor_.call(this,n),t===null&&(t=this.getFactory().createLinearRing()),e===null&&(e=[]),A.hasNullElements(e))throw new ht("holes must not contain null elements");if(t.isEmpty()&&A.hasNonEmptyElements(e))throw new ht("shell is empty but holes are not");this._shell=t,this._holes=e}computeEnvelopeInternal(){return this._shell.getEnvelopeInternal()}getCoordinates(){if(this.isEmpty())return[];const t=new Array(this.getNumPoints()).fill(null);let e=-1;const n=this._shell.getCoordinates();for(let i=0;i<n.length;i++)e++,t[e]=n[i];for(let i=0;i<this._holes.length;i++){const s=this._holes[i].getCoordinates();for(let o=0;o<s.length;o++)e++,t[e]=s[o]}return t}getArea(){let t=0;t+=Io.ofRing(this._shell.getCoordinateSequence());for(let e=0;e<this._holes.length;e++)t-=Io.ofRing(this._holes[e].getCoordinateSequence());return t}copyInternal(){const t=this._shell.copy(),e=new Array(this._holes.length).fill(null);for(let n=0;n<this._holes.length;n++)e[n]=this._holes[n].copy();return new jt(t,e,this._factory)}isRectangle(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;const t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal();for(let s=0;s<5;s++){const o=t.getX(s);if(!(o===e.getMinX()||o===e.getMaxX()))return!1;const a=t.getY(s);if(!(a===e.getMinY()||a===e.getMaxY()))return!1}let n=t.getX(0),i=t.getY(0);for(let s=1;s<=4;s++){const o=t.getX(s),a=t.getY(s);if(o!==n===(a!==i))return!1;n=o,i=a}return!0}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const n=t,i=this._shell,s=n._shell;if(!i.equalsExact(s,e)||this._holes.length!==n._holes.length)return!1;for(let o=0;o<this._holes.length;o++)if(!this._holes[o].equalsExact(n._holes[o],e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}normalize(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(let t=0;t<this._holes.length;t++)this._holes[t]=this.normalized(this._holes[t],!1);as.sort(this._holes)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(t.isEmpty())return null;const n=t.getCoordinateSequence(),i=ae.minCoordinateIndex(n,0,n.size()-2);ae.scroll(n,i,!0),J.isCCW(n)===e&&ae.reverse(n)}}getCoordinate(){return this._shell.getCoordinate()}getNumInteriorRing(){return this._holes.length}getBoundaryDimension(){return 1}reverseInternal(){const t=this.getExteriorRing().reverse(),e=new Array(this.getNumInteriorRing()).fill(null);for(let n=0;n<e.length;n++)e[n]=this.getInteriorRingN(n).reverse();return this.getFactory().createPolygon(t,e)}getTypeCode(){return A.TYPECODE_POLYGON}getDimension(){return 2}getLength(){let t=0;t+=this._shell.getLength();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t}getNumPoints(){let t=this._shell.getNumPoints();for(let e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t}convexHull(){return this.getExteriorRing().convexHull()}normalized(t,e){const n=t.copy();return this.normalize(n,e),n}compareToSameClass(){if(arguments.length===1){const t=arguments[0],e=this._shell,n=t._shell;return e.compareToSameClass(n)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t,i=this._shell,s=n._shell,o=i.compareToSameClass(s,e);if(o!==0)return o;const a=this.getNumInteriorRing(),l=n.getNumInteriorRing();let c=0;for(;c<a&&c<l;){const h=this.getInteriorRingN(c),u=n.getInteriorRingN(c),d=h.compareToSameClass(u,e);if(d!==0)return d;c++}return c<a?1:c<l?-1:0}}apply(){if(H(arguments[0],Wr)){const t=arguments[0];this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(H(arguments[0],Vs)){const t=arguments[0];if(this._shell.apply(t),!t.isDone())for(let e=0;e<this._holes.length&&(this._holes[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(H(arguments[0],ds))arguments[0].filter(this);else if(H(arguments[0],Xr)){const t=arguments[0];t.filter(this),this._shell.apply(t);for(let e=0;e<this._holes.length;e++)this._holes[e].apply(t)}}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(let e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)}getGeometryType(){return A.TYPENAME_POLYGON}getExteriorRing(){return this._shell}isEmpty(){return this._shell.isEmpty()}getInteriorRingN(t){return this._holes[t]}get interfaces_(){return[qs]}}let df=class extends le{contains(){}};class HE extends df{}class zs extends HE{constructor(t){super(),this.array=[],t instanceof le&&this.addAll(t)}contains(t){for(const e of this.array)if(e.compareTo(t)===0)return!0;return!1}add(t){if(this.contains(t))return!1;for(let e=0,n=this.array.length;e<n;e++)if(this.array[e].compareTo(t)===1)return!!this.array.splice(e,0,t);return this.array.push(t),!0}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new _i}size(){return this.array.length}isEmpty(){return this.array.length===0}toArray(){return this.array.slice()}iterator(){return new VE(this.array)}}let VE=class{constructor(t){this.array=t,this.position=0}next(){if(this.position===this.array.length)throw new El;return this.array[this.position++]}hasNext(){return this.position<this.array.length}remove(){throw new _i}};class St extends A{constructor(){super(),St.constructor_.apply(this,arguments)}static constructor_(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){let t=arguments[0],e=arguments[1];if(A.constructor_.call(this,e),t===null&&(t=[]),A.hasNullElements(t))throw new ht("geometries must not contain null elements");this._geometries=t}}}computeEnvelopeInternal(){const t=new ct;for(let e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t}getGeometryN(t){return this._geometries[t]}getCoordinates(){const t=new Array(this.getNumPoints()).fill(null);let e=-1;for(let n=0;n<this._geometries.length;n++){const i=this._geometries[n].getCoordinates();for(let s=0;s<i.length;s++)e++,t[e]=i[s]}return t}getArea(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new St(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;const n=t;if(this._geometries.length!==n._geometries.length)return!1;for(let i=0;i<this._geometries.length;i++)if(!this._geometries[i].equalsExact(n._geometries[i],e))return!1;return!0}else return super.equalsExact.apply(this,arguments)}normalize(){for(let t=0;t<this._geometries.length;t++)this._geometries[t].normalize();as.sort(this._geometries)}getCoordinate(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}getBoundaryDimension(){let t=O.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t}reverseInternal(){const t=this._geometries.length,e=new F(t);for(let n=0;n<t;n++)e.add(this._geometries[n].reverse());return this.getFactory().buildGeometry(e)}getTypeCode(){return A.TYPECODE_GEOMETRYCOLLECTION}getDimension(){let t=O.FALSE;for(let e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t}getLength(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t}getNumPoints(){let t=0;for(let e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t}getNumGeometries(){return this._geometries.length}compareToSameClass(){if(arguments.length===1){const t=arguments[0],e=new zs(as.asList(this._geometries)),n=new zs(as.asList(t._geometries));return this.compare(e,n)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t,i=this.getNumGeometries(),s=n.getNumGeometries();let o=0;for(;o<i&&o<s;){const a=this.getGeometryN(o),l=n.getGeometryN(o),c=a.compareToSameClass(l,e);if(c!==0)return c;o++}return o<i?1:o<s?-1:0}}apply(){if(H(arguments[0],Wr)){const t=arguments[0];for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(H(arguments[0],Vs)){const t=arguments[0];if(this._geometries.length===0)return null;for(let e=0;e<this._geometries.length&&(this._geometries[e].apply(t),!t.isDone());e++);t.isGeometryChanged()&&this.geometryChanged()}else if(H(arguments[0],ds)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}else if(H(arguments[0],Xr)){const t=arguments[0];t.filter(this);for(let e=0;e<this._geometries.length;e++)this._geometries[e].apply(t)}}getBoundary(){return A.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null}getGeometryType(){return A.TYPENAME_GEOMETRYCOLLECTION}isEmpty(){for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0}}class Wn extends St{constructor(){super(),Wn.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];St.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Wn(t,this._factory)}isValid(){return!0}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getCoordinate(){if(arguments.length===1&&Number.isInteger(arguments[0])){const t=arguments[0];return this._geometries[t].getCoordinate()}else return super.getCoordinate.apply(this,arguments)}getBoundaryDimension(){return O.FALSE}getTypeCode(){return A.TYPECODE_MULTIPOINT}getDimension(){return 0}getBoundary(){return this.getFactory().createGeometryCollection()}getGeometryType(){return A.TYPENAME_MULTIPOINT}get interfaces_(){return[uf]}}class ve extends vt{constructor(){super(),ve.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];vt.constructor_.call(this,t,e),this.validateConstruction()}copyInternal(){return new ve(this._points.copy(),this._factory)}getBoundaryDimension(){return O.FALSE}isClosed(){return this.isEmpty()?!0:super.isClosed.call(this)}reverseInternal(){const t=this._points.copy();return ae.reverse(t),this.getFactory().createLinearRing(t)}getTypeCode(){return A.TYPECODE_LINEARRING}validateConstruction(){if(!this.isEmpty()&&!super.isClosed.call(this))throw new ht("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<ve.MINIMUM_VALID_SIZE)throw new ht("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}getGeometryType(){return A.TYPENAME_LINEARRING}}ve.MINIMUM_VALID_SIZE=4;class Ue extends w{constructor(){super(),Ue.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)w.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof Ue){const t=arguments[0];w.constructor_.call(this,t.x,t.y)}else if(arguments[0]instanceof w){const t=arguments[0];w.constructor_.call(this,t.x,t.y)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];w.constructor_.call(this,t,e,w.NULL_ORDINATE)}}setOrdinate(t,e){switch(t){case Ue.X:this.x=e;break;case Ue.Y:this.y=e;break;default:throw new ht("Invalid ordinate index: "+t)}}getZ(){return w.NULL_ORDINATE}getOrdinate(t){switch(t){case Ue.X:return this.x;case Ue.Y:return this.y}throw new ht("Invalid ordinate index: "+t)}setZ(t){throw new ht("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new Ue(this)}toString(){return"("+this.x+", "+this.y+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ()}}Ue.X=0;Ue.Y=1;Ue.Z=-1;Ue.M=-1;class be extends w{constructor(){super(),be.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,arguments.length===0)w.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof be){const t=arguments[0];w.constructor_.call(this,t.x,t.y),this._m=t._m}else if(arguments[0]instanceof w){const t=arguments[0];w.constructor_.call(this,t.x,t.y),this._m=this.getM()}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];w.constructor_.call(this,t,e,w.NULL_ORDINATE),this._m=n}}getM(){return this._m}setOrdinate(t,e){switch(t){case be.X:this.x=e;break;case be.Y:this.y=e;break;case be.M:this._m=e;break;default:throw new ht("Invalid ordinate index: "+t)}}setM(t){this._m=t}getZ(){return w.NULL_ORDINATE}getOrdinate(t){switch(t){case be.X:return this.x;case be.Y:return this.y;case be.M:return this._m}throw new ht("Invalid ordinate index: "+t)}setZ(t){throw new ht("CoordinateXY dimension 2 does not support z-ordinate")}copy(){return new be(this)}toString(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}be.X=0;be.Y=1;be.Z=-1;be.M=2;class Ds extends w{constructor(){super(),Ds.constructor_.apply(this,arguments)}static constructor_(){if(this._m=null,arguments.length===0)w.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof Ds){const t=arguments[0];w.constructor_.call(this,t),this._m=t._m}else if(arguments[0]instanceof w){const t=arguments[0];w.constructor_.call(this,t),this._m=this.getM()}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];w.constructor_.call(this,t,e,n),this._m=i}}getM(){return this._m}setOrdinate(t,e){switch(t){case w.X:this.x=e;break;case w.Y:this.y=e;break;case w.Z:this.z=e;break;case w.M:this._m=e;break;default:throw new ht("Invalid ordinate index: "+t)}}setM(t){this._m=t}getOrdinate(t){switch(t){case w.X:return this.x;case w.Y:return this.y;case w.Z:return this.getZ();case w.M:return this.getM()}throw new ht("Invalid ordinate index: "+t)}copy(){return new Ds(this)}toString(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}setCoordinate(t){this.x=t.x,this.y=t.y,this.z=t.getZ(),this._m=t.getM()}}class Pr{static measures(t){return t instanceof Ue?0:t instanceof be||t instanceof Ds?1:(t instanceof w,0)}static dimension(t){return t instanceof Ue?2:t instanceof be?3:t instanceof Ds?4:(t instanceof w,3)}static create(){if(arguments.length===1){const t=arguments[0];return Pr.create(t,0)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t===2?new Ue:t===3&&e===0?new w:t===3&&e===1?new be:t===4&&e===1?new Ds:new w}}}class Yn extends F{constructor(){super(),Yn.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.ensureCapacity(t.length),this.add(t,e)}}}getCoordinate(t){return this.get(t)}addAll(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&H(arguments[0],le)){const t=arguments[0],e=arguments[1];let n=!1;for(let i=t.iterator();i.hasNext();)this.add(i.next(),e),n=!0;return n}else return super.addAll.apply(this,arguments)}clone(){const t=super.clone.call(this);for(let e=0;e<this.size();e++)t.add(e,this.get(e).clone());return t}toCoordinateArray(){if(arguments.length===0)return this.toArray(Yn.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(Yn.coordArrayType);const e=this.size(),n=new Array(e).fill(null);for(let i=0;i<e;i++)n[i]=this.get(e-i-1);return n}}add(){if(arguments.length===1){const t=arguments[0];return super.add.call(this,t)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];return this.add(t,e,!0),!0}else if(arguments[0]instanceof w&&typeof arguments[1]=="boolean"){const t=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(t))return null;super.add.call(this,t)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];return this.add(t,e),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1];if(arguments[2])for(let i=0;i<t.length;i++)this.add(t[i],e);else for(let i=t.length-1;i>=0;i--)this.add(t[i],e);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1];if(!arguments[2]){const i=this.size();if(i>0&&(t>0&&this.get(t-1).equals2D(e)||t<i&&this.get(t).equals2D(e)))return null}super.add.call(this,t,e)}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];let s=1;n>i&&(s=-1);for(let o=n;o!==i;o+=s)this.add(t[o],e);return!0}}closeRing(){if(this.size()>0){const t=this.get(0).copy();this.add(t,!1)}}}Yn.coordArrayType=new Array(0).fill(null);class Xs{static log10(t){const e=Math.log(t);return j.isInfinite(e)||j.isNaN(e)?e:e/Xs.LOG_10}static min(t,e,n,i){let s=t;return e<s&&(s=e),n<s&&(s=n),i<s&&(s=i),s}static clamp(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}}static wrap(t,e){return t<0?e- -t%e:t%e}static max(){if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];let i=t;return e>i&&(i=e),n>i&&(i=n),i}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];let s=t;return e>s&&(s=e),n>s&&(s=n),i>s&&(s=i),s}}static average(t,e){return(t+e)/2}}Xs.LOG_10=Math.log(10);class en{static arraycopy(t,e,n,i,s){let o=0;for(let a=e;a<e+s;a++)n[i+o]=t[a],o++}static getProperty(t){return{"line.separator":`
`}[t]}}class kt{static isRing(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))}static ptNotInList(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(kt.indexOf(i,e)<0)return i}return null}static scroll(t,e){const n=kt.indexOf(e,t);if(n<0)return null;const i=new Array(t.length).fill(null);en.arraycopy(t,n,i,0,t.length-n),en.arraycopy(t,0,i,t.length-n,n),en.arraycopy(i,0,t,0,t.length)}static equals(){if(arguments.length===2){const t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(n.compare(t[i],e[i])!==0)return!1;return!0}}static intersection(t,e){const n=new Yn;for(let i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()}static measures(t){if(t===null||t.length===0)return 0;let e=0;for(const n of t)e=Math.max(e,Pr.measures(n));return e}static hasRepeatedPoints(t){for(let e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1}static removeRepeatedPoints(t){return kt.hasRepeatedPoints(t)?new Yn(t,!1).toCoordinateArray():t}static reverse(t){const e=t.length-1,n=Math.trunc(e/2);for(let i=0;i<=n;i++){const s=t[i];t[i]=t[e-i],t[e-i]=s}}static removeNull(t){let e=0;for(let s=0;s<t.length;s++)t[s]!==null&&e++;const n=new Array(e).fill(null);if(e===0)return n;let i=0;for(let s=0;s<t.length;s++)t[s]!==null&&(n[i++]=t[s]);return n}static copyDeep(){if(arguments.length===1){const t=arguments[0],e=new Array(t.length).fill(null);for(let n=0;n<t.length;n++)e[n]=t[n].copy();return e}else if(arguments.length===5){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4];for(let o=0;o<s;o++)n[i+o]=t[e+o].copy()}}static isEqualReversed(t,e){for(let n=0;n<t.length;n++){const i=t[n],s=e[t.length-n-1];if(i.compareTo(s)!==0)return!1}return!0}static envelope(t){const e=new ct;for(let n=0;n<t.length;n++)e.expandToInclude(t[n]);return e}static toCoordinateArray(t){return t.toArray(kt.coordArrayType)}static dimension(t){if(t===null||t.length===0)return 3;let e=0;for(const n of t)e=Math.max(e,Pr.dimension(n));return e}static atLeastNCoordinatesOrNothing(t,e){return e.length>=t?e:[]}static indexOf(t,e){for(let n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1}static increasingDirection(t){for(let e=0;e<Math.trunc(t.length/2);e++){const n=t.length-1-e,i=t[e].compareTo(t[n]);if(i!==0)return i}return 1}static compare(t,e){let n=0;for(;n<t.length&&n<e.length;){const i=t[n].compareTo(e[n]);if(i!==0)return i;n++}return n<e.length?-1:n<t.length?1:0}static minCoordinate(t){let e=null;for(let n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e}static extract(t,e,n){e=Xs.clamp(e,0,t.length),n=Xs.clamp(n,-1,t.length);let i=n-e+1;n<0&&(i=0),e>=t.length&&(i=0),n<e&&(i=0);const s=new Array(i).fill(null);if(i===0)return s;let o=0;for(let a=e;a<=n;a++)s[o++]=t[a];return s}}class qE{compare(t,e){const n=t,i=e;return kt.compare(n,i)}get interfaces_(){return[gs]}}class KE{compare(t,e){const n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;const s=kt.compare(n,i);return kt.isEqualReversed(n,i)?0:s}OLDcompare(t,e){const n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;const s=kt.increasingDirection(n),o=kt.increasingDirection(i);let a=s>0?0:n.length-1,l=o>0?0:n.length-1;for(let c=0;c<n.length;c++){const h=n[a].compareTo(i[l]);if(h!==0)return h;a+=s,l+=o}return 0}get interfaces_(){return[gs]}}kt.ForwardComparator=qE;kt.BidirectionalComparator=KE;kt.coordArrayType=new Array(0).fill(null);class Il{constructor(t){this.str=t}append(t){this.str+=t}setCharAt(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)}toString(){return this.str}}class Fn{constructor(){Fn.constructor_.apply(this,arguments)}static constructor_(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];Fn.constructor_.call(this,t,kt.dimension(t),kt.measures(t))}else if(Number.isInteger(arguments[0])){const t=arguments[0];this._coordinates=new Array(t).fill(null);for(let e=0;e<t;e++)this._coordinates[e]=new w}else if(H(arguments[0],Rt)){const t=arguments[0];if(t===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=t.getDimension(),this._measures=t.getMeasures(),this._coordinates=new Array(t.size()).fill(null);for(let e=0;e<this._coordinates.length;e++)this._coordinates[e]=t.getCoordinateCopy(e)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];Fn.constructor_.call(this,t,e,kt.measures(t))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1];this._coordinates=new Array(t).fill(null),this._dimension=e;for(let n=0;n<t;n++)this._coordinates[n]=Pr.create(e)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],n=arguments[2];this._dimension=e,this._measures=n,t===null?this._coordinates=new Array(0).fill(null):this._coordinates=t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],n=arguments[2];this._coordinates=new Array(t).fill(null),this._dimension=e,this._measures=n;for(let i=0;i<t;i++)this._coordinates[i]=this.createCoordinate()}}}getM(t){return this.hasM()?this._coordinates[t].getM():j.NaN}setOrdinate(t,e,n){switch(e){case Rt.X:this._coordinates[t].x=n;break;case Rt.Y:this._coordinates[t].y=n;break;default:this._coordinates[t].setOrdinate(e,n)}}getZ(t){return this.hasZ()?this._coordinates[t].getZ():j.NaN}size(){return this._coordinates.length}getOrdinate(t,e){switch(e){case Rt.X:return this._coordinates[t].x;case Rt.Y:return this._coordinates[t].y;default:return this._coordinates[t].getOrdinate(e)}}getCoordinate(){if(arguments.length===1){const t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){const t=arguments[0];arguments[1].setCoordinate(this._coordinates[t])}}getCoordinateCopy(t){const e=this.createCoordinate();return e.setCoordinate(this._coordinates[t]),e}createCoordinate(){return Pr.create(this.getDimension(),this.getMeasures())}getDimension(){return this._dimension}getX(t){return this._coordinates[t].x}getMeasures(){return this._measures}expandEnvelope(t){for(let e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t}copy(){const t=new Array(this.size()).fill(null);for(let e=0;e<this._coordinates.length;e++){const n=this.createCoordinate();n.setCoordinate(this._coordinates[e]),t[e]=n}return new Fn(t,this._dimension,this._measures)}toString(){if(this._coordinates.length>0){const t=new Il(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(let e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}else return"()"}getY(t){return this._coordinates[t].y}toCoordinateArray(){return this._coordinates}get interfaces_(){return[Rt,rn]}}class Ar{static instance(){return Ar.instanceObject}readResolve(){return Ar.instance()}create(){if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return new Fn(t)}else if(H(arguments[0],Rt)){const t=arguments[0];return new Fn(t)}}else if(arguments.length===2){let t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2&&(e=2),new Fn(t,e)}else if(arguments.length===3){let t=arguments[0],e=arguments[1],n=arguments[2],i=e-n;return n>1&&(n=1),i>3&&(i=3),i<2&&(i=2),new Fn(t,i+n,n)}}get interfaces_(){return[lf,rn]}}Ar.instanceObject=new Ar;class nn extends St{constructor(){super(),nn.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];St.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new nn(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return 1}getTypeCode(){return A.TYPECODE_MULTIPOLYGON}getDimension(){return 2}getBoundary(){if(this.isEmpty())return this.getFactory().createMultiLineString();const t=new F;for(let n=0;n<this._geometries.length;n++){const s=this._geometries[n].getBoundary();for(let o=0;o<s.getNumGeometries();o++)t.add(s.getGeometryN(o))}const e=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(e))}getGeometryType(){return A.TYPENAME_MULTIPOLYGON}get interfaces_(){return[qs]}}let ff=class{get(){}put(){}size(){}values(){}entrySet(){}};class Wo extends df{constructor(t){super(),this.map=new Map,t instanceof le&&this.addAll(t)}contains(t){const e=t.hashCode?t.hashCode():t;return!!this.map.has(e)}add(t){const e=t.hashCode?t.hashCode():t;return this.map.has(e)?!1:!!this.map.set(e,t)}addAll(t){for(const e of t)this.add(e);return!0}remove(){throw new _i}size(){return this.map.size}isEmpty(){return this.map.size===0}toArray(){return Array.from(this.map.values())}iterator(){return new JE(this.map)}[Symbol.iterator](){return this.map}}let JE=class{constructor(t){this.iterator=t.values();const{done:e,value:n}=this.iterator.next();this.done=e,this.value=n}next(){if(this.done)throw new El;const t=this.value,{done:e,value:n}=this.iterator.next();return this.done=e,this.value=n,t}hasNext(){return!this.done}remove(){throw new _i}};class mf extends ff{constructor(){super(),this.map=new Map}get(t){return this.map.get(t)||null}put(t,e){return this.map.set(t,e),e}values(){const t=new F,e=this.map.values();let n=e.next();for(;!n.done;)t.add(n.value),n=e.next();return t}entrySet(){const t=new Wo;return this.map.entries().forEach(e=>t.add(e)),t}size(){return this.map.size()}}class Pt{constructor(){Pt.constructor_.apply(this,arguments)}static constructor_(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=Pt.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof li){const t=arguments[0];this._modelType=t,t===Pt.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){const t=arguments[0];this._modelType=Pt.FIXED,this.setScale(t)}else if(arguments[0]instanceof Pt){const t=arguments[0];this._modelType=t._modelType,this._scale=t._scale}}}static mostPrecise(t,e){return t.compareTo(e)>=0?t:e}equals(t){if(!(t instanceof Pt))return!1;const e=t;return this._modelType===e._modelType&&this._scale===e._scale}compareTo(t){const e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return Or.compare(n,i)}getScale(){return this._scale}isFloating(){return this._modelType===Pt.FLOATING||this._modelType===Pt.FLOATING_SINGLE}getType(){return this._modelType}toString(){let t="UNKNOWN";return this._modelType===Pt.FLOATING?t="Floating":this._modelType===Pt.FLOATING_SINGLE?t="Floating-Single":this._modelType===Pt.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t}makePrecise(){if(typeof arguments[0]=="number"){const t=arguments[0];return j.isNaN(t)||this._modelType===Pt.FLOATING_SINGLE?t:this._modelType===Pt.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof w){const t=arguments[0];if(this._modelType===Pt.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}}getMaximumSignificantDigits(){let t=16;return this._modelType===Pt.FLOATING?t=16:this._modelType===Pt.FLOATING_SINGLE?t=6:this._modelType===Pt.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t}setScale(t){this._scale=Math.abs(t)}get interfaces_(){return[rn,sn]}}class li{constructor(){li.constructor_.apply(this,arguments)}static constructor_(){this._name=null;const t=arguments[0];this._name=t,li.nameToTypeMap.put(t,this)}readResolve(){return li.nameToTypeMap.get(this._name)}toString(){return this._name}get interfaces_(){return[rn]}}li.nameToTypeMap=new mf;Pt.Type=li;Pt.FIXED=new li("FIXED");Pt.FLOATING=new li("FLOATING");Pt.FLOATING_SINGLE=new li("FLOATING SINGLE");Pt.maximumPreciseValue=9007199254740992;class Nn extends St{constructor(){super(),Nn.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];St.constructor_.call(this,t,e)}copyInternal(){const t=new Array(this._geometries.length).fill(null);for(let e=0;e<t.length;e++)t[e]=this._geometries[e].copy();return new Nn(t,this._factory)}equalsExact(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof A){const t=arguments[0],e=arguments[1];return this.isEquivalentClass(t)?super.equalsExact.call(this,t,e):!1}else return super.equalsExact.apply(this,arguments)}getBoundaryDimension(){return this.isClosed()?O.FALSE:0}isClosed(){if(this.isEmpty())return!1;for(let t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0}getTypeCode(){return A.TYPECODE_MULTILINESTRING}getDimension(){return 1}getBoundary(){throw new _i}getGeometryType(){return A.TYPENAME_MULTILINESTRING}get interfaces_(){return[hf]}}class Qt{constructor(){Qt.constructor_.apply(this,arguments)}static constructor_(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)Qt.constructor_.call(this,new Pt,0);else if(arguments.length===1){if(H(arguments[0],lf)){const t=arguments[0];Qt.constructor_.call(this,new Pt,0,t)}else if(arguments[0]instanceof Pt){const t=arguments[0];Qt.constructor_.call(this,t,0,Qt.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];Qt.constructor_.call(this,t,e,Qt.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._precisionModel=t,this._coordinateSequenceFactory=n,this._SRID=e}}static toMultiPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toGeometryArray(t){if(t===null)return null;const e=new Array(t.size()).fill(null);return t.toArray(e)}static getDefaultCoordinateSequenceFactory(){return Ar.instance()}static toMultiLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLineStringArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toMultiPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toLinearRingArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPointArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static toPolygonArray(t){const e=new Array(t.size()).fill(null);return t.toArray(e)}static createPointFromInternalCoord(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)}createEmpty(t){switch(t){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ht("Invalid dimension: "+t)}}toGeometry(t){return t.isNull()?this.createPoint():t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new w(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new w(t.getMinX(),t.getMinY()),new w(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new w(t.getMinX(),t.getMinY()),new w(t.getMinX(),t.getMaxY()),new w(t.getMaxX(),t.getMaxY()),new w(t.getMaxX(),t.getMinY()),new w(t.getMinX(),t.getMinY())]),null)}createLineString(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLineString(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(H(arguments[0],Rt)){const t=arguments[0];return new vt(t,this)}}}createMultiLineString(){if(arguments.length===0)return new Nn(null,this);if(arguments.length===1){const t=arguments[0];return new Nn(t,this)}}buildGeometry(t){let e=null,n=!1,i=!1;for(let a=t.iterator();a.hasNext();){const l=a.next(),c=l.getTypeCode();e===null&&(e=c),c!==e&&(n=!0),l instanceof St&&(i=!0)}if(e===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(Qt.toGeometryArray(t));const s=t.iterator().next();if(t.size()>1){if(s instanceof jt)return this.createMultiPolygon(Qt.toPolygonArray(t));if(s instanceof vt)return this.createMultiLineString(Qt.toLineStringArray(t));if(s instanceof ee)return this.createMultiPoint(Qt.toPointArray(t));et.shouldNeverReachHere("Unhandled geometry type: "+s.getGeometryType())}return s}createMultiPointFromCoords(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)}createPoint(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof w){const t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(H(arguments[0],Rt)){const t=arguments[0];return new ee(t,this)}}}getCoordinateSequenceFactory(){return this._coordinateSequenceFactory}createPolygon(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(H(arguments[0],Rt)){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){const t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof ve){const t=arguments[0];return this.createPolygon(t,null)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new jt(t,e,this)}}getSRID(){return this._SRID}createGeometryCollection(){if(arguments.length===0)return new St(null,this);if(arguments.length===1){const t=arguments[0];return new St(t,this)}}getPrecisionModel(){return this._precisionModel}createLinearRing(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(H(arguments[0],Rt)){const t=arguments[0];return new ve(t,this)}}}createMultiPolygon(){if(arguments.length===0)return new nn(null,this);if(arguments.length===1){const t=arguments[0];return new nn(t,this)}}createMultiPoint(){if(arguments.length===0)return new Wn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];return new Wn(t,this)}else if(H(arguments[0],Rt)){const t=arguments[0];if(t===null)return this.createMultiPoint(new Array(0).fill(null));const e=new Array(t.size()).fill(null);for(let n=0;n<t.size();n++){const i=this.getCoordinateSequenceFactory().create(1,t.getDimension(),t.getMeasures());ae.copy(t,n,i,0,1),e[n]=this.createPoint(i)}return this.createMultiPoint(e)}}}get interfaces_(){return[rn]}}const Jn={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};class $E{constructor(t){this.geometryFactory=t||new Qt,this.precisionModel=this.geometryFactory.getPrecisionModel()}read(t){let e,n,i;t=t.replace(/[\n\r]/g," ");let s=Jn.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(s=Jn.emptyTypeStr.exec(t),s[2]=void 0),s&&(n=s[1].toLowerCase(),i=s[2],bi[n]&&(e=bi[n].call(this,i))),e===void 0)throw new Error("Could not parse WKT "+t);return e}write(t){return this.extractGeometry(t)}extractGeometry(t){const e=t.getGeometryType().toLowerCase();if(!$n[e])return null;const n=e.toUpperCase();let i;return t.isEmpty()?i=n+" EMPTY":i=n+"("+$n[e].call(this,t)+")",i}}const $n={coordinate(r){return this.precisionModel.makePrecise(r),r.x+" "+r.y},point(r){return $n.coordinate.call(this,r._coordinates._coordinates[0])},multipoint(r){const t=[];for(let e=0,n=r._geometries.length;e<n;++e)t.push("("+$n.point.call(this,r._geometries[e])+")");return t.join(",")},linestring(r){const t=[];for(let e=0,n=r._points._coordinates.length;e<n;++e)t.push($n.coordinate.call(this,r._points._coordinates[e]));return t.join(",")},linearring(r){const t=[];for(let e=0,n=r._points._coordinates.length;e<n;++e)t.push($n.coordinate.call(this,r._points._coordinates[e]));return t.join(",")},multilinestring(r){const t=[];for(let e=0,n=r._geometries.length;e<n;++e)t.push("("+$n.linestring.call(this,r._geometries[e])+")");return t.join(",")},polygon(r){const t=[];t.push("("+$n.linestring.call(this,r._shell)+")");for(let e=0,n=r._holes.length;e<n;++e)t.push("("+$n.linestring.call(this,r._holes[e])+")");return t.join(",")},multipolygon(r){const t=[];for(let e=0,n=r._geometries.length;e<n;++e)t.push("("+$n.polygon.call(this,r._geometries[e])+")");return t.join(",")},geometrycollection(r){const t=[];for(let e=0,n=r._geometries.length;e<n;++e)t.push(this.extractGeometry(r._geometries[e]));return t.join(",")}},bi={coord(r){const t=r.trim().split(Jn.spaces),e=new w(Number.parseFloat(t[0]),Number.parseFloat(t[1]));return this.precisionModel.makePrecise(e),e},point(r){return r===void 0?this.geometryFactory.createPoint():this.geometryFactory.createPoint(bi.coord.call(this,r))},multipoint(r){if(r===void 0)return this.geometryFactory.createMultiPoint();let t;const e=r.trim().split(","),n=[];for(let i=0,s=e.length;i<s;++i)t=e[i].replace(Jn.trimParens,"$1"),n.push(bi.point.call(this,t));return this.geometryFactory.createMultiPoint(n)},linestring(r){if(r===void 0)return this.geometryFactory.createLineString();const t=r.trim().split(","),e=[];for(let n=0,i=t.length;n<i;++n)e.push(bi.coord.call(this,t[n]));return this.geometryFactory.createLineString(e)},linearring(r){if(r===void 0)return this.geometryFactory.createLinearRing();const t=r.trim().split(","),e=[];for(let n=0,i=t.length;n<i;++n)e.push(bi.coord.call(this,t[n]));return this.geometryFactory.createLinearRing(e)},multilinestring(r){if(r===void 0)return this.geometryFactory.createMultiLineString();let t;const e=r.trim().split(Jn.parenComma),n=[];for(let i=0,s=e.length;i<s;++i)t=e[i].replace(Jn.trimParens,"$1"),n.push(bi.linestring.call(this,t));return this.geometryFactory.createMultiLineString(n)},polygon(r){if(r===void 0)return this.geometryFactory.createPolygon();let t,e,n;const i=r.trim().split(Jn.parenComma);let s;const o=[];for(let a=0,l=i.length;a<l;++a)t=i[a].replace(Jn.trimParens,"$1"),e=bi.linestring.call(this,t),n=this.geometryFactory.createLinearRing(e._points),a===0?s=n:o.push(n);return this.geometryFactory.createPolygon(s,o)},multipolygon(r){if(r===void 0)return this.geometryFactory.createMultiPolygon();let t;const e=r.trim().split(Jn.doubleParenComma),n=[];for(let i=0,s=e.length;i<s;++i)t=e[i].replace(Jn.trimParens,"$1"),n.push(bi.polygon.call(this,t));return this.geometryFactory.createMultiPolygon(n)},geometrycollection(r){if(r===void 0)return this.geometryFactory.createGeometryCollection();r=r.replace(/,\s*([A-Za-z])/g,"|$1");const t=r.trim().split("|"),e=[];for(let n=0,i=t.length;n<i;++n)e.push(this.read(t[n]));return this.geometryFactory.createGeometryCollection(e)}};class di{constructor(t){this.parser=new $E(t)}write(t){return this.parser.write(t)}static toLineString(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}function $r(r){return[r.x,r.y]}class Cl{constructor(t,e){this.geometryFactory=t||new Qt,this.ol=e||typeof ol<"u"&&ol}inject(t,e,n,i,s,o,a,l){this.ol={geom:{Point:t,LineString:e,LinearRing:n,Polygon:i,MultiPoint:s,MultiLineString:o,MultiPolygon:a,GeometryCollection:l}}}read(t){const e=this.ol;if(t instanceof e.geom.Point)return this.convertFromPoint(t);if(t instanceof e.geom.LineString)return this.convertFromLineString(t);if(t instanceof e.geom.LinearRing)return this.convertFromLinearRing(t);if(t instanceof e.geom.Polygon)return this.convertFromPolygon(t);if(t instanceof e.geom.MultiPoint)return this.convertFromMultiPoint(t);if(t instanceof e.geom.MultiLineString)return this.convertFromMultiLineString(t);if(t instanceof e.geom.MultiPolygon)return this.convertFromMultiPolygon(t);if(t instanceof e.geom.GeometryCollection)return this.convertFromCollection(t)}convertFromPoint(t){const e=t.getCoordinates();return this.geometryFactory.createPoint(new w(e[0],e[1]))}convertFromLineString(t){return this.geometryFactory.createLineString(t.getCoordinates().map(function(e){return new w(e[0],e[1])}))}convertFromLinearRing(t){return this.geometryFactory.createLinearRing(t.getCoordinates().map(function(e){return new w(e[0],e[1])}))}convertFromPolygon(t){const e=t.getLinearRings();let n=null;const i=[];for(let s=0;s<e.length;s++){const o=this.convertFromLinearRing(e[s]);s===0?n=o:i.push(o)}return this.geometryFactory.createPolygon(n,i)}convertFromMultiPoint(t){const e=t.getPoints().map(function(n){return this.convertFromPoint(n)},this);return this.geometryFactory.createMultiPoint(e)}convertFromMultiLineString(t){const e=t.getLineStrings().map(function(n){return this.convertFromLineString(n)},this);return this.geometryFactory.createMultiLineString(e)}convertFromMultiPolygon(t){const e=t.getPolygons().map(function(n){return this.convertFromPolygon(n)},this);return this.geometryFactory.createMultiPolygon(e)}convertFromCollection(t){const e=t.getGeometries().map(function(n){return this.read(n)},this);return this.geometryFactory.createGeometryCollection(e)}write(t){if(t.getGeometryType()==="Point")return this.convertToPoint(t.getCoordinate());if(t.getGeometryType()==="LineString")return this.convertToLineString(t);if(t.getGeometryType()==="LinearRing")return this.convertToLinearRing(t);if(t.getGeometryType()==="Polygon")return this.convertToPolygon(t);if(t.getGeometryType()==="MultiPoint")return this.convertToMultiPoint(t);if(t.getGeometryType()==="MultiLineString")return this.convertToMultiLineString(t);if(t.getGeometryType()==="MultiPolygon")return this.convertToMultiPolygon(t);if(t.getGeometryType()==="GeometryCollection")return this.convertToCollection(t)}convertToPoint(t){return new this.ol.geom.Point([t.x,t.y])}convertToLineString(t){const e=t._points._coordinates.map($r);return new this.ol.geom.LineString(e)}convertToLinearRing(t){const e=t._points._coordinates.map($r);return new this.ol.geom.LinearRing(e)}convertToPolygon(t){const e=[t._shell._points._coordinates.map($r)];for(let n=0;n<t._holes.length;n++)e.push(t._holes[n]._points._coordinates.map($r));return new this.ol.geom.Polygon(e)}convertToMultiPoint(t){return new this.ol.geom.MultiPoint(t.getCoordinates().map($r))}convertToMultiLineString(t){const e=[];for(let n=0;n<t._geometries.length;n++)e.push(this.convertToLineString(t._geometries[n]).getCoordinates());return new this.ol.geom.MultiLineString(e)}convertToMultiPolygon(t){const e=[];for(let n=0;n<t._geometries.length;n++)e.push(this.convertToPolygon(t._geometries[n]).getCoordinates());return new this.ol.geom.MultiPolygon(e)}convertToCollection(t){const e=[];for(let n=0;n<t._geometries.length;n++){const i=t._geometries[n];e.push(this.write(i))}return new this.ol.geom.GeometryCollection(e)}}class bh{static intersection(t,e,n,i){const s=t.x<e.x?t.x:e.x,o=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,c=n.x<i.x?n.x:i.x,h=n.y<i.y?n.y:i.y,u=n.x>i.x?n.x:i.x,d=n.y>i.y?n.y:i.y,f=s>c?s:c,p=a<u?a:u,m=o>h?o:h,I=l<d?l:d,x=(f+p)/2,E=(m+I)/2,R=t.x-x,T=t.y-E,N=e.x-x,S=e.y-E,M=n.x-x,L=n.y-E,D=i.x-x,Y=i.y-E,W=T-S,B=N-R,$=R*S-N*T,it=L-Y,Z=D-M,V=M*Y-D*L,X=B*V-Z*$,st=it*$-W*V,xt=W*Z-it*B,_t=X/xt,Mt=st/xt;return j.isNaN(_t)||j.isInfinite(_t)||j.isNaN(Mt)||j.isInfinite(Mt)?null:new w(_t+x,Mt+E)}}class ge{static segmentToSegment(t,e,n,i){if(t.equals(e))return ge.pointToSegment(t,n,i);if(n.equals(i))return ge.pointToSegment(i,t,e);let s=!1;if(!ct.intersects(t,e,n,i))s=!0;else{const o=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(o===0)s=!0;else{const a=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),c=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,h=a/o;(h<0||h>1||c<0||c>1)&&(s=!0)}}return s?Xs.min(ge.pointToSegment(t,n,i),ge.pointToSegment(e,n,i),ge.pointToSegment(n,t,e),ge.pointToSegment(i,t,e)):0}static pointToSegment(t,e,n){if(e.x===n.x&&e.y===n.y)return t.distance(e);const i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),s=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;if(s<=0)return t.distance(e);if(s>=1)return t.distance(n);const o=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(o)*Math.sqrt(i)}static pointToLinePerpendicular(t,e,n){const i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),s=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(s)*Math.sqrt(i)}static pointToSegmentString(t,e){if(e.length===0)throw new ht("Line array must contain at least one vertex");let n=t.distance(e[0]);for(let i=0;i<e.length-1;i++){const s=ge.pointToSegment(t,e[i],e[i+1]);s<n&&(n=s)}return n}}class Ft{constructor(){Ft.constructor_.apply(this,arguments)}static constructor_(){this._result=null,this._inputLines=Array(2).fill().map(()=>Array(2)),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new w,this._intPt[1]=new w,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}static computeEdgeDistance(t,e,n){const i=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);let o=-1;if(t.equals(e))o=0;else if(t.equals(n))i>s?o=i:o=s;else{const a=Math.abs(t.x-e.x),l=Math.abs(t.y-e.y);i>s?o=a:o=l,o===0&&!t.equals(e)&&(o=Math.max(a,l))}return et.isTrue(!(o===0&&!t.equals(e)),"Bad distance calculation"),o}static nonRobustComputeEdgeDistance(t,e,n){const i=t.x-e.x,s=t.y-e.y,o=Math.sqrt(i*i+s*s);return et.isTrue(!(o===0&&!t.equals(e)),"Invalid distance calculation"),o}getIndexAlongSegment(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]}getTopologySummary(){const t=new Il;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()}computeIntersection(t,e,n,i){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(t,e,n,i)}getIntersectionNum(){return this._result}computeIntLineIndex(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(()=>Array(2)),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){const t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}}isProper(){return this.hasIntersection()&&this._isProper}setPrecisionModel(t){this._precisionModel=t}isInteriorIntersection(){if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){const t=arguments[0];for(let e=0;e<this._result;e++)if(!(this._intPt[e].equals2D(this._inputLines[t][0])||this._intPt[e].equals2D(this._inputLines[t][1])))return!0;return!1}}getIntersection(t){return this._intPt[t]}isEndPoint(){return this.hasIntersection()&&!this._isProper}hasIntersection(){return this._result!==Ft.NO_INTERSECTION}getEdgeDistance(t,e){return Ft.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])}isCollinear(){return this._result===Ft.COLLINEAR_INTERSECTION}toString(){return di.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+di.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}getEndpoint(t,e){return this._inputLines[t][e]}isIntersection(t){for(let e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1}getIntersectionAlongSegment(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]}}Ft.DONT_INTERSECT=0;Ft.DO_INTERSECT=1;Ft.COLLINEAR=2;Ft.NO_INTERSECTION=0;Ft.POINT_INTERSECTION=1;Ft.COLLINEAR_INTERSECTION=2;class Me extends Ft{constructor(){super()}static nearestEndpoint(t,e,n,i){let s=t,o=ge.pointToSegment(t,n,i),a=ge.pointToSegment(e,n,i);return a<o&&(o=a,s=e),a=ge.pointToSegment(n,t,e),a<o&&(o=a,s=n),a=ge.pointToSegment(i,t,e),a<o&&(o=a,s=i),s}isInSegmentEnvelopes(t){const e=new ct(this._inputLines[0][0],this._inputLines[0][1]),n=new ct(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&n.contains(t)}computeIntersection(){if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(this._isProper=!1,ct.intersects(e,n,t)&&J.index(e,n,t)===0&&J.index(n,e,t)===0)return this._isProper=!0,(t.equals(e)||t.equals(n))&&(this._isProper=!1),this._result=Ft.POINT_INTERSECTION,null;this._result=Ft.NO_INTERSECTION}else return super.computeIntersection.apply(this,arguments)}intersection(t,e,n,i){let s=this.intersectionSafe(t,e,n,i);return this.isInSegmentEnvelopes(s)||(s=new w(Me.nearestEndpoint(t,e,n,i))),this._precisionModel!==null&&this._precisionModel.makePrecise(s),s}checkDD(t,e,n,i,s){const o=ni.intersection(t,e,n,i),a=this.isInSegmentEnvelopes(o);en.out.println("DD in env = "+a+"  --------------------- "+o),s.distance(o)>1e-4&&en.out.println("Distance = "+s.distance(o))}intersectionSafe(t,e,n,i){let s=bh.intersection(t,e,n,i);return s===null&&(s=Me.nearestEndpoint(t,e,n,i)),s}computeCollinearIntersection(t,e,n,i){const s=ct.intersects(t,e,n),o=ct.intersects(t,e,i),a=ct.intersects(n,i,t),l=ct.intersects(n,i,e);return s&&o?(this._intPt[0]=n,this._intPt[1]=i,Ft.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=t,this._intPt[1]=e,Ft.COLLINEAR_INTERSECTION):s&&a?(this._intPt[0]=n,this._intPt[1]=t,n.equals(t)&&!o&&!l?Ft.POINT_INTERSECTION:Ft.COLLINEAR_INTERSECTION):s&&l?(this._intPt[0]=n,this._intPt[1]=e,n.equals(e)&&!o&&!a?Ft.POINT_INTERSECTION:Ft.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=i,this._intPt[1]=t,i.equals(t)&&!s&&!l?Ft.POINT_INTERSECTION:Ft.COLLINEAR_INTERSECTION):o&&l?(this._intPt[0]=i,this._intPt[1]=e,i.equals(e)&&!s&&!a?Ft.POINT_INTERSECTION:Ft.COLLINEAR_INTERSECTION):Ft.NO_INTERSECTION}computeIntersect(t,e,n,i){if(this._isProper=!1,!ct.intersects(t,e,n,i))return Ft.NO_INTERSECTION;const s=J.index(t,e,n),o=J.index(t,e,i);if(s>0&&o>0||s<0&&o<0)return Ft.NO_INTERSECTION;const a=J.index(n,i,t),l=J.index(n,i,e);return a>0&&l>0||a<0&&l<0?Ft.NO_INTERSECTION:s===0&&o===0&&a===0&&l===0?this.computeCollinearIntersection(t,e,n,i):(s===0||o===0||a===0||l===0?(this._isProper=!1,t.equals2D(n)||t.equals2D(i)?this._intPt[0]=t:e.equals2D(n)||e.equals2D(i)?this._intPt[0]=e:s===0?this._intPt[0]=new w(n):o===0?this._intPt[0]=new w(i):a===0?this._intPt[0]=new w(t):l===0&&(this._intPt[0]=new w(e))):(this._isProper=!0,this._intPt[0]=this.intersection(t,e,n,i)),Ft.POINT_INTERSECTION)}}class At{constructor(){At.constructor_.apply(this,arguments)}static constructor_(){if(this.p0=null,this.p1=null,arguments.length===0)At.constructor_.call(this,new w,new w);else if(arguments.length===1){const t=arguments[0];At.constructor_.call(this,t.p0,t.p1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.p0=t,this.p1=e}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];At.constructor_.call(this,new w(t,e),new w(n,i))}}static midPoint(t,e){return new w((t.x+e.x)/2,(t.y+e.y)/2)}minX(){return Math.min(this.p0.x,this.p1.x)}orientationIndex(){if(arguments[0]instanceof At){const t=arguments[0],e=J.index(this.p0,this.p1,t.p0),n=J.index(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof w){const t=arguments[0];return J.index(this.p0,this.p1,t)}}toGeometry(t){return t.createLineString([this.p0,this.p1])}isVertical(){return this.p0.x===this.p1.x}equals(t){if(!(t instanceof At))return!1;const e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)}intersection(t){const e=new Me;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null}project(){if(arguments[0]instanceof w){const t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new w(t);const e=this.projectionFactor(t),n=new w;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof At){const t=arguments[0],e=this.projectionFactor(t.p0),n=this.projectionFactor(t.p1);if(e>=1&&n>=1||e<=0&&n<=0)return null;let i=this.project(t.p0);e<0&&(i=this.p0),e>1&&(i=this.p1);let s=this.project(t.p1);return n<0&&(s=this.p0),n>1&&(s=this.p1),new At(i,s)}}normalize(){this.p1.compareTo(this.p0)<0&&this.reverse()}angle(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}getCoordinate(t){return t===0?this.p0:this.p1}distancePerpendicular(t){return ge.pointToLinePerpendicular(t,this.p0,this.p1)}minY(){return Math.min(this.p0.y,this.p1.y)}midPoint(){return At.midPoint(this.p0,this.p1)}projectionFactor(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;const e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=e*e+n*n;return i<=0?j.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/i}closestPoints(t){const e=this.intersection(t);if(e!==null)return[e,e];const n=new Array(2).fill(null);let i=j.MAX_VALUE,s=null;const o=this.closestPoint(t.p0);i=o.distance(t.p0),n[0]=o,n[1]=t.p0;const a=this.closestPoint(t.p1);s=a.distance(t.p1),s<i&&(i=s,n[0]=a,n[1]=t.p1);const l=t.closestPoint(this.p0);s=l.distance(this.p0),s<i&&(i=s,n[0]=this.p0,n[1]=l);const c=t.closestPoint(this.p1);return s=c.distance(this.p1),s<i&&(i=s,n[0]=this.p1,n[1]=c),n}closestPoint(t){const e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);const n=this.p0.distance(t),i=this.p1.distance(t);return n<i?this.p0:this.p1}maxX(){return Math.max(this.p0.x,this.p1.x)}getLength(){return this.p0.distance(this.p1)}compareTo(t){const e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)}reverse(){const t=this.p0;this.p0=this.p1,this.p1=t}equalsTopo(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)}lineIntersection(t){return bh.intersection(this.p0,this.p1,t.p0,t.p1)}maxY(){return Math.max(this.p0.y,this.p1.y)}pointAlongOffset(t,e){const n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(s*s+o*o);let l=0,c=0;if(e!==0){if(a<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");l=e*s/a,c=e*o/a}const h=n-c,u=i+l;return new w(h,u)}setCoordinates(){if(arguments.length===1){const t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=e.x,this.p1.y=e.y}}segmentFraction(t){let e=this.projectionFactor(t);return e<0?e=0:(e>1||j.isNaN(e))&&(e=1),e}toString(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}isHorizontal(){return this.p0.y===this.p1.y}reflect(t){const e=this.p1.getY()-this.p0.getY(),n=this.p0.getX()-this.p1.getX(),i=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),s=e*e+n*n,o=e*e-n*n,a=t.getX(),l=t.getY(),c=(-o*a-2*e*n*l-2*e*i)/s,h=(o*l-2*e*n*a-2*n*i)/s;return new w(c,h)}distance(){if(arguments[0]instanceof At){const t=arguments[0];return ge.segmentToSegment(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof w){const t=arguments[0];return ge.pointToSegment(t,this.p0,this.p1)}}pointAlong(t){const e=new w;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e}hashCode(){let t=j.doubleToLongBits(this.p0.x);t^=j.doubleToLongBits(this.p0.y)*31;const e=Math.trunc(t)^Math.trunc(t>>32);let n=j.doubleToLongBits(this.p1.x);n^=j.doubleToLongBits(this.p1.y)*31;const i=Math.trunc(n)^Math.trunc(n>>32);return e^i}get interfaces_(){return[sn,rn]}}class y{static toLocationSymbol(t){switch(t){case y.EXTERIOR:return"e";case y.BOUNDARY:return"b";case y.INTERIOR:return"i";case y.NONE:return"-"}throw new ht("Unknown location value: "+t)}}y.INTERIOR=0;y.BOUNDARY=1;y.EXTERIOR=2;y.NONE=-1;class Tt{constructor(){Tt.constructor_.apply(this,arguments)}static constructor_(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(()=>Array(3)),this.setAll(O.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){const t=arguments[0];Tt.constructor_.call(this),this.set(t)}else if(arguments[0]instanceof Tt){const t=arguments[0];Tt.constructor_.call(this),this._matrix[y.INTERIOR][y.INTERIOR]=t._matrix[y.INTERIOR][y.INTERIOR],this._matrix[y.INTERIOR][y.BOUNDARY]=t._matrix[y.INTERIOR][y.BOUNDARY],this._matrix[y.INTERIOR][y.EXTERIOR]=t._matrix[y.INTERIOR][y.EXTERIOR],this._matrix[y.BOUNDARY][y.INTERIOR]=t._matrix[y.BOUNDARY][y.INTERIOR],this._matrix[y.BOUNDARY][y.BOUNDARY]=t._matrix[y.BOUNDARY][y.BOUNDARY],this._matrix[y.BOUNDARY][y.EXTERIOR]=t._matrix[y.BOUNDARY][y.EXTERIOR],this._matrix[y.EXTERIOR][y.INTERIOR]=t._matrix[y.EXTERIOR][y.INTERIOR],this._matrix[y.EXTERIOR][y.BOUNDARY]=t._matrix[y.EXTERIOR][y.BOUNDARY],this._matrix[y.EXTERIOR][y.EXTERIOR]=t._matrix[y.EXTERIOR][y.EXTERIOR]}}}static matches(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){const t=arguments[0],e=arguments[1];return e===O.SYM_DONTCARE||e===O.SYM_TRUE&&(t>=0||t===O.TRUE)||e===O.SYM_FALSE&&t===O.FALSE||e===O.SYM_P&&t===O.P||e===O.SYM_L&&t===O.L||e===O.SYM_A&&t===O.A}else if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){const t=arguments[0],e=arguments[1];return new Tt(t).matches(e)}}static isTrue(t){return t>=0||t===O.TRUE}isIntersects(){return!this.isDisjoint()}isCovers(){return(Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])||Tt.isTrue(this._matrix[y.INTERIOR][y.BOUNDARY])||Tt.isTrue(this._matrix[y.BOUNDARY][y.INTERIOR])||Tt.isTrue(this._matrix[y.BOUNDARY][y.BOUNDARY]))&&this._matrix[y.EXTERIOR][y.INTERIOR]===O.FALSE&&this._matrix[y.EXTERIOR][y.BOUNDARY]===O.FALSE}isCoveredBy(){return(Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])||Tt.isTrue(this._matrix[y.INTERIOR][y.BOUNDARY])||Tt.isTrue(this._matrix[y.BOUNDARY][y.INTERIOR])||Tt.isTrue(this._matrix[y.BOUNDARY][y.BOUNDARY]))&&this._matrix[y.INTERIOR][y.EXTERIOR]===O.FALSE&&this._matrix[y.BOUNDARY][y.EXTERIOR]===O.FALSE}set(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<t.length;e++){const n=Math.trunc(e/3),i=e%3;this._matrix[n][i]=O.toDimensionValue(t.charAt(e))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._matrix[t][e]=n}}isContains(){return Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&this._matrix[y.EXTERIOR][y.INTERIOR]===O.FALSE&&this._matrix[y.EXTERIOR][y.BOUNDARY]===O.FALSE}setAtLeast(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<t.length;e++){const n=Math.trunc(e/3),i=e%3;this.setAtLeast(n,i,O.toDimensionValue(t.charAt(e)))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._matrix[t][e]<n&&(this._matrix[t][e]=n)}}setAtLeastIfValid(t,e,n){t>=0&&e>=0&&this.setAtLeast(t,e,n)}isWithin(){return Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&this._matrix[y.INTERIOR][y.EXTERIOR]===O.FALSE&&this._matrix[y.BOUNDARY][y.EXTERIOR]===O.FALSE}isTouches(t,e){return t>e?this.isTouches(e,t):t===O.A&&e===O.A||t===O.L&&e===O.L||t===O.L&&e===O.A||t===O.P&&e===O.A||t===O.P&&e===O.L?this._matrix[y.INTERIOR][y.INTERIOR]===O.FALSE&&(Tt.isTrue(this._matrix[y.INTERIOR][y.BOUNDARY])||Tt.isTrue(this._matrix[y.BOUNDARY][y.INTERIOR])||Tt.isTrue(this._matrix[y.BOUNDARY][y.BOUNDARY])):!1}isOverlaps(t,e){return t===O.P&&e===O.P||t===O.A&&e===O.A?Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&Tt.isTrue(this._matrix[y.INTERIOR][y.EXTERIOR])&&Tt.isTrue(this._matrix[y.EXTERIOR][y.INTERIOR]):t===O.L&&e===O.L?this._matrix[y.INTERIOR][y.INTERIOR]===1&&Tt.isTrue(this._matrix[y.INTERIOR][y.EXTERIOR])&&Tt.isTrue(this._matrix[y.EXTERIOR][y.INTERIOR]):!1}isEquals(t,e){return t!==e?!1:Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&this._matrix[y.INTERIOR][y.EXTERIOR]===O.FALSE&&this._matrix[y.BOUNDARY][y.EXTERIOR]===O.FALSE&&this._matrix[y.EXTERIOR][y.INTERIOR]===O.FALSE&&this._matrix[y.EXTERIOR][y.BOUNDARY]===O.FALSE}toString(){const t=new Il("123456789");for(let e=0;e<3;e++)for(let n=0;n<3;n++)t.setCharAt(3*e+n,O.toDimensionSymbol(this._matrix[e][n]));return t.toString()}setAll(t){for(let e=0;e<3;e++)for(let n=0;n<3;n++)this._matrix[e][n]=t}get(t,e){return this._matrix[t][e]}transpose(){let t=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=t,t=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=t,t=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=t,this}matches(t){if(t.length!==9)throw new ht("Should be length 9: "+t);for(let e=0;e<3;e++)for(let n=0;n<3;n++)if(!Tt.matches(this._matrix[e][n],t.charAt(3*e+n)))return!1;return!0}add(t){for(let e=0;e<3;e++)for(let n=0;n<3;n++)this.setAtLeast(e,n,t.get(e,n))}isDisjoint(){return this._matrix[y.INTERIOR][y.INTERIOR]===O.FALSE&&this._matrix[y.INTERIOR][y.BOUNDARY]===O.FALSE&&this._matrix[y.BOUNDARY][y.INTERIOR]===O.FALSE&&this._matrix[y.BOUNDARY][y.BOUNDARY]===O.FALSE}isCrosses(t,e){return t===O.P&&e===O.L||t===O.P&&e===O.A||t===O.L&&e===O.A?Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&Tt.isTrue(this._matrix[y.INTERIOR][y.EXTERIOR]):t===O.L&&e===O.P||t===O.A&&e===O.P||t===O.A&&e===O.L?Tt.isTrue(this._matrix[y.INTERIOR][y.INTERIOR])&&Tt.isTrue(this._matrix[y.EXTERIOR][y.INTERIOR]):t===O.L&&e===O.L?this._matrix[y.INTERIOR][y.INTERIOR]===0:!1}get interfaces_(){return[zr]}}class Nt{static toDegrees(t){return t*180/Math.PI}static normalize(t){for(;t>Math.PI;)t-=Nt.PI_TIMES_2;for(;t<=-Math.PI;)t+=Nt.PI_TIMES_2;return t}static angle(){if(arguments.length===1){const t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)}}static isAcute(t,e,n){const i=t.x-e.x,s=t.y-e.y,o=n.x-e.x,a=n.y-e.y;return i*o+s*a>0}static isObtuse(t,e,n){const i=t.x-e.x,s=t.y-e.y,o=n.x-e.x,a=n.y-e.y;return i*o+s*a<0}static interiorAngle(t,e,n){const i=Nt.angle(e,t),s=Nt.angle(e,n);return Math.abs(s-i)}static normalizePositive(t){if(t<0){for(;t<0;)t+=Nt.PI_TIMES_2;t>=Nt.PI_TIMES_2&&(t=0)}else{for(;t>=Nt.PI_TIMES_2;)t-=Nt.PI_TIMES_2;t<0&&(t=0)}return t}static angleBetween(t,e,n){const i=Nt.angle(e,t),s=Nt.angle(e,n);return Nt.diff(i,s)}static diff(t,e){let n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n}static toRadians(t){return t*Math.PI/180}static getTurn(t,e){const n=Math.sin(e-t);return n>0?Nt.COUNTERCLOCKWISE:n<0?Nt.CLOCKWISE:Nt.NONE}static angleBetweenOriented(t,e,n){const i=Nt.angle(e,t),o=Nt.angle(e,n)-i;return o<=-Math.PI?o+Nt.PI_TIMES_2:o>Math.PI?o-Nt.PI_TIMES_2:o}}Nt.PI_TIMES_2=2*Math.PI;Nt.PI_OVER_2=Math.PI/2;Nt.PI_OVER_4=Math.PI/4;Nt.COUNTERCLOCKWISE=J.COUNTERCLOCKWISE;Nt.CLOCKWISE=J.CLOCKWISE;Nt.NONE=J.COLLINEAR;class ka extends gn{constructor(){super(),ka.constructor_.apply(this,arguments)}static constructor_(){gn.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}class Fs{constructor(){Fs.constructor_.apply(this,arguments)}static constructor_(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){const t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];this.x=t,this.y=e,this.w=1}else if(arguments[0]instanceof Fs&&arguments[1]instanceof Fs){const t=arguments[0],e=arguments[1];this.x=t.y*e.w-e.y*t.w,this.y=e.x*t.w-t.x*e.w,this.w=t.x*e.y-e.x*t.y}else if(arguments[0]instanceof w&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1];this.x=t.y-e.y,this.y=e.x-t.x,this.w=t.x*e.y-e.x*t.y}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this.x=t,this.y=e,this.w=n}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,l=n.y-i.y,c=i.x-n.x,h=n.x*i.y-i.x*n.y;this.x=o*h-c*a,this.y=l*a-s*h,this.w=s*c-l*o}}getY(){const t=this.y/this.w;if(j.isNaN(t)||j.isInfinite(t))throw new ka;return t}getX(){const t=this.x/this.w;if(j.isNaN(t)||j.isInfinite(t))throw new ka;return t}getCoordinate(){const t=new w;return t.x=this.getX(),t.y=this.getY(),t}}class Xe{constructor(){Xe.constructor_.apply(this,arguments)}static constructor_(){this.p0=null,this.p1=null,this.p2=null;const t=arguments[0],e=arguments[1],n=arguments[2];this.p0=t,this.p1=e,this.p2=n}static area(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)}static signedArea(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2}static det(t,e,n,i){return t*i-e*n}static interpolateZ(t,e,n,i){const s=e.x,o=e.y,a=n.x-s,l=i.x-s,c=n.y-o,h=i.y-o,u=a*h-l*c,d=t.x-s,f=t.y-o,p=(h*d-l*f)/u,m=(-c*d+a*f)/u;return e.getZ()+p*(n.getZ()-e.getZ())+m*(i.getZ()-e.getZ())}static longestSideLength(t,e,n){const i=t.distance(e),s=e.distance(n),o=n.distance(t);let a=i;return s>a&&(a=s),o>a&&(a=o),a}static circumcentreDD(t,e,n){const i=v.valueOf(t.x).subtract(n.x),s=v.valueOf(t.y).subtract(n.y),o=v.valueOf(e.x).subtract(n.x),a=v.valueOf(e.y).subtract(n.y),l=v.determinant(i,s,o,a).multiply(2),c=i.sqr().add(s.sqr()),h=o.sqr().add(a.sqr()),u=v.determinant(s,c,a,h),d=v.determinant(i,c,o,h),f=v.valueOf(n.x).subtract(u.divide(l)).doubleValue(),p=v.valueOf(n.y).add(d.divide(l)).doubleValue();return new w(f,p)}static isAcute(t,e,n){return!(!Nt.isAcute(t,e,n)||!Nt.isAcute(e,n,t)||!Nt.isAcute(n,t,e))}static circumcentre(t,e,n){const i=n.x,s=n.y,o=t.x-i,a=t.y-s,l=e.x-i,c=e.y-s,h=2*Xe.det(o,a,l,c),u=Xe.det(a,o*o+a*a,c,l*l+c*c),d=Xe.det(o,o*o+a*a,l,l*l+c*c),f=i-u/h,p=s+d/h;return new w(f,p)}static perpendicularBisector(t,e){const n=e.x-t.x,i=e.y-t.y,s=new Fs(t.x+n/2,t.y+i/2,1),o=new Fs(t.x-i+n/2,t.y+n+i/2,1);return new Fs(s,o)}static angleBisector(t,e,n){const i=e.distance(t),s=e.distance(n),o=i/(i+s),a=n.x-t.x,l=n.y-t.y;return new w(t.x+o*a,t.y+o*l)}static area3D(t,e,n){const i=e.x-t.x,s=e.y-t.y,o=e.getZ()-t.getZ(),a=n.x-t.x,l=n.y-t.y,c=n.getZ()-t.getZ(),h=s*c-o*l,u=o*a-i*c,d=i*l-s*a,f=h*h+u*u+d*d;return Math.sqrt(f)/2}static centroid(t,e,n){const i=(t.x+e.x+n.x)/3,s=(t.y+e.y+n.y)/3;return new w(i,s)}static inCentre(t,e,n){const i=e.distance(n),s=t.distance(n),o=t.distance(e),a=i+s+o,l=(i*t.x+s*e.x+o*n.x)/a,c=(i*t.y+s*e.y+o*n.y)/a;return new w(l,c)}area(){return Xe.area(this.p0,this.p1,this.p2)}signedArea(){return Xe.signedArea(this.p0,this.p1,this.p2)}interpolateZ(t){if(t===null)throw new ht("Supplied point is null.");return Xe.interpolateZ(t,this.p0,this.p1,this.p2)}longestSideLength(){return Xe.longestSideLength(this.p0,this.p1,this.p2)}isAcute(){return Xe.isAcute(this.p0,this.p1,this.p2)}circumcentre(){return Xe.circumcentre(this.p0,this.p1,this.p2)}area3D(){return Xe.area3D(this.p0,this.p1,this.p2)}centroid(){return Xe.centroid(this.p0,this.p1,this.p2)}inCentre(){return Xe.inCentre(this.p0,this.p1,this.p2)}}class vh extends gn{constructor(){super(),vh.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)gn.constructor_.call(this);else if(arguments.length===1){const t=arguments[0];gn.constructor_.call(this,t)}}}class Xt{constructor(){Xt.constructor_.apply(this,arguments)}static constructor_(){if(this._m00=null,this._m01=null,this._m02=null,this._m10=null,this._m11=null,this._m12=null,arguments.length===0)this.setToIdentity();else if(arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];this._m00=t[0],this._m01=t[1],this._m02=t[2],this._m10=t[3],this._m11=t[4],this._m12=t[5]}else if(arguments[0]instanceof Xt){const t=arguments[0];this.setTransformation(t)}}else if(arguments.length===6&&typeof arguments[5]=="number"&&typeof arguments[4]=="number"&&typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5];this.setTransformation(t,e,n,i,s,o)}}static translationInstance(t,e){const n=new Xt;return n.setToTranslation(t,e),n}static shearInstance(t,e){const n=new Xt;return n.setToShear(t,e),n}static reflectionInstance(){if(arguments.length===2){const t=arguments[0],e=arguments[1],n=new Xt;return n.setToReflection(t,e),n}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=new Xt;return s.setToReflection(t,e,n,i),s}}static rotationInstance(){if(arguments.length===1){const t=arguments[0];return Xt.rotationInstance(Math.sin(t),Math.cos(t))}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=new Xt;return n.setToRotation(t,e),n}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return Xt.rotationInstance(Math.sin(t),Math.cos(t),e,n)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=new Xt;return s.setToRotation(t,e,n,i),s}}static scaleInstance(){if(arguments.length===2){const t=arguments[0],e=arguments[1],n=new Xt;return n.setToScale(t,e),n}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=new Xt;return s.translate(-n,-i),s.scale(t,e),s.translate(n,i),s}}setToReflectionBasic(t,e,n,i){if(t===n&&e===i)throw new ht("Reflection line points must be distinct");const s=n-t,o=i-e,a=Math.sqrt(s*s+o*o),l=o/a,c=s/a,h=2*l*c,u=c*c-l*l;return this._m00=u,this._m01=h,this._m02=0,this._m10=h,this._m11=-u,this._m12=0,this}getInverse(){const t=this.getDeterminant();if(t===0)throw new vh("Transformation is non-invertible");const e=this._m11/t,n=-this._m10/t,i=-this._m01/t,s=this._m00/t,o=(this._m01*this._m12-this._m02*this._m11)/t,a=(-this._m00*this._m12+this._m10*this._m02)/t;return new Xt(e,i,o,n,s,a)}compose(t){const e=t._m00*this._m00+t._m01*this._m10,n=t._m00*this._m01+t._m01*this._m11,i=t._m00*this._m02+t._m01*this._m12+t._m02,s=t._m10*this._m00+t._m11*this._m10,o=t._m10*this._m01+t._m11*this._m11,a=t._m10*this._m02+t._m11*this._m12+t._m12;return this._m00=e,this._m01=n,this._m02=i,this._m10=s,this._m11=o,this._m12=a,this}equals(t){if(t===null||!(t instanceof Xt))return!1;const e=t;return this._m00===e._m00&&this._m01===e._m01&&this._m02===e._m02&&this._m10===e._m10&&this._m11===e._m11&&this._m12===e._m12}setToScale(t,e){return this._m00=t,this._m01=0,this._m02=0,this._m10=0,this._m11=e,this._m12=0,this}isIdentity(){return this._m00===1&&this._m01===0&&this._m02===0&&this._m10===0&&this._m11===1&&this._m12===0}scale(t,e){return this.compose(Xt.scaleInstance(t,e)),this}setToIdentity(){return this._m00=1,this._m01=0,this._m02=0,this._m10=0,this._m11=1,this._m12=0,this}isGeometryChanged(){return!0}setTransformation(){if(arguments.length===1){const t=arguments[0];return this._m00=t._m00,this._m01=t._m01,this._m02=t._m02,this._m10=t._m10,this._m11=t._m11,this._m12=t._m12,this}else if(arguments.length===6){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5];return this._m00=t,this._m01=e,this._m02=n,this._m10=i,this._m11=s,this._m12=o,this}}setToRotation(){if(arguments.length===1){const t=arguments[0];return this.setToRotation(Math.sin(t),Math.cos(t)),this}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this._m00=e,this._m01=-t,this._m02=0,this._m10=t,this._m11=e,this._m12=0,this}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return this.setToRotation(Math.sin(t),Math.cos(t),e,n),this}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return this._m00=e,this._m01=-t,this._m02=n-n*e+i*t,this._m10=t,this._m11=e,this._m12=i-n*t-i*e,this}}getMatrixEntries(){return[this._m00,this._m01,this._m02,this._m10,this._m11,this._m12]}filter(t,e){this.transform(t,e)}rotate(){if(arguments.length===1){const t=arguments[0];return this.compose(Xt.rotationInstance(t)),this}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.compose(Xt.rotationInstance(t,e)),this}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return this.compose(Xt.rotationInstance(t,e,n)),this}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return this.compose(Xt.rotationInstance(t,e,n,i)),this}}getDeterminant(){return this._m00*this._m11-this._m01*this._m10}composeBefore(t){const e=this._m00*t._m00+this._m01*t._m10,n=this._m00*t._m01+this._m01*t._m11,i=this._m00*t._m02+this._m01*t._m12+this._m02,s=this._m10*t._m00+this._m11*t._m10,o=this._m10*t._m01+this._m11*t._m11,a=this._m10*t._m02+this._m11*t._m12+this._m12;return this._m00=e,this._m01=n,this._m02=i,this._m10=s,this._m11=o,this._m12=a,this}setToShear(t,e){return this._m00=1,this._m01=t,this._m02=0,this._m10=e,this._m11=1,this._m12=0,this}isDone(){return!1}clone(){try{return null}catch(t){if(t instanceof gn)et.shouldNeverReachHere();else throw t}finally{}return null}translate(t,e){return this.compose(Xt.translationInstance(t,e)),this}setToReflection(){if(arguments.length===2){const t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new ht("Reflection vector must be non-zero");if(t===e)return this._m00=0,this._m01=1,this._m02=0,this._m10=1,this._m11=0,this._m12=0,this;const n=Math.sqrt(t*t+e*e),i=e/n,s=t/n;return this.rotate(-i,s),this.scale(1,-1),this.rotate(i,s),this}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];if(t===n&&e===i)throw new ht("Reflection line points must be distinct");this.setToTranslation(-t,-e);const s=n-t,o=i-e,a=Math.sqrt(s*s+o*o),l=o/a,c=s/a;return this.rotate(-l,c),this.scale(1,-1),this.rotate(l,c),this.translate(t,e),this}}toString(){return"AffineTransformation[["+this._m00+", "+this._m01+", "+this._m02+"], ["+this._m10+", "+this._m11+", "+this._m12+"]]"}setToTranslation(t,e){return this._m00=1,this._m01=0,this._m02=t,this._m10=0,this._m11=1,this._m12=e,this}shear(t,e){return this.compose(Xt.shearInstance(t,e)),this}transform(){if(arguments.length===1){const e=arguments[0].copy();return e.apply(this),e}else if(arguments.length===2){if(arguments[0]instanceof w&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1],n=this._m00*t.x+this._m01*t.y+this._m02,i=this._m10*t.x+this._m11*t.y+this._m12;return e.x=n,e.y=i,e}else if(H(arguments[0],Rt)&&Number.isInteger(arguments[1])){const t=arguments[0],e=arguments[1],n=this._m00*t.getOrdinate(e,0)+this._m01*t.getOrdinate(e,1)+this._m02,i=this._m10*t.getOrdinate(e,0)+this._m11*t.getOrdinate(e,1)+this._m12;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)}}}reflect(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.compose(Xt.reflectionInstance(t,e)),this}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return this.compose(Xt.reflectionInstance(t,e,n,i)),this}}get interfaces_(){return[zr,Vs]}}class Ya{constructor(){Ya.constructor_.apply(this,arguments)}static constructor_(){this._mapOp=null;const t=arguments[0];this._mapOp=t}static map(t,e){return new Ya(e).map(t)}map(t){const e=new F;for(let n=0;n<t.getNumGeometries();n++){const i=this._mapOp.map(t.getGeometryN(n));i.isEmpty()||e.add(i)}return t.getFactory().createGeometryCollection(Qt.toGeometryArray(e))}}class On{constructor(){On.constructor_.apply(this,arguments)}static constructor_(){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null;const t=arguments[0];this._geomFactory=On.extractFactory(t),this._inputGeoms=t}static combine(){if(arguments.length===1){const t=arguments[0];return new On(t).combine()}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new On(On.createList(t,e)).combine()}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return new On(On.createList(t,e,n)).combine()}}static extractFactory(t){return t.isEmpty()?null:t.iterator().next().getFactory()}static createList(){if(arguments.length===2){const t=arguments[0],e=arguments[1],n=new F;return n.add(t),n.add(e),n}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2],i=new F;return i.add(t),i.add(e),i.add(n),i}}extractElements(t,e){if(t===null)return null;for(let n=0;n<t.getNumGeometries();n++){const i=t.getGeometryN(n);this._skipEmpty&&i.isEmpty()||e.add(i)}}combine(){const t=new F;for(let e=this._inputGeoms.iterator();e.hasNext();){const n=e.next();this.extractElements(n,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection():null:this._geomFactory.buildGeometry(t)}}class Mh{constructor(){Mh.constructor_.apply(this,arguments)}static constructor_(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1}transformPoint(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))}transformPolygon(t,e){let n=!0;const i=this.transformLinearRing(t.getExteriorRing(),t);(i===null||!(i instanceof ve)||i.isEmpty())&&(n=!1);const s=new F;for(let o=0;o<t.getNumInteriorRing();o++){const a=this.transformLinearRing(t.getInteriorRingN(o),t);a===null||a.isEmpty()||(a instanceof ve||(n=!1),s.add(a))}if(n)return this._factory.createPolygon(i,s.toArray([]));{const o=new F;return i!==null&&o.add(i),o.addAll(s),this._factory.buildGeometry(o)}}createCoordinateSequence(t){return this._factory.getCoordinateSequenceFactory().create(t)}getInputGeometry(){return this._inputGeom}transformMultiLineString(t,e){const n=new F;for(let i=0;i<t.getNumGeometries();i++){const s=this.transformLineString(t.getGeometryN(i),t);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)}transformCoordinates(t,e){return this.copy(t)}transformLineString(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))}transformMultiPoint(t,e){const n=new F;for(let i=0;i<t.getNumGeometries();i++){const s=this.transformPoint(t.getGeometryN(i),t);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)}transformMultiPolygon(t,e){const n=new F;for(let i=0;i<t.getNumGeometries();i++){const s=this.transformPolygon(t.getGeometryN(i),t);s!==null&&(s.isEmpty()||n.add(s))}return this._factory.buildGeometry(n)}copy(t){return t.copy()}transformGeometryCollection(t,e){const n=new F;for(let i=0;i<t.getNumGeometries();i++){const s=this.transform(t.getGeometryN(i));s!==null&&(this._pruneEmptyGeometry&&s.isEmpty()||n.add(s))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Qt.toGeometryArray(n)):this._factory.buildGeometry(n)}transform(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof ee)return this.transformPoint(t,null);if(t instanceof Wn)return this.transformMultiPoint(t,null);if(t instanceof ve)return this.transformLinearRing(t,null);if(t instanceof vt)return this.transformLineString(t,null);if(t instanceof Nn)return this.transformMultiLineString(t,null);if(t instanceof jt)return this.transformPolygon(t,null);if(t instanceof nn)return this.transformMultiPolygon(t,null);if(t instanceof St)return this.transformGeometryCollection(t,null);throw new ht("Unknown Geometry subtype: "+t.getGeometryType())}transformLinearRing(t,e){const n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);const i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)}}class je{constructor(){je.constructor_.apply(this,arguments)}static constructor_(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){const t=arguments[0];this._lines=t}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._lines=t,this._isForcedToLineString=e}}static getGeometry(){if(arguments.length===1){const t=arguments[0];return t.getFactory().buildGeometry(je.getLines(t))}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t.getFactory().buildGeometry(je.getLines(t,e))}}static getLines(){if(arguments.length===1){const t=arguments[0];return je.getLines(t,!1)}else if(arguments.length===2){if(H(arguments[0],le)&&H(arguments[1],le)){const t=arguments[0],e=arguments[1];for(let n=t.iterator();n.hasNext();){const i=n.next();je.getLines(i,e)}return e}else if(arguments[0]instanceof A&&typeof arguments[1]=="boolean"){const t=arguments[0],e=arguments[1],n=new F;return t.apply(new je(n,e)),n}else if(arguments[0]instanceof A&&H(arguments[1],le)){const t=arguments[0],e=arguments[1];return t instanceof vt?e.add(t):t.apply(new je(e)),e}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&H(arguments[0],le)&&H(arguments[1],le)){const t=arguments[0],e=arguments[1],n=arguments[2];for(let i=t.iterator();i.hasNext();){const s=i.next();je.getLines(s,e,n)}return e}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof A&&H(arguments[1],le)){const t=arguments[0],e=arguments[1],n=arguments[2];return t.apply(new je(e,n)),e}}}filter(t){if(this._isForcedToLineString&&t instanceof ve){const e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof vt&&this._lines.add(t)}setForceToLineString(t){this._isForcedToLineString=t}get interfaces_(){return[Xr]}}const Fi={reverseOrder:function(){return{compare(r,t){return t.compareTo(r)}}},min:function(r){return Fi.sort(r),r.get(0)},sort:function(r,t){const e=r.toArray();t?as.sort(e,t):as.sort(e);const n=r.iterator();for(let i=0,s=e.length;i<s;i++)n.next(),n.set(e[i])},singletonList:function(r){const t=new F;return t.add(r),t}};class xr{constructor(){xr.constructor_.apply(this,arguments)}static constructor_(){this._pts=null;const t=arguments[0];this._pts=t}static getPoints(){if(arguments.length===1){const t=arguments[0];return t instanceof ee?Fi.singletonList(t):xr.getPoints(t,new F)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t instanceof ee?e.add(t):t instanceof St&&t.apply(new xr(e)),e}}filter(t){t instanceof ee&&this._pts.add(t)}get interfaces_(){return[ds]}}class Er{constructor(){Er.constructor_.apply(this,arguments)}static constructor_(){this._comps=null;const t=arguments[0];this._comps=t}static getPolygons(){if(arguments.length===1){const t=arguments[0];return Er.getPolygons(t,new F)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t instanceof jt?e.add(t):t instanceof St&&t.apply(new Er(e)),e}}filter(t){t instanceof jt&&this._comps.add(t)}get interfaces_(){return[ds]}}class Bo{constructor(){Bo.constructor_.apply(this,arguments)}static constructor_(){this._isDone=!1}applyTo(t){for(let e=0;e<t.getNumGeometries()&&!this._isDone;e++){const n=t.getGeometryN(e);if(n instanceof St)this.applyTo(n);else if(this.visit(n),this.isDone())return this._isDone=!0,null}}}class QE extends Fo{constructor(t){super(t),this.getLabelProvider=()=>this.labelProvider,this.getFilter=()=>this.filter,this.getOccupiedSpaces=()=>this.occupiedSpaces,this.createRenderer=()=>new tI(this),this.renderOrder=(e,n)=>{const i=e.getGeometry(),s=i instanceof de||i instanceof De,o=n.getGeometry(),a=o instanceof de||o instanceof De;return s&&!a?-1:a&&!s?1:s&&a?o.getArea()-i.getArea():yh(e,n)},this.labelProvider=t.labelProvider,this.filter=t.filter||(()=>!0),this.occupiedSpaces=t.occupiedSpaces||(()=>[])}}class tI extends Od{constructor(t){super(t),this.container=document.createElement("div"),this.tempTransform=kn(),this.parser=new Cl,this.geoJson=new of,this.cache=new WeakMap,this.occupiedSpaces=[],this.occupiedByLabels=[],this.getCacheEntry=e=>{const n=e.getGeometry(),i=this.cache.get(e),s=e.getRevision(),o=n.getRevision();if(i?.featureRevision===s&&i?.geometryRevision===o)return i;{const a={featureRevision:s,geometryRevision:o,inacessibilityPole:void 0,labels:[]};return this.cache.set(e,a),a}},this.renderFeature=(e,n,i,s,o)=>{let a=e.getGeometry();if(a instanceof De){let u=0;for(const d of a.getPolygons()){const f=d.getArea();f>u&&(u=f,a=d)}}if(!(a instanceof Fe||a instanceof de))return;const l=this.getCacheEntry(e),c=2*Math.floor(n.viewState.zoom)+(Math.ceil(n.viewState.zoom*10)%10>=5?1:0);if(l.labels[c]===null)return;if(l.labels[c]){const u=[...l.inacessibilityPole];ue(i,u);const d=l.labels[c];if(this.tryOccupy(u,d,!0)){const f=s===0?d.div:d.div.cloneNode(!0);return f.style.left=`${u[0]-d.width/2}px`,f.style.top=`${u[1]-d.height/2}px`,this.container.append(f),f}else return}const h=a.clone();if(h.applyTransform((u,d,f)=>Pi(u,0,u.length,f,i,d)),h instanceof Fe){const u=this.parser.read(h);l.inacessibilityPole=a.getCoordinates();const d=h.getFirstCoordinate();let f=500;const p=document.createElement("div");p.style.position="absolute";let m="default";for(;m;){p.innerHTML="";const I=this.getLayer().getLabelProvider()(e,p,m,n);m=I?I.fallbackVariant:null;const x=I?I.allowExtendingGeometry:!1;if(p.childNodes.length===0){l.labels[c]=null;return}if(this.container.append(p),!x&&p.scrollWidth>f){l.labels[c]=null,this.container.removeChild(p);continue}const E=new Range;for(let N=0;N<10;N++){const S=this.getRectsJts(u,p,E);if(x||S&&!this.intersectsOccupiedSpaces(S,!1)){const M=l.labels[c],L=S.getEnvelopeInternal().getWidth(),D=S.getEnvelopeInternal().getHeight(),Y=L/D,W=M?M.width/M.height:null;if(W===null||Y<W&&Y>2.3)l.labels[c]={div:p.cloneNode(!0),shape:Xt.translationInstance(-d[0],-d[1]).transform(S),width:L,height:D};else if(W!==null)break}if(f=S.getEnvelopeInternal().getWidth()-50,f<30&&l.labels[c]===void 0){l.labels[c]=null;return}p.style.width=`${f}px`}E.detach();const R=l.labels[c];if(R&&this.tryOccupy(d,R,!1))return p.style.width=R.div.style.width,p.style.left=`${u.getX()-R.width/2}px`,p.style.top=`${u.getY()-R.height/2}px`,p;l.labels[c]=null,this.container.removeChild(p)}}if(h instanceof de){let u=Math.floor(Wt(h.getExtent()));if(u<30){l.labels[c]=null;return}const d=document.createElement("div");d.style.position="absolute";let f="default";for(;f;){d.style.width=`${u}px`,d.innerHTML="";const p=this.getLayer().getLabelProvider()(e,d,f,n);f=p?p.fallbackVariant:null;const m=p?p.allowExtendingGeometry:!1;if(d.childNodes.length===0){l.labels[c]=null;return}if(this.container.append(d),!m&&d.scrollWidth>u){l.labels[c]=null,this.container.removeChild(d);continue}const I=new Range;l.inacessibilityPole=l.inacessibilityPole||Ga(this.geoJson.writeGeometryObject(a).coordinates);const x=[...l.inacessibilityPole];ue(i,x);const E=this.parser.read(h);for(let N=0;N<10;N++){const S=this.getRectsJts(E.getFactory().createPoint(new w(x[0],x[1])),d,I),M=S.getEnvelopeInternal();if(!m&&(d.scrollWidth-2>u||M.getWidth()===0||M.getHeight()>zn(h.getExtent()))){l.labels[c]=null;break}if(m||S&&E.contains(S)&&!this.intersectsOccupiedSpaces(S,!1)){const L=Xt.translationInstance(-x[0],-x[1]);l.labels[c]={div:d,shape:L.transform(S),width:u,height:M.getHeight()};break}u=Math.min(u-1,Math.floor(E.intersection(S).getEnvelopeInternal().getWidth())-1),d.style.width=`${u}px`}I.detach();const R=l.labels[c],T=R&&this.tryOccupy(x,R,!1);if(T)return d.style.left=`${T.getMinX()}px`,d.style.top=`${T.getMinY()}px`,d;l.labels[c]=null,this.container.removeChild(d)}}},this.intersectsOccupiedSpaces=(e,n)=>{const i=[this.occupiedByLabels];n||i.push(this.occupiedSpaces);const s=e.getEnvelopeInternal();for(const o of i)for(const a of o)if(a.getEnvelopeInternal().intersects(s)&&a.intersects(e))return!0;return!1},this.getRectsJts=(e,n,i)=>{const o=this.getRects(n,i).map(u=>{const d=new ct(u.left,u.right,u.top,u.bottom);return e.getFactory().toGeometry(d)}),a=o.length>0?o.reduce((u,d)=>u.union(d)):void 0,l=e.getCoordinate(),h=a.getEnvelopeInternal().centre();return Xt.translationInstance(l.x-h.x,l.y-h.y).transform(a)},this.prepareFrame=e=>{const n=dl(e.extent,e.viewState.projection);return this.features=this.getLayer().getSource().getFeaturesInExtent(n).filter(i=>this.getLayer().getFilter()(i)),this.features.sort(this.getLayer().renderOrder),this.features.length===0?(this.container.innerHTML="",!1):!0},this.renderFrame=(e,n)=>{if(this.container.parentElement===null)this.changed();else{this.occupiedSpaces=this.forEachWorld(e,this.getLayer().getOccupiedSpaces()).flatMap(s=>s),this.occupiedByLabels=[];const i=this.renderWorlds(e);this.container.replaceChildren(...i)}return this.container},this.renderWorld=(e,n,i,s)=>{const o=[];for(const a of this.features)try{const l=this.renderFeature(a,n,i,e,s);l&&o.push(l)}catch(l){console.warn("Failed to render "+a.getId()+", skipping it.",l)}return o},this.container.style.position="absolute",this.container.style.width="200%",this.container.style.height="100%",this.container.style.pointerEvents="none",this.parser.inject(Fe,Rn,vr,de,Yr,rs,De)}tryOccupy(t,e,n){const s=Xt.translationInstance(t[0],t[1]).transform(e.shape);if(!this.intersectsOccupiedSpaces(s,n))return this.occupiedByLabels.push(s),new ct(t[0]-e.width/2,t[0]+e.width/2,t[1]-e.height/2,t[1]+e.height/2)}getRects(t,e){const n=[];for(const i of t.childNodes)i instanceof Text?(e.selectNodeContents(i),n.push(...e.getClientRects())):i instanceof HTMLImageElement?n.push(i.getBoundingClientRect()):i instanceof HTMLElement&&n.push(...this.getRects(i,e));return n}renderWorlds(t){const e=[];for(const n of this.forEachWorld(t,this.renderWorld))e.push(...n);return e}forEachWorld(t,e){const n=t.extent,i=t.viewState,s=i.center,o=i.resolution,a=i.projection,l=i.rotation,c=a.getExtent(),h=this.getLayer().getSource(),u=t.viewHints;u[Ie.ANIMATING]||u[Ie.INTERACTING];const d=Math.round(t.size[0]),f=Math.round(t.size[1]),p=h.getWrapX()&&a.canWrapX(),m=p?Wt(c):null,I=p?Math.ceil((n[2]-c[2])/m)+1:1;let x=p?Math.floor((n[0]-c[0])/m):0;const E=[];do{const R=this.getRenderTransform(s,o,l,d,f,x*m);E.push(e(x,t,R,l))}while(++x<I);return E}getRenderTransform(t,e,n,i,s,o){const a=i/2,l=s/2,c=1/e,h=-c,u=-t[0]+o,d=-t[1];return Di(this.tempTransform,a,l,c,h,-n,u,d)}}var za={},eI={get exports(){return za},set exports(r){za=r}};/**
 * @license
 * lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash exports="node" include="clone,merge,isEmpty,isArray,compact,each" -d`
 * Copyright jQuery Foundation and other contributors <https://jquery.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(r,t){(function(){var e,n="4.15.0",i=200,s="Expected a function",o="__lodash_hash_undefined__",a=1,l=2,c=1/0,h=9007199254740991,u="[object Arguments]",d="[object Array]",f="[object Boolean]",p="[object Date]",m="[object Error]",I="[object Function]",x="[object GeneratorFunction]",E="[object Map]",R="[object Number]",T="[object Object]",N="[object Promise]",S="[object RegExp]",M="[object Set]",L="[object String]",D="[object Symbol]",Y="[object WeakMap]",W="[object ArrayBuffer]",B="[object DataView]",$="[object Float32Array]",it="[object Float64Array]",Z="[object Int8Array]",V="[object Int16Array]",X="[object Int32Array]",st="[object Uint8Array]",xt="[object Uint8ClampedArray]",_t="[object Uint16Array]",Mt="[object Uint32Array]",k=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ke=/^\w*$/,ot=/^\./,ut=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lt=/[\\^$.*+?()[\]{}|]/g,It=/\\(\\)?/g,Yt=/\w*$/,pe=/^\[object .+?Constructor\]$/,Vt=/^(?:0|[1-9]\d*)$/,gt={};gt[$]=gt[it]=gt[Z]=gt[V]=gt[X]=gt[st]=gt[xt]=gt[_t]=gt[Mt]=!0,gt[u]=gt[d]=gt[W]=gt[f]=gt[B]=gt[p]=gt[m]=gt[I]=gt[E]=gt[R]=gt[T]=gt[S]=gt[M]=gt[L]=gt[Y]=!1;var Q={};Q[u]=Q[d]=Q[W]=Q[B]=Q[f]=Q[p]=Q[$]=Q[it]=Q[Z]=Q[V]=Q[X]=Q[E]=Q[R]=Q[T]=Q[S]=Q[M]=Q[L]=Q[D]=Q[st]=Q[xt]=Q[_t]=Q[Mt]=!0,Q[m]=Q[I]=Q[Y]=!1;var he=typeof Jr=="object"&&Jr&&Jr.Object===Object&&Jr,we=typeof self=="object"&&self&&self.Object===Object&&self,fe=he||we||Function("return this")(),He=t&&!t.nodeType&&t,Ve=He&&!0&&r&&!r.nodeType&&r,jn=Ve&&Ve.exports===He,qe=jn&&he.process,mn=function(){try{return qe&&qe.binding("util")}catch{}}(),pi=mn&&mn.isTypedArray;function yt(g,_){return g.set(_[0],_[1]),g}function Ht(g,_){return g.add(_),g}function ne(g,_,C){switch(C.length){case 0:return g.call(_);case 1:return g.call(_,C[0]);case 2:return g.call(_,C[0],C[1]);case 3:return g.call(_,C[0],C[1],C[2])}return g.apply(_,C)}function ye(g,_){for(var C=-1,b=g?g.length:0;++C<b&&_(g[C],C,g)!==!1;);return g}function Ke(g,_){for(var C=-1,b=_.length,z=g.length;++C<b;)g[z+C]=_[C];return g}function on(g,_,C,b){var z=-1,G=g?g.length:0;for(b&&G&&(C=g[++z]);++z<G;)C=_(C,g[z],z,g);return C}function Te(g,_){for(var C=-1,b=g?g.length:0;++C<b;)if(_(g[C],C,g))return!0;return!1}function ie(g){return function(_){return _==null?e:_[g]}}function _n(g,_){for(var C=-1,b=Array(g);++C<g;)b[C]=_(C);return b}function se(g){return function(_){return g(_)}}function yi(g,_){return g==null?e:g[_]}function pn(g){var _=!1;if(g!=null&&typeof g.toString!="function")try{_=!!(g+"")}catch{}return _}function xi(g){var _=-1,C=Array(g.size);return g.forEach(function(b,z){C[++_]=[z,b]}),C}function Ei(g,_){return function(C){return g(_(C))}}function Zn(g){var _=-1,C=Array(g.size);return g.forEach(function(b){C[++_]=b}),C}var fs=Array.prototype,ms=Function.prototype,Un=Object.prototype,Ii=fe["__core-js_shared__"],zi=function(){var g=/[^.]+$/.exec(Ii&&Ii.keys&&Ii.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Hn=ms.toString,Ne=Un.hasOwnProperty,Zo=Hn.call(Object),re=Un.toString,Xi=RegExp("^"+Hn.call(Ne).replace(lt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ye=jn?fe.Buffer:e,yn=fe.Symbol,xe=fe.Uint8Array,_s=Ei(Object.getPrototypeOf,Object),$s=Object.create,Se=Un.propertyIsEnumerable,Je=fs.splice,xn=Object.getOwnPropertySymbols,zl=Ye?Ye.isBuffer:e,mu=Ei(Object.keys,Object),_u=Math.max,Xl=tr(fe,"DataView"),Ur=tr(fe,"Map"),Wl=tr(fe,"Promise"),Bl=tr(fe,"Set"),jl=tr(fe,"WeakMap"),Hr=tr(Object,"create"),Ff=!Se.call({valueOf:1},"valueOf"),Gf=ys(Xl),kf=ys(Ur),Yf=ys(Wl),zf=ys(Bl),Xf=ys(jl),Uo=yn?yn.prototype:e,Vr=Uo?Uo.valueOf:e,pu=Uo?Uo.toString:e;function Ct(){}function ps(g){var _=-1,C=g?g.length:0;for(this.clear();++_<C;){var b=g[_];this.set(b[0],b[1])}}function Wf(){this.__data__=Hr?Hr(null):{}}function Bf(g){return this.has(g)&&delete this.__data__[g]}function jf(g){var _=this.__data__;if(Hr){var C=_[g];return C===o?e:C}return Ne.call(_,g)?_[g]:e}function Zf(g){var _=this.__data__;return Hr?_[g]!==e:Ne.call(_,g)}function Uf(g,_){var C=this.__data__;return C[g]=Hr&&_===e?o:_,this}ps.prototype.clear=Wf,ps.prototype.delete=Bf,ps.prototype.get=jf,ps.prototype.has=Zf,ps.prototype.set=Uf;function Ci(g){var _=-1,C=g?g.length:0;for(this.clear();++_<C;){var b=g[_];this.set(b[0],b[1])}}function Hf(){this.__data__=[]}function Vf(g){var _=this.__data__,C=Vo(_,g);if(C<0)return!1;var b=_.length-1;return C==b?_.pop():Je.call(_,C,1),!0}function qf(g){var _=this.__data__,C=Vo(_,g);return C<0?e:_[C][1]}function Kf(g){return Vo(this.__data__,g)>-1}function Jf(g,_){var C=this.__data__,b=Vo(C,g);return b<0?C.push([g,_]):C[b][1]=_,this}Ci.prototype.clear=Hf,Ci.prototype.delete=Vf,Ci.prototype.get=qf,Ci.prototype.has=Kf,Ci.prototype.set=Jf;function Ri(g){var _=-1,C=g?g.length:0;for(this.clear();++_<C;){var b=g[_];this.set(b[0],b[1])}}function $f(){this.__data__={hash:new ps,map:new(Ur||Ci),string:new ps}}function Qf(g){return qo(this,g).delete(g)}function tm(g){return qo(this,g).get(g)}function em(g){return qo(this,g).has(g)}function nm(g,_){return qo(this,g).set(g,_),this}Ri.prototype.clear=$f,Ri.prototype.delete=Qf,Ri.prototype.get=tm,Ri.prototype.has=em,Ri.prototype.set=nm;function Ho(g){var _=-1,C=g?g.length:0;for(this.__data__=new Ri;++_<C;)this.add(g[_])}function im(g){return this.__data__.set(g,o),this}function sm(g){return this.__data__.has(g)}Ho.prototype.add=Ho.prototype.push=im,Ho.prototype.has=sm;function Sn(g){this.__data__=new Ci(g)}function rm(){this.__data__=new Ci}function om(g){return this.__data__.delete(g)}function am(g){return this.__data__.get(g)}function lm(g){return this.__data__.has(g)}function cm(g,_){var C=this.__data__;if(C instanceof Ci){var b=C.__data__;if(!Ur||b.length<i-1)return b.push([g,_]),this;C=this.__data__=new Ri(b)}return C.set(g,_),this}Sn.prototype.clear=rm,Sn.prototype.delete=om,Sn.prototype.get=am,Sn.prototype.has=lm,Sn.prototype.set=cm;function yu(g,_){var C=ze(g)||nr(g)?_n(g.length,String):[],b=C.length,z=!!b;for(var G in g)(_||Ne.call(g,G))&&!(z&&(G=="length"||ql(G,b)))&&C.push(G);return C}function Zl(g,_,C){(C!==e&&!er(g[_],C)||typeof _=="number"&&C===e&&!(_ in g))&&(g[_]=C)}function xu(g,_,C){var b=g[_];(!(Ne.call(g,_)&&er(b,C))||C===e&&!(_ in g))&&(g[_]=C)}function Vo(g,_){for(var C=g.length;C--;)if(er(g[C][0],_))return C;return-1}function hm(g,_){return g&&Vl(_,Wi(_),g)}function Qs(g,_,C,b,z,G,U){var q;if(b&&(q=G?b(g,z,G,U):b(g)),q!==e)return q;if(!Ln(g))return g;var dt=ze(g);if(dt){if(q=Um(g),!_)return Tu(g,q)}else{var zt=Vn(g),Ot=zt==I||zt==x;if(Jl(g))return bm(g,_);if(zt==T||zt==u||Ot&&!G){if(pn(g))return G?g:{};if(q=Hm(Ot?{}:g),!_)return Fm(g,hm(q,g))}else{if(!Q[zt])return G?g:{};q=Vm(g,zt,Qs,_)}}U||(U=new Sn);var qt=U.get(g);if(qt)return qt;if(U.set(g,q),!dt)var oe=C?Wm(g):Wi(g);return ye(oe||g,function(Oe,Le){oe&&(Le=Oe,Oe=g[Le]),xu(q,Le,Qs(Oe,_,C,b,Le,g,U))}),q}function um(g){return Ln(g)?$s(g):{}}var gm=km(fm),dm=Ym();function fm(g,_){return g&&dm(g,_,Wi)}function Eu(g,_){_=Ko(_,g)?[_]:wu(_);for(var C=0,b=_.length;g!=null&&C<b;)g=g[$o(_[C++])];return C&&C==b?g:e}function mm(g,_,C){var b=_(g);return ze(g)?b:Ke(b,C(g))}function _m(g){return re.call(g)}function pm(g,_){return g!=null&&_ in Object(g)}function Ul(g,_,C,b,z){return g===_?!0:g==null||_==null||!Ln(g)&&!ir(_)?g!==g&&_!==_:ym(g,_,Ul,C,b,z)}function ym(g,_,C,b,z,G){var U=ze(g),q=ze(_),dt=d,zt=d;U||(dt=Vn(g),dt=dt==u?T:dt),q||(zt=Vn(_),zt=zt==u?T:zt);var Ot=dt==T&&!pn(g),qt=zt==T&&!pn(_),oe=dt==zt;if(oe&&!Ot)return G||(G=new Sn),U||ia(g)?Nu(g,_,C,b,z,G):zm(g,_,dt,C,b,z,G);if(!(z&l)){var Oe=Ot&&Ne.call(g,"__wrapped__"),Le=qt&&Ne.call(_,"__wrapped__");if(Oe||Le){var Bi=Oe?g.value():g,wi=Le?_.value():_;return G||(G=new Sn),C(Bi,wi,b,z,G)}}return oe?(G||(G=new Sn),Xm(g,_,C,b,z,G)):!1}function xm(g,_,C,b){var z=C.length,G=z,U=!b;if(g==null)return!G;for(g=Object(g);z--;){var q=C[z];if(U&&q[2]?q[1]!==g[q[0]]:!(q[0]in g))return!1}for(;++z<G;){q=C[z];var dt=q[0],zt=g[dt],Ot=q[1];if(U&&q[2]){if(zt===e&&!(dt in g))return!1}else{var qt=new Sn;if(b)var oe=b(zt,Ot,dt,g,_,qt);if(!(oe===e?Ul(Ot,zt,b,a|l,qt):oe))return!1}}return!0}function Em(g){if(!Ln(g)||Jm(g))return!1;var _=ta(g)||pn(g)?Xi:pe;return _.test(ys(g))}function Im(g){return ir(g)&&ea(g.length)&&!!gt[re.call(g)]}function Iu(g){return typeof g=="function"?g:g==null?Gu:typeof g=="object"?ze(g)?wm(g[0],g[1]):Rm(g):ku(g)}function Cm(g){if(!Jo(g))return mu(g);var _=[];for(var C in Object(g))Ne.call(g,C)&&C!="constructor"&&_.push(C);return _}function Cu(g){if(!Ln(g))return $m(g);var _=Jo(g),C=[];for(var b in g)b=="constructor"&&(_||!Ne.call(g,b))||C.push(b);return C}function Rm(g){var _=jm(g);return _.length==1&&_[0][2]?bu(_[0][0],_[0][1]):function(C){return C===g||xm(C,g,_)}}function wm(g,_){return Ko(g)&&Lu(_)?bu($o(g),_):function(C){var b=Au(C,g);return b===e&&b===_?Du(C,g):Ul(_,b,e,a|l)}}function Ru(g,_,C,b,z){if(g!==_){if(!(ze(_)||ia(_)))var G=Cu(_);ye(G||_,function(U,q){if(G&&(q=U,U=_[q]),Ln(U))z||(z=new Sn),Tm(g,_,q,C,Ru,b,z);else{var dt=b?b(g[q],U,q+"",g,_,z):e;dt===e&&(dt=U),Zl(g,q,dt)}})}}function Tm(g,_,C,b,z,G,U){var q=g[C],dt=_[C],zt=U.get(dt);if(zt){Zl(g,C,zt);return}var Ot=G?G(q,dt,C+"",g,_,U):e,qt=Ot===e;qt&&(Ot=dt,ze(dt)||ia(dt)?ze(q)?Ot=q:Kl(q)?Ot=Tu(q):(qt=!1,Ot=Qs(dt,!0)):Mu(dt)||nr(dt)?nr(q)?Ot=Ou(q):!Ln(q)||b&&ta(q)?(qt=!1,Ot=Qs(dt,!0)):Ot=q:qt=!1),qt&&(U.set(dt,Ot),z(Ot,dt,b,G,U),U.delete(dt)),Zl(g,C,Ot)}function Nm(g){return function(_){return Eu(_,g)}}function Sm(g,_){return _=_u(_===e?g.length-1:_,0),function(){for(var C=arguments,b=-1,z=_u(C.length-_,0),G=Array(z);++b<z;)G[b]=C[_+b];b=-1;for(var U=Array(_+1);++b<_;)U[b]=C[b];return U[_]=G,ne(g,this,U)}}function Lm(g){if(typeof g=="string")return g;if(na(g))return pu?pu.call(g):"";var _=g+"";return _=="0"&&1/g==-c?"-0":_}function wu(g){return ze(g)?g:Qm(g)}function bm(g,_){if(_)return g.slice();var C=new g.constructor(g.length);return g.copy(C),C}function Hl(g){var _=new g.constructor(g.byteLength);return new xe(_).set(new xe(g)),_}function vm(g,_){var C=_?Hl(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.byteLength)}function Mm(g,_,C){var b=_?C(xi(g),!0):xi(g);return on(b,yt,new g.constructor)}function Om(g){var _=new g.constructor(g.source,Yt.exec(g));return _.lastIndex=g.lastIndex,_}function Pm(g,_,C){var b=_?C(Zn(g),!0):Zn(g);return on(b,Ht,new g.constructor)}function Am(g){return Vr?Object(Vr.call(g)):{}}function Dm(g,_){var C=_?Hl(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.length)}function Tu(g,_){var C=-1,b=g.length;for(_||(_=Array(b));++C<b;)_[C]=g[C];return _}function Vl(g,_,C,b){C||(C={});for(var z=-1,G=_.length;++z<G;){var U=_[z],q=b?b(C[U],g[U],U,C,g):e;xu(C,U,q===e?g[U]:q)}return C}function Fm(g,_){return Vl(g,Su(g),_)}function Gm(g){return Sm(function(_,C){var b=-1,z=C.length,G=z>1?C[z-1]:e,U=z>2?C[2]:e;for(G=g.length>3&&typeof G=="function"?(z--,G):e,U&&qm(C[0],C[1],U)&&(G=z<3?e:G,z=1),_=Object(_);++b<z;){var q=C[b];q&&g(_,q,b,G)}return _})}function km(g,_){return function(C,b){if(C==null)return C;if(!xs(C))return g(C,b);for(var z=C.length,G=_?z:-1,U=Object(C);(_?G--:++G<z)&&b(U[G],G,U)!==!1;);return C}}function Ym(g){return function(_,C,b){for(var z=-1,G=Object(_),U=b(_),q=U.length;q--;){var dt=U[g?q:++z];if(C(G[dt],dt,G)===!1)break}return _}}function Nu(g,_,C,b,z,G){var U=z&l,q=g.length,dt=_.length;if(q!=dt&&!(U&&dt>q))return!1;var zt=G.get(g);if(zt&&G.get(_))return zt==_;var Ot=-1,qt=!0,oe=z&a?new Ho:e;for(G.set(g,_),G.set(_,g);++Ot<q;){var Oe=g[Ot],Le=_[Ot];if(b)var Bi=U?b(Le,Oe,Ot,_,g,G):b(Oe,Le,Ot,g,_,G);if(Bi!==e){if(Bi)continue;qt=!1;break}if(oe){if(!Te(_,function(wi,Es){if(!oe.has(Es)&&(Oe===wi||C(Oe,wi,b,z,G)))return oe.add(Es)})){qt=!1;break}}else if(!(Oe===Le||C(Oe,Le,b,z,G))){qt=!1;break}}return G.delete(g),G.delete(_),qt}function zm(g,_,C,b,z,G,U){switch(C){case B:if(g.byteLength!=_.byteLength||g.byteOffset!=_.byteOffset)return!1;g=g.buffer,_=_.buffer;case W:return!(g.byteLength!=_.byteLength||!b(new xe(g),new xe(_)));case f:case p:case R:return er(+g,+_);case m:return g.name==_.name&&g.message==_.message;case S:case L:return g==_+"";case E:var q=xi;case M:var dt=G&l;if(q||(q=Zn),g.size!=_.size&&!dt)return!1;var zt=U.get(g);if(zt)return zt==_;G|=a,U.set(g,_);var Ot=Nu(q(g),q(_),b,z,G,U);return U.delete(g),Ot;case D:if(Vr)return Vr.call(g)==Vr.call(_)}return!1}function Xm(g,_,C,b,z,G){var U=z&l,q=Wi(g),dt=q.length,zt=Wi(_),Ot=zt.length;if(dt!=Ot&&!U)return!1;for(var qt=dt;qt--;){var oe=q[qt];if(!(U?oe in _:Ne.call(_,oe)))return!1}var Oe=G.get(g);if(Oe&&G.get(_))return Oe==_;var Le=!0;G.set(g,_),G.set(_,g);for(var Bi=U;++qt<dt;){oe=q[qt];var wi=g[oe],Es=_[oe];if(b)var Xu=U?b(Es,wi,oe,_,g,G):b(wi,Es,oe,g,_,G);if(!(Xu===e?wi===Es||C(wi,Es,b,z,G):Xu)){Le=!1;break}Bi||(Bi=oe=="constructor")}if(Le&&!Bi){var sa=g.constructor,ra=_.constructor;sa!=ra&&"constructor"in g&&"constructor"in _&&!(typeof sa=="function"&&sa instanceof sa&&typeof ra=="function"&&ra instanceof ra)&&(Le=!1)}return G.delete(g),G.delete(_),Le}function Wm(g){return mm(g,Wi,Su)}function Bm(){var g=Ct.iteratee||$l;return g=g===$l?Iu:g,arguments.length?g(arguments[0],arguments[1]):g}function qo(g,_){var C=g.__data__;return Km(_)?C[typeof _=="string"?"string":"hash"]:C.map}function jm(g){for(var _=Wi(g),C=_.length;C--;){var b=_[C],z=g[b];_[C]=[b,z,Lu(z)]}return _}function tr(g,_){var C=yi(g,_);return Em(C)?C:e}var Su=xn?Ei(xn,Object):Yu,Vn=_m;(Xl&&Vn(new Xl(new ArrayBuffer(1)))!=B||Ur&&Vn(new Ur)!=E||Wl&&Vn(Wl.resolve())!=N||Bl&&Vn(new Bl)!=M||jl&&Vn(new jl)!=Y)&&(Vn=function(g){var _=re.call(g),C=_==T?g.constructor:e,b=C?ys(C):e;if(b)switch(b){case Gf:return B;case kf:return E;case Yf:return N;case zf:return M;case Xf:return Y}return _});function Zm(g,_,C){_=Ko(_,g)?[_]:wu(_);for(var b,z=-1,U=_.length;++z<U;){var G=$o(_[z]);if(!(b=g!=null&&C(g,G)))break;g=g[G]}if(b)return b;var U=g?g.length:0;return!!U&&ea(U)&&ql(G,U)&&(ze(g)||nr(g))}function Um(g){var _=g.length,C=g.constructor(_);return _&&typeof g[0]=="string"&&Ne.call(g,"index")&&(C.index=g.index,C.input=g.input),C}function Hm(g){return typeof g.constructor=="function"&&!Jo(g)?um(_s(g)):{}}function Vm(g,_,C,b){var z=g.constructor;switch(_){case W:return Hl(g);case f:case p:return new z(+g);case B:return vm(g,b);case $:case it:case Z:case V:case X:case st:case xt:case _t:case Mt:return Dm(g,b);case E:return Mm(g,b,C);case R:case L:return new z(g);case S:return Om(g);case M:return Pm(g,b,C);case D:return Am(g)}}function ql(g,_){return _=_??h,!!_&&(typeof g=="number"||Vt.test(g))&&g>-1&&g%1==0&&g<_}function qm(g,_,C){if(!Ln(C))return!1;var b=typeof _;return(b=="number"?xs(C)&&ql(_,C.length):b=="string"&&_ in C)?er(C[_],g):!1}function Ko(g,_){if(ze(g))return!1;var C=typeof g;return C=="number"||C=="symbol"||C=="boolean"||g==null||na(g)?!0:ke.test(g)||!k.test(g)||_!=null&&g in Object(_)}function Km(g){var _=typeof g;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?g!=="__proto__":g===null}function Jm(g){return!!zi&&zi in g}function Jo(g){var _=g&&g.constructor,C=typeof _=="function"&&_.prototype||Un;return g===C}function Lu(g){return g===g&&!Ln(g)}function bu(g,_){return function(C){return C==null?!1:C[g]===_&&(_!==e||g in Object(C))}}function $m(g){var _=[];if(g!=null)for(var C in Object(g))_.push(C);return _}var Qm=Qo(function(g){g=Pu(g);var _=[];return ot.test(g)&&_.push(""),g.replace(ut,function(C,b,z,G){_.push(z?G.replace(It,"$1"):b||C)}),_});function $o(g){if(typeof g=="string"||na(g))return g;var _=g+"";return _=="0"&&1/g==-c?"-0":_}function ys(g){if(g!=null){try{return Hn.call(g)}catch{}try{return g+""}catch{}}return""}function t_(g){for(var _=-1,C=g?g.length:0,b=0,z=[];++_<C;){var G=g[_];G&&(z[b++]=G)}return z}function vu(g,_){var C=ze(g)?ye:gm;return C(g,Bm(_,3))}function Qo(g,_){if(typeof g!="function"||_&&typeof _!="function")throw new TypeError(s);var C=function(){var b=arguments,z=_?_.apply(this,b):b[0],G=C.cache;if(G.has(z))return G.get(z);var U=g.apply(this,b);return C.cache=G.set(z,U),U};return C.cache=new(Qo.Cache||Ri),C}Qo.Cache=Ri;function e_(g){return Qs(g,!1,!0)}function er(g,_){return g===_||g!==g&&_!==_}function nr(g){return Kl(g)&&Ne.call(g,"callee")&&(!Se.call(g,"callee")||re.call(g)==u)}var ze=Array.isArray;function xs(g){return g!=null&&ea(g.length)&&!ta(g)}function Kl(g){return ir(g)&&xs(g)}var Jl=zl||zu;function n_(g){if(xs(g)&&(ze(g)||typeof g=="string"||typeof g.splice=="function"||Jl(g)||nr(g)))return!g.length;var _=Vn(g);if(_==E||_==M)return!g.size;if(Ff||Jo(g))return!mu(g).length;for(var C in g)if(Ne.call(g,C))return!1;return!0}function ta(g){var _=Ln(g)?re.call(g):"";return _==I||_==x}function ea(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=h}function Ln(g){var _=typeof g;return!!g&&(_=="object"||_=="function")}function ir(g){return!!g&&typeof g=="object"}function Mu(g){if(!ir(g)||re.call(g)!=T||pn(g))return!1;var _=_s(g);if(_===null)return!0;var C=Ne.call(_,"constructor")&&_.constructor;return typeof C=="function"&&C instanceof C&&Hn.call(C)==Zo}function na(g){return typeof g=="symbol"||ir(g)&&re.call(g)==D}var ia=pi?se(pi):Im;function Ou(g){return Vl(g,Fu(g))}function Pu(g){return g==null?"":Lm(g)}function Au(g,_,C){var b=g==null?e:Eu(g,_);return b===e?C:b}function Du(g,_){return g!=null&&Zm(g,_,pm)}function Wi(g){return xs(g)?yu(g):Cm(g)}function Fu(g){return xs(g)?yu(g,!0):Cu(g)}var i_=Gm(function(g,_,C){Ru(g,_,C)});function Gu(g){return g}function $l(g){return Iu(typeof g=="function"?g:Qs(g,!0))}function ku(g){return Ko(g)?ie($o(g)):Nm(g)}function Yu(){return[]}function zu(){return!1}Ct.compact=t_,Ct.iteratee=$l,Ct.keys=Wi,Ct.keysIn=Fu,Ct.memoize=Qo,Ct.merge=i_,Ct.property=ku,Ct.toPlainObject=Ou,Ct.clone=e_,Ct.eq=er,Ct.forEach=vu,Ct.get=Au,Ct.hasIn=Du,Ct.identity=Gu,Ct.isArguments=nr,Ct.isArray=ze,Ct.isArrayLike=xs,Ct.isArrayLikeObject=Kl,Ct.isBuffer=Jl,Ct.isEmpty=n_,Ct.isFunction=ta,Ct.isLength=ea,Ct.isObject=Ln,Ct.isObjectLike=ir,Ct.isPlainObject=Mu,Ct.isSymbol=na,Ct.isTypedArray=ia,Ct.stubArray=Yu,Ct.stubFalse=zu,Ct.toString=Pu,Ct.each=vu,Ct.VERSION=n,Ve&&((Ve.exports=Ct)._=Ct,He._=Ct)}).call(Jr)})(eI,za);var nI=wa;function wa(r,t){var e=r&&r.type,n;if(e==="FeatureCollection")for(n=0;n<r.features.length;n++)wa(r.features[n],t);else if(e==="GeometryCollection")for(n=0;n<r.geometries.length;n++)wa(r.geometries[n],t);else if(e==="Feature")wa(r.geometry,t);else if(e==="Polygon")Dg(r.coordinates,t);else if(e==="MultiPolygon")for(n=0;n<r.coordinates.length;n++)Dg(r.coordinates[n],t);return r}function Dg(r,t){if(r.length!==0){Fg(r[0],t);for(var e=1;e<r.length;e++)Fg(r[e],!t)}}function Fg(r,t){for(var e=0,n=0,i=0,s=r.length,o=s-1;i<s;o=i++){var a=(r[i][0]-r[o][0])*(r[o][1]+r[i][1]),l=e+a;n+=Math.abs(e)>=Math.abs(a)?e-l+a:a-l+e,e=l}e+n>=0!=!!t&&r.reverse()}var Bc={},iI={get exports(){return Bc},set exports(r){Bc=r}};const sI=[{key:"building",polygon:"all"},{key:"highway",polygon:"whitelist",values:["services","rest_area","escape","elevator"]},{key:"natural",polygon:"blacklist",values:["coastline","cliff","ridge","arete","tree_row"]},{key:"landuse",polygon:"all"},{key:"waterway",polygon:"whitelist",values:["riverbank","dock","boatyard","dam"]},{key:"amenity",polygon:"all"},{key:"leisure",polygon:"all"},{key:"barrier",polygon:"whitelist",values:["city_wall","ditch","hedge","retaining_wall","wall","spikes"]},{key:"railway",polygon:"whitelist",values:["station","turntable","roundhouse","platform"]},{key:"area",polygon:"all"},{key:"boundary",polygon:"all"},{key:"man_made",polygon:"blacklist",values:["cutline","embankment","pipeline"]},{key:"power",polygon:"whitelist",values:["plant","substation","generator","transformer"]},{key:"place",polygon:"all"},{key:"shop",polygon:"all"},{key:"aeroway",polygon:"blacklist",values:["taxiway"]},{key:"tourism",polygon:"all"},{key:"historic",polygon:"all"},{key:"public_transport",polygon:"all"},{key:"office",polygon:"all"},{key:"building:part",polygon:"all"},{key:"military",polygon:"all"},{key:"ruins",polygon:"all"},{key:"area:highway",polygon:"all"},{key:"craft",polygon:"all"},{key:"golf",polygon:"all"},{key:"indoor",polygon:"all"}];(function(r){r.exports=sI})(iI);var mt=za,xa=nI,Ta={};Bc.forEach(function(r){if(r.polygon==="all")Ta[r.key]=!0;else{var t=r.polygon==="whitelist"?"included_values":"excluded_values",e={};r.values.forEach(function(n){e[n]=!0}),Ta[r.key]={},Ta[r.key][t]=e}});function rI(r,t){return(r.version||t.version)&&r.version!==t.version?(+r.version||0)>(+t.version||0)?r:t:mt.merge(r,t)}var Xa={};Xa=function(r,t,e){t=mt.merge({verbose:!1,flatProperties:!0,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:Ta,deduplicator:rI},t);var n;return typeof XMLDocument<"u"&&r instanceof XMLDocument||typeof XMLDocument>"u"&&r.childNodes?n=s(r):n=i(r),n;function i(l){var c=new Array,h=new Array,u=new Array;function d(N){var S=mt.clone(N);S.lat=N.center.lat,S.lon=N.center.lon,S.__is_center_placeholder=!0,c.push(S)}function f(N){var S=mt.clone(N);S.nodes=[];function M(L,D,Y){var W={type:"node",id:"_"+S.type+"/"+S.id+"bounds"+Y,lat:L,lon:D};S.nodes.push(W.id),c.push(W)}M(S.bounds.minlat,S.bounds.minlon,1),M(S.bounds.maxlat,S.bounds.minlon,2),M(S.bounds.maxlat,S.bounds.maxlon,3),M(S.bounds.minlat,S.bounds.maxlon,4),S.nodes.push(S.nodes[0]),S.__is_bounds_placeholder=!0,h.push(S)}function p(N){function S(M,L,D){var Y={type:"node",id:D,lat:M,lon:L};c.push(Y)}mt.isArray(N.nodes)||(N.nodes=N.geometry.map(function(M){return M!==null?"_anonymous@"+M.lat+"/"+M.lon:"_anonymous@unknown_location"})),N.geometry.forEach(function(M,L){M&&S(M.lat,M.lon,N.nodes[L])})}function m(N){function S(L,D,Y){var W={type:"node",id:Y,lat:L,lon:D};c.push(W)}function M(L,D){if(h.some(function(B){return B.type=="way"&&B.id==D}))return;var Y={type:"way",id:D,nodes:[]};function W(B,$){var it={type:"node",id:"_anonymous@"+B+"/"+$,lat:B,lon:$};Y.nodes.push(it.id),c.push(it)}L.forEach(function(B){B?W(B.lat,B.lon):Y.nodes.push(void 0)}),h.push(Y)}N.members.forEach(function(L,D){L.type=="node"?L.lat&&S(L.lat,L.lon,L.ref):L.type=="way"&&L.geometry&&(L.ref="_fullGeom"+L.ref,M(L.geometry,L.ref))})}for(var I=0;I<l.elements.length;I++)switch(l.elements[I].type){case"node":var x=l.elements[I];c.push(x);break;case"way":var E=mt.clone(l.elements[I]);E.nodes=mt.clone(E.nodes),h.push(E),E.center&&d(E),E.geometry?p(E):E.bounds&&f(E);break;case"relation":var R=mt.clone(l.elements[I]);R.members=mt.clone(R.members),u.push(R);var T=R.members&&R.members.some(function(N){return N.type=="node"&&N.lat||N.type=="way"&&N.geometry&&N.geometry.length>0});R.center&&d(R),T?m(R):R.bounds&&f(R);break}return o(c,h,u)}function s(l){var c=new Array,h=new Array,u=new Array;function d(R,T,N){R.hasAttribute(N)&&(T[N]=R.getAttribute(N))}function f(R,T){var N=mt.clone(R);d(T,N,"lat"),d(T,N,"lon"),N.__is_center_placeholder=!0,c.push(N)}function p(R,T){var N=mt.clone(R);N.nodes=[];function S(M,L,D){var Y={type:"node",id:"_"+N.type+"/"+N.id+"bounds"+D,lat:M,lon:L};N.nodes.push(Y.id),c.push(Y)}S(T.getAttribute("minlat"),T.getAttribute("minlon"),1),S(T.getAttribute("maxlat"),T.getAttribute("minlon"),2),S(T.getAttribute("maxlat"),T.getAttribute("maxlon"),3),S(T.getAttribute("minlat"),T.getAttribute("maxlon"),4),N.nodes.push(N.nodes[0]),N.__is_bounds_placeholder=!0,h.push(N)}function m(R,T){function N(S,M,L){var D={type:"node",id:L,lat:S,lon:M};return c.push(D),D.id}mt.isArray(R.nodes)||(R.nodes=[],mt.each(T,function(S,M){R.nodes.push("_anonymous@"+S.getAttribute("lat")+"/"+S.getAttribute("lon"))})),mt.each(T,function(S,M){S.getAttribute("lat")&&N(S.getAttribute("lat"),S.getAttribute("lon"),R.nodes[M])})}function I(R,T){function N(M,L,D){var Y={type:"node",id:D,lat:M,lon:L};c.push(Y)}function S(M,L){if(h.some(function(W){return W.type=="way"&&W.id==L}))return;var D={type:"way",id:L,nodes:[]};function Y(W,B){var $={type:"node",id:"_anonymous@"+W+"/"+B,lat:W,lon:B};D.nodes.push($.id),c.push($)}mt.each(M,function(W){W.getAttribute("lat")?Y(W.getAttribute("lat"),W.getAttribute("lon")):D.nodes.push(void 0)}),h.push(D)}mt.each(T,function(M,L){R.members[L].type=="node"?M.getAttribute("lat")&&N(M.getAttribute("lat"),M.getAttribute("lon"),R.members[L].ref):R.members[L].type=="way"&&M.getElementsByTagName("nd").length>0&&(R.members[L].ref="_fullGeom"+R.members[L].ref,S(M.getElementsByTagName("nd"),R.members[L].ref))})}mt.each(l.getElementsByTagName("node"),function(R,T){var N={};mt.each(R.getElementsByTagName("tag"),function(M){N[M.getAttribute("k")]=M.getAttribute("v")});var S={type:"node"};d(R,S,"id"),d(R,S,"lat"),d(R,S,"lon"),d(R,S,"version"),d(R,S,"timestamp"),d(R,S,"changeset"),d(R,S,"uid"),d(R,S,"user"),mt.isEmpty(N)||(S.tags=N),c.push(S)});var x,E;return mt.each(l.getElementsByTagName("way"),function(R,T){var N={},S=[];mt.each(R.getElementsByTagName("tag"),function(D){N[D.getAttribute("k")]=D.getAttribute("v")});var M=!1;mt.each(R.getElementsByTagName("nd"),function(D,Y){var W;(W=D.getAttribute("ref"))&&(S[Y]=W),!M&&D.getAttribute("lat")&&(M=!0)});var L={type:"way"};d(R,L,"id"),d(R,L,"version"),d(R,L,"timestamp"),d(R,L,"changeset"),d(R,L,"uid"),d(R,L,"user"),S.length>0&&(L.nodes=S),mt.isEmpty(N)||(L.tags=N),(x=R.getElementsByTagName("center")[0])&&f(L,x),M?m(L,R.getElementsByTagName("nd")):(E=R.getElementsByTagName("bounds")[0])&&p(L,E),h.push(L)}),mt.each(l.getElementsByTagName("relation"),function(R,T){var N={},S=[];mt.each(R.getElementsByTagName("tag"),function(D){N[D.getAttribute("k")]=D.getAttribute("v")});var M=!1;mt.each(R.getElementsByTagName("member"),function(D,Y){S[Y]={},d(D,S[Y],"ref"),d(D,S[Y],"role"),d(D,S[Y],"type"),(!M&&S[Y].type=="node"&&D.getAttribute("lat")||S[Y].type=="way"&&D.getElementsByTagName("nd").length>0)&&(M=!0)});var L={type:"relation"};d(R,L,"id"),d(R,L,"version"),d(R,L,"timestamp"),d(R,L,"changeset"),d(R,L,"uid"),d(R,L,"user"),S.length>0&&(L.members=S),mt.isEmpty(N)||(L.tags=N),(x=R.getElementsByTagName("center")[0])&&f(L,x),M?I(L,R.getElementsByTagName("member")):(E=R.getElementsByTagName("bounds")[0])&&p(L,E),u.push(L)}),o(c,h,u)}function o(l,c,h){function u(ot,ut){if(typeof ut!="object"&&(ut={}),typeof t.uninterestingTags=="function")return!t.uninterestingTags(ot,ut);for(var lt in ot)if(t.uninterestingTags[lt]!==!0&&!(ut[lt]===!0||ut[lt]===ot[lt]))return!0;return!1}function d(ot){var ut={timestamp:ot.timestamp,version:ot.version,changeset:ot.changeset,user:ot.user,uid:ot.uid};for(var lt in ut)ut[lt]===void 0&&delete ut[lt];return ut}for(var f=new Object,p=new Object,m=0;m<l.length;m++){var I=l[m];f[I.id]!==void 0&&(I=t.deduplicator(I,f[I.id])),f[I.id]=I,typeof I.tags<"u"&&u(I.tags)&&(p[I.id]=!0)}for(var m=0;m<h.length;m++)if(mt.isArray(h[m].members))for(var x=0;x<h[m].members.length;x++)h[m].members[x].type=="node"&&(p[h[m].members[x].ref]=!0);for(var E=new Object,R=new Object,m=0;m<c.length;m++){var T=c[m];if(E[T.id]&&(T=t.deduplicator(T,E[T.id])),E[T.id]=T,mt.isArray(T.nodes))for(var x=0;x<T.nodes.length;x++)typeof T.nodes[x]!="object"&&(R[T.nodes[x]]=!0,T.nodes[x]=f[T.nodes[x]])}var N=new Array;for(var S in f){var I=f[S];(!R[S]||p[S])&&N.push(I)}for(var M=new Array,m=0;m<h.length;m++){var L=h[m];M[L.id]&&(L=t.deduplicator(L,M[L.id])),M[L.id]=L}var D={node:{},way:{},relation:{}};for(var S in M){var L=M[S];if(!mt.isArray(L.members)){t.verbose&&console.warn("Relation",L.type+"/"+L.id,"ignored because it has no members");continue}for(var x=0;x<L.members.length;x++){var Y=L.members[x].type,W=L.members[x].ref;if(typeof W!="number"&&(W=W.replace("_fullGeom","")),!D[Y]){t.verbose&&console.warn("Relation",L.type+"/"+L.id,"member",Y+"/"+W,"ignored because it has an invalid type");continue}typeof D[Y][W]>"u"&&(D[Y][W]=[]),D[Y][W].push({role:L.members[x].role,rel:L.id,reltags:L.tags})}}var B,$=[];for(m=0;m<N.length;m++){if(typeof N[m].lon>"u"||typeof N[m].lat>"u"){t.verbose&&console.warn("POI",N[m].type+"/"+N[m].id,"ignored because it lacks coordinates");continue}var it={type:"Feature",id:N[m].type+"/"+N[m].id,properties:{type:N[m].type,id:N[m].id,tags:N[m].tags||{},relations:D.node[N[m].id]||[],meta:d(N[m])},geometry:{type:"Point",coordinates:[+N[m].lon,+N[m].lat]}};N[m].__is_center_placeholder&&(it.properties.geometry="center"),e?e(it):$.push(it)}for(var Z=[],V=[],m=0;m<h.length;m++)if(M[h[m].id]===h[m]){if(typeof h[m].tags<"u"&&(h[m].tags.type=="route"||h[m].tags.type=="waterway")){let ut=function(lt){var It=!1,Yt;Yt=lt.members.filter(function(Q){return Q.type==="way"}),Yt=Yt.map(function(Q){var he=E[Q.ref];if(he===void 0||he.nodes===void 0){t.verbose&&console.warn("Route "+lt.type+"/"+lt.id,"tainted by a missing or incomplete  way",Q.type+"/"+Q.ref),It=!0;return}return{id:Q.ref,role:Q.role,way:he,nodes:he.nodes.filter(function(we){return we!==void 0?!0:(It=!0,t.verbose&&console.warn("Route",lt.type+"/"+lt.id,"tainted by a way",Q.type+"/"+Q.ref,"with a missing node"),!1)})}}),Yt=mt.compact(Yt);var pe;pe=dc(Yt);var Vt=[];if(Vt=mt.compact(pe.map(function(Q){return mt.compact(Q.map(function(he){return[+he.lon,+he.lat]}))})),Vt.length==0)return t.verbose&&console.warn("Route",lt.type+"/"+lt.id,"contains no coordinates"),!1;var gt={type:"Feature",id:lt.type+"/"+lt.id,properties:{type:lt.type,id:lt.id,tags:lt.tags||{},relations:D[lt.type][lt.id]||[],meta:d(lt)},geometry:{type:Vt.length===1?"LineString":"MultiLineString",coordinates:Vt.length===1?Vt[0]:Vt}};return It&&(t.verbose&&console.warn("Route",lt.type+"/"+lt.id,"is tainted"),gt.properties.tainted=!0),gt};var k=ut;if(!mt.isArray(h[m].members)){t.verbose&&console.warn("Route",h[m].type+"/"+h[m].id,"ignored because it has no members");continue}if(h[m].members.forEach(function(lt){E[lt.ref]&&!u(E[lt.ref].tags)&&(E[lt.ref].is_skippablerelationmember=!0)}),it=ut(h[m]),it===!1){t.verbose&&console.warn("Route relation",h[m].type+"/"+h[m].id,"ignored because it has invalid geometry");continue}e?e(xa(it)):V.push(it)}if(typeof h[m].tags<"u"&&(h[m].tags.type=="multipolygon"||h[m].tags.type=="boundary")){let lt=function(It,Yt){var pe=!1,Vt=st?"way":"relation",gt=typeof It.id=="number"?It.id:+It.id.replace("_fullGeom",""),Q;Q=Yt.members.filter(function(yt){return yt.type==="way"}),Q=Q.map(function(yt){var Ht=E[yt.ref];if(Ht===void 0||Ht.nodes===void 0){t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"tainted by a missing or incomplete way",yt.type+"/"+yt.ref),pe=!0;return}return{id:yt.ref,role:yt.role||"outer",way:Ht,nodes:Ht.nodes.filter(function(ne){return ne!==void 0?!0:(pe=!0,t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"tainted by a way",yt.type+"/"+yt.ref,"with a missing node"),!1)})}}),Q=mt.compact(Q);var he,we;he=dc(Q.filter(function(yt){return yt.role==="outer"})),we=dc(Q.filter(function(yt){return yt.role==="inner"}));var fe;function He(yt){var Ht=function(Te,ie){for(var _n=0;_n<ie.length;_n++)if(ye(ie[_n],Te))return!0;return!1},ne=function(Te){return Te.map(function(ie){return[+ie.lat,+ie.lon]})},ye=function(Te,ie){for(var _n=Te[0],se=Te[1],yi=!1,pn=0,xi=ie.length-1;pn<ie.length;xi=pn++){var Ei=ie[pn][0],Zn=ie[pn][1],fs=ie[xi][0],ms=ie[xi][1],Un=Zn>se!=ms>se&&_n<(fs-Ei)*(se-Zn)/(ms-Zn)+Ei;Un&&(yi=!yi)}return yi},Ke,on;for(yt=ne(yt),Ke=0;Ke<he.length;Ke++)if(on=ne(he[Ke]),Ht(on,yt))return Ke}fe=he.map(function(yt){return[yt]});for(var Ve=0;Ve<we.length;Ve++){var jn=He(we[Ve]);jn!==void 0?fe[jn].push(we[Ve]):t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"contains an inner ring with no containing outer")}var qe=[];if(qe=mt.compact(fe.map(function(yt){var Ht=mt.compact(yt.map(function(ne){if(ne.length<4){t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"contains a ring with less than four nodes");return}return mt.compact(ne.map(function(ye){return[+ye.lon,+ye.lat]}))}));if(Ht.length==0){t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"contains an empty ring cluster");return}return Ht})),qe.length==0)return t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"contains no coordinates"),!1;var mn="MultiPolygon";qe.length===1&&(mn="Polygon",qe=qe[0]);var pi={type:"Feature",id:It.type+"/"+gt,properties:{type:It.type,id:gt,tags:It.tags||{},relations:D[It.type][It.id]||[],meta:d(It)},geometry:{type:mn,coordinates:qe}};return pe&&(t.verbose&&console.warn("Multipolygon",Vt+"/"+gt,"is tainted"),pi.properties.tainted=!0),pi};var ke=lt;if(!mt.isArray(h[m].members)){t.verbose&&console.warn("Multipolygon",h[m].type+"/"+h[m].id,"ignored because it has no members");continue}for(var X=0,x=0;x<h[m].members.length;x++)h[m].members[x].role=="outer"?X++:t.verbose&&h[m].members[x].role!="inner"&&console.warn("Multipolygon",h[m].type+"/"+h[m].id,"member",h[m].members[x].type+"/"+h[m].members[x].ref,'ignored because it has an invalid role: "'+h[m].members[x].role+'"');if(h[m].members.forEach(function(It){E[It.ref]&&(It.role==="outer"&&!u(E[It.ref].tags,h[m].tags)&&(E[It.ref].is_skippablerelationmember=!0),It.role==="inner"&&!u(E[It.ref].tags)&&(E[It.ref].is_skippablerelationmember=!0))}),X==0){t.verbose&&console.warn("Multipolygon relation",h[m].type+"/"+h[m].id,"ignored because it has no outer ways");continue}var st=!1;X==1&&!u(h[m].tags,{type:!0})&&(st=!0);var it=null;if(!st)it=lt(h[m],h[m]);else{var xt=h[m].members.filter(function(It){return It.role==="outer"})[0];if(xt=E[xt.ref],xt===void 0){t.verbose&&console.warn("Multipolygon relation",h[m].type+"/"+h[m].id,"ignored because outer way",xt.type+"/"+xt.ref,"is missing");continue}xt.is_skippablerelationmember=!0,it=lt(xt,h[m])}if(it===!1){t.verbose&&console.warn("Multipolygon relation",h[m].type+"/"+h[m].id,"ignored because it has invalid geometry");continue}e?e(xa(it)):V.push(it)}}for(var m=0;m<c.length;m++)if(E[c[m].id]===c[m]){if(!mt.isArray(c[m].nodes)){t.verbose&&console.warn("Way",c[m].type+"/"+c[m].id,"ignored because it has no nodes");continue}if(!c[m].is_skippablerelationmember){typeof c[m].id!="number"&&(c[m].id=+c[m].id.replace("_fullGeom","")),c[m].tainted=!1,c[m].hidden=!1;var _t=new Array;for(x=0;x<c[m].nodes.length;x++)typeof c[m].nodes[x]=="object"?_t.push([+c[m].nodes[x].lon,+c[m].nodes[x].lat]):(t.verbose&&console.warn("Way",c[m].type+"/"+c[m].id,"is tainted by an invalid node"),c[m].tainted=!0);if(_t.length<=1){t.verbose&&console.warn("Way",c[m].type+"/"+c[m].id,"ignored because it contains too few nodes");continue}var Mt="LineString";typeof c[m].nodes[0]<"u"&&typeof c[m].nodes[c[m].nodes.length-1]<"u"&&c[m].nodes[0].id===c[m].nodes[c[m].nodes.length-1].id&&(typeof c[m].tags<"u"&&a(c[m].tags)||c[m].__is_bounds_placeholder)&&(Mt="Polygon",_t=[_t]);var it={type:"Feature",id:c[m].type+"/"+c[m].id,properties:{type:c[m].type,id:c[m].id,tags:c[m].tags||{},relations:D.way[c[m].id]||[],meta:d(c[m])},geometry:{type:Mt,coordinates:_t}};c[m].tainted&&(t.verbose&&console.warn("Way",c[m].type+"/"+c[m].id,"is tainted"),it.properties.tainted=!0),c[m].__is_bounds_placeholder&&(it.properties.geometry="bounds"),e?e(xa(it)):Mt=="LineString"?Z.push(it):V.push(it)}}return e?!0:(B={type:"FeatureCollection",features:[]},B.features=B.features.concat(V),B.features=B.features.concat(Z),B.features=B.features.concat($),t.flatProperties&&B.features.forEach(function(ot){ot.properties=mt.merge(ot.properties.meta,ot.properties.tags,{id:ot.properties.type+"/"+ot.properties.id})}),B=xa(B),B)}function a(l){var c=t.polygonFeatures;if(typeof c=="function")return c(l);if(l.area==="no")return!1;for(var h in l){var u=l[h],d=c[h];if(!(typeof d>"u")&&u!=="no"&&(d===!0||d.included_values&&d.included_values[u]===!0||d.excluded_values&&d.excluded_values[u]!==!0))return!0}return!1}};function dc(r){for(var t=function(u){return u[0]},e=function(u){return u[u.length-1]},n=function(u,d){return u!==void 0&&d!==void 0&&u.id===d.id},i=[],s,o,a,l,c,h;r.length;)for(s=r.pop().nodes.slice(),i.push(s);r.length&&!n(t(s),e(s));){for(o=t(s),a=e(s),l=0;l<r.length;l++)if(h=r[l].nodes,n(a,t(h))){c=s.push,h=h.slice(1);break}else if(n(a,e(h))){c=s.push,h=h.slice(0,-1).reverse();break}else if(n(o,e(h))){c=s.unshift,h=h.slice(0,-1);break}else if(n(o,t(h))){c=s.unshift,h=h.slice(1).reverse();break}else h=c=null;if(!h)break;r.splice(l,1),c.apply(s,h)}return i}Xa.toGeojson=Xa;var oI=Xa;class aI extends Eo{constructor(t){super({...t,loader:t.loader||(()=>{})}),this.concurrentRequests=0,this.queryTemplate=`[out:json][timeout:25];
  // gather results
  (
    nwr[indoor][level][!building]({{bbox}});
    nw[door][level][!building]({{bbox}});
    nw[entrance][level][!building]({{bbox}});
    nwr[shop][level][!building]({{bbox}});
    nwr[amenity][level][!building]({{bbox}});
  ) -> .indoor;
  (nwr[indoor=room]({{bbox}});nwr[indoor=corridor]({{bbox}});) -> .rooms;
  .rooms >; is_in;nwr(pivot._)[building]({{bbox}}) -> .buildings;
  // print results
  (.indoor; .buildings;); out body;
  >;
  out skel qt;`,this.geoJsonFormat=new of,this.loader=async(e,n,i,s,o)=>{const a=np(e,i,"EPSG:4326"),l=this.queryTemplate.replace(/\{\{bbox\}\}/g,a[1]+","+Math.max(a[0],-180)+","+a[3]+","+Math.min(a[2],180));try{const c=await caches.open("osm-floorplans"),h=new Request("https://overpass.kumi.systems/api/interpreter?data="+encodeURIComponent(l));let u=await c.match(h);if(u&&new Date().getTime()-new Date(u.headers.get("x-date")).getTime()>1e3*60*60*24*7&&(await c.delete(h),u=void 0),!u){if(this.concurrentRequests>30){console.error("Too many concurrent Overpass requests."),this.removeLoadedExtent(e),o();return}else this.concurrentRequests=this.concurrentRequests+1;const m=new Request("https://overpass.kumi.systems/api/interpreter",{method:"POST",body:new URLSearchParams({data:l})}),I=await fetch(m);if(this.concurrentRequests=this.concurrentRequests-1,I.status!==200)throw new Error("Overpass failure response.");await c.put(h,new Response(await I.arrayBuffer(),{status:I.status,headers:{"content-type":"application/json","x-date":new Date().toISOString()}}))}u=await c.match(h);const d=await u.json(),f=oI(d,{flatProperties:!0}),p=this.geoJsonFormat.readFeatures(f,{featureProjection:i});this.addFeatures(p),s(p)}catch(c){console.error(c),this.removeLoadedExtent(e),o()}},t.loader||this.setLoader(this.loader)}}class Ir{constructor(){Ir.constructor_.apply(this,arguments)}static constructor_(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;const t=arguments[0];this._p=t}static locatePointInRing(){if(arguments[0]instanceof w&&H(arguments[1],Rt)){const t=arguments[0],e=arguments[1],n=new Ir(t),i=new w,s=new w;for(let o=1;o<e.size();o++)if(e.getCoordinate(o,i),e.getCoordinate(o-1,s),n.countSegment(i,s),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof w&&arguments[1]instanceof Array){const t=arguments[0],e=arguments[1],n=new Ir(t);for(let i=1;i<e.length;i++){const s=e[i],o=e[i-1];if(n.countSegment(s,o),n.isOnSegment())return n.getLocation()}return n.getLocation()}}countSegment(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){let n=t.x,i=e.x;return n>i&&(n=e.x,i=t.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){let n=J.index(t,e,this._p);if(n===J.COLLINEAR)return this._isPointOnSegment=!0,null;e.y<t.y&&(n=-n),n===J.LEFT&&this._crossingCount++}}isPointInPolygon(){return this.getLocation()!==y.EXTERIOR}getLocation(){return this._isPointOnSegment?y.BOUNDARY:this._crossingCount%2===1?y.INTERIOR:y.EXTERIOR}isOnSegment(){return this._isPointOnSegment}}class wn{static isOnLine(){if(arguments[0]instanceof w&&H(arguments[1],Rt)){const t=arguments[0],e=arguments[1],n=new Me,i=new w,s=new w,o=e.size();for(let a=1;a<o;a++)if(e.getCoordinate(a-1,i),e.getCoordinate(a,s),n.computeIntersection(t,i,s),n.hasIntersection())return!0;return!1}else if(arguments[0]instanceof w&&arguments[1]instanceof Array){const t=arguments[0],e=arguments[1],n=new Me;for(let i=1;i<e.length;i++){const s=e[i-1],o=e[i];if(n.computeIntersection(t,s,o),n.hasIntersection())return!0}return!1}}static locateInRing(t,e){return Ir.locatePointInRing(t,e)}static isInRing(t,e){return wn.locateInRing(t,e)!==y.EXTERIOR}}class Re{isInBoundary(t){}}class _f{isInBoundary(t){return t%2===1}get interfaces_(){return[Re]}}class pf{isInBoundary(t){return t>0}get interfaces_(){return[Re]}}class yf{isInBoundary(t){return t>1}get interfaces_(){return[Re]}}class xf{isInBoundary(t){return t===1}get interfaces_(){return[Re]}}Re.Mod2BoundaryNodeRule=_f;Re.EndPointBoundaryNodeRule=pf;Re.MultiValentEndPointBoundaryNodeRule=yf;Re.MonoValentEndPointBoundaryNodeRule=xf;Re.MOD2_BOUNDARY_RULE=new _f;Re.ENDPOINT_BOUNDARY_RULE=new pf;Re.MULTIVALENT_ENDPOINT_BOUNDARY_RULE=new yf;Re.MONOVALENT_ENDPOINT_BOUNDARY_RULE=new xf;Re.OGC_SFS_BOUNDARY_RULE=Re.MOD2_BOUNDARY_RULE;class lI{hasNext(){}next(){}remove(){}}class Cr{constructor(){Cr.constructor_.apply(this,arguments)}static constructor_(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;const t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()}static isAtomic(t){return!(t instanceof St)}next(){if(this._atStart)return this._atStart=!1,Cr.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new El;const t=this._parent.getGeometryN(this._index++);return t instanceof St?(this._subcollectionIterator=new Cr(t),this._subcollectionIterator.next()):t}remove(){throw new _i(this.getClass().getName())}hasNext(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}get interfaces_(){return[lI]}}class Ks{constructor(){Ks.constructor_.apply(this,arguments)}static constructor_(){if(this._boundaryRule=Re.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){const t=arguments[0];if(t===null)throw new ht("Rule must be non-null");this._boundaryRule=t}}}locateInPolygonRing(t,e){return e.getEnvelopeInternal().intersects(t)?wn.locateInRing(t,e.getCoordinates()):y.EXTERIOR}intersects(t,e){return this.locate(t,e)!==y.EXTERIOR}updateLocationInfo(t){t===y.INTERIOR&&(this._isIn=!0),t===y.BOUNDARY&&this._numBoundaries++}computeLocation(t,e){if(e instanceof ee&&this.updateLocationInfo(this.locateOnPoint(t,e)),e instanceof vt)this.updateLocationInfo(this.locateOnLineString(t,e));else if(e instanceof jt)this.updateLocationInfo(this.locateInPolygon(t,e));else if(e instanceof Nn){const n=e;for(let i=0;i<n.getNumGeometries();i++){const s=n.getGeometryN(i);this.updateLocationInfo(this.locateOnLineString(t,s))}}else if(e instanceof nn){const n=e;for(let i=0;i<n.getNumGeometries();i++){const s=n.getGeometryN(i);this.updateLocationInfo(this.locateInPolygon(t,s))}}else if(e instanceof St){const n=new Cr(e);for(;n.hasNext();){const i=n.next();i!==e&&this.computeLocation(t,i)}}}locateOnPoint(t,e){return e.getCoordinate().equals2D(t)?y.INTERIOR:y.EXTERIOR}locateOnLineString(t,e){if(!e.getEnvelopeInternal().intersects(t))return y.EXTERIOR;const n=e.getCoordinateSequence();return!e.isClosed()&&(t.equals(n.getCoordinate(0))||t.equals(n.getCoordinate(n.size()-1)))?y.BOUNDARY:wn.isOnLine(t,n)?y.INTERIOR:y.EXTERIOR}locateInPolygon(t,e){if(e.isEmpty())return y.EXTERIOR;const n=e.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===y.EXTERIOR)return y.EXTERIOR;if(i===y.BOUNDARY)return y.BOUNDARY;for(let s=0;s<e.getNumInteriorRing();s++){const o=e.getInteriorRingN(s),a=this.locateInPolygonRing(t,o);if(a===y.INTERIOR)return y.EXTERIOR;if(a===y.BOUNDARY)return y.BOUNDARY}return y.INTERIOR}locate(t,e){return e.isEmpty()?y.EXTERIOR:e instanceof vt?this.locateOnLineString(t,e):e instanceof jt?this.locateInPolygon(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?y.BOUNDARY:this._numBoundaries>0||this._isIn?y.INTERIOR:y.EXTERIOR)}}class Wa{constructor(){Wa.constructor_.apply(this,arguments)}static constructor_(){this._pointGeom=null,this._otherGeom=null,this._geomFact=null;const t=arguments[0],e=arguments[1];this._pointGeom=t,this._otherGeom=e,this._geomFact=e.getFactory()}static union(t,e){return new Wa(t,e).union()}union(){const t=new Ks,e=new zs;for(let s=0;s<this._pointGeom.getNumGeometries();s++){const a=this._pointGeom.getGeometryN(s).getCoordinate();t.locate(a,this._otherGeom)===y.EXTERIOR&&e.add(a)}if(e.size()===0)return this._otherGeom;let n=null;const i=kt.toCoordinateArray(e);return i.length===1?n=this._geomFact.createPoint(i[0]):n=this._geomFact.createMultiPointFromCoords(i),On.combine(n,this._otherGeom)}}class so{constructor(){so.constructor_.apply(this,arguments)}static constructor_(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new At,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof vt&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];so.constructor_.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];this._srcPts=t,this._isClosed=so.isClosed(t),this._snapTolerance=e}}static isClosed(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])}snapVertices(t,e){const n=this._isClosed?t.size()-1:t.size();for(let i=0;i<n;i++){const s=t.get(i),o=this.findSnapForVertex(s,e);o!==null&&(t.set(i,new w(o)),i===0&&this._isClosed&&t.set(t.size()-1,new w(o)))}}findSnapForVertex(t,e){for(let n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this._snapTolerance)return e[n]}return null}snapTo(t){const e=new Yn(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()}snapSegments(t,e){if(e.length===0)return null;let n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(let i=0;i<n;i++){const s=e[i],o=this.findSegmentIndexToSnap(s,t);o>=0&&t.add(o+1,new w(s),!1)}}findSegmentIndexToSnap(t,e){let n=j.MAX_VALUE,i=-1;for(let s=0;s<e.size()-1;s++){if(this._seg.p0=e.get(s),this._seg.p1=e.get(s+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}const o=this._seg.distance(t);o<this._snapTolerance&&o<n&&(n=o,i=s)}return i}setAllowSnappingToSourceVertices(t){this._allowSnappingToSourceVertices=t}}class ln{constructor(){ln.constructor_.apply(this,arguments)}static constructor_(){this._srcGeom=null;const t=arguments[0];this._srcGeom=t}static snap(t,e,n){const i=new Array(2).fill(null),s=new ln(t);i[0]=s.snapTo(e,n);const o=new ln(e);return i[1]=o.snapTo(i[0],n),i}static computeOverlaySnapTolerance(){if(arguments.length===1){const t=arguments[0];let e=ln.computeSizeBasedSnapTolerance(t);const n=t.getPrecisionModel();if(n.getType()===Pt.FIXED){const i=1/n.getScale()*2/1.415;i>e&&(e=i)}return e}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return Math.min(ln.computeOverlaySnapTolerance(t),ln.computeOverlaySnapTolerance(e))}}static computeSizeBasedSnapTolerance(t){const e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*ln.SNAP_PRECISION_FACTOR}static snapToSelf(t,e,n){return new ln(t).snapToSelf(e,n)}snapTo(t,e){const n=this.extractTargetCoordinates(t);return new Ba(e,n).transform(this._srcGeom)}snapToSelf(t,e){const n=this.extractTargetCoordinates(this._srcGeom),s=new Ba(t,n,!0).transform(this._srcGeom);let o=s;return e&&H(o,qs)&&(o=s.buffer(0)),o}computeSnapTolerance(t){return this.computeMinimumSegmentLength(t)/10}extractTargetCoordinates(t){const e=new zs,n=t.getCoordinates();for(let i=0;i<n.length;i++)e.add(n[i]);return e.toArray(new Array(0).fill(null))}computeMinimumSegmentLength(t){let e=j.MAX_VALUE;for(let n=0;n<t.length-1;n++){const i=t[n].distance(t[n+1]);i<e&&(e=i)}return e}}ln.SNAP_PRECISION_FACTOR=1e-9;class Ba extends Mh{constructor(){super(),Ba.constructor_.apply(this,arguments)}static constructor_(){if(this._snapTolerance=null,this._snapPts=null,this._isSelfSnap=!1,arguments.length===2){const t=arguments[0],e=arguments[1];this._snapTolerance=t,this._snapPts=e}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._snapTolerance=t,this._snapPts=e,this._isSelfSnap=n}}snapLine(t,e){const n=new so(t,this._snapTolerance);return n.setAllowSnappingToSourceVertices(this._isSelfSnap),n.snapTo(e)}transformCoordinates(t,e){const n=t.toCoordinateArray(),i=this.snapLine(n,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(i)}}class Qn{constructor(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=new Ns,this._commonSignExp=null}getCommon(){return j.longBitsToDouble(this._commonBits)}add(t){const e=j.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=Qn.signExpBits(this._commonBits),this._isFirst=!1,null;if(Qn.signExpBits(e)!==this._commonSignExp)return this._commonBits.high=0,this._commonBits.low=0,null;this._commonMantissaBitsCount=Qn.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=Qn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))}toString(){if(arguments.length===1){const t=arguments[0],e=j.longBitsToDouble(t),i="0000000000000000000000000000000000000000000000000000000000000000"+Ns.toBinaryString(t),s=i.substring(i.length-64);return s.substring(0,1)+"  "+s.substring(1,12)+"(exp) "+s.substring(12)+" [ "+e+" ]"}}getClass(){return Qn}get interfaces_(){return[]}static getBit(t,e){const n=1<<e%32;return e<32?t.low&n?1:0:t.high&n?1:0}static signExpBits(t){return t.high>>>20}static zeroLowerBits(t,e){let n="low";if(e>32&&(t.low=0,e%=32,n="high"),e>0){const i=e<32?~((1<<e)-1):0;t[n]&=i}return t}static numCommonMostSigMantissaBits(t,e){let n=0;for(let i=52;i>=0;i--){if(Qn.getBit(t,i)!==Qn.getBit(e,i))return n;n++}return 52}}class jo{constructor(){jo.constructor_.apply(this,arguments)}static constructor_(){this._commonCoord=null,this._ccFilter=new Rl}addCommonBits(t){const e=new Ro(this._commonCoord);t.apply(e),t.geometryChanged()}removeCommonBits(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;const e=new w(this._commonCoord);e.x=-e.x,e.y=-e.y;const n=new Ro(e);return t.apply(n),t.geometryChanged(),t}getCommonCoordinate(){return this._commonCoord}add(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()}}class Rl{constructor(){Rl.constructor_.apply(this,arguments)}static constructor_(){this._commonBitsX=new Qn,this._commonBitsY=new Qn}filter(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)}getCommonCoordinate(){return new w(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())}get interfaces_(){return[Wr]}}class Ro{constructor(){Ro.constructor_.apply(this,arguments)}static constructor_(){this.trans=null;const t=arguments[0];this.trans=t}filter(t,e){const n=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)}isDone(){return!1}isGeometryChanged(){return!0}get interfaces_(){return[Vs]}}jo.CommonCoordinateFilter=Rl;jo.Translater=Ro;class wl{static octant(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new ht("Cannot compute the octant for point ( "+t+", "+e+" )");const n=Math.abs(t),i=Math.abs(e);return t>=0?e>=0?n>=i?0:1:n>=i?7:6:e>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof w&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1],n=e.x-t.x,i=e.y-t.y;if(n===0&&i===0)throw new ht("Cannot compute the octant for two identical points "+t);return wl.octant(n,i)}}}class Ef{getCoordinates(){}size(){}getCoordinate(t){}isClosed(){}setData(t){}getData(){}}class Oh{constructor(){Oh.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._data=null;const t=arguments[0],e=arguments[1];this._pts=t,this._data=e}getCoordinates(){return this._pts}size(){return this._pts.length}getCoordinate(t){return this._pts[t]}isClosed(){return this._pts[0].equals(this._pts[this._pts.length-1])}getSegmentOctant(t){return t===this._pts.length-1?-1:wl.octant(this.getCoordinate(t),this.getCoordinate(t+1))}setData(t){this._data=t}getData(){return this._data}toString(){return di.toLineString(new Fn(this._pts))}get interfaces_(){return[Ef]}}class If{getBounds(){}}class Pn{constructor(){Pn.constructor_.apply(this,arguments)}static constructor_(){this._bounds=null,this._item=null;const t=arguments[0],e=arguments[1];this._bounds=t,this._item=e}getItem(){return this._item}getBounds(){return this._bounds}get interfaces_(){return[If,rn]}}class mr{constructor(){mr.constructor_.apply(this,arguments)}static constructor_(){this._size=null,this._items=null,this._size=0,this._items=new F,this._items.add(null)}poll(){if(this.isEmpty())return null;const t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t}size(){return this._size}reorder(t){let e=null;const n=this._items.get(t);for(;t*2<=this._size&&(e=t*2,e!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(n)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,n)}clear(){this._size=0,this._items.clear()}peek(){return this.isEmpty()?null:this._items.get(1)}isEmpty(){return this._size===0}add(t){this._items.add(null),this._size+=1;let e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)}}class cI{insert(t,e){}remove(t,e){}query(){}}class $e{constructor(){$e.constructor_.apply(this,arguments)}static constructor_(){if(this._childBoundables=new F,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this._level=t}}}getLevel(){return this._level}size(){return this._childBoundables.size()}getChildBoundables(){return this._childBoundables}addChildBoundable(t){et.isTrue(this._bounds===null),this._childBoundables.add(t)}isEmpty(){return this._childBoundables.isEmpty()}getBounds(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}get interfaces_(){return[If,rn]}}class Kt{static maxDistance(t,e,n,i,s,o,a,l){let c=Kt.distance(t,e,s,o);return c=Math.max(c,Kt.distance(t,e,a,l)),c=Math.max(c,Kt.distance(n,i,s,o)),c=Math.max(c,Kt.distance(n,i,a,l)),c}static distance(t,e,n,i){const s=n-t,o=i-e;return Math.sqrt(s*s+o*o)}static maximumDistance(t,e){const n=Math.min(t.getMinX(),e.getMinX()),i=Math.min(t.getMinY(),e.getMinY()),s=Math.max(t.getMaxX(),e.getMaxX()),o=Math.max(t.getMaxY(),e.getMaxY());return Kt.distance(n,i,s,o)}static minMaxDistance(t,e){const n=t.getMinX(),i=t.getMinY(),s=t.getMaxX(),o=t.getMaxY(),a=e.getMinX(),l=e.getMinY(),c=e.getMaxX(),h=e.getMaxY();let u=Kt.maxDistance(n,i,n,o,a,l,a,h);return u=Math.min(u,Kt.maxDistance(n,i,n,o,a,l,c,l)),u=Math.min(u,Kt.maxDistance(n,i,n,o,c,h,a,h)),u=Math.min(u,Kt.maxDistance(n,i,n,o,c,h,c,l)),u=Math.min(u,Kt.maxDistance(n,i,s,i,a,l,a,h)),u=Math.min(u,Kt.maxDistance(n,i,s,i,a,l,c,l)),u=Math.min(u,Kt.maxDistance(n,i,s,i,c,h,a,h)),u=Math.min(u,Kt.maxDistance(n,i,s,i,c,h,c,l)),u=Math.min(u,Kt.maxDistance(s,o,n,o,a,l,a,h)),u=Math.min(u,Kt.maxDistance(s,o,n,o,a,l,c,l)),u=Math.min(u,Kt.maxDistance(s,o,n,o,c,h,a,h)),u=Math.min(u,Kt.maxDistance(s,o,n,o,c,h,c,l)),u=Math.min(u,Kt.maxDistance(s,o,s,i,a,l,a,h)),u=Math.min(u,Kt.maxDistance(s,o,s,i,a,l,c,l)),u=Math.min(u,Kt.maxDistance(s,o,s,i,c,h,a,h)),u=Math.min(u,Kt.maxDistance(s,o,s,i,c,h,c,l)),u}}class Ae{constructor(){Ae.constructor_.apply(this,arguments)}static constructor_(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;const t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()}static area(t){return t.getBounds().getArea()}static isComposite(t){return t instanceof $e}maximumDistance(){return Kt.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}expandToQueue(t,e){const n=Ae.isComposite(this._boundable1),i=Ae.isComposite(this._boundable2);if(n&&i)return Ae.area(this._boundable1)>Ae.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,t,e),null):(this.expand(this._boundable2,this._boundable1,!0,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,!1,t,e),null;if(i)return this.expand(this._boundable2,this._boundable1,!0,t,e),null;throw new ht("neither boundable is composite")}isLeaves(){return!(Ae.isComposite(this._boundable1)||Ae.isComposite(this._boundable2))}compareTo(t){const e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0}expand(t,e,n,i,s){const o=t.getChildBoundables();for(let a=o.iterator();a.hasNext();){const l=a.next();let c=null;n?c=new Ae(e,l,this._itemDistance):c=new Ae(l,e,this._itemDistance),c.getDistance()<s&&i.add(c)}}getBoundable(t){return t===0?this._boundable1:this._boundable2}getDistance(){return this._distance}distance(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}get interfaces_(){return[sn]}}class Tl{visitItem(t){}}class ci{constructor(){ci.constructor_.apply(this,arguments)}static constructor_(){if(this._root=null,this._built=!1,this._itemBoundables=new F,this._nodeCapacity=null,arguments.length===0)ci.constructor_.call(this,ci.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){const t=arguments[0];et.isTrue(t>1,"Node capacity must be greater than 1"),this._nodeCapacity=t}}static compareDoubles(t,e){return t>e?1:t<e?-1:0}queryInternal(){if(H(arguments[2],Tl)&&arguments[0]instanceof Object&&arguments[1]instanceof $e){const t=arguments[0],e=arguments[1],n=arguments[2],i=e.getChildBoundables();for(let s=0;s<i.size();s++){const o=i.get(s);this.getIntersectsOp().intersects(o.getBounds(),t)&&(o instanceof $e?this.queryInternal(t,o,n):o instanceof Pn?n.visitItem(o.getItem()):et.shouldNeverReachHere())}}else if(H(arguments[2],dn)&&arguments[0]instanceof Object&&arguments[1]instanceof $e){const t=arguments[0],e=arguments[1],n=arguments[2],i=e.getChildBoundables();for(let s=0;s<i.size();s++){const o=i.get(s);this.getIntersectsOp().intersects(o.getBounds(),t)&&(o instanceof $e?this.queryInternal(t,o,n):o instanceof Pn?n.add(o.getItem()):et.shouldNeverReachHere())}}}getNodeCapacity(){return this._nodeCapacity}lastNode(t){return t.get(t.size()-1)}size(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){const t=arguments[0];let e=0;for(let n=t.getChildBoundables().iterator();n.hasNext();){const i=n.next();i instanceof $e?e+=this.size(i):i instanceof Pn&&(e+=1)}return e}}removeItem(t,e){let n=null;for(let i=t.getChildBoundables().iterator();i.hasNext();){const s=i.next();s instanceof Pn&&s.getItem()===e&&(n=s)}return n!==null?(t.getChildBoundables().remove(n),!0):!1}itemsTree(){if(arguments.length===0){this.build();const t=this.itemsTree(this._root);return t===null?new F:t}else if(arguments.length===1){const t=arguments[0],e=new F;for(let n=t.getChildBoundables().iterator();n.hasNext();){const i=n.next();if(i instanceof $e){const s=this.itemsTree(i);s!==null&&e.add(s)}else i instanceof Pn?e.add(i.getItem()):et.shouldNeverReachHere()}return e.size()<=0?null:e}}insert(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Pn(t,e))}boundablesAtLevel(){if(arguments.length===1){const t=arguments[0],e=new F;return this.boundablesAtLevel(t,this._root,e),e}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(et.isTrue(t>-2),e.getLevel()===t)return n.add(e),null;for(let i=e.getChildBoundables().iterator();i.hasNext();){const s=i.next();s instanceof $e?this.boundablesAtLevel(t,s,n):(et.isTrue(s instanceof Pn),t===-1&&n.add(s))}return null}}query(){if(arguments.length===1){const t=arguments[0];this.build();const e=new F;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e),e}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.queryInternal(t,this._root,e)}}build(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}getRoot(){return this.build(),this._root}remove(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,e):!1}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];let i=this.removeItem(e,n);if(i)return!0;let s=null;for(let o=e.getChildBoundables().iterator();o.hasNext();){const a=o.next();if(this.getIntersectsOp().intersects(a.getBounds(),t)&&a instanceof $e&&(i=this.remove(t,a,n),i)){s=a;break}}return s!==null&&s.getChildBoundables().isEmpty()&&e.getChildBoundables().remove(s),i}}createHigherLevels(t,e){et.isTrue(!t.isEmpty());const n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)}depth(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){const t=arguments[0];let e=0;for(let n=t.getChildBoundables().iterator();n.hasNext();){const i=n.next();if(i instanceof $e){const s=this.depth(i);s>e&&(e=s)}}return e+1}}createParentBoundables(t,e){et.isTrue(!t.isEmpty());const n=new F;n.add(this.createNode(e));const i=new F(t);Fi.sort(i,this.getComparator());for(let s=i.iterator();s.hasNext();){const o=s.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(o)}return n}isEmpty(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}get interfaces_(){return[rn]}}function hI(){}ci.IntersectsOp=hI;ci.DEFAULT_NODE_CAPACITY=10;class uI{distance(t,e){}}class te extends ci{constructor(){super(),te.constructor_.apply(this,arguments)}static constructor_(){if(arguments.length===0)te.constructor_.call(this,te.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){const t=arguments[0];ci.constructor_.call(this,t)}}static centreX(t){return te.avg(t.getMinX(),t.getMaxX())}static avg(t,e){return(t+e)/2}static getItems(t){const e=new Array(t.size()).fill(null);let n=0;for(;!t.isEmpty();){const i=t.poll();e[n]=i.getBoundable(0).getItem(),n++}return e}static centreY(t){return te.avg(t.getMinY(),t.getMaxY())}createParentBoundablesFromVerticalSlices(t,e){et.isTrue(t.length>0);const n=new F;for(let i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n}nearestNeighbourK(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.nearestNeighbourK(t,j.POSITIVE_INFINITY,e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];let i=e;const s=new mr;s.add(t);const o=new mr;for(;!s.isEmpty()&&i>=0;){const a=s.poll(),l=a.getDistance();if(l>=i)break;a.isLeaves()?o.size()<n?o.add(a):(o.peek().getDistance()>l&&(o.poll(),o.add(a)),i=o.peek().getDistance()):a.expandToQueue(s,i)}return te.getItems(o)}}createNode(t){return new Nl(t)}size(){return arguments.length===0?super.size.call(this):super.size.apply(this,arguments)}insert(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof ct){const t=arguments[0],e=arguments[1];if(t.isNull())return null;super.insert.call(this,t,e)}else return super.insert.apply(this,arguments)}getIntersectsOp(){return te.intersectsOp}verticalSlices(t,e){const n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),s=t.iterator();for(let o=0;o<e;o++){i[o]=new F;let a=0;for(;s.hasNext()&&a<n;){const l=s.next();i[o].add(l),a++}}return i}query(){if(arguments.length===1){const t=arguments[0];return super.query.call(this,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];super.query.call(this,t,e)}}getComparator(){return te.yComparator}createParentBoundablesFromVerticalSlice(t,e){return super.createParentBoundables.call(this,t,e)}remove(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof ct){const t=arguments[0],e=arguments[1];return super.remove.call(this,t,e)}else return super.remove.apply(this,arguments)}depth(){return arguments.length===0?super.depth.call(this):super.depth.apply(this,arguments)}createParentBoundables(t,e){et.isTrue(!t.isEmpty());const n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new F(t);Fi.sort(i,te.xComparator);const s=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(s,e)}nearestNeighbour(){if(arguments.length===1){if(H(arguments[0],uI)){const t=arguments[0];if(this.isEmpty())return null;const e=new Ae(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}else if(arguments[0]instanceof Ae){const t=arguments[0];let e=j.POSITIVE_INFINITY,n=null;const i=new mr;for(i.add(t);!i.isEmpty()&&e>0;){const s=i.poll(),o=s.getDistance();if(o>=e)break;s.isLeaves()?(e=o,n=s):s.expandToQueue(i,e)}return n===null?null:[n.getBoundable(0).getItem(),n.getBoundable(1).getItem()]}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this.isEmpty()||t.isEmpty())return null;const n=new Ae(this.getRoot(),t.getRoot(),e);return this.nearestNeighbour(n)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2],i=new Pn(t,e),s=new Ae(this.getRoot(),i,n);return this.nearestNeighbour(s)[0]}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=new Pn(t,e),o=new Ae(this.getRoot(),s,n);return this.nearestNeighbourK(o,i)}}isWithinDistance(){if(arguments.length===2){const t=arguments[0],e=arguments[1];let n=j.POSITIVE_INFINITY;const i=new mr;for(i.add(t);!i.isEmpty();){const s=i.poll(),o=s.getDistance();if(o>e)return!1;if(s.maximumDistance()<=e)return!0;if(s.isLeaves()){if(n=o,n<=e)return!0}else s.expandToQueue(i,n)}return!1}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2],i=new Ae(this.getRoot(),t.getRoot(),e);return this.isWithinDistance(i,n)}}get interfaces_(){return[cI,rn]}}class Nl extends $e{constructor(){super(),Nl.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0];$e.constructor_.call(this,t)}computeBounds(){let t=null;for(let e=this.getChildBoundables().iterator();e.hasNext();){const n=e.next();t===null?t=new ct(n.getBounds()):t.expandToInclude(n.getBounds())}return t}}te.STRtreeNode=Nl;te.xComparator=new class{get interfaces_(){return[gs]}compare(r,t){return ci.compareDoubles(te.centreX(r.getBounds()),te.centreX(t.getBounds()))}};te.yComparator=new class{get interfaces_(){return[gs]}compare(r,t){return ci.compareDoubles(te.centreY(r.getBounds()),te.centreY(t.getBounds()))}};te.intersectsOp=new class{get interfaces_(){return[IntersectsOp]}intersects(r,t){return r.intersects(t)}};te.DEFAULT_NODE_CAPACITY=10;class In{static relativeSign(t,e){return t<e?-1:t>e?1:0}static compare(t,e,n){if(e.equals2D(n))return 0;const i=In.relativeSign(e.x,n.x),s=In.relativeSign(e.y,n.y);switch(t){case 0:return In.compareValue(i,s);case 1:return In.compareValue(s,i);case 2:return In.compareValue(s,-i);case 3:return In.compareValue(-i,s);case 4:return In.compareValue(-i,-s);case 5:return In.compareValue(-s,-i);case 6:return In.compareValue(-s,i);case 7:return In.compareValue(i,-s)}return et.shouldNeverReachHere("invalid octant value"),0}static compareValue(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0}}class Ph{constructor(){Ph.constructor_.apply(this,arguments)}static constructor_(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this._segString=t,this.coord=new w(e),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!e.equals2D(t.getCoordinate(n))}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)}compareTo(t){const e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:this._isInterior?e._isInterior?In.compare(this._segmentOctant,this.coord,e.coord):1:-1}isEndPoint(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t}toString(){return this.segmentIndex+":"+this.coord.toString()}isInterior(){return this._isInterior}get interfaces_(){return[sn]}}class gI extends ff{}const Kn=0,Vi=1;function Gg(r){return r==null?Kn:r.color}function Lt(r){return r==null?null:r.parent}function qn(r,t){r!==null&&(r.color=t)}function fc(r){return r==null?null:r.left}function kg(r){return r==null?null:r.right}class fi extends gI{constructor(){super(),this.root_=null,this.size_=0}get(t){let e=this.root_;for(;e!==null;){const n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null}put(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Kn,getValue(){return this.value},getKey(){return this.key}},this.size_=1,null;let n=this.root_,i,s;do if(i=n,s=t.compareTo(n.key),s<0)n=n.left;else if(s>0)n=n.right;else{const a=n.value;return n.value=e,a}while(n!==null);const o={key:t,left:null,right:null,value:e,parent:i,color:Kn,getValue(){return this.value},getKey(){return this.key}};return s<0?i.left=o:i.right=o,this.fixAfterInsertion(o),this.size_++,null}fixAfterInsertion(t){let e;for(t.color=Vi;t!=null&&t!==this.root_&&t.parent.color===Vi;)Lt(t)===fc(Lt(Lt(t)))?(e=kg(Lt(Lt(t))),Gg(e)===Vi?(qn(Lt(t),Kn),qn(e,Kn),qn(Lt(Lt(t)),Vi),t=Lt(Lt(t))):(t===kg(Lt(t))&&(t=Lt(t),this.rotateLeft(t)),qn(Lt(t),Kn),qn(Lt(Lt(t)),Vi),this.rotateRight(Lt(Lt(t))))):(e=fc(Lt(Lt(t))),Gg(e)===Vi?(qn(Lt(t),Kn),qn(e,Kn),qn(Lt(Lt(t)),Vi),t=Lt(Lt(t))):(t===fc(Lt(t))&&(t=Lt(t),this.rotateRight(t)),qn(Lt(t),Kn),qn(Lt(Lt(t)),Vi),this.rotateLeft(Lt(Lt(t)))));this.root_.color=Kn}values(){const t=new F;let e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=fi.successor(e))!==null;)t.add(e.value);return t}entrySet(){const t=new Wo;let e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=fi.successor(e))!==null;)t.add(e);return t}rotateLeft(t){if(t!=null){const e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent==null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}}rotateRight(t){if(t!=null){const e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent==null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}}getFirstEntry(){let t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t}static successor(t){let e;if(t===null)return null;if(t.right!==null){for(e=t.right;e.left!==null;)e=e.left;return e}else{e=t.parent;let n=t;for(;e!==null&&n===e.right;)n=e,e=e.parent;return e}}size(){return this.size_}containsKey(t){let e=this.root_;for(;e!==null;){const n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return!0}return!1}}class Ah{constructor(){Ah.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new fi,this._edge=null;const t=arguments[0];this._edge=t}getSplitCoordinates(){const t=new Yn;this.addEndpoints();const e=this.iterator();let n=e.next();for(;e.hasNext();){const i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()}addCollapsedNodes(){const t=new F;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(let e=t.iterator();e.hasNext();){const n=e.next().intValue();this.add(this._edge.getCoordinate(n),n)}}createSplitEdgePts(t,e){let n=e.segmentIndex-t.segmentIndex+2;if(n===2)return[new w(t.coord),new w(e.coord)];const i=this._edge.getCoordinate(e.segmentIndex),s=e.isInterior()||!e.coord.equals2D(i);s||n--;const o=new Array(n).fill(null);let a=0;o[a++]=new w(t.coord);for(let l=t.segmentIndex+1;l<=e.segmentIndex;l++)o[a++]=this._edge.getCoordinate(l);return s&&(o[a]=new w(e.coord)),o}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}findCollapsesFromExistingVertices(t){for(let e=0;e<this._edge.size()-2;e++){const n=this._edge.getCoordinate(e);this._edge.getCoordinate(e+1);const i=this._edge.getCoordinate(e+2);n.equals2D(i)&&t.add(Or.valueOf(e+1))}}addEdgeCoordinates(t,e,n){const i=this.createSplitEdgePts(t,e);n.add(i,!1)}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints(),this.addCollapsedNodes();const e=this.iterator();let n=e.next();for(;e.hasNext();){const i=e.next(),s=this.createSplitEdge(n,i);t.add(s),n=i}}findCollapseIndex(t,e,n){if(!t.coord.equals2D(e.coord))return!1;let i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,i===1?(n[0]=t.segmentIndex+1,!0):!1}findCollapsesFromInsertedNodes(t){const e=new Array(1).fill(null),n=this.iterator();let i=n.next();for(;n.hasNext();){const s=n.next();this.findCollapseIndex(i,s,e)&&t.add(Or.valueOf(e[0])),i=s}}getEdge(){return this._edge}addEndpoints(){const t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)}createSplitEdge(t,e){const n=this.createSplitEdgePts(t,e);return new hi(n,this._edge.getData())}add(t,e){const n=new Ph(this._edge,t,e,this._edge.getSegmentOctant(e)),i=this._nodeMap.get(n);return i!==null?(et.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)}checkSplitEdgesCorrectness(t){const e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new ai("bad split edge start point at "+i);const o=t.get(t.size()-1).getCoordinates(),a=o[o.length-1];if(!a.equals2D(e[e.length-1]))throw new ai("bad split edge end point at "+a)}}class dI{addIntersection(t,e){}get interfaces_(){return[Ef]}}class hi{constructor(){hi.constructor_.apply(this,arguments)}static constructor_(){this._nodeList=new Ah(this),this._pts=null,this._data=null;const t=arguments[0],e=arguments[1];this._pts=t,this._data=e}static getNodedSubstrings(){if(arguments.length===1){const t=arguments[0],e=new F;return hi.getNodedSubstrings(t,e),e}else if(arguments.length===2){const t=arguments[0],e=arguments[1];for(let n=t.iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(e)}}getCoordinates(){return this._pts}size(){return this._pts.length}getCoordinate(t){return this._pts[t]}isClosed(){return this._pts[0].equals(this._pts[this._pts.length-1])}getSegmentOctant(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))}setData(t){this._data=t}safeOctant(t,e){return t.equals2D(e)?0:wl.octant(t,e)}getData(){return this._data}addIntersection(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[3],i=new w(t.getIntersection(n));this.addIntersection(i,e)}}toString(){return di.toLineString(new Fn(this._pts))}getNodeList(){return this._nodeList}addIntersectionNode(t,e){let n=e;const i=n+1;if(i<this._pts.length){const o=this._pts[i];t.equals2D(o)&&(n=i)}return this._nodeList.add(t,n)}addIntersections(t,e,n){for(let i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)}get interfaces_(){return[dI]}}class Dh{constructor(){Dh.constructor_.apply(this,arguments)}static constructor_(){this._overlapSeg1=new At,this._overlapSeg2=new At}overlap(){if(arguments.length!==2){if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}let Cf=class Rf{constructor(){Rf.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=i}getLineSegment(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]}computeSelect(t,e,n,i){const s=this._pts[e],o=this._pts[n];if(n-e===1)return i.select(this,e),null;if(!t.intersects(s,o))return null;const a=Math.trunc((e+n)/2);e<a&&this.computeSelect(t,e,a,i),a<n&&this.computeSelect(t,a,n,i)}getCoordinates(){const t=new Array(this._end-this._start+1).fill(null);let e=0;for(let n=this._start;n<=this._end;n++)t[e++]=this._pts[n];return t}computeOverlaps(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.computeOverlaps(this._start,this._end,t,t._start,t._end,e)}else if(arguments.length===6){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5];if(e-t===1&&s-i===1)return o.overlap(this,t,n,i),null;if(!this.overlaps(t,e,n,i,s))return null;const a=Math.trunc((t+e)/2),l=Math.trunc((i+s)/2);t<a&&(i<l&&this.computeOverlaps(t,a,n,i,l,o),l<s&&this.computeOverlaps(t,a,n,l,s,o)),a<e&&(i<l&&this.computeOverlaps(a,e,n,i,l,o),l<s&&this.computeOverlaps(a,e,n,l,s,o))}}setId(t){this._id=t}select(t,e){this.computeSelect(t,this._start,this._end,e)}getEnvelope(){if(this._env===null){const t=this._pts[this._start],e=this._pts[this._end];this._env=new ct(t,e)}return this._env}overlaps(t,e,n,i,s){return ct.intersects(this._pts[t],this._pts[e],n._pts[i],n._pts[s])}getEndIndex(){return this._end}getStartIndex(){return this._start}getContext(){return this._context}getId(){return this._id}};class Gt{static isNorthern(t){return t===Gt.NE||t===Gt.NW}static isOpposite(t,e){return t===e?!1:(t-e+4)%4===2}static commonHalfPlane(t,e){if(t===e)return t;if((t-e+4)%4===2)return-1;const i=t<e?t:e,s=t>e?t:e;return i===0&&s===3?3:i}static isInHalfPlane(t,e){return e===Gt.SE?t===Gt.SE||t===Gt.SW:t===e||t===e+1}static quadrant(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new ht("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Gt.NE:Gt.SE:e>=0?Gt.NW:Gt.SW}else if(arguments[0]instanceof w&&arguments[1]instanceof w){const t=arguments[0],e=arguments[1];if(e.x===t.x&&e.y===t.y)throw new ht("Cannot compute the quadrant for two identical points "+t);return e.x>=t.x?e.y>=t.y?Gt.NE:Gt.SE:e.y>=t.y?Gt.NW:Gt.SW}}}Gt.NE=0;Gt.NW=1;Gt.SW=2;Gt.SE=3;class ja{static findChainEnd(t,e){let n=e;for(;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;const i=Gt.quadrant(t[n],t[n+1]);let s=e+1;for(;s<t.length&&!(!t[s-1].equals2D(t[s])&&Gt.quadrant(t[s-1],t[s])!==i);)s++;return s-1}static getChains(){if(arguments.length===1){const t=arguments[0];return ja.getChains(t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=new F;let i=0;do{const s=ja.findChainEnd(t,i),o=new Cf(t,i,s,e);n.add(o),i=s}while(i<t.length-1);return n}}}class Fh{computeNodes(t){}getNodedSubstrings(){}}class Za{constructor(){Za.constructor_.apply(this,arguments)}static constructor_(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.setSegmentIntersector(t)}}}setSegmentIntersector(t){this._segInt=t}get interfaces_(){return[Fh]}}class Br extends Za{constructor(){super(),Br.constructor_.apply(this,arguments)}static constructor_(){if(this._monoChains=new F,this._index=new te,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){const t=arguments[0];Za.constructor_.call(this,t)}}}getMonotoneChains(){return this._monoChains}getNodedSubstrings(){return hi.getNodedSubstrings(this._nodedSegStrings)}getIndex(){return this._index}add(t){const e=ja.getChains(t.getCoordinates(),t);for(let n=e.iterator();n.hasNext();){const i=n.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}}computeNodes(t){this._nodedSegStrings=t;for(let e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()}intersectChains(){const t=new Sl(this._segInt);for(let e=this._monoChains.iterator();e.hasNext();){const n=e.next(),i=this._index.query(n.getEnvelope());for(let s=i.iterator();s.hasNext();){const o=s.next();if(o.getId()>n.getId()&&(n.computeOverlaps(o,t),this._nOverlaps++),this._segInt.isDone())return null}}}}class Sl extends Dh{constructor(){super(),Sl.constructor_.apply(this,arguments)}static constructor_(){this._si=null;const t=arguments[0];this._si=t}overlap(){if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=t.getContext(),o=n.getContext();this._si.processIntersections(s,e,o,i)}else return super.overlap.apply(this,arguments)}}Br.SegmentOverlapAction=Sl;class Bn extends ai{constructor(t,e){super(e?t+" [ "+e+" ]":t),this.pt=e?new w(e):void 0}getCoordinate(){return this.pt}}let Gh=class{processIntersections(t,e,n,i){}isDone(){}};class We{constructor(){We.constructor_.apply(this,arguments)}static constructor_(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._keepIntersections=!0,this._isInteriorIntersectionsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new F,this._intersectionCount=0;const t=arguments[0];this._li=t,this._interiorIntersection=null}static createAllIntersectionsFinder(t){const e=new We(t);return e.setFindAllIntersections(!0),e}static isInteriorVertexIntersection(){if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];return n&&i?!1:!!t.equals2D(e)}else if(arguments.length===8){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5],a=arguments[6],l=arguments[7];return!!(We.isInteriorVertexIntersection(t,n,s,a)||We.isInteriorVertexIntersection(t,i,s,l)||We.isInteriorVertexIntersection(e,n,o,a)||We.isInteriorVertexIntersection(e,i,o,l))}}static createInteriorIntersectionCounter(t){const e=new We(t);return e.setInteriorIntersectionsOnly(!0),e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e}static createIntersectionCounter(t){const e=new We(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e}static isEndSegment(t,e){return e===0||e>=t.size()-2}static createAnyIntersectionFinder(t){return new We(t)}static createInteriorIntersectionsFinder(t){const e=new We(t);return e.setFindAllIntersections(!0),e.setInteriorIntersectionsOnly(!0),e}setCheckEndSegmentsOnly(t){this._isCheckEndSegmentsOnly=t}getIntersectionSegments(){return this._intSegments}count(){return this._intersectionCount}getIntersections(){return this._intersections}setFindAllIntersections(t){this._findAllIntersections=t}setKeepIntersections(t){this._keepIntersections=t}getIntersection(){return this._interiorIntersection}processIntersections(t,e,n,i){if(!this._findAllIntersections&&this.hasIntersection())return null;const s=t===n;if(s&&e===i||this._isCheckEndSegmentsOnly&&!(We.isEndSegment(t,e)||We.isEndSegment(n,i)))return null;const a=t.getCoordinate(e),l=t.getCoordinate(e+1),c=n.getCoordinate(i),h=n.getCoordinate(i+1),u=e===0,d=e+2===t.size(),f=i===0,p=i+2===n.size();this._li.computeIntersection(a,l,c,h);const m=this._li.hasIntersection()&&this._li.isInteriorIntersection();let I=!1;this._isInteriorIntersectionsOnly||(I=!(s&&Math.abs(i-e)<=1)&&We.isInteriorVertexIntersection(a,l,c,h,u,d,f,p)),(m||I)&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=l,this._intSegments[2]=c,this._intSegments[3]=h,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)}hasIntersection(){return this._interiorIntersection!==null}isDone(){return this._findAllIntersections?!1:this._interiorIntersection!==null}setInteriorIntersectionsOnly(t){this._isInteriorIntersectionsOnly=t}get interfaces_(){return[Gh]}}class Ua{constructor(){Ua.constructor_.apply(this,arguments)}static constructor_(){this._li=new Me,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;const t=arguments[0];this._segStrings=t}static computeIntersections(t){const e=new Ua(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()}execute(){if(this._segInt!==null)return null;this.checkInteriorIntersections()}getIntersections(){return this._segInt.getIntersections()}isValid(){return this.execute(),this._isValid}setFindAllIntersections(t){this._findAllIntersections=t}checkInteriorIntersections(){this._isValid=!0,this._segInt=new We(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);const t=new Br;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null}checkValid(){if(this.execute(),!this._isValid)throw new Bn(this.getErrorMessage(),this._segInt.getIntersection())}getErrorMessage(){if(this._isValid)return"no intersections found";const t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+di.toLineString(t[0],t[1])+" and "+di.toLineString(t[2],t[3])}}class ro{constructor(){ro.constructor_.apply(this,arguments)}static constructor_(){this._nv=null;const t=arguments[0];this._nv=new Ua(ro.toSegmentStrings(t))}static toSegmentStrings(t){const e=new F;for(let n=t.iterator();n.hasNext();){const i=n.next();e.add(new Oh(i.getCoordinates(),i))}return e}static checkValid(t){new ro(t).checkValid()}checkValid(){this._nv.checkValid()}}class P{static opposite(t){return t===P.LEFT?P.RIGHT:t===P.RIGHT?P.LEFT:t}}P.ON=0;P.LEFT=1;P.RIGHT=2;class Be{constructor(){Be.constructor_.apply(this,arguments)}static constructor_(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){const t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){const t=arguments[0];this.init(1),this.location[P.ON]=t}else if(arguments[0]instanceof Be){const t=arguments[0];if(this.init(t.location.length),t!==null)for(let e=0;e<this.location.length;e++)this.location[e]=t.location[e]}}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this.init(3),this.location[P.ON]=t,this.location[P.LEFT]=e,this.location[P.RIGHT]=n}}setAllLocations(t){for(let e=0;e<this.location.length;e++)this.location[e]=t}isNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]!==y.NONE)return!1;return!0}setAllLocationsIfNull(t){for(let e=0;e<this.location.length;e++)this.location[e]===y.NONE&&(this.location[e]=t)}isLine(){return this.location.length===1}merge(t){if(t.location.length>this.location.length){const e=new Array(3).fill(null);e[P.ON]=this.location[P.ON],e[P.LEFT]=y.NONE,e[P.RIGHT]=y.NONE,this.location=e}for(let e=0;e<this.location.length;e++)this.location[e]===y.NONE&&e<t.location.length&&(this.location[e]=t.location[e])}getLocations(){return this.location}flip(){if(this.location.length<=1)return null;const t=this.location[P.LEFT];this.location[P.LEFT]=this.location[P.RIGHT],this.location[P.RIGHT]=t}toString(){const t=new Co;return this.location.length>1&&t.append(y.toLocationSymbol(this.location[P.LEFT])),t.append(y.toLocationSymbol(this.location[P.ON])),this.location.length>1&&t.append(y.toLocationSymbol(this.location[P.RIGHT])),t.toString()}setLocations(t,e,n){this.location[P.ON]=t,this.location[P.LEFT]=e,this.location[P.RIGHT]=n}get(t){return t<this.location.length?this.location[t]:y.NONE}isArea(){return this.location.length>1}isAnyNull(){for(let t=0;t<this.location.length;t++)if(this.location[t]===y.NONE)return!0;return!1}setLocation(){if(arguments.length===1){const t=arguments[0];this.setLocation(P.ON,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.location[t]=e}}init(t){this.location=new Array(t).fill(null),this.setAllLocations(y.NONE)}isEqualOnSide(t,e){return this.location[e]===t.location[e]}allPositionsEqual(t){for(let e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0}}class Ut{constructor(){Ut.constructor_.apply(this,arguments)}static constructor_(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){const t=arguments[0];this.elt[0]=new Be(t),this.elt[1]=new Be(t)}else if(arguments[0]instanceof Ut){const t=arguments[0];this.elt[0]=new Be(t.elt[0]),this.elt[1]=new Be(t.elt[1])}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[0]=new Be(y.NONE),this.elt[1]=new Be(y.NONE),this.elt[t].setLocation(e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this.elt[0]=new Be(t,e,n),this.elt[1]=new Be(t,e,n)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.elt[0]=new Be(y.NONE,y.NONE,y.NONE),this.elt[1]=new Be(y.NONE,y.NONE,y.NONE),this.elt[t].setLocations(e,n,i)}}static toLineLabel(t){const e=new Ut(y.NONE);for(let n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e}getGeometryCount(){let t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t}setAllLocations(t,e){this.elt[t].setAllLocations(e)}isNull(t){return this.elt[t].isNull()}setAllLocationsIfNull(){if(arguments.length===1){const t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[t].setAllLocationsIfNull(e)}}isLine(t){return this.elt[t].isLine()}merge(t){for(let e=0;e<2;e++)this.elt[e]===null&&t.elt[e]!==null?this.elt[e]=new Be(t.elt[e]):this.elt[e].merge(t.elt[e])}flip(){this.elt[0].flip(),this.elt[1].flip()}getLocation(){if(arguments.length===1){const t=arguments[0];return this.elt[t].get(P.ON)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.elt[t].get(e)}}toString(){const t=new Co;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()}isArea(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){const t=arguments[0];return this.elt[t].isArea()}}isAnyNull(t){return this.elt[t].isAnyNull()}setLocation(){if(arguments.length===2){const t=arguments[0],e=arguments[1];this.elt[t].setLocation(P.ON,e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this.elt[t].setLocation(e,n)}}isEqualOnSide(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)}allPositionsEqual(t,e){return this.elt[t].allPositionsEqual(e)}toLine(t){this.elt[t].isArea()&&(this.elt[t]=new Be(this.elt[t].location[0]))}}class Dr{constructor(){Dr.constructor_.apply(this,arguments)}static constructor_(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new F,this._pts=new F,this._label=new Ut(y.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new F,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){const t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()}}}computeRing(){if(this._ring!==null)return null;const t=new Array(this._pts.size()).fill(null);for(let e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=J.isCCW(this._ring.getCoordinates())}isIsolated(){return this._label.getGeometryCount()===1}computePoints(t){this._startDe=t;let e=t,n=!0;do{if(e===null)throw new Bn("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Bn("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);const i=e.getLabel();et.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)}getLinearRing(){return this._ring}getCoordinate(t){return this._pts.get(t)}computeMaxNodeDegree(){this._maxNodeDegree=0;let t=this._startDe;do{const n=t.getNode().getEdges().getOutgoingDegree(this);n>this._maxNodeDegree&&(this._maxNodeDegree=n),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2}addPoints(t,e,n){const i=t.getCoordinates();if(e){let s=1;n&&(s=0);for(let o=s;o<i.length;o++)this._pts.add(i[o])}else{let s=i.length-2;n&&(s=i.length-1);for(let o=s;o>=0;o--)this._pts.add(i[o])}}isHole(){return this._isHole}setInResult(){let t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)}containsPoint(t){const e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t)||!wn.isInRing(t,e.getCoordinates()))return!1;for(let i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(t))return!1;return!0}addHole(t){this._holes.add(t)}isShell(){return this._shell===null}getLabel(){return this._label}getEdges(){return this._edges}getMaxNodeDegree(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}getShell(){return this._shell}mergeLabel(){if(arguments.length===1){const t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t.getLocation(e,P.RIGHT);if(n===y.NONE)return null;if(this._label.getLocation(e)===y.NONE)return this._label.setLocation(e,n),null}}setShell(t){this._shell=t,t!==null&&t.addHole(this)}toPolygon(t){const e=new Array(this._holes.size()).fill(null);for(let i=0;i<this._holes.size();i++)e[i]=this._holes.get(i).getLinearRing();return t.createPolygon(this.getLinearRing(),e)}}class kh extends Dr{constructor(){super(),kh.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];Dr.constructor_.call(this,t,e)}setEdgeRing(t,e){t.setMinEdgeRing(e)}getNext(t){return t.getNextMin()}}class Ll extends Dr{constructor(){super(),Ll.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];Dr.constructor_.call(this,t,e)}buildMinimalRings(){const t=new F;let e=this._startDe;do{if(e.getMinEdgeRing()===null){const n=new kh(e,this._geometryFactory);t.add(n)}e=e.getNext()}while(e!==this._startDe);return t}setEdgeRing(t,e){t.setEdgeRing(e)}linkDirectedEdgesForMinimalEdgeRings(){let t=this._startDe;do t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext();while(t!==this._startDe)}getNext(t){return t.getNext()}}class bl{constructor(){bl.constructor_.apply(this,arguments)}static constructor_(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this._label=t}}}setVisited(t){this._isVisited=t}setInResult(t){this._isInResult=t}isCovered(){return this._isCovered}isCoveredSet(){return this._isCoveredSet}setLabel(t){this._label=t}getLabel(){return this._label}setCovered(t){this._isCovered=t,this._isCoveredSet=!0}updateIM(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)}isInResult(){return this._isInResult}isVisited(){return this._isVisited}}class Gi extends bl{constructor(){super(),Gi.constructor_.apply(this,arguments)}static constructor_(){this._coord=null,this._edges=null;const t=arguments[0],e=arguments[1];this._coord=t,this._edges=e,this._label=new Ut(0,y.NONE)}isIncidentEdgeInResult(){for(let t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1}isIsolated(){return this._label.getGeometryCount()===1}getCoordinate(){return this._coord}print(t){t.println("node "+this._coord+" lbl: "+this._label)}computeIM(t){}computeMergedLocation(t,e){let n=y.NONE;if(n=this._label.getLocation(e),!t.isNull(e)){const i=t.getLocation(e);n!==y.BOUNDARY&&(n=i)}return n}setLabel(){if(arguments.length===2&&Number.isInteger(arguments[1])&&Number.isInteger(arguments[0])){const t=arguments[0],e=arguments[1];this._label===null?this._label=new Ut(t,e):this._label.setLocation(t,e)}else return super.setLabel.apply(this,arguments)}getEdges(){return this._edges}mergeLabel(){if(arguments[0]instanceof Gi){const t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Ut){const t=arguments[0];for(let e=0;e<2;e++){const n=this.computeMergedLocation(t,e);this._label.getLocation(e)===y.NONE&&this._label.setLocation(e,n)}}}add(t){this._edges.insert(t),t.setNode(this)}setLabelBoundary(t){if(this._label===null)return null;let e=y.NONE;this._label!==null&&(e=this._label.getLocation(t));let n=null;switch(e){case y.BOUNDARY:n=y.INTERIOR;break;case y.INTERIOR:n=y.BOUNDARY;break;default:n=y.BOUNDARY;break}this._label.setLocation(t,n)}}class Fr{constructor(){Fr.constructor_.apply(this,arguments)}static constructor_(){this.nodeMap=new fi,this.nodeFact=null;const t=arguments[0];this.nodeFact=t}find(t){return this.nodeMap.get(t)}addNode(){if(arguments[0]instanceof w){const t=arguments[0];let e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof Gi){const t=arguments[0],e=this.nodeMap.get(t.getCoordinate());return e===null?(this.nodeMap.put(t.getCoordinate(),t),t):(e.mergeLabel(t),e)}}print(t){for(let e=this.iterator();e.hasNext();)e.next().print(t)}iterator(){return this.nodeMap.values().iterator()}values(){return this.nodeMap.values()}getBoundaryNodes(t){const e=new F;for(let n=this.iterator();n.hasNext();){const i=n.next();i.getLabel().getLocation(t)===y.BOUNDARY&&e.add(i)}return e}add(t){const e=t.getCoordinate();this.addNode(e).add(t)}}class ui{constructor(){ui.constructor_.apply(this,arguments)}static constructor_(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){const t=arguments[0];this._edge=t}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];ui.constructor_.call(this,t,e,n,null)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];ui.constructor_.call(this,t),this.init(e,n),this._label=i}}compareDirection(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:J.index(t._p0,t._p1,this._p1)}getDy(){return this._dy}getCoordinate(){return this._p0}setNode(t){this._node=t}print(t){const e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),s=n.substring(i+1);t.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)}compareTo(t){const e=t;return this.compareDirection(e)}getDirectedCoordinate(){return this._p1}getDx(){return this._dx}getLabel(){return this._label}getEdge(){return this._edge}getQuadrant(){return this._quadrant}getNode(){return this._node}toString(){const t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label}computeLabel(t){}init(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Gt.quadrant(this._dx,this._dy),et.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}get interfaces_(){return[sn]}}class wo extends ui{constructor(){super(),wo.constructor_.apply(this,arguments)}static constructor_(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];const t=arguments[0],e=arguments[1];if(ui.constructor_.call(this,t),this._isForward=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{const n=t.getNumPoints()-1;this.init(t.getCoordinate(n),t.getCoordinate(n-1))}this.computeDirectedLabel()}static depthFactor(t,e){return t===y.EXTERIOR&&e===y.INTERIOR?1:t===y.INTERIOR&&e===y.EXTERIOR?-1:0}getNextMin(){return this._nextMin}getDepth(t){return this._depth[t]}setVisited(t){this._isVisited=t}computeDirectedLabel(){this._label=new Ut(this._edge.getLabel()),this._isForward||this._label.flip()}getNext(){return this._next}setDepth(t,e){if(this._depth[t]!==-999&&this._depth[t]!==e)throw new Bn("assigned depths do not match",this.getCoordinate());this._depth[t]=e}isInteriorAreaEdge(){let t=!0;for(let e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,P.LEFT)===y.INTERIOR&&this._label.getLocation(e,P.RIGHT)===y.INTERIOR||(t=!1);return t}setNextMin(t){this._nextMin=t}print(t){super.print.call(this,t),t.print(" "+this._depth[P.LEFT]+"/"+this._depth[P.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")}setMinEdgeRing(t){this._minEdgeRing=t}isLineEdge(){const t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,y.EXTERIOR),n=!this._label.isArea(1)||this._label.allPositionsEqual(1,y.EXTERIOR);return t&&e&&n}setEdgeRing(t){this._edgeRing=t}getMinEdgeRing(){return this._minEdgeRing}getDepthDelta(){let t=this._edge.getDepthDelta();return this._isForward||(t=-t),t}setInResult(t){this._isInResult=t}getSym(){return this._sym}isForward(){return this._isForward}getEdge(){return this._edge}printEdge(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)}setSym(t){this._sym=t}setVisitedEdge(t){this.setVisited(t),this._sym.setVisited(t)}setEdgeDepths(t,e){let n=this.getEdge().getDepthDelta();this._isForward||(n=-n);let i=1;t===P.LEFT&&(i=-1);const s=P.opposite(t),o=n*i,a=e+o;this.setDepth(t,e),this.setDepth(s,a)}getEdgeRing(){return this._edgeRing}isInResult(){return this._isInResult}setNext(t){this._next=t}isVisited(){return this._isVisited}}class Yh{createNode(t){return new Gi(t,null)}}class Js{constructor(){Js.constructor_.apply(this,arguments)}static constructor_(){if(this._edges=new F,this._nodes=null,this._edgeEndList=new F,arguments.length===0)this._nodes=new Fr(new Yh);else if(arguments.length===1){const t=arguments[0];this._nodes=new Fr(t)}}static linkResultDirectedEdges(t){for(let e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()}printEdges(t){t.println("Edges:");for(let e=0;e<this._edges.size();e++){t.println("edge "+e+":");const n=this._edges.get(e);n.print(t),n.eiList.print(t)}}find(t){return this._nodes.find(t)}addNode(){if(arguments[0]instanceof Gi){const t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof w){const t=arguments[0];return this._nodes.addNode(t)}}getNodeIterator(){return this._nodes.iterator()}linkResultDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()}debugPrintln(t){en.out.println(t)}isBoundaryNode(t,e){const n=this._nodes.find(e);if(n===null)return!1;const i=n.getLabel();return i!==null&&i.getLocation(t)===y.BOUNDARY}linkAllDirectedEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()}matchInSameDirection(t,e,n,i){return t.equals(n)?J.index(t,e,i)===J.COLLINEAR&&Gt.quadrant(t,e)===Gt.quadrant(n,i):!1}getEdgeEnds(){return this._edgeEndList}debugPrint(t){en.out.print(t)}getEdgeIterator(){return this._edges.iterator()}findEdgeInSameDirection(t,e){for(let n=0;n<this._edges.size();n++){const i=this._edges.get(n),s=i.getCoordinates();if(this.matchInSameDirection(t,e,s[0],s[1])||this.matchInSameDirection(t,e,s[s.length-1],s[s.length-2]))return i}return null}insertEdge(t){this._edges.add(t)}findEdgeEnd(t){for(let e=this.getEdgeEnds().iterator();e.hasNext();){const n=e.next();if(n.getEdge()===t)return n}return null}addEdges(t){for(let e=t.iterator();e.hasNext();){const n=e.next();this._edges.add(n);const i=new wo(n,!0),s=new wo(n,!1);i.setSym(s),s.setSym(i),this.add(i),this.add(s)}}add(t){this._nodes.add(t),this._edgeEndList.add(t)}getNodes(){return this._nodes.values()}findEdge(t,e){for(let n=0;n<this._edges.size();n++){const i=this._edges.get(n),s=i.getCoordinates();if(t.equals(s[0])&&e.equals(s[1]))return i}return null}}class To{constructor(){To.constructor_.apply(this,arguments)}static constructor_(){this._geometryFactory=null,this._shellList=new F;const t=arguments[0];this._geometryFactory=t}static findEdgeRingContaining(t,e){const n=t.getLinearRing(),i=n.getEnvelopeInternal();let s=n.getCoordinateN(0),o=null,a=null;for(let l=e.iterator();l.hasNext();){const c=l.next(),h=c.getLinearRing(),u=h.getEnvelopeInternal();if(u.equals(i)||!u.contains(i))continue;s=kt.ptNotInList(n.getCoordinates(),h.getCoordinates());let d=!1;wn.isInRing(s,h.getCoordinates())&&(d=!0),d&&(o===null||a.contains(u))&&(o=c,a=o.getLinearRing().getEnvelopeInternal())}return o}sortShellsAndHoles(t,e,n){for(let i=t.iterator();i.hasNext();){const s=i.next();s.isHole()?n.add(s):e.add(s)}}computePolygons(t){const e=new F;for(let n=t.iterator();n.hasNext();){const s=n.next().toPolygon(this._geometryFactory);e.add(s)}return e}placeFreeHoles(t,e){for(let n=e.iterator();n.hasNext();){const i=n.next();if(i.getShell()===null){const s=To.findEdgeRingContaining(i,t);if(s===null)throw new Bn("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(s)}}}buildMinimalEdgeRings(t,e,n){const i=new F;for(let s=t.iterator();s.hasNext();){const o=s.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();const a=o.buildMinimalRings(),l=this.findShell(a);l!==null?(this.placePolygonHoles(l,a),e.add(l)):n.addAll(a)}else i.add(o)}return i}buildMaximalEdgeRings(t){const e=new F;for(let n=t.iterator();n.hasNext();){const i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){const s=new Ll(i,this._geometryFactory);e.add(s),s.setInResult()}}return e}placePolygonHoles(t,e){for(let n=e.iterator();n.hasNext();){const i=n.next();i.isHole()&&i.setShell(t)}}getPolygons(){return this.computePolygons(this._shellList)}findShell(t){let e=0,n=null;for(let i=t.iterator();i.hasNext();){const s=i.next();s.isHole()||(n=s,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n}add(){if(arguments.length===1){const t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){const t=arguments[0],e=arguments[1];Js.linkResultDirectedEdges(e);const n=this.buildMaximalEdgeRings(t),i=new F,s=this.buildMinimalEdgeRings(n,this._shellList,i);this.sortShellsAndHoles(s,this._shellList,i),this.placeFreeHoles(this._shellList,i)}}}class zh{constructor(){zh.constructor_.apply(this,arguments)}static constructor_(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new F,this._resultLineList=new F;const t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n}collectLines(t){for(let e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){const n=e.next();this.collectLineEdge(n,t,this._lineEdgesList),this.collectBoundaryTouchEdge(n,t,this._lineEdgesList)}}labelIsolatedLine(t,e){const n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)}build(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList}collectLineEdge(t,e,n){const i=t.getLabel(),s=t.getEdge();t.isLineEdge()&&!t.isVisited()&&K.isResultOfOp(i,e)&&!s.isCovered()&&(n.add(s),t.setVisitedEdge(!0))}findCoveredLineEdges(){for(let t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(let t=this._op.getGraph().getEdgeEnds().iterator();t.hasNext();){const e=t.next(),n=e.getEdge();if(e.isLineEdge()&&!n.isCoveredSet()){const i=this._op.isCoveredByA(e.getCoordinate());n.setCovered(i)}}}labelIsolatedLines(t){for(let e=t.iterator();e.hasNext();){const n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}}buildLines(t){for(let e=this._lineEdgesList.iterator();e.hasNext();){const n=e.next(),i=this._geometryFactory.createLineString(n.getCoordinates());this._resultLineList.add(i),n.setInResult(!0)}}collectBoundaryTouchEdge(t,e,n){const i=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),K.isResultOfOp(i,e)&&e===K.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))}}class Xh{constructor(){Xh.constructor_.apply(this,arguments)}static constructor_(){this._op=null,this._geometryFactory=null,this._resultPointList=new F;const t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e}filterCoveredNodeToPoint(t){const e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){const n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}}extractNonCoveredResultNodes(t){for(let e=this._op.getGraph().getNodes().iterator();e.hasNext();){const n=e.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||t===K.INTERSECTION)){const i=n.getLabel();K.isResultOfOp(i,t)&&this.filterCoveredNodeToPoint(n)}}}build(t){return this.extractNonCoveredResultNodes(t),this._resultPointList}}class wf{locate(t){}}class Cn{constructor(){Cn.constructor_.apply(this,arguments)}static constructor_(){this._geom=null;const t=arguments[0];this._geom=t}static locatePointInPolygon(t,e){if(e.isEmpty())return y.EXTERIOR;const n=e.getExteriorRing(),i=Cn.locatePointInRing(t,n);if(i!==y.INTERIOR)return i;for(let s=0;s<e.getNumInteriorRing();s++){const o=e.getInteriorRingN(s),a=Cn.locatePointInRing(t,o);if(a===y.BOUNDARY)return y.BOUNDARY;if(a===y.INTERIOR)return y.EXTERIOR}return y.INTERIOR}static locatePointInRing(t,e){return e.getEnvelopeInternal().intersects(t)?wn.locateInRing(t,e.getCoordinates()):y.EXTERIOR}static containsPointInPolygon(t,e){return y.EXTERIOR!==Cn.locatePointInPolygon(t,e)}static locateInGeometry(t,e){if(e instanceof jt)return Cn.locatePointInPolygon(t,e);if(e instanceof St){const n=new Cr(e);for(;n.hasNext();){const i=n.next();if(i!==e){const s=Cn.locateInGeometry(t,i);if(s!==y.EXTERIOR)return s}}}return y.EXTERIOR}static isContained(t,e){return y.EXTERIOR!==Cn.locate(t,e)}static locate(t,e){return e.isEmpty()||!e.getEnvelopeInternal().intersects(t)?y.EXTERIOR:Cn.locateInGeometry(t,e)}locate(t){return Cn.locate(t,this._geom)}get interfaces_(){return[wf]}}class vl{constructor(){vl.constructor_.apply(this,arguments)}static constructor_(){this._edgeMap=new fi,this._edgeList=null,this._ptInAreaLocation=[y.NONE,y.NONE]}getNextCW(t){this.getEdges();const e=this._edgeList.indexOf(t);let n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)}propagateSideLabels(t){let e=y.NONE;for(let i=this.iterator();i.hasNext();){const o=i.next().getLabel();o.isArea(t)&&o.getLocation(t,P.LEFT)!==y.NONE&&(e=o.getLocation(t,P.LEFT))}if(e===y.NONE)return null;let n=e;for(let i=this.iterator();i.hasNext();){const s=i.next(),o=s.getLabel();if(o.getLocation(t,P.ON)===y.NONE&&o.setLocation(t,P.ON,n),o.isArea(t)){const a=o.getLocation(t,P.LEFT),l=o.getLocation(t,P.RIGHT);if(l!==y.NONE){if(l!==n)throw new Bn("side location conflict",s.getCoordinate());a===y.NONE&&et.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),n=a}else et.isTrue(o.getLocation(t,P.LEFT)===y.NONE,"found single null side"),o.setLocation(t,P.RIGHT,n),o.setLocation(t,P.LEFT,n)}}}getCoordinate(){const t=this.iterator();return t.hasNext()?t.next().getCoordinate():null}print(t){en.out.println("EdgeEndStar:   "+this.getCoordinate());for(let e=this.iterator();e.hasNext();)e.next().print(t)}isAreaLabelsConsistent(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}checkAreaLabelsConsistent(t){const e=this.getEdges();if(e.size()<=0)return!0;const n=e.size()-1,s=e.get(n).getLabel().getLocation(t,P.LEFT);et.isTrue(s!==y.NONE,"Found unlabelled area edge");let o=s;for(let a=this.iterator();a.hasNext();){const c=a.next().getLabel();et.isTrue(c.isArea(t),"Found non-area edge");const h=c.getLocation(t,P.LEFT),u=c.getLocation(t,P.RIGHT);if(h===u||u!==o)return!1;o=h}return!0}findIndex(t){this.iterator();for(let e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1}iterator(){return this.getEdges().iterator()}getEdges(){return this._edgeList===null&&(this._edgeList=new F(this._edgeMap.values())),this._edgeList}getLocation(t,e,n){return this._ptInAreaLocation[t]===y.NONE&&(this._ptInAreaLocation[t]=Cn.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]}toString(){const t=new Co;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(let e=this.iterator();e.hasNext();){const n=e.next();t.append(n),t.append(`
`)}return t.toString()}computeEdgeEndLabels(t){for(let e=this.iterator();e.hasNext();)e.next().computeLabel(t)}computeLabelling(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);const e=[!1,!1];for(let n=this.iterator();n.hasNext();){const s=n.next().getLabel();for(let o=0;o<2;o++)s.isLine(o)&&s.getLocation(o)===y.BOUNDARY&&(e[o]=!0)}for(let n=this.iterator();n.hasNext();){const i=n.next(),s=i.getLabel();for(let o=0;o<2;o++)if(s.isAnyNull(o)){let a=y.NONE;if(e[o])a=y.EXTERIOR;else{const l=i.getCoordinate();a=this.getLocation(o,l,t)}s.setAllLocationsIfNull(o,a)}}}getDegree(){return this._edgeMap.size()}insertEdgeEnd(t,e){this._edgeMap.put(t,e),this._edgeList=null}}class Wh extends vl{constructor(){super(),Wh.constructor_.apply(this,arguments)}static constructor_(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}linkResultDirectedEdges(){this.getResultAreaEdges();let t=null,e=null,n=this._SCANNING_FOR_INCOMING;for(let i=0;i<this._resultAreaEdgeList.size();i++){const s=this._resultAreaEdgeList.get(i),o=s.getSym();if(s.getLabel().isArea())switch(t===null&&s.isInResult()&&(t=s),n){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!s.isInResult())continue;e.setNext(s),n=this._SCANNING_FOR_INCOMING;break}}if(n===this._LINKING_TO_OUTGOING){if(t===null)throw new Bn("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}}insert(t){const e=t;this.insertEdgeEnd(e,e)}getRightmostEdge(){const t=this.getEdges(),e=t.size();if(e<1)return null;const n=t.get(0);if(e===1)return n;const i=t.get(e-1),s=n.getQuadrant(),o=i.getQuadrant();return Gt.isNorthern(s)&&Gt.isNorthern(o)?n:!Gt.isNorthern(s)&&!Gt.isNorthern(o)?i:n.getDy()!==0?n:i.getDy()!==0?i:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null)}print(t){en.out.println("DirectedEdgeStar: "+this.getCoordinate());for(let e=this.iterator();e.hasNext();){const n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}}getResultAreaEdges(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new F;for(let t=this.iterator();t.hasNext();){const e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList}updateLabelling(t){for(let e=this.iterator();e.hasNext();){const i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}}linkAllDirectedEdges(){this.getEdges();let t=null,e=null;for(let n=this._edgeList.size()-1;n>=0;n--){const i=this._edgeList.get(n),s=i.getSym();e===null&&(e=s),t!==null&&s.setNext(t),t=i}e.setNext(t)}computeDepths(){if(arguments.length===1){const t=arguments[0],e=this.findIndex(t),n=t.getDepth(P.LEFT),i=t.getDepth(P.RIGHT),s=this.computeDepths(e+1,this._edgeList.size(),n);if(this.computeDepths(0,e,s)!==i)throw new Bn("depth mismatch at "+t.getCoordinate())}else if(arguments.length===3){const t=arguments[0],e=arguments[1];let i=arguments[2];for(let s=t;s<e;s++){const o=this._edgeList.get(s);o.setEdgeDepths(P.RIGHT,i),i=o.getDepth(P.LEFT)}return i}}mergeSymLabels(){for(let t=this.iterator();t.hasNext();){const e=t.next();e.getLabel().merge(e.getSym().getLabel())}}linkMinimalDirectedEdges(t){let e=null,n=null,i=this._SCANNING_FOR_INCOMING;for(let s=this._resultAreaEdgeList.size()-1;s>=0;s--){const o=this._resultAreaEdgeList.get(s),a=o.getSym();switch(e===null&&o.getEdgeRing()===t&&(e=o),i){case this._SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;n=a,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;n.setNextMin(o),i=this._SCANNING_FOR_INCOMING;break}}i===this._LINKING_TO_OUTGOING&&(et.isTrue(e!==null,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))}getOutgoingDegree(){if(arguments.length===0){let t=0;for(let e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}else if(arguments.length===1){const t=arguments[0];let e=0;for(let n=this.iterator();n.hasNext();)n.next().getEdgeRing()===t&&e++;return e}}getLabel(){return this._label}findCoveredLineEdges(){let t=y.NONE;for(let n=this.iterator();n.hasNext();){const i=n.next(),s=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=y.INTERIOR;break}if(s.isInResult()){t=y.EXTERIOR;break}}}if(t===y.NONE)return null;let e=t;for(let n=this.iterator();n.hasNext();){const i=n.next(),s=i.getSym();i.isLineEdge()?i.getEdge().setCovered(e===y.INTERIOR):(i.isInResult()&&(e=y.EXTERIOR),s.isInResult()&&(e=y.INTERIOR))}}computeLabelling(t){super.computeLabelling.call(this,t),this._label=new Ut(y.NONE);for(let e=this.iterator();e.hasNext();){const s=e.next().getEdge().getLabel();for(let o=0;o<2;o++){const a=s.getLocation(o);(a===y.INTERIOR||a===y.BOUNDARY)&&this._label.setLocation(o,y.INTERIOR)}}}}class Bh extends Yh{constructor(){super()}createNode(t){return new Gi(t,new Wh)}}class jh{constructor(){jh.constructor_.apply(this,arguments)}static constructor_(){this.mce=null,this.chainIndex=null;const t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e}computeIntersections(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)}}class si{constructor(){si.constructor_.apply(this,arguments)}static constructor_(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){const t=arguments[0],e=arguments[1];this._eventType=si.DELETE,this._xValue=t,this._insertEvent=e}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._eventType=si.INSERT,this._label=t,this._xValue=e,this._obj=n}}isDelete(){return this._eventType===si.DELETE}setDeleteEventIndex(t){this._deleteEventIndex=t}getObject(){return this._obj}compareTo(t){const e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0}getInsertEvent(){return this._insertEvent}isInsert(){return this._eventType===si.INSERT}isSameLabel(t){return this._label===null?!1:this._label===t._label}getDeleteEventIndex(){return this._deleteEventIndex}get interfaces_(){return[sn]}}si.INSERT=1;si.DELETE=2;class fI{}class Ws{constructor(){Ws.constructor_.apply(this,arguments)}static constructor_(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;const t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n}static isAdjacentSegments(t,e){return Math.abs(t-e)===1}isTrivialIntersection(t,e,n,i){if(t===n&&this._li.getIntersectionNum()===1){if(Ws.isAdjacentSegments(e,i))return!0;if(t.isClosed()){const s=t.getNumPoints()-1;if(e===0&&i===s||i===0&&e===s)return!0}}return!1}getProperIntersectionPoint(){return this._properIntersectionPoint}setIsDoneIfProperInt(t){this._isDoneWhenProperInt=t}hasProperInteriorIntersection(){return this._hasProperInterior}isBoundaryPointInternal(t,e){for(let n=e.iterator();n.hasNext();){const s=n.next().getCoordinate();if(t.isIntersection(s))return!0}return!1}hasProperIntersection(){return this._hasProper}hasIntersection(){return this._hasIntersection}isDone(){return this._isDone}isBoundaryPoint(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))}setBoundaryNodes(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e}addIntersections(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;const s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],l=n.getCoordinates()[i+1];this._li.computeIntersection(s,o,a,l),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))}}class Zh extends fI{constructor(){super(),Zh.constructor_.apply(this,arguments)}static constructor_(){this.events=new F,this.nOverlaps=null}prepareEvents(){Fi.sort(this.events);for(let t=0;t<this.events.size();t++){const e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}}computeIntersections(){if(arguments.length===1){const t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(let e=0;e<this.events.size();e++){const n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Ws&&H(arguments[0],dn)&&H(arguments[1],dn)){const t=arguments[0],e=arguments[1],n=arguments[2];this.addEdges(t,t),this.addEdges(e,e),this.computeIntersections(n)}else if(typeof arguments[2]=="boolean"&&H(arguments[0],dn)&&arguments[1]instanceof Ws){const t=arguments[0],e=arguments[1];arguments[2]?this.addEdges(t,null):this.addEdges(t),this.computeIntersections(e)}}}addEdge(t,e){const n=t.getMonotoneChainEdge(),i=n.getStartIndexes();for(let s=0;s<i.length-1;s++){const o=new jh(n,s),a=new si(e,n.getMinX(s),o);this.events.add(a),this.events.add(new si(n.getMaxX(s),a))}}processOverlaps(t,e,n,i){const s=n.getObject();for(let o=t;o<e;o++){const a=this.events.get(o);if(a.isInsert()){const l=a.getObject();n.isSameLabel(a)||(s.computeIntersections(l,i),this.nOverlaps++)}}}addEdges(){if(arguments.length===1){const t=arguments[0];for(let e=t.iterator();e.hasNext();){const n=e.next();this.addEdge(n,n)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];for(let n=t.iterator();n.hasNext();){const i=n.next();this.addEdge(i,e)}}}}class jr{constructor(){jr.constructor_.apply(this,arguments)}static constructor_(){this._min=j.POSITIVE_INFINITY,this._max=j.NEGATIVE_INFINITY}getMin(){return this._min}intersects(t,e){return!(this._min>e||this._max<t)}getMax(){return this._max}toString(){return di.toLineString(new w(this._min,0),new w(this._max,0))}}class mI{compare(t,e){const n=t,i=e,s=(n._min+n._max)/2,o=(i._min+i._max)/2;return s<o?-1:s>o?1:0}get interfaces_(){return[gs]}}jr.NodeComparator=mI;class Uh extends jr{constructor(){super(),Uh.constructor_.apply(this,arguments)}static constructor_(){this._item=null;const t=arguments[0],e=arguments[1],n=arguments[2];this._min=t,this._max=e,this._item=n}query(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this._item)}}class Hh extends jr{constructor(){super(),Hh.constructor_.apply(this,arguments)}static constructor_(){this._node1=null,this._node2=null;const t=arguments[0],e=arguments[1];this._node1=t,this._node2=e,this.buildExtent(this._node1,this._node2)}buildExtent(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)}query(t,e,n){if(!this.intersects(t,e))return null;this._node1!==null&&this._node1.query(t,e,n),this._node2!==null&&this._node2.query(t,e,n)}}class Vh{constructor(){Vh.constructor_.apply(this,arguments)}static constructor_(){this._leaves=new F,this._root=null,this._level=0}buildTree(){Fi.sort(this._leaves,new jr.NodeComparator);let t=this._leaves,e=null,n=new F;for(;;){if(this.buildLevel(t,n),n.size()===1)return n.get(0);e=t,t=n,n=e}}insert(t,e,n){if(this._root!==null)throw new IllegalStateException("Index cannot be added to once it has been queried");this._leaves.add(new Uh(t,e,n))}query(t,e,n){if(this.init(),this._root===null)return null;this._root.query(t,e,n)}buildRoot(){if(this._root!==null)return null;this._root=this.buildTree()}printNode(t){en.out.println(di.toLineString(new w(t._min,this._level),new w(t._max,this._level)))}init(){if(this._root!==null||this._leaves.size()===0)return null;this.buildRoot()}buildLevel(t,e){this._level++,e.clear();for(let n=0;n<t.size();n+=2){const i=t.get(n);if((n+1<t.size()?t.get(n):null)===null)e.add(i);else{const o=new Hh(t.get(n),t.get(n+1));e.add(o)}}}}class qh{constructor(){qh.constructor_.apply(this,arguments)}static constructor_(){this._items=new F}visitItem(t){this._items.add(t)}getItems(){return this._items}get interfaces_(){return[Tl]}}class Zr{constructor(){Zr.constructor_.apply(this,arguments)}static constructor_(){this._geom=null,this._index=null;const t=arguments[0];if(!(H(t,qs)||t instanceof ve))throw new ht("Argument must be Polygonal or LinearRing");this._geom=t}locate(t){this._index===null&&(this._index=new Ol(this._geom),this._geom=null);const e=new Ir(t),n=new Ml(e);return this._index.query(t.y,t.y,n),e.getLocation()}get interfaces_(){return[wf]}}class Ml{constructor(){Ml.constructor_.apply(this,arguments)}static constructor_(){this._counter=null;const t=arguments[0];this._counter=t}visitItem(t){const e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))}get interfaces_(){return[Tl]}}class Ol{constructor(){Ol.constructor_.apply(this,arguments)}static constructor_(){this._isEmpty=!1,this._index=new Vh;const t=arguments[0];t.isEmpty()?this._isEmpty=!0:this.init(t)}init(t){const e=je.getLines(t);for(let n=e.iterator();n.hasNext();){const s=n.next().getCoordinates();this.addLine(s)}}addLine(t){for(let e=1;e<t.length;e++){const n=new At(t[e-1],t[e]),i=Math.min(n.p0.y,n.p1.y),s=Math.max(n.p0.y,n.p1.y);this._index.insert(i,s,n)}}query(){if(arguments.length===2){const t=arguments[0],e=arguments[1];if(this._isEmpty)return new F;const n=new qh;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(this._isEmpty)return null;this._index.query(t,e,n)}}}Zr.SegmentVisitor=Ml;Zr.IntervalIndexedGeometry=Ol;class Kh{constructor(){Kh.constructor_.apply(this,arguments)}static constructor_(){this.coord=null,this.segmentIndex=null,this.dist=null;const t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new w(t),this.segmentIndex=e,this.dist=n}getSegmentIndex(){return this.segmentIndex}getCoordinate(){return this.coord}print(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)}compareTo(t){const e=t;return this.compare(e.segmentIndex,e.dist)}isEndPoint(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t}toString(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}getDistance(){return this.dist}compare(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0}get interfaces_(){return[sn]}}class Jh{constructor(){Jh.constructor_.apply(this,arguments)}static constructor_(){this._nodeMap=new fi,this.edge=null;const t=arguments[0];this.edge=t}print(t){t.println("Intersections:");for(let e=this.iterator();e.hasNext();)e.next().print(t)}iterator(){return this._nodeMap.values().iterator()}addSplitEdges(t){this.addEndpoints();const e=this.iterator();let n=e.next();for(;e.hasNext();){const i=e.next(),s=this.createSplitEdge(n,i);t.add(s),n=i}}addEndpoints(){const t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)}createSplitEdge(t,e){let n=e.segmentIndex-t.segmentIndex+2;const i=this.edge.pts[e.segmentIndex],s=e.dist>0||!e.coord.equals2D(i);s||n--;const o=new Array(n).fill(null);let a=0;o[a++]=new w(t.coord);for(let l=t.segmentIndex+1;l<=e.segmentIndex;l++)o[a++]=this.edge.pts[l];return s&&(o[a]=e.coord),new An(o,new Ut(this.edge._label))}add(t,e,n){const i=new Kh(t,e,n),s=this._nodeMap.get(i);return s!==null?s:(this._nodeMap.put(i,i),i)}isIntersection(t){for(let e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1}}class Ha{constructor(){Ha.constructor_.apply(this,arguments)}static constructor_(){if(this._data=null,this._size=0,arguments.length===0)Ha.constructor_.call(this,10);else if(arguments.length===1){const t=arguments[0];this._data=new Array(t).fill(null)}}size(){return this._size}addAll(t){if(t===null||t.length===0)return null;this.ensureCapacity(this._size+t.length),en.arraycopy(t,0,this._data,this._size,t.length),this._size+=t.length}ensureCapacity(t){if(t<=this._data.length)return null;const e=Math.max(t,this._data.length*2);this._data=as.copyOf(this._data,e)}toArray(){const t=new Array(this._size).fill(null);return en.arraycopy(this._data,0,t,0,this._size),t}add(t){this.ensureCapacity(this._size+1),this._data[this._size]=t,++this._size}}class $h{static toIntArray(t){const e=new Array(t.size()).fill(null);for(let n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e}getChainStartIndices(t){let e=0;const n=new Ha(Math.trunc(t.length/2));n.add(e);do{const i=this.findChainEnd(t,e);n.add(i),e=i}while(e<t.length-1);return n.toArray()}findChainEnd(t,e){const n=Gt.quadrant(t[e],t[e+1]);let i=e+1;for(;i<t.length&&Gt.quadrant(t[i-1],t[i])===n;)i++;return i-1}OLDgetChainStartIndices(t){let e=0;const n=new F;n.add(e);do{const s=this.findChainEnd(t,e);n.add(s),e=s}while(e<t.length-1);return $h.toIntArray(n)}}class Qh{constructor(){Qh.constructor_.apply(this,arguments)}static constructor_(){this.e=null,this.pts=null,this.startIndex=null;const t=arguments[0];this.e=t,this.pts=t.getCoordinates();const e=new $h;this.startIndex=e.getChainStartIndices(this.pts)}getCoordinates(){return this.pts}getMaxX(t){const e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n}getMinX(t){const e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n}computeIntersectsForChain(){if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],i)}else if(arguments.length===6){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=arguments[4],o=arguments[5];if(e-t===1&&s-i===1)return o.addIntersections(this.e,t,n.e,i),null;if(!this.overlaps(t,e,n,i,s))return null;const a=Math.trunc((t+e)/2),l=Math.trunc((i+s)/2);t<a&&(i<l&&this.computeIntersectsForChain(t,a,n,i,l,o),l<s&&this.computeIntersectsForChain(t,a,n,l,s,o)),a<e&&(i<l&&this.computeIntersectsForChain(a,e,n,i,l,o),l<s&&this.computeIntersectsForChain(a,e,n,l,s,o))}}overlaps(t,e,n,i,s){return ct.intersects(this.pts[t],this.pts[e],n.pts[i],n.pts[s])}getStartIndexes(){return this.startIndex}computeIntersects(t,e){for(let n=0;n<this.startIndex.length-1;n++)for(let i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)}}class Mn{constructor(){Mn.constructor_.apply(this,arguments)}static constructor_(){this._depth=Array(2).fill().map(()=>Array(3));for(let t=0;t<2;t++)for(let e=0;e<3;e++)this._depth[t][e]=Mn.NULL_VALUE}static depthAtLocation(t){return t===y.EXTERIOR?0:t===y.INTERIOR?1:Mn.NULL_VALUE}getDepth(t,e){return this._depth[t][e]}setDepth(t,e,n){this._depth[t][e]=n}isNull(){if(arguments.length===0){for(let t=0;t<2;t++)for(let e=0;e<3;e++)if(this._depth[t][e]!==Mn.NULL_VALUE)return!1;return!0}else if(arguments.length===1){const t=arguments[0];return this._depth[t][1]===Mn.NULL_VALUE}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return this._depth[t][e]===Mn.NULL_VALUE}}normalize(){for(let t=0;t<2;t++)if(!this.isNull(t)){let e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(let n=1;n<3;n++){let i=0;this._depth[t][n]>e&&(i=1),this._depth[t][n]=i}}}getDelta(t){return this._depth[t][P.RIGHT]-this._depth[t][P.LEFT]}getLocation(t,e){return this._depth[t][e]<=0?y.EXTERIOR:y.INTERIOR}toString(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}add(){if(arguments.length===1){const t=arguments[0];for(let e=0;e<2;e++)for(let n=1;n<3;n++){const i=t.getLocation(e,n);(i===y.EXTERIOR||i===y.INTERIOR)&&(this.isNull(e,n)?this._depth[e][n]=Mn.depthAtLocation(i):this._depth[e][n]+=Mn.depthAtLocation(i))}}else if(arguments.length===3){const t=arguments[0],e=arguments[1];arguments[2]===y.INTERIOR&&this._depth[t][e]++}}}Mn.NULL_VALUE=-1;class An extends bl{constructor(){super(),An.constructor_.apply(this,arguments)}static constructor_(){if(this.pts=null,this._env=null,this.eiList=new Jh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Mn,this._depthDelta=0,arguments.length===1){const t=arguments[0];An.constructor_.call(this,t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.pts=t,this._label=e}}static updateIM(){if(arguments.length===2&&arguments[1]instanceof Tt&&arguments[0]instanceof Ut){const t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,P.ON),t.getLocation(1,P.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,P.LEFT),t.getLocation(1,P.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,P.RIGHT),t.getLocation(1,P.RIGHT),2))}else return super.updateIM.apply(this,arguments)}getDepth(){return this._depth}getCollapsedEdge(){const t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new An(t,Ut.toLineLabel(this._label))}isIsolated(){return this._isIsolated}getCoordinates(){return this.pts}setIsolated(t){this._isIsolated=t}setName(t){this._name=t}equals(t){if(!(t instanceof An))return!1;const e=t;if(this.pts.length!==e.pts.length)return!1;let n=!0,i=!0,s=this.pts.length;for(let o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(e.pts[o])||(n=!1),this.pts[o].equals2D(e.pts[--s])||(i=!1),!n&&!i)return!1;return!0}getCoordinate(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){const t=arguments[0];return this.pts[t]}}print(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)}computeIM(t){An.updateIM(this._label,t)}isCollapsed(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])}isClosed(){return this.pts[0].equals(this.pts[this.pts.length-1])}getMaximumSegmentIndex(){return this.pts.length-1}getDepthDelta(){return this._depthDelta}getNumPoints(){return this.pts.length}printReverse(t){t.print("edge "+this._name+": ");for(let e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")}getMonotoneChainEdge(){return this._mce===null&&(this._mce=new Qh(this)),this._mce}getEnvelope(){if(this._env===null){this._env=new ct;for(let t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env}addIntersection(t,e,n,i){const s=new w(t.getIntersection(i));let o=e,a=t.getEdgeDistance(n,i);const l=o+1;if(l<this.pts.length){const c=this.pts[l];s.equals2D(c)&&(o=l,a=0)}this.eiList.add(s,o,a)}toString(){const t=new Il;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(let e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()}isPointwiseEqual(t){if(this.pts.length!==t.pts.length)return!1;for(let e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0}setDepthDelta(t){this._depthDelta=t}getEdgeIntersectionList(){return this.eiList}addIntersections(t,e,n){for(let i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)}}class un extends Js{constructor(){super(),un.constructor_.apply(this,arguments)}static constructor_(){if(this._parentGeom=null,this._lineEdgeMap=new mf,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ks,arguments.length===2){const t=arguments[0],e=arguments[1];un.constructor_.call(this,t,e,Re.OGC_SFS_BOUNDARY_RULE)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._argIndex=t,this._parentGeom=e,this._boundaryNodeRule=n,e!==null&&this.add(e)}}static determineBoundary(t,e){return t.isInBoundary(e)?y.BOUNDARY:y.INTERIOR}insertBoundaryPoint(t,e){const i=this._nodes.addNode(e).getLabel();let s=1,o=y.NONE;o=i.getLocation(t,P.ON),o===y.BOUNDARY&&s++;const a=un.determineBoundary(this._boundaryNodeRule,s);i.setLocation(t,a)}computeSelfNodes(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2],i=new Ws(t,!0,!1);i.setIsDoneIfProperInt(n);const s=this.createEdgeSetIntersector(),o=this._parentGeom instanceof ve||this._parentGeom instanceof jt||this._parentGeom instanceof nn,a=e||!o;return s.computeIntersections(this._edges,i,a),this.addSelfIntersectionNodes(this._argIndex),i}}computeSplitEdges(t){for(let e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)}computeEdgeIntersections(t,e,n){const i=new Ws(e,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,i),i}getGeometry(){return this._parentGeom}getBoundaryNodeRule(){return this._boundaryNodeRule}hasTooFewPoints(){return this._hasTooFewPoints}addPoint(){if(arguments[0]instanceof ee){const e=arguments[0].getCoordinate();this.insertPoint(this._argIndex,e,y.INTERIOR)}else if(arguments[0]instanceof w){const t=arguments[0];this.insertPoint(this._argIndex,t,y.INTERIOR)}}addPolygon(t){this.addPolygonRing(t.getExteriorRing(),y.EXTERIOR,y.INTERIOR);for(let e=0;e<t.getNumInteriorRing();e++){const n=t.getInteriorRingN(e);this.addPolygonRing(n,y.INTERIOR,y.EXTERIOR)}}addEdge(t){this.insertEdge(t);const e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],y.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],y.BOUNDARY)}addLineString(t){const e=kt.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;const n=new An(e,new Ut(this._argIndex,y.INTERIOR));this._lineEdgeMap.put(t,n),this.insertEdge(n),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])}getInvalidPoint(){return this._invalidPoint}getBoundaryPoints(){const t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null);let n=0;for(let i=t.iterator();i.hasNext();){const s=i.next();e[n++]=s.getCoordinate().copy()}return e}getBoundaryNodes(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes}addSelfIntersectionNode(t,e,n){if(this.isBoundaryNode(t,e))return null;n===y.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)}addPolygonRing(t,e,n){if(t.isEmpty())return null;const i=kt.removeRepeatedPoints(t.getCoordinates());if(i.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;let s=e,o=n;J.isCCW(i)&&(s=n,o=e);const a=new An(i,new Ut(this._argIndex,y.BOUNDARY,s,o));this._lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this._argIndex,i[0],y.BOUNDARY)}insertPoint(t,e,n){const i=this._nodes.addNode(e),s=i.getLabel();s===null?i._label=new Ut(t,n):s.setLocation(t,n)}createEdgeSetIntersector(){return new Zh}addSelfIntersectionNodes(t){for(let e=this._edges.iterator();e.hasNext();){const n=e.next(),i=n.getLabel().getLocation(t);for(let s=n.eiList.iterator();s.hasNext();){const o=s.next();this.addSelfIntersectionNode(t,o.coord,i)}}}add(){if(arguments.length===1&&arguments[0]instanceof A){const t=arguments[0];if(t.isEmpty())return null;if(t instanceof nn&&(this._useBoundaryDeterminationRule=!1),t instanceof jt)this.addPolygon(t);else if(t instanceof vt)this.addLineString(t);else if(t instanceof ee)this.addPoint(t);else if(t instanceof Wn)this.addCollection(t);else if(t instanceof Nn)this.addCollection(t);else if(t instanceof nn)this.addCollection(t);else if(t instanceof St)this.addCollection(t);else throw new _i(t.getGeometryType())}else return super.add.apply(this,arguments)}addCollection(t){for(let e=0;e<t.getNumGeometries();e++){const n=t.getGeometryN(e);this.add(n)}}locate(t){return H(this._parentGeom,qs)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Zr(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)}findEdge(){if(arguments.length===1&&arguments[0]instanceof vt){const t=arguments[0];return this._lineEdgeMap.get(t)}else return super.findEdge.apply(this,arguments)}}class ls{constructor(){ls.constructor_.apply(this,arguments)}static constructor_(){if(this._li=new Me,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){const t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new un(0,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];ls.constructor_.call(this,t,e,Re.OGC_SFS_BOUNDARY_RULE)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];t.getPrecisionModel().compareTo(e.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new un(0,t,n),this._arg[1]=new un(1,e,n)}}getArgGeometry(t){return this._arg[t].getGeometry()}setComputationPrecision(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)}}class Rr{constructor(){Rr.constructor_.apply(this,arguments)}static constructor_(){this._pts=null,this._orientation=null;const t=arguments[0];this._pts=t,this._orientation=Rr.orientation(t)}static orientation(t){return kt.increasingDirection(t)===1}static compareOriented(t,e,n,i){const s=e?1:-1,o=i?1:-1,a=e?t.length:-1,l=i?n.length:-1;let c=e?0:t.length-1,h=i?0:n.length-1;for(;;){const u=t[c].compareTo(n[h]);if(u!==0)return u;c+=s,h+=o;const d=c===a,f=h===l;if(d&&!f)return-1;if(!d&&f)return 1;if(d&&f)return 0}}compareTo(t){const e=t;return Rr.compareOriented(this._pts,this._orientation,e._pts,e._orientation)}get interfaces_(){return[sn]}}class Pl{constructor(){Pl.constructor_.apply(this,arguments)}static constructor_(){this._edges=new F,this._ocaMap=new fi}print(t){t.print("MULTILINESTRING ( ");for(let e=0;e<this._edges.size();e++){const n=this._edges.get(e);e>0&&t.print(","),t.print("(");const i=n.getCoordinates();for(let s=0;s<i.length;s++)s>0&&t.print(","),t.print(i[s].x+" "+i[s].y);t.println(")")}t.print(")  ")}addAll(t){for(let e=t.iterator();e.hasNext();)this.add(e.next())}findEdgeIndex(t){for(let e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1}iterator(){return this._edges.iterator()}getEdges(){return this._edges}get(t){return this._edges.get(t)}findEqualEdge(t){const e=new Rr(t.getCoordinates());return this._ocaMap.get(e)}add(t){this._edges.add(t);const e=new Rr(t.getCoordinates());this._ocaMap.put(e,t)}}class K extends ls{constructor(){super(),K.constructor_.apply(this,arguments)}static constructor_(){this._ptLocator=new Ks,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Pl,this._resultPolyList=new F,this._resultLineList=new F,this._resultPointList=new F;const t=arguments[0],e=arguments[1];ls.constructor_.call(this,t,e),this._graph=new Js(new Bh),this._geomFact=t.getFactory()}static overlayOp(t,e,n){return new K(t,e).getResultGeometry(n)}static union(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return K.createEmptyResult(K.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}if(t.isGeometryCollection()||e.isGeometryCollection())throw new ht("This method does not support GeometryCollection arguments");return cn.overlayOp(t,e,K.UNION)}static intersection(t,e){if(t.isEmpty()||e.isEmpty())return K.createEmptyResult(K.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){const n=e;return Ya.map(t,new class{get interfaces_(){return[MapOp]}map(i){return K.intersection(i,n)}})}return cn.overlayOp(t,e,K.INTERSECTION)}static symDifference(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return K.createEmptyResult(K.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}if(t.isGeometryCollection()||e.isGeometryCollection())throw new ht("This method does not support GeometryCollection arguments");return cn.overlayOp(t,e,K.SYMDIFFERENCE)}static resultDimension(t,e,n){const i=e.getDimension(),s=n.getDimension();let o=-1;switch(t){case K.INTERSECTION:o=Math.min(i,s);break;case K.UNION:o=Math.max(i,s);break;case K.DIFFERENCE:o=i;break;case K.SYMDIFFERENCE:o=Math.max(i,s);break}return o}static createEmptyResult(t,e,n,i){const s=K.resultDimension(t,e,n);return i.createEmpty(s)}static difference(t,e){if(t.isEmpty())return K.createEmptyResult(K.DIFFERENCE,t,e,t.getFactory());if(e.isEmpty())return t.copy();if(t.isGeometryCollection()||e.isGeometryCollection())throw new ht("This method does not support GeometryCollection arguments");return cn.overlayOp(t,e,K.DIFFERENCE)}static isResultOfOp(){if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return K.isResultOfOp(n,i,e)}else if(arguments.length===3){let t=arguments[0],e=arguments[1],n=arguments[2];switch(t===y.BOUNDARY&&(t=y.INTERIOR),e===y.BOUNDARY&&(e=y.INTERIOR),n){case K.INTERSECTION:return t===y.INTERIOR&&e===y.INTERIOR;case K.UNION:return t===y.INTERIOR||e===y.INTERIOR;case K.DIFFERENCE:return t===y.INTERIOR&&e!==y.INTERIOR;case K.SYMDIFFERENCE:return t===y.INTERIOR&&e!==y.INTERIOR||t!==y.INTERIOR&&e===y.INTERIOR}return!1}}insertUniqueEdge(t){const e=this._edgeList.findEqualEdge(t);if(e!==null){const n=e.getLabel();let i=t.getLabel();e.isPointwiseEqual(t)||(i=new Ut(t.getLabel()),i.flip());const s=e.getDepth();s.isNull()&&s.add(n),s.add(i),n.merge(i)}else this._edgeList.add(t)}getGraph(){return this._graph}cancelDuplicateResultEdges(){for(let t=this._graph.getEdgeEnds().iterator();t.hasNext();){const e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}}isCoveredByLA(t){return!!(this.isCovered(t,this._resultLineList)||this.isCovered(t,this._resultPolyList))}computeGeometry(t,e,n,i){const s=new F;return s.addAll(t),s.addAll(e),s.addAll(n),s.isEmpty()?K.createEmptyResult(i,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(s)}mergeSymLabels(){for(let t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()}isCovered(t,e){for(let n=e.iterator();n.hasNext();){const i=n.next();if(this._ptLocator.locate(t,i)!==y.EXTERIOR)return!0}return!1}replaceCollapsedEdges(){const t=new F;for(let e=this._edgeList.iterator();e.hasNext();){const n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this._edgeList.addAll(t)}updateNodeLabelling(){for(let t=this._graph.getNodes().iterator();t.hasNext();){const e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}}getResultGeometry(t){return this.computeOverlay(t),this._resultGeom}insertUniqueEdges(t){for(let e=t.iterator();e.hasNext();){const n=e.next();this.insertUniqueEdge(n)}}computeOverlay(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);const e=new F;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ro.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();const n=new To(this._geomFact);n.add(this._graph),this._resultPolyList=n.getPolygons();const i=new zh(this,this._geomFact,this._ptLocator);this._resultLineList=i.build(t);const s=new Xh(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)}labelIncompleteNode(t,e){const n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,n)}copyPoints(t){for(let e=this._arg[t].getNodeIterator();e.hasNext();){const n=e.next();this._graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}}findResultAreaEdges(t){for(let e=this._graph.getEdgeEnds().iterator();e.hasNext();){const n=e.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&K.isResultOfOp(i.getLocation(0,P.RIGHT),i.getLocation(1,P.RIGHT),t)&&n.setInResult(!0)}}computeLabelsFromDepths(){for(let t=this._edgeList.iterator();t.hasNext();){const e=t.next(),n=e.getLabel(),i=e.getDepth();if(!i.isNull()){i.normalize();for(let s=0;s<2;s++)!n.isNull(s)&&n.isArea()&&!i.isNull(s)&&(i.getDelta(s)===0?n.toLine(s):(et.isTrue(!i.isNull(s,P.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(s,P.LEFT,i.getLocation(s,P.LEFT)),et.isTrue(!i.isNull(s,P.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(s,P.RIGHT,i.getLocation(s,P.RIGHT))))}}}computeLabelling(){for(let t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()}labelIncompleteNodes(){for(let t=this._graph.getNodes().iterator();t.hasNext();){const e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}}isCoveredByA(t){return!!this.isCovered(t,this._resultPolyList)}}K.INTERSECTION=1;K.UNION=2;K.DIFFERENCE=3;K.SYMDIFFERENCE=4;class Qi{constructor(){Qi.constructor_.apply(this,arguments)}static constructor_(){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null;const t=arguments[0],e=arguments[1];this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()}static overlayOp(t,e,n){return new Qi(t,e).getResultGeometry(n)}static union(t,e){return Qi.overlayOp(t,e,K.UNION)}static intersection(t,e){return Qi.overlayOp(t,e,K.INTERSECTION)}static symDifference(t,e){return Qi.overlayOp(t,e,K.SYMDIFFERENCE)}static difference(t,e){return Qi.overlayOp(t,e,K.DIFFERENCE)}selfSnap(t){return new ln(t).snapTo(t,this._snapTolerance)}removeCommonBits(t){this._cbr=new jo,this._cbr.add(t[0]),this._cbr.add(t[1]);const e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e}prepareResult(t){return this._cbr.addCommonBits(t),t}getResultGeometry(t){const e=this.snap(this._geom),n=K.overlayOp(e[0],e[1],t);return this.prepareResult(n)}checkValid(t){t.isValid()||en.out.println("Snapped geometry is invalid")}computeSnapTolerance(){this._snapTolerance=ln.computeOverlaySnapTolerance(this._geom[0],this._geom[1])}snap(t){const e=this.removeCommonBits(t);return ln.snap(e[0],e[1],this._snapTolerance)}}class cn{constructor(){cn.constructor_.apply(this,arguments)}static constructor_(){this._geom=new Array(2).fill(null);const t=arguments[0],e=arguments[1];this._geom[0]=t,this._geom[1]=e}static overlayOp(t,e,n){return new cn(t,e).getResultGeometry(n)}static union(t,e){return cn.overlayOp(t,e,K.UNION)}static intersection(t,e){return cn.overlayOp(t,e,K.INTERSECTION)}static symDifference(t,e){return cn.overlayOp(t,e,K.SYMDIFFERENCE)}static difference(t,e){return cn.overlayOp(t,e,K.DIFFERENCE)}getResultGeometry(t){let e=null,n=!1,i=null;try{e=K.overlayOp(this._geom[0],this._geom[1],t),!0&&(n=!0)}catch(s){if(s instanceof ai)i=s;else throw s}finally{}if(!n)try{e=Qi.overlayOp(this._geom[0],this._geom[1],t)}catch(s){throw s instanceof ai?i:s}finally{}return e}}class wr{constructor(){wr.constructor_.apply(this,arguments)}static constructor_(){this._geomFactory=null,this._polygons=new F,this._lines=new F,this._points=new F,this._dimension=O.FALSE}static extract(){if(H(arguments[0],le)){const t=arguments[0],e=new wr;return e.add(t),e}else if(arguments[0]instanceof A){const t=arguments[0],e=new wr;return e.add(t),e}}getFactory(){return this._geomFactory}recordDimension(t){t>this._dimension&&(this._dimension=t)}getDimension(){return this._dimension}filter(t){if(this.recordDimension(t.getDimension()),t instanceof St||t.isEmpty())return null;if(t instanceof jt)return this._polygons.add(t),null;if(t instanceof vt)return this._lines.add(t),null;if(t instanceof ee)return this._points.add(t),null;et.shouldNeverReachHere("Unhandled geometry type: "+t.getGeometryType())}getExtract(t){switch(t){case 0:return this._points;case 1:return this._lines;case 2:return this._polygons}return et.shouldNeverReachHere("Invalid dimension: "+t),null}isEmpty(){return this._polygons.isEmpty()&&this._lines.isEmpty()&&this._points.isEmpty()}add(){if(H(arguments[0],le)){const t=arguments[0];for(const e of t)this.add(e)}else if(arguments[0]instanceof A){const t=arguments[0];this._geomFactory===null&&(this._geomFactory=t.getFactory()),t.apply(this)}}get interfaces_(){return[ds]}}class an{constructor(){an.constructor_.apply(this,arguments)}static constructor_(){this._geomFactory=null,this._g0=null,this._g1=null,this._isUnionSafe=null;const t=arguments[0],e=arguments[1];this._g0=t,this._g1=e,this._geomFactory=t.getFactory()}static containsProperly(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return t.isNull()?!1:e.getX()>t.getMinX()&&e.getX()<t.getMaxX()&&e.getY()>t.getMinY()&&e.getY()<t.getMaxY()}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return an.containsProperly(t,e)&&an.containsProperly(t,n)}}static union(t,e){return new an(t,e).union()}static intersects(t,e,n){return t.intersects(e)||t.intersects(n)}static overlapEnvelope(t,e){const n=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();return n.intersection(i)}static extractBorderSegments(t,e,n){t.apply(new class{get interfaces_(){return[Vs]}filter(i,s){if(s<=0)return null;const o=i.getCoordinate(s-1),a=i.getCoordinate(s);if(an.intersects(e,o,a)&&!an.containsProperly(e,o,a)){const c=new At(o,a);n.add(c)}}isDone(){return!1}isGeometryChanged(){return!1}})}static unionBuffer(t,e){return t.getFactory().createGeometryCollection([t,e]).buffer(0)}isBorderSegmentsSame(t,e){const n=this.extractBorderSegments(this._g0,this._g1,e),i=new F;return an.extractBorderSegments(t,e,i),this.isEqual(n,i)}extractByEnvelope(t,e,n){const i=new F;for(let s=0;s<e.getNumGeometries();s++){const o=e.getGeometryN(s);if(o.getEnvelopeInternal().intersects(t))i.add(o);else{const a=o.copy();n.add(a)}}return this._geomFactory.buildGeometry(i)}isEqual(t,e){if(t.size()!==e.size())return!1;const n=new Wo(t);for(const i of e)if(!n.contains(i))return!1;return!0}union(){const t=an.overlapEnvelope(this._g0,this._g1);if(t.isNull()){const a=this._g0.copy(),l=this._g1.copy();return On.combine(a,l)}const e=new F,n=this.extractByEnvelope(t,this._g0,e),i=this.extractByEnvelope(t,this._g1,e),s=this.unionFull(n,i);let o=null;return this._isUnionSafe=this.isBorderSegmentsSame(s,t),this._isUnionSafe?o=this.combine(s,e):o=this.unionFull(this._g0,this._g1),o}combine(t,e){return e.size()<=0?t:(e.add(t),On.combine(e))}unionFull(t,e){try{return t.union(e)}catch(n){if(n instanceof Bn)return an.unionBuffer(t,e);throw n}finally{}}extractBorderSegments(t,e,n){const i=new F;return an.extractBorderSegments(t,n,i),e!==null&&an.extractBorderSegments(e,n,i),i}isUnionOptimized(){return this._isUnionSafe}}class ti{constructor(){ti.constructor_.apply(this,arguments)}static constructor_(){this._inputPolys=null,this._geomFactory=null;const t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new F)}static restrictToPolygons(t){if(H(t,qs))return t;const e=Er.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(Qt.toPolygonArray(e))}static getGeometry(t,e){return e>=t.size()?null:t.get(e)}static union(t){return new ti(t).union()}reduceToGeometries(t){const e=new F;for(let n=t.iterator();n.hasNext();){const i=n.next();let s=null;H(i,dn)?s=this.unionTree(i):i instanceof A&&(s=i),e.add(s)}return e}union(){if(this._inputPolys===null)throw new IllegalStateException("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();const t=new te(ti.STRTREE_NODE_CAPACITY);for(let i=this._inputPolys.iterator();i.hasNext();){const s=i.next();t.insert(s.getEnvelopeInternal(),s)}this._inputPolys=null;const e=t.itemsTree();return this.unionTree(e)}binaryUnion(){if(arguments.length===1){const t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];if(n-e<=1){const i=ti.getGeometry(t,e);return this.unionSafe(i,null)}else{if(n-e===2)return this.unionSafe(ti.getGeometry(t,e),ti.getGeometry(t,e+1));{const i=Math.trunc((n+e)/2),s=this.binaryUnion(t,e,i),o=this.binaryUnion(t,i,n);return this.unionSafe(s,o)}}}}repeatedUnion(t){let e=null;for(let n=t.iterator();n.hasNext();){const i=n.next();e===null?e=i.copy():e=e.union(i)}return e}unionSafe(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionActual(t,e)}unionActual(t,e){const n=an.union(t,e);return ti.restrictToPolygons(n)}unionTree(t){const e=this.reduceToGeometries(t);return this.binaryUnion(e)}bufferUnion(){if(arguments.length===1){const t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return t.getFactory().createGeometryCollection([t,e]).buffer(0)}}}ti.STRTREE_NODE_CAPACITY=4;class Ms{constructor(){Ms.constructor_.apply(this,arguments)}static constructor_(){if(this._geomFact=null,this._extracter=null,arguments.length===1){if(H(arguments[0],le)){const t=arguments[0];this.extract(t)}else if(arguments[0]instanceof A){const t=arguments[0];this.extract(t)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._geomFact=e,this.extract(t)}}static union(){if(arguments.length===1){if(H(arguments[0],le)){const t=arguments[0];return new Ms(t).union()}else if(arguments[0]instanceof A){const t=arguments[0];return new Ms(t).union()}}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Ms(t,e).union()}}unionNoOpt(t){const e=this._geomFact.createPoint();return cn.overlayOp(t,e,K.UNION)}unionWithNull(t,e){return t===null&&e===null?null:e===null?t:t===null?e:t.union(e)}extract(){if(H(arguments[0],le)){const t=arguments[0];this._extracter=wr.extract(t)}else if(arguments[0]instanceof A){const t=arguments[0];this._extracter=wr.extract(t)}}union(){if(this._geomFact===null&&(this._geomFact=this._extracter.getFactory()),this._geomFact===null)return null;if(this._extracter.isEmpty())return this._geomFact.createEmpty(this._extracter.getDimension());const t=this._extracter.getExtract(0),e=this._extracter.getExtract(1),n=this._extracter.getExtract(2);let i=null;if(t.size()>0){const c=this._geomFact.buildGeometry(t);i=this.unionNoOpt(c)}let s=null;if(e.size()>0){const c=this._geomFact.buildGeometry(e);s=this.unionNoOpt(c)}let o=null;n.size()>0&&(o=ti.union(n));const a=this.unionWithNull(s,o);let l=null;return i===null?l=a:a===null?l=i:l=Wa.union(i,a),l===null?this._geomFact.createGeometryCollection():l}}class No{get interfaces_(){return[]}getClass(){return No}static union(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return K.createEmptyResult(K.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),cn.overlayOp(t,e,K.UNION)}}class nt{constructor(){nt.constructor_.apply(this,arguments)}static constructor_(){if(this._quadrantSegments=nt.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=nt.CAP_ROUND,this._joinStyle=nt.JOIN_ROUND,this._mitreLimit=nt.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=nt.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){const t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this.setQuadrantSegments(t),this.setEndCapStyle(e)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.setQuadrantSegments(t),this.setEndCapStyle(e),this.setJoinStyle(n),this.setMitreLimit(i)}}}static bufferDistanceError(t){const e=Math.PI/2/t;return 1-Math.cos(e/2)}getEndCapStyle(){return this._endCapStyle}isSingleSided(){return this._isSingleSided}setQuadrantSegments(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=nt.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=nt.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==nt.JOIN_ROUND&&(this._quadrantSegments=nt.DEFAULT_QUADRANT_SEGMENTS)}getJoinStyle(){return this._joinStyle}setJoinStyle(t){this._joinStyle=t}setSimplifyFactor(t){this._simplifyFactor=t<0?0:t}getSimplifyFactor(){return this._simplifyFactor}getQuadrantSegments(){return this._quadrantSegments}setEndCapStyle(t){this._endCapStyle=t}getMitreLimit(){return this._mitreLimit}setMitreLimit(t){this._mitreLimit=t}setSingleSided(t){this._isSingleSided=t}}nt.CAP_ROUND=1;nt.CAP_FLAT=2;nt.CAP_SQUARE=3;nt.JOIN_ROUND=1;nt.JOIN_MITRE=2;nt.JOIN_BEVEL=3;nt.DEFAULT_QUADRANT_SEGMENTS=8;nt.DEFAULT_MITRE_LIMIT=5;nt.DEFAULT_SIMPLIFY_FACTOR=.01;class Yg extends gn{}class Tf extends dn{constructor(){super(),this.array=[]}add(t){return this.array.push(t),!0}get(t){if(t<0||t>=this.size())throw new gf;return this.array[t]}push(t){return this.array.push(t),t}pop(){if(this.array.length===0)throw new Yg;return this.array.pop()}peek(){if(this.array.length===0)throw new Yg;return this.array[this.array.length-1]}empty(){return this.array.length===0}isEmpty(){return this.empty()}search(t){return this.array.indexOf(t)}size(){return this.array.length}toArray(){return this.array.slice()}}class tu{constructor(){tu.constructor_.apply(this,arguments)}static constructor_(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}getCoordinate(){return this._minCoord}getRightmostSide(t,e){let n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n}findRightmostEdgeAtVertex(){const t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");const e=t[this._minIndex-1],n=t[this._minIndex+1],i=J.index(this._minCoord,n,e);let s=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&i===J.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&i===J.CLOCKWISE)&&(s=!0),s&&(this._minIndex=this._minIndex-1)}getRightmostSideOfSegment(t,e){const i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length||i[e].y===i[e+1].y)return-1;let s=P.LEFT;return i[e].y<i[e+1].y&&(s=P.RIGHT),s}getEdge(){return this._orientedDe}checkForRightmostCoordinate(t){const e=t.getEdge().getCoordinates();for(let n=0;n<e.length-1;n++)(this._minCoord===null||e[n].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=n,this._minCoord=e[n])}findRightmostEdgeAtNode(){const e=this._minDe.getNode().getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}findEdge(t){for(let n=t.iterator();n.hasNext();){const i=n.next();i.isForward()&&this.checkForRightmostCoordinate(i)}et.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===P.LEFT&&(this._orientedDe=this._minDe.getSym())}}class _I{constructor(){this.array=[]}addLast(t){this.array.push(t)}removeFirst(){return this.array.shift()}isEmpty(){return this.array.length===0}}class eu{constructor(){eu.constructor_.apply(this,arguments)}static constructor_(){this._finder=null,this._dirEdgeList=new F,this._nodes=new F,this._rightMostCoord=null,this._env=null,this._finder=new tu}clearVisitedEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)}getRightmostCoordinate(){return this._rightMostCoord}computeNodeDepth(t){let e=null;for(let n=t.getEdges().iterator();n.hasNext();){const i=n.next();if(i.isVisited()||i.getSym().isVisited()){e=i;break}}if(e===null)throw new Bn("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(let n=t.getEdges().iterator();n.hasNext();){const i=n.next();i.setVisited(!0),this.copySymDepths(i)}}computeDepth(t){this.clearVisitedEdges();const e=this._finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(P.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)}create(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}findResultEdges(){for(let t=this._dirEdgeList.iterator();t.hasNext();){const e=t.next();e.getDepth(P.RIGHT)>=1&&e.getDepth(P.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}}computeDepths(t){const e=new Wo,n=new _I,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){const s=n.removeFirst();e.add(s),this.computeNodeDepth(s);for(let o=s.getEdges().iterator();o.hasNext();){const l=o.next().getSym();if(l.isVisited())continue;const c=l.getNode();e.contains(c)||(n.addLast(c),e.add(c))}}}compareTo(t){const e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0}getEnvelope(){if(this._env===null){const t=new ct;for(let e=this._dirEdgeList.iterator();e.hasNext();){const i=e.next().getEdge().getCoordinates();for(let s=0;s<i.length-1;s++)t.expandToInclude(i[s])}this._env=t}return this._env}addReachable(t){const e=new Tf;for(e.add(t);!e.empty();){const n=e.pop();this.add(n,e)}}copySymDepths(t){const e=t.getSym();e.setDepth(P.LEFT,t.getDepth(P.RIGHT)),e.setDepth(P.RIGHT,t.getDepth(P.LEFT))}add(t,e){t.setVisited(!0),this._nodes.add(t);for(let n=t.getEdges().iterator();n.hasNext();){const i=n.next();this._dirEdgeList.add(i);const o=i.getSym().getNode();o.isVisited()||e.push(o)}}getNodes(){return this._nodes}getDirectedEdges(){return this._dirEdgeList}get interfaces_(){return[sn]}}class Ce{constructor(){Ce.constructor_.apply(this,arguments)}static constructor_(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=J.COUNTERCLOCKWISE;const t=arguments[0];this._inputLine=t}static simplify(t,e){return new Ce(t).simplify(e)}isDeletable(t,e,n,i){const s=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[n];return!this.isConcave(s,o,a)||!this.isShallow(s,o,a,i)?!1:this.isShallowSampled(s,o,t,n,i)}deleteShallowConcavities(){let t=1,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e),i=!1;for(;n<this._inputLine.length;){let s=!1;this.isDeletable(t,e,n,this._distanceTol)&&(this._isDeleted[e]=Ce.DELETE,s=!0,i=!0),s?t=n:t=e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return i}isShallowConcavity(t,e,n,i){return J.index(t,e,n)===this._angleOrientation?ge.pointToSegment(e,t,n)<i:!1}isShallowSampled(t,e,n,i,s){let o=Math.trunc((i-n)/Ce.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(let a=n;a<i;a+=o)if(!this.isShallow(t,e,this._inputLine[a],s))return!1;return!0}isConcave(t,e,n){return J.index(t,e,n)===this._angleOrientation}simplify(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=J.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);let e=!1;do e=this.deleteShallowConcavities();while(e);return this.collapseLine()}findNextNonDeletedIndex(t){let e=t+1;for(;e<this._inputLine.length&&this._isDeleted[e]===Ce.DELETE;)e++;return e}isShallow(t,e,n,i){return ge.pointToSegment(e,t,n)<i}collapseLine(){const t=new Yn;for(let e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ce.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()}}Ce.INIT=0;Ce.DELETE=1;Ce.KEEP=1;Ce.NUM_PTS_TO_CHECK=10;class So{constructor(){So.constructor_.apply(this,arguments)}static constructor_(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new F}getCoordinates(){return this._ptList.toArray(So.COORDINATE_ARRAY_TYPE)}setPrecisionModel(t){this._precisionModel=t}addPt(t){const e=new w(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)}reverse(){}addPts(t,e){if(e)for(let n=0;n<t.length;n++)this.addPt(t[n]);else for(let n=t.length-1;n>=0;n--)this.addPt(t[n])}isRedundant(t){if(this._ptList.size()<1)return!1;const e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance}toString(){return new Qt().createLineString(this.getCoordinates()).toString()}closeRing(){if(this._ptList.size()<1)return null;const t=new w(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)}setMinimumVertexDistance(t){this._minimimVertexDistance=t}}So.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);class Dn{constructor(){Dn.constructor_.apply(this,arguments)}static constructor_(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new At,this._seg1=new At,this._offset0=new At,this._offset1=new At,this._side=0,this._hasNarrowConcaveAngle=!1;const t=arguments[0],e=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new Me,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===nt.JOIN_ROUND&&(this._closingSegLengthFactor=Dn.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}addNextSegment(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;const n=J.index(this._s0,this._s1,this._s2),i=n===J.CLOCKWISE&&this._side===P.LEFT||n===J.COUNTERCLOCKWISE&&this._side===P.RIGHT;n===0?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)}addLineEndCap(t,e){const n=new At(t,e),i=new At;this.computeOffsetSegment(n,P.LEFT,this._distance,i);const s=new At;this.computeOffsetSegment(n,P.RIGHT,this._distance,s);const o=e.x-t.x,a=e.y-t.y,l=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case nt.CAP_ROUND:this._segList.addPt(i.p1),this.addDirectedFillet(e,l+Math.PI/2,l-Math.PI/2,J.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case nt.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(s.p1);break;case nt.CAP_SQUARE:const c=new w;c.x=Math.abs(this._distance)*Math.cos(l),c.y=Math.abs(this._distance)*Math.sin(l);const h=new w(i.p1.x+c.x,i.p1.y+c.y),u=new w(s.p1.x+c.x,s.p1.y+c.y);this._segList.addPt(h),this._segList.addPt(u);break}}getCoordinates(){return this._segList.getCoordinates()}addMitreJoin(t,e,n,i){const s=bh.intersection(e.p0,e.p1,n.p0,n.p1);if(s!==null&&(i<=0?1:s.distance(t)/Math.abs(i))<=this._bufParams.getMitreLimit())return this._segList.addPt(s),null;this.addLimitedMitreJoin(e,n,i,this._bufParams.getMitreLimit())}addOutsideTurn(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Dn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===nt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===nt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))}createSquare(t){this._segList.addPt(new w(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new w(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new w(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new w(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()}addSegments(t,e){this._segList.addPts(t,e)}addFirstSegment(){this._segList.addPt(this._offset1.p0)}addCornerFillet(t,e,n,i,s){const o=e.x-t.x,a=e.y-t.y;let l=Math.atan2(a,o);const c=n.x-t.x,h=n.y-t.y,u=Math.atan2(h,c);i===J.CLOCKWISE?l<=u&&(l+=2*Math.PI):l>=u&&(l-=2*Math.PI),this._segList.addPt(e),this.addDirectedFillet(t,l,u,i,s),this._segList.addPt(n)}addLastSegment(){this._segList.addPt(this._offset1.p1)}initSideSegments(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)}addLimitedMitreJoin(t,e,n,i){const s=this._seg0.p1,o=Nt.angle(s,this._seg0.p0),l=Nt.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1)/2,c=Nt.normalize(o+l),h=Nt.normalize(c+Math.PI),u=i*n,d=u*Math.abs(Math.sin(l)),f=n-d,p=s.x+u*Math.cos(h),m=s.y+u*Math.sin(h),I=new w(p,m),x=new At(s,I),E=x.pointAlongOffset(1,f),R=x.pointAlongOffset(1,-f);this._side===P.LEFT?(this._segList.addPt(E),this._segList.addPt(R)):(this._segList.addPt(R),this._segList.addPt(E))}addDirectedFillet(t,e,n,i,s){const o=i===J.CLOCKWISE?-1:1,a=Math.abs(e-n),l=Math.trunc(a/this._filletAngleQuantum+.5);if(l<1)return null;const c=a/l,h=new w;for(let u=0;u<l;u++){const d=e+o*u*c;h.x=t.x+s*Math.cos(d),h.y=t.y+s*Math.sin(d),this._segList.addPt(h)}}computeOffsetSegment(t,e,n,i){const s=e===P.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,l=Math.sqrt(o*o+a*a),c=s*n*o/l,h=s*n*a/l;i.p0.x=t.p0.x-h,i.p0.y=t.p0.y+c,i.p1.x=t.p1.x-h,i.p1.y=t.p1.y+c}addInsideTurn(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Dn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){const n=new w((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);const i=new w((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}createCircle(t){const e=new w(t.x+this._distance,t.y);this._segList.addPt(e),this.addDirectedFillet(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}addBevelJoin(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)}init(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new So,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Dn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}addCollinear(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===nt.JOIN_BEVEL||this._bufParams.getJoinStyle()===nt.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,J.CLOCKWISE,this._distance))}closeRing(){this._segList.closeRing()}hasNarrowConcaveAngle(){return this._hasNarrowConcaveAngle}}Dn.OFFSET_SEGMENT_SEPARATION_FACTOR=.001;Dn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001;Dn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6;Dn.MAX_CLOSING_SEG_LEN_FACTOR=80;class Va{constructor(){Va.constructor_.apply(this,arguments)}static constructor_(){this._distance=0,this._precisionModel=null,this._bufParams=null;const t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e}static copyCoordinates(t){const e=new Array(t.length).fill(null);for(let n=0;n<e.length;n++)e[n]=new w(t[n]);return e}getOffsetCurve(t,e){if(this._distance=e,e===0)return null;const n=e<0,i=Math.abs(e),s=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],s):this.computeOffsetCurve(t,n,s);const o=s.getCoordinates();return n&&kt.reverse(o),o}computeSingleSidedBufferCurve(t,e,n){const i=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);const s=Ce.simplify(t,-i),o=s.length-1;n.initSideSegments(s[o],s[o-1],P.LEFT),n.addFirstSegment();for(let a=o-2;a>=0;a--)n.addNextSegment(s[a],!0)}else{n.addSegments(t,!1);const s=Ce.simplify(t,i),o=s.length-1;n.initSideSegments(s[0],s[1],P.LEFT),n.addFirstSegment();for(let a=2;a<=o;a++)n.addNextSegment(s[a],!0)}n.addLastSegment(),n.closeRing()}computeRingBufferCurve(t,e,n){let i=this.simplifyTolerance(this._distance);e===P.RIGHT&&(i=-i);const s=Ce.simplify(t,i),o=s.length-1;n.initSideSegments(s[o-1],s[0],e);for(let a=1;a<=o;a++){const l=a!==1;n.addNextSegment(s[a],l)}n.closeRing()}computeLineBufferCurve(t,e){const n=this.simplifyTolerance(this._distance),i=Ce.simplify(t,n),s=i.length-1;e.initSideSegments(i[0],i[1],P.LEFT);for(let l=2;l<=s;l++)e.addNextSegment(i[l],!0);e.addLastSegment(),e.addLineEndCap(i[s-1],i[s]);const o=Ce.simplify(t,-n),a=o.length-1;e.initSideSegments(o[a],o[a-1],P.LEFT);for(let l=a-2;l>=0;l--)e.addNextSegment(o[l],!0);e.addLastSegment(),e.addLineEndCap(o[1],o[0]),e.closeRing()}computePointCurve(t,e){switch(this._bufParams.getEndCapStyle()){case nt.CAP_ROUND:e.createCircle(t);break;case nt.CAP_SQUARE:e.createSquare(t);break}}getLineCurve(t,e){if(this._distance=e,this.isLineOffsetEmpty(e))return null;const n=Math.abs(e),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this._bufParams.isSingleSided()){const o=e<0;this.computeSingleSidedBufferCurve(t,o,i)}else this.computeLineBufferCurve(t,i);return i.getCoordinates()}getBufferParameters(){return this._bufParams}simplifyTolerance(t){return t*this._bufParams.getSimplifyFactor()}getRingCurve(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return Va.copyCoordinates(t);const i=this.getSegGen(n);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()}computeOffsetCurve(t,e,n){const i=this.simplifyTolerance(this._distance);if(e){const s=Ce.simplify(t,-i),o=s.length-1;n.initSideSegments(s[o],s[o-1],P.LEFT),n.addFirstSegment();for(let a=o-2;a>=0;a--)n.addNextSegment(s[a],!0)}else{const s=Ce.simplify(t,i),o=s.length-1;n.initSideSegments(s[0],s[1],P.LEFT),n.addFirstSegment();for(let a=2;a<=o;a++)n.addNextSegment(s[a],!0)}n.addLastSegment()}isLineOffsetEmpty(t){return t===0||t<0&&!this._bufParams.isSingleSided()}getSegGen(t){return new Dn(this._precisionModel,this._bufParams,t)}}class Al{constructor(){Al.constructor_.apply(this,arguments)}static constructor_(){this._subgraphs=null,this._seg=new At;const t=arguments[0];this._subgraphs=t}findStabbedSegments(){if(arguments.length===1){const t=arguments[0],e=new F;for(let n=this._subgraphs.iterator();n.hasNext();){const i=n.next(),s=i.getEnvelope();t.y<s.getMinY()||t.y>s.getMaxY()||this.findStabbedSegments(t,i.getDirectedEdges(),e)}return e}else if(arguments.length===3){if(H(arguments[2],dn)&&arguments[0]instanceof w&&arguments[1]instanceof wo){const t=arguments[0],e=arguments[1],n=arguments[2],i=e.getEdge().getCoordinates();for(let s=0;s<i.length-1;s++){if(this._seg.p0=i[s],this._seg.p1=i[s+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),Math.max(this._seg.p0.x,this._seg.p1.x)<t.x||this._seg.isHorizontal()||t.y<this._seg.p0.y||t.y>this._seg.p1.y||J.index(this._seg.p0,this._seg.p1,t)===J.RIGHT)continue;let a=e.getDepth(P.LEFT);this._seg.p0.equals(i[s])||(a=e.getDepth(P.RIGHT));const l=new Dl(this._seg,a);n.add(l)}}else if(H(arguments[2],dn)&&arguments[0]instanceof w&&H(arguments[1],dn)){const t=arguments[0],e=arguments[1],n=arguments[2];for(let i=e.iterator();i.hasNext();){const s=i.next();s.isForward()&&this.findStabbedSegments(t,s,n)}}}}getDepth(t){const e=this.findStabbedSegments(t);return e.size()===0?0:Fi.min(e)._leftDepth}}class Dl{constructor(){Dl.constructor_.apply(this,arguments)}static constructor_(){this._upwardSeg=null,this._leftDepth=null;const t=arguments[0],e=arguments[1];this._upwardSeg=new At(t),this._leftDepth=e}compareTo(t){const e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;let n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)}compareX(t,e){const n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)}toString(){return this._upwardSeg.toString()}get interfaces_(){return[sn]}}Al.DepthSegment=Dl;class nu{constructor(){nu.constructor_.apply(this,arguments)}static constructor_(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new F;const t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n}addRingSide(t,e,n,i,s){if(e===0&&t.length<ve.MINIMUM_VALID_SIZE)return null;let o=i,a=s;t.length>=ve.MINIMUM_VALID_SIZE&&J.isCCW(t)&&(o=s,a=i,n=P.opposite(n));const l=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(l,o,a)}addRingBothSides(t,e){this.addRingSide(t,e,P.LEFT,y.EXTERIOR,y.INTERIOR),this.addRingSide(t,e,P.RIGHT,y.INTERIOR,y.EXTERIOR)}addPoint(t){if(this._distance<=0)return null;const e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,y.EXTERIOR,y.INTERIOR)}addPolygon(t){let e=this._distance,n=P.LEFT;this._distance<0&&(e=-this._distance,n=P.RIGHT);const i=t.getExteriorRing(),s=kt.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&s.length<3)return null;this.addRingSide(s,e,n,y.EXTERIOR,y.INTERIOR);for(let o=0;o<t.getNumInteriorRing();o++){const a=t.getInteriorRingN(o),l=kt.removeRepeatedPoints(a.getCoordinates());this._distance>0&&this.isErodedCompletely(a,-this._distance)||this.addRingSide(l,e,P.opposite(n),y.INTERIOR,y.EXTERIOR)}}isTriangleErodedCompletely(t,e){const n=new Xe(t[0],t[1],t[2]),i=n.inCentre();return ge.pointToSegment(i,n.p0,n.p1)<Math.abs(e)}addLineString(t){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;const e=kt.removeRepeatedPoints(t.getCoordinates());if(kt.isRing(e)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(e,this._distance);else{const n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,y.EXTERIOR,y.INTERIOR)}}addCurve(t,e,n){if(t===null||t.length<2)return null;const i=new hi(t,new Ut(0,y.BOUNDARY,e,n));this._curveList.add(i)}getCurves(){return this.add(this._inputGeom),this._curveList}add(t){if(t.isEmpty())return null;if(t instanceof jt)this.addPolygon(t);else if(t instanceof vt)this.addLineString(t);else if(t instanceof ee)this.addPoint(t);else if(t instanceof Wn)this.addCollection(t);else if(t instanceof Nn)this.addCollection(t);else if(t instanceof nn)this.addCollection(t);else if(t instanceof St)this.addCollection(t);else throw new _i(t.getGeometryType())}isErodedCompletely(t,e){const n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);const i=t.getEnvelopeInternal(),s=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>s}addCollection(t){for(let e=0;e<t.getNumGeometries();e++){const n=t.getGeometryN(e);this.add(n)}}}class qa{constructor(){qa.constructor_.apply(this,arguments)}static constructor_(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;const t=arguments[0];this._li=t}static isAdjacentSegments(t,e){return Math.abs(t-e)===1}isTrivialIntersection(t,e,n,i){if(t===n&&this._li.getIntersectionNum()===1){if(qa.isAdjacentSegments(e,i))return!0;if(t.isClosed()){const s=t.size()-1;if(e===0&&i===s||i===0&&e===s)return!0}}return!1}getProperIntersectionPoint(){return this._properIntersectionPoint}hasProperInteriorIntersection(){return this._hasProperInterior}getLineIntersector(){return this._li}hasProperIntersection(){return this._hasProper}processIntersections(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;const s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],l=n.getCoordinates()[i+1];this._li.computeIntersection(s,o,a,l),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}hasIntersection(){return this._hasIntersection}isDone(){return!1}hasInteriorIntersection(){return this._hasInterior}get interfaces_(){return[Gh]}}class Tr{constructor(){Tr.constructor_.apply(this,arguments)}static constructor_(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Pl;const t=arguments[0];this._bufParams=t}static depthDelta(t){const e=t.getLocation(0,P.LEFT),n=t.getLocation(0,P.RIGHT);return e===y.INTERIOR&&n===y.EXTERIOR?1:e===y.EXTERIOR&&n===y.INTERIOR?-1:0}static convertSegStrings(t){const e=new Qt,n=new F;for(;t.hasNext();){const i=t.next(),s=e.createLineString(i.getCoordinates());n.add(s)}return e.buildGeometry(n)}setWorkingPrecisionModel(t){this._workingPrecisionModel=t}insertUniqueEdge(t){const e=this._edgeList.findEqualEdge(t);if(e!==null){const n=e.getLabel();let i=t.getLabel();e.isPointwiseEqual(t)||(i=new Ut(t.getLabel()),i.flip()),n.merge(i);const s=Tr.depthDelta(i),a=e.getDepthDelta()+s;e.setDepthDelta(a)}else this._edgeList.add(t),t.setDepthDelta(Tr.depthDelta(t.getLabel()))}buildSubgraphs(t,e){const n=new F;for(let i=t.iterator();i.hasNext();){const s=i.next(),o=s.getRightmostCoordinate(),l=new Al(n).getDepth(o);s.computeDepth(l),s.findResultEdges(),n.add(s),e.add(s.getDirectedEdges(),s.getNodes())}}createSubgraphs(t){const e=new F;for(let n=t.getNodes().iterator();n.hasNext();){const i=n.next();if(!i.isVisited()){const s=new eu;s.create(i),e.add(s)}}return Fi.sort(e,Fi.reverseOrder()),e}createEmptyResultGeometry(){return this._geomFact.createPolygon()}getNoder(t){if(this._workingNoder!==null)return this._workingNoder;const e=new Br,n=new Me;return n.setPrecisionModel(t),e.setSegmentIntersector(new qa(n)),e}buffer(t,e){let n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();const i=new Va(n,this._bufParams),o=new nu(t,e,i).getCurves();if(o.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(o,n),this._graph=new Js(new Bh),this._graph.addEdges(this._edgeList.getEdges());const a=this.createSubgraphs(this._graph),l=new To(this._geomFact);this.buildSubgraphs(a,l);const c=l.getPolygons();return c.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(c)}computeNodedEdges(t,e){const n=this.getNoder(e);n.computeNodes(t);const i=n.getNodedSubstrings();for(let s=i.iterator();s.hasNext();){const o=s.next(),a=o.getCoordinates();if(a.length===2&&a[0].equals2D(a[1]))continue;const l=o.getData(),c=new An(o.getCoordinates(),new Ut(l));this.insertUniqueEdge(c)}}setNoder(t){this._workingNoder=t}}class Ka{constructor(){Ka.constructor_.apply(this,arguments)}static constructor_(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){const t=arguments[0],e=arguments[1];Ka.constructor_.call(this,t,e,0,0)}else if(arguments.length===4){const t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._isScaled=!this.isIntegerPrecision()}}rescale(){if(H(arguments[0],le)){const t=arguments[0];for(let e=t.iterator();e.hasNext();){const n=e.next();this.rescale(n.getCoordinates())}}else if(arguments[0]instanceof Array){const t=arguments[0];for(let e=0;e<t.length;e++)t[e].x=t[e].x/this._scaleFactor+this._offsetX,t[e].y=t[e].y/this._scaleFactor+this._offsetY;t.length===2&&t[0].equals2D(t[1])&&en.out.println(t)}}scale(){if(H(arguments[0],le)){const t=arguments[0],e=new F(t.size());for(let n=t.iterator();n.hasNext();){const i=n.next();e.add(new hi(this.scale(i.getCoordinates()),i.getData()))}return e}else if(arguments[0]instanceof Array){const t=arguments[0],e=new Array(t.length).fill(null);for(let i=0;i<t.length;i++)e[i]=new w(Math.round((t[i].x-this._offsetX)*this._scaleFactor),Math.round((t[i].y-this._offsetY)*this._scaleFactor),t[i].getZ());return kt.removeRepeatedPoints(e)}}isIntegerPrecision(){return this._scaleFactor===1}getNodedSubstrings(){const t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t}computeNodes(t){let e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)}get interfaces_(){return[Fh]}}class Lo{constructor(){Lo.constructor_.apply(this,arguments)}static constructor_(){this._li=new Me,this._segStrings=null;const t=arguments[0];this._segStrings=t}checkEndPtVertexIntersections(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const n=t.next().getCoordinates();this.checkEndPtVertexIntersections(n[0],this._segStrings),this.checkEndPtVertexIntersections(n[n.length-1],this._segStrings)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];for(let n=e.iterator();n.hasNext();){const s=n.next().getCoordinates();for(let o=1;o<s.length-1;o++)if(s[o].equals(t))throw new ai("found endpt/interior pt intersection at index "+o+" :pt "+t)}}}checkInteriorIntersections(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();for(let n=this._segStrings.iterator();n.hasNext();){const i=n.next();this.checkInteriorIntersections(e,i)}}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t.getCoordinates(),i=e.getCoordinates();for(let s=0;s<n.length-1;s++)for(let o=0;o<i.length-1;o++)this.checkInteriorIntersections(t,s,e,o)}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];if(t===n&&e===i)return null;const s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],l=n.getCoordinates()[i+1];if(this._li.computeIntersection(s,o,a,l),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,s,o)||this.hasInteriorIntersection(this._li,a,l)))throw new ai("found non-noded intersection at "+s+"-"+o+" and "+a+"-"+l)}}checkValid(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}checkCollapses(){if(arguments.length===0)for(let t=this._segStrings.iterator();t.hasNext();){const e=t.next();this.checkCollapses(e)}else if(arguments.length===1){const e=arguments[0].getCoordinates();for(let n=0;n<e.length-2;n++)this.checkCollapse(e[n],e[n+1],e[n+2])}}hasInteriorIntersection(t,e,n){for(let i=0;i<t.getIntersectionNum();i++){const s=t.getIntersection(i);if(!(s.equals(e)||s.equals(n)))return!0}return!1}checkCollapse(t,e,n){if(t.equals(n))throw new ai("found non-noded collapse at "+Lo.fact.createLineString([t,e,n]))}}Lo.fact=new Qt;class Gr{constructor(){Gr.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;const t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new ht("Scale factor must be non-zero");e!==1&&(this._pt=new w(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new w,this._p1Scaled=new w),this.initCorners(this._pt)}intersectsScaled(t,e){const n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),s=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<n||this._minx>i||this._maxy<s||this._miny>o;if(a)return!1;const l=this.intersectsToleranceSquare(t,e);return et.isTrue(!(a&&l),"Found bad envelope test"),l}initCorners(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new w(this._maxx,this._maxy),this._corner[1]=new w(this._minx,this._maxy),this._corner[2]=new w(this._minx,this._miny),this._corner[3]=new w(this._maxx,this._miny)}intersects(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}scale(t){return Math.round(t*this._scaleFactor)}getCoordinate(){return this._originalPt}copyScaled(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)}getSafeEnvelope(){if(this._safeEnv===null){const t=Gr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ct(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv}intersectsPixelClosure(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))}intersectsToleranceSquare(t,e){let n=!1,i=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||t.equals(this._pt)||e.equals(this._pt))}addSnappedNode(t,e){const n=t.getCoordinate(e),i=t.getCoordinate(e+1);return this.intersects(n,i)?(t.addIntersection(this.getCoordinate(),e),!0):!1}}Gr.SAFE_ENV_EXPANSION_FACTOR=.75;class iu{constructor(){iu.constructor_.apply(this,arguments)}static constructor_(){this.selectedSegment=new At}select(){if(arguments.length!==1){if(arguments.length===2){const t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}}}class Fl{constructor(){Fl.constructor_.apply(this,arguments)}static constructor_(){this._index=null;const t=arguments[0];this._index=t}snap(){if(arguments.length===1){const t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2],i=t.getSafeEnvelope(),s=new Gl(t,e,n);return this._index.query(i,new class{get interfaces_(){return[Tl]}visitItem(o){o.select(i,s)}}),s.isNodeAdded()}}}class Gl extends iu{constructor(){super(),Gl.constructor_.apply(this,arguments)}static constructor_(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;const t=arguments[0],e=arguments[1],n=arguments[2];this._hotPixel=t,this._parentEdge=e,this._hotPixelVertexIndex=n}isNodeAdded(){return this._isNodeAdded}select(){if(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Cf){const t=arguments[0],e=arguments[1],n=t.getContext();if(this._parentEdge===n&&(e===this._hotPixelVertexIndex||e+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(n,e)}else return super.select.apply(this,arguments)}}Fl.HotPixelSnapAction=Gl;class su{constructor(){su.constructor_.apply(this,arguments)}static constructor_(){this._li=null,this._interiorIntersections=null;const t=arguments[0];this._li=t,this._interiorIntersections=new F}processIntersections(t,e,n,i){if(t===n&&e===i)return null;const s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],l=n.getCoordinates()[i+1];if(this._li.computeIntersection(s,o,a,l),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(let c=0;c<this._li.getIntersectionNum();c++)this._interiorIntersections.add(this._li.getIntersection(c));t.addIntersections(this._li,e,0),n.addIntersections(this._li,i,1)}}isDone(){return!1}getInteriorIntersections(){return this._interiorIntersections}get interfaces_(){return[Gh]}}class ru{constructor(){ru.constructor_.apply(this,arguments)}static constructor_(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;const t=arguments[0];this._pm=t,this._li=new Me,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()}checkCorrectness(t){const e=hi.getNodedSubstrings(t),n=new Lo(e);try{n.checkValid()}catch(i){if(i instanceof gn)i.printStackTrace();else throw i}finally{}}getNodedSubstrings(){return hi.getNodedSubstrings(this._nodedSegStrings)}snapRound(t,e){const n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)}findInteriorIntersections(t,e){const n=new su(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()}computeVertexSnaps(){if(H(arguments[0],le)){const t=arguments[0];for(let e=t.iterator();e.hasNext();){const n=e.next();this.computeVertexSnaps(n)}}else if(arguments[0]instanceof hi){const t=arguments[0],e=t.getCoordinates();for(let n=0;n<e.length;n++){const i=new Gr(e[n],this._scaleFactor,this._li);this._pointSnapper.snap(i,t,n)&&t.addIntersection(e[n],n)}}}computeNodes(t){this._nodedSegStrings=t,this._noder=new Br,this._pointSnapper=new Fl(this._noder.getIndex()),this.snapRound(t,this._li)}computeIntersectionSnaps(t){for(let e=t.iterator();e.hasNext();){const n=e.next(),i=new Gr(n,this._scaleFactor,this._li);this._pointSnapper.snap(i)}}get interfaces_(){return[Fh]}}class Jt{constructor(){Jt.constructor_.apply(this,arguments)}static constructor_(){if(this._argGeom=null,this._distance=null,this._bufParams=new nt,this._resultGeometry=null,this._saveException=null,arguments.length===1){const t=arguments[0];this._argGeom=t}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._argGeom=t,this._bufParams=e}}static bufferOp(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Jt(t).getResultGeometry(e)}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof A&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2],i=new Jt(t);return i.setQuadrantSegments(n),i.getResultGeometry(e)}else if(arguments[2]instanceof nt&&arguments[0]instanceof A&&typeof arguments[1]=="number"){const t=arguments[0],e=arguments[1],n=arguments[2];return new Jt(t,n).getResultGeometry(e)}}else if(arguments.length===4){const t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],s=new Jt(t);return s.setQuadrantSegments(n),s.setEndCapStyle(i),s.getResultGeometry(e)}}static precisionScaleFactor(t,e,n){const i=t.getEnvelopeInternal(),s=Xs.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),o=e>0?e:0,a=s+2*o,l=Math.trunc(Math.log(a)/Math.log(10)+1),c=n-l;return Math.pow(10,c)}bufferFixedPrecision(t){const e=new Ka(new ru(new Pt(1)),t.getScale()),n=new Tr(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)}bufferReducedPrecision(){if(arguments.length===0){for(let t=Jt.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(e){if(e instanceof Bn)this._saveException=e;else throw e}finally{}if(this._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){const t=arguments[0],e=Jt.precisionScaleFactor(this._argGeom,this._distance,t),n=new Pt(e);this.bufferFixedPrecision(n)}}computeGeometry(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;const t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Pt.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()}setQuadrantSegments(t){this._bufParams.setQuadrantSegments(t)}bufferOriginalPrecision(){try{const t=new Tr(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof ai)this._saveException=t;else throw t}finally{}}getResultGeometry(t){return this._distance=t,this.computeGeometry(),this._resultGeometry}setEndCapStyle(t){this._bufParams.setEndCapStyle(t)}}Jt.CAP_ROUND=nt.CAP_ROUND;Jt.CAP_BUTT=nt.CAP_FLAT;Jt.CAP_FLAT=nt.CAP_FLAT;Jt.CAP_SQUARE=nt.CAP_SQUARE;Jt.MAX_PRECISION_DIGITS=12;class Nf{createEdgeEndForNext(t,e,n,i){const s=n.segmentIndex+1;if(s>=t.getNumPoints()&&i===null)return null;let o=t.getCoordinate(s);i!==null&&i.segmentIndex===n.segmentIndex&&(o=i.coord);const a=new ui(t,n.coord,o,new Ut(t.getLabel()));e.add(a)}createEdgeEndForPrev(t,e,n,i){let s=n.segmentIndex;if(n.dist===0){if(s===0)return null;s--}let o=t.getCoordinate(s);i!==null&&i.segmentIndex>=s&&(o=i.coord);const a=new Ut(t.getLabel());a.flip();const l=new ui(t,n.coord,o,a);e.add(l)}computeEdgeEnds(){if(arguments.length===1){const t=arguments[0],e=new F;for(let n=t;n.hasNext();){const i=n.next();this.computeEdgeEnds(i,e)}return e}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=t.getEdgeIntersectionList();n.addEndpoints();const i=n.iterator();let s=null,o=null;if(!i.hasNext())return null;let a=i.next();do s=o,o=a,a=null,i.hasNext()&&(a=i.next()),o!==null&&(this.createEdgeEndForPrev(t,e,o,s),this.createEdgeEndForNext(t,e,o,a));while(o!==null)}}}class Ja extends ui{constructor(){super(),Ja.constructor_.apply(this,arguments)}static constructor_(){if(this._edgeEnds=new F,arguments.length===1){const t=arguments[0];Ja.constructor_.call(this,null,t)}else if(arguments.length===2){const t=arguments[1];ui.constructor_.call(this,t.getEdge(),t.getCoordinate(),t.getDirectedCoordinate(),new Ut(t.getLabel())),this.insert(t)}}insert(t){this._edgeEnds.add(t)}print(t){t.println("EdgeEndBundle--> Label: "+this._label);for(let e=this.iterator();e.hasNext();)e.next().print(t),t.println()}iterator(){return this._edgeEnds.iterator()}getEdgeEnds(){return this._edgeEnds}computeLabelOn(t,e){let n=0,i=!1;for(let o=this.iterator();o.hasNext();){const l=o.next().getLabel().getLocation(t);l===y.BOUNDARY&&n++,l===y.INTERIOR&&(i=!0)}let s=y.NONE;i&&(s=y.INTERIOR),n>0&&(s=un.determineBoundary(e,n)),this._label.setLocation(t,s)}computeLabelSide(t,e){for(let n=this.iterator();n.hasNext();){const i=n.next();if(i.getLabel().isArea()){const s=i.getLabel().getLocation(t,e);if(s===y.INTERIOR)return this._label.setLocation(t,e,y.INTERIOR),null;s===y.EXTERIOR&&this._label.setLocation(t,e,y.EXTERIOR)}}}getLabel(){return this._label}computeLabelSides(t){this.computeLabelSide(t,P.LEFT),this.computeLabelSide(t,P.RIGHT)}updateIM(t){An.updateIM(this._label,t)}computeLabel(t){let e=!1;for(let n=this.iterator();n.hasNext();)n.next().getLabel().isArea()&&(e=!0);e?this._label=new Ut(y.NONE,y.NONE,y.NONE):this._label=new Ut(y.NONE);for(let n=0;n<2;n++)this.computeLabelOn(n,t),e&&this.computeLabelSides(n)}}class pI extends vl{constructor(){super()}updateIM(t){for(let e=this.iterator();e.hasNext();)e.next().updateIM(t)}insert(t){let e=this._edgeMap.get(t);e===null?(e=new Ja(t),this.insertEdgeEnd(t,e)):e.insert(t)}}class ou extends Gi{constructor(){super(),ou.constructor_.apply(this,arguments)}static constructor_(){const t=arguments[0],e=arguments[1];Gi.constructor_.call(this,t,e)}updateIMFromEdges(t){this._edges.updateIM(t)}computeIM(t){t.setAtLeastIfValid(this._label.getLocation(0),this._label.getLocation(1),0)}}class Sf extends Yh{constructor(){super()}createNode(t){return new ou(t,new pI)}}class $a{constructor(){$a.constructor_.apply(this,arguments)}static constructor_(){this._li=new Me,this._ptLocator=new Ks,this._arg=null,this._nodes=new Fr(new Sf),this._im=null,this._isolatedEdges=new F,this._invalidPoint=null;const t=arguments[0];this._arg=t}insertEdgeEnds(t){for(let e=t.iterator();e.hasNext();){const n=e.next();this._nodes.add(n)}}computeProperIntersectionIM(t,e){const n=this._arg[0].getGeometry().getDimension(),i=this._arg[1].getGeometry().getDimension(),s=t.hasProperIntersection(),o=t.hasProperInteriorIntersection();n===2&&i===2?s&&e.setAtLeast("212101212"):n===2&&i===1?(s&&e.setAtLeast("FFF0FFFF2"),o&&e.setAtLeast("1FFFFF1FF")):n===1&&i===2?(s&&e.setAtLeast("F0FFFFFF2"),o&&e.setAtLeast("1F1FFFFFF")):n===1&&i===1&&o&&e.setAtLeast("0FFFFFFFF")}labelIsolatedEdges(t,e){for(let n=this._arg[t].getEdgeIterator();n.hasNext();){const i=n.next();i.isIsolated()&&(this.labelIsolatedEdge(i,e,this._arg[e].getGeometry()),this._isolatedEdges.add(i))}}labelIsolatedEdge(t,e,n){if(n.getDimension()>0){const i=this._ptLocator.locate(t.getCoordinate(),n);t.getLabel().setAllLocations(e,i)}else t.getLabel().setAllLocations(e,y.EXTERIOR)}computeIM(){const t=new Tt;if(t.set(y.EXTERIOR,y.EXTERIOR,2),!this._arg[0].getGeometry().getEnvelopeInternal().intersects(this._arg[1].getGeometry().getEnvelopeInternal()))return this.computeDisjointIM(t),t;this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1);const e=this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!1);this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(e,t);const n=new Nf,i=n.computeEdgeEnds(this._arg[0].getEdgeIterator());this.insertEdgeEnds(i);const s=n.computeEdgeEnds(this._arg[1].getEdgeIterator());return this.insertEdgeEnds(s),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(t),t}labelNodeEdges(){for(let t=this._nodes.iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg)}copyNodesAndLabels(t){for(let e=this._arg[t].getNodeIterator();e.hasNext();){const n=e.next();this._nodes.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}}labelIntersectionNodes(t){for(let e=this._arg[t].getEdgeIterator();e.hasNext();){const n=e.next(),i=n.getLabel().getLocation(t);for(let s=n.getEdgeIntersectionList().iterator();s.hasNext();){const o=s.next(),a=this._nodes.find(o.coord);a.getLabel().isNull(t)&&(i===y.BOUNDARY?a.setLabelBoundary(t):a.setLabel(t,y.INTERIOR))}}}labelIsolatedNode(t,e){const n=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setAllLocations(e,n)}computeIntersectionNodes(t){for(let e=this._arg[t].getEdgeIterator();e.hasNext();){const n=e.next(),i=n.getLabel().getLocation(t);for(let s=n.getEdgeIntersectionList().iterator();s.hasNext();){const o=s.next(),a=this._nodes.addNode(o.coord);i===y.BOUNDARY?a.setLabelBoundary(t):a.getLabel().isNull(t)&&a.setLabel(t,y.INTERIOR)}}}labelIsolatedNodes(){for(let t=this._nodes.iterator();t.hasNext();){const e=t.next(),n=e.getLabel();et.isTrue(n.getGeometryCount()>0,"node with empty label found"),e.isIsolated()&&(n.isNull(0)?this.labelIsolatedNode(e,0):this.labelIsolatedNode(e,1))}}updateIM(t){for(let e=this._isolatedEdges.iterator();e.hasNext();)e.next().updateIM(t);for(let e=this._nodes.iterator();e.hasNext();){const n=e.next();n.updateIM(t),n.updateIMFromEdges(t)}}computeDisjointIM(t){const e=this._arg[0].getGeometry();e.isEmpty()||(t.set(y.INTERIOR,y.EXTERIOR,e.getDimension()),t.set(y.BOUNDARY,y.EXTERIOR,e.getBoundaryDimension()));const n=this._arg[1].getGeometry();n.isEmpty()||(t.set(y.EXTERIOR,y.INTERIOR,n.getDimension()),t.set(y.EXTERIOR,y.BOUNDARY,n.getBoundaryDimension()))}}class Qa{constructor(){Qa.constructor_.apply(this,arguments)}static constructor_(){this._rectEnv=null;const t=arguments[0];this._rectEnv=t.getEnvelopeInternal()}static contains(t,e){return new Qa(t).contains(e)}isContainedInBoundary(t){if(t instanceof jt)return!1;if(t instanceof ee)return this.isPointContainedInBoundary(t);if(t instanceof vt)return this.isLineStringContainedInBoundary(t);for(let e=0;e<t.getNumGeometries();e++){const n=t.getGeometryN(e);if(!this.isContainedInBoundary(n))return!1}return!0}isLineSegmentContainedInBoundary(t,e){if(t.equals(e))return this.isPointContainedInBoundary(t);if(t.x===e.x){if(t.x===this._rectEnv.getMinX()||t.x===this._rectEnv.getMaxX())return!0}else if(t.y===e.y&&(t.y===this._rectEnv.getMinY()||t.y===this._rectEnv.getMaxY()))return!0;return!1}isLineStringContainedInBoundary(t){const e=t.getCoordinateSequence(),n=new w,i=new w;for(let s=0;s<e.size()-1;s++)if(e.getCoordinate(s,n),e.getCoordinate(s+1,i),!this.isLineSegmentContainedInBoundary(n,i))return!1;return!0}isPointContainedInBoundary(){if(arguments[0]instanceof ee){const t=arguments[0];return this.isPointContainedInBoundary(t.getCoordinate())}else if(arguments[0]instanceof w){const t=arguments[0];return t.x===this._rectEnv.getMinX()||t.x===this._rectEnv.getMaxX()||t.y===this._rectEnv.getMinY()||t.y===this._rectEnv.getMaxY()}}contains(t){return!(!this._rectEnv.contains(t.getEnvelopeInternal())||this.isContainedInBoundary(t))}}class au{constructor(){au.constructor_.apply(this,arguments)}static constructor_(){this._li=new Me,this._rectEnv=null,this._diagUp0=null,this._diagUp1=null,this._diagDown0=null,this._diagDown1=null;const t=arguments[0];this._rectEnv=t,this._diagUp0=new w(t.getMinX(),t.getMinY()),this._diagUp1=new w(t.getMaxX(),t.getMaxY()),this._diagDown0=new w(t.getMinX(),t.getMaxY()),this._diagDown1=new w(t.getMaxX(),t.getMinY())}intersects(t,e){const n=new ct(t,e);if(!this._rectEnv.intersects(n))return!1;if(this._rectEnv.intersects(t)||this._rectEnv.intersects(e))return!0;if(t.compareTo(e)>0){const s=t;t=e,e=s}let i=!1;return e.y>t.y&&(i=!0),i?this._li.computeIntersection(t,e,this._diagDown0,this._diagDown1):this._li.computeIntersection(t,e,this._diagUp0,this._diagUp1),!!this._li.hasIntersection()}}class bo{constructor(){bo.constructor_.apply(this,arguments)}static constructor_(){this._rectangle=null,this._rectEnv=null;const t=arguments[0];this._rectangle=t,this._rectEnv=t.getEnvelopeInternal()}static intersects(t,e){return new bo(t).intersects(e)}intersects(t){if(!this._rectEnv.intersects(t.getEnvelopeInternal()))return!1;const e=new lu(this._rectEnv);if(e.applyTo(t),e.intersects())return!0;const n=new cu(this._rectangle);if(n.applyTo(t),n.containsPoint())return!0;const i=new hu(this._rectangle);return i.applyTo(t),!!i.intersects()}}class lu extends Bo{constructor(){super(),lu.constructor_.apply(this,arguments)}static constructor_(){this._rectEnv=null,this._intersects=!1;const t=arguments[0];this._rectEnv=t}isDone(){return this._intersects===!0}visit(t){const e=t.getEnvelopeInternal();if(!this._rectEnv.intersects(e))return null;if(this._rectEnv.contains(e))return this._intersects=!0,null;if(e.getMinX()>=this._rectEnv.getMinX()&&e.getMaxX()<=this._rectEnv.getMaxX())return this._intersects=!0,null;if(e.getMinY()>=this._rectEnv.getMinY()&&e.getMaxY()<=this._rectEnv.getMaxY())return this._intersects=!0,null}intersects(){return this._intersects}}class cu extends Bo{constructor(){super(),cu.constructor_.apply(this,arguments)}static constructor_(){this._rectSeq=null,this._rectEnv=null,this._containsPoint=!1;const t=arguments[0];this._rectSeq=t.getExteriorRing().getCoordinateSequence(),this._rectEnv=t.getEnvelopeInternal()}isDone(){return this._containsPoint===!0}visit(t){if(!(t instanceof jt))return null;const e=t.getEnvelopeInternal();if(!this._rectEnv.intersects(e))return null;const n=new w;for(let i=0;i<4;i++)if(this._rectSeq.getCoordinate(i,n),!!e.contains(n)&&Cn.containsPointInPolygon(n,t))return this._containsPoint=!0,null}containsPoint(){return this._containsPoint}}class hu extends Bo{constructor(){super(),hu.constructor_.apply(this,arguments)}static constructor_(){this._rectEnv=null,this._rectIntersector=null,this._hasIntersection=!1,this._p0=new w,this._p1=new w;const t=arguments[0];this._rectEnv=t.getEnvelopeInternal(),this._rectIntersector=new au(this._rectEnv)}intersects(){return this._hasIntersection}isDone(){return this._hasIntersection===!0}visit(t){const e=t.getEnvelopeInternal();if(!this._rectEnv.intersects(e))return null;const n=je.getLines(t);this.checkIntersectionWithLineStrings(n)}checkIntersectionWithLineStrings(t){for(let e=t.iterator();e.hasNext();){const n=e.next();if(this.checkIntersectionWithSegments(n),this._hasIntersection)return null}}checkIntersectionWithSegments(t){const e=t.getCoordinateSequence();for(let n=1;n<e.size();n++)if(e.getCoordinate(n-1,this._p0),e.getCoordinate(n,this._p1),this._rectIntersector.intersects(this._p0,this._p1))return this._hasIntersection=!0,null}}class Bt extends ls{constructor(){super(),Bt.constructor_.apply(this,arguments)}static constructor_(){if(this._relate=null,arguments.length===2){const t=arguments[0],e=arguments[1];ls.constructor_.call(this,t,e),this._relate=new $a(this._arg)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];ls.constructor_.call(this,t,e,n),this._relate=new $a(this._arg)}}static covers(t,e){return e.getDimension()===2&&t.getDimension()<2||e.getDimension()===1&&t.getDimension()<1&&e.getLength()>0||!t.getEnvelopeInternal().covers(e.getEnvelopeInternal())?!1:t.isRectangle()?!0:new Bt(t,e).getIntersectionMatrix().isCovers()}static intersects(t,e){if(!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal()))return!1;if(t.isRectangle())return bo.intersects(t,e);if(e.isRectangle())return bo.intersects(e,t);if(t.isGeometryCollection()||e.isGeometryCollection()){for(let n=0;n<t.getNumGeometries();n++)for(let i=0;i<e.getNumGeometries();i++)if(t.getGeometryN(n).intersects(e.getGeometryN(i)))return!0;return!1}return new Bt(t,e).getIntersectionMatrix().isIntersects()}static touches(t,e){return t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())?new Bt(t,e).getIntersectionMatrix().isTouches(t.getDimension(),e.getDimension()):!1}static equalsTopo(t,e){return t.getEnvelopeInternal().equals(e.getEnvelopeInternal())?Bt.relate(t,e).isEquals(t.getDimension(),e.getDimension()):!1}static relate(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Bt(t,e).getIntersectionMatrix()}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return new Bt(t,e,n).getIntersectionMatrix()}}static overlaps(t,e){return t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())?new Bt(t,e).getIntersectionMatrix().isOverlaps(t.getDimension(),e.getDimension()):!1}static crosses(t,e){return t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())?new Bt(t,e).getIntersectionMatrix().isCrosses(t.getDimension(),e.getDimension()):!1}static contains(t,e){return e.getDimension()===2&&t.getDimension()<2||e.getDimension()===1&&t.getDimension()<1&&e.getLength()>0||!t.getEnvelopeInternal().contains(e.getEnvelopeInternal())?!1:t.isRectangle()?Qa.contains(t,e):new Bt(t,e).getIntersectionMatrix().isContains()}getIntersectionMatrix(){return this._relate.computeIM()}}class tl{constructor(){tl.constructor_.apply(this,arguments)}static constructor_(){this._geometryFactory=new Qt,this._geomGraph=null,this._disconnectedRingcoord=null;const t=arguments[0];this._geomGraph=t}static findDifferentPoint(t,e){for(let n=0;n<t.length;n++)if(!t[n].equals(e))return t[n];return null}visitInteriorRing(t,e){if(t.isEmpty())return null;const n=t.getCoordinates(),i=n[0],s=tl.findDifferentPoint(n,i),o=e.findEdgeInSameDirection(i,s),a=e.findEdgeEnd(o);let l=null;a.getLabel().getLocation(0,P.RIGHT)===y.INTERIOR?l=a:a.getSym().getLabel().getLocation(0,P.RIGHT)===y.INTERIOR&&(l=a.getSym()),et.isTrue(l!==null,"unable to find dirEdge with Interior on RHS"),this.visitLinkedDirectedEdges(l)}visitShellInteriors(t,e){if(t instanceof jt){const n=t;this.visitInteriorRing(n.getExteriorRing(),e)}if(t instanceof nn){const n=t;for(let i=0;i<n.getNumGeometries();i++){const s=n.getGeometryN(i);this.visitInteriorRing(s.getExteriorRing(),e)}}}getCoordinate(){return this._disconnectedRingcoord}setInteriorEdgesInResult(t){for(let e=t.getEdgeEnds().iterator();e.hasNext();){const n=e.next();n.getLabel().getLocation(0,P.RIGHT)===y.INTERIOR&&n.setInResult(!0)}}visitLinkedDirectedEdges(t){const e=t;let n=t;do et.isTrue(n!==null,"found null Directed Edge"),n.setVisited(!0),n=n.getNext();while(n!==e)}buildEdgeRings(t){const e=new F;for(let n=t.iterator();n.hasNext();){const i=n.next();if(i.isInResult()&&i.getEdgeRing()===null){const s=new Ll(i,this._geometryFactory);s.linkDirectedEdgesForMinimalEdgeRings();const o=s.buildMinimalRings();e.addAll(o)}}return e}hasUnvisitedShellEdge(t){for(let e=0;e<t.size();e++){const n=t.get(e);if(n.isHole())continue;const i=n.getEdges();let s=i.get(0);if(s.getLabel().getLocation(0,P.RIGHT)===y.INTERIOR){for(let o=0;o<i.size();o++)if(s=i.get(o),!s.isVisited())return this._disconnectedRingcoord=s.getCoordinate(),!0}}return!1}isInteriorsConnected(){const t=new F;this._geomGraph.computeSplitEdges(t);const e=new Js(new Bh);e.addEdges(t),this.setInteriorEdgesInResult(e),e.linkResultDirectedEdges();const n=this.buildEdgeRings(e.getEdgeEnds());return this.visitShellInteriors(this._geomGraph.getGeometry(),e),!this.hasUnvisitedShellEdge(n)}}class uu{constructor(){uu.constructor_.apply(this,arguments)}static constructor_(){this._nodes=new Fr(new Sf)}insertEdgeEnds(t){for(let e=t.iterator();e.hasNext();){const n=e.next();this._nodes.add(n)}}getNodeIterator(){return this._nodes.iterator()}copyNodesAndLabels(t,e){for(let n=t.getNodeIterator();n.hasNext();){const i=n.next();this._nodes.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}}build(t){this.computeIntersectionNodes(t,0),this.copyNodesAndLabels(t,0);const n=new Nf().computeEdgeEnds(t.getEdgeIterator());this.insertEdgeEnds(n)}computeIntersectionNodes(t,e){for(let n=t.getEdgeIterator();n.hasNext();){const i=n.next(),s=i.getLabel().getLocation(e);for(let o=i.getEdgeIntersectionList().iterator();o.hasNext();){const a=o.next(),l=this._nodes.addNode(a.coord);s===y.BOUNDARY?l.setLabelBoundary(e):l.getLabel().isNull(e)&&l.setLabel(e,y.INTERIOR)}}}}class gu{constructor(){gu.constructor_.apply(this,arguments)}static constructor_(){this._li=new Me,this._geomGraph=null,this._nodeGraph=new uu,this._invalidPoint=null;const t=arguments[0];this._geomGraph=t}isNodeEdgeAreaLabelsConsistent(){for(let t=this._nodeGraph.getNodeIterator();t.hasNext();){const e=t.next();if(!e.getEdges().isAreaLabelsConsistent(this._geomGraph))return this._invalidPoint=e.getCoordinate().copy(),!1}return!0}getInvalidPoint(){return this._invalidPoint}hasDuplicateRings(){for(let t=this._nodeGraph.getNodeIterator();t.hasNext();){const e=t.next();for(let n=e.getEdges().iterator();n.hasNext();){const i=n.next();if(i.getEdgeEnds().size()>1)return this._invalidPoint=i.getEdge().getCoordinate(0),!0}}return!1}isNodeConsistentArea(){const t=this._geomGraph.computeSelfNodes(this._li,!0,!0);return t.hasProperIntersection()?(this._invalidPoint=t.getProperIntersectionPoint(),!1):(this._nodeGraph.build(this._geomGraph),this.isNodeEdgeAreaLabelsConsistent())}}class du{constructor(){du.constructor_.apply(this,arguments)}static constructor_(){this._graph=null,this._rings=new F,this._totalEnv=new ct,this._index=null,this._nestedPt=null;const t=arguments[0];this._graph=t}buildIndex(){this._index=new te;for(let t=0;t<this._rings.size();t++){const e=this._rings.get(t),n=e.getEnvelopeInternal();this._index.insert(n,e)}}getNestedPoint(){return this._nestedPt}isNonNested(){this.buildIndex();for(let t=0;t<this._rings.size();t++){const e=this._rings.get(t),n=e.getCoordinates(),i=this._index.query(e.getEnvelopeInternal());for(let s=0;s<i.size();s++){const o=i.get(s),a=o.getCoordinates();if(e===o||!e.getEnvelopeInternal().intersects(o.getEnvelopeInternal()))continue;const l=ei.findPtNotNode(n,o,this._graph);if(l===null)continue;if(wn.isInRing(l,a))return this._nestedPt=l,!1}}return!0}add(t){this._rings.add(t),this._totalEnv.expandToInclude(t.getEnvelopeInternal())}}class pt{constructor(){pt.constructor_.apply(this,arguments)}static constructor_(){if(this._errorType=null,this._pt=null,arguments.length===1){const t=arguments[0];pt.constructor_.call(this,t,null)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._errorType=t,e!==null&&(this._pt=e.copy())}}getErrorType(){return this._errorType}getMessage(){return pt.errMsg[this._errorType]}getCoordinate(){return this._pt}toString(){let t="";return this._pt!==null&&(t=" at or near point "+this._pt),this.getMessage()+t}}pt.ERROR=0;pt.REPEATED_POINT=1;pt.HOLE_OUTSIDE_SHELL=2;pt.NESTED_HOLES=3;pt.DISCONNECTED_INTERIOR=4;pt.SELF_INTERSECTION=5;pt.RING_SELF_INTERSECTION=6;pt.NESTED_SHELLS=7;pt.DUPLICATE_RINGS=8;pt.TOO_FEW_POINTS=9;pt.INVALID_COORDINATE=10;pt.RING_NOT_CLOSED=11;pt.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"];class ei{constructor(){ei.constructor_.apply(this,arguments)}static constructor_(){this._parentGeometry=null,this._isSelfTouchingRingFormingHoleValid=!1,this._validErr=null;const t=arguments[0];this._parentGeometry=t}static findPtNotNode(t,e,n){const s=n.findEdge(e).getEdgeIntersectionList();for(let o=0;o<t.length;o++){const a=t[o];if(!s.isIntersection(a))return a}return null}static isValid(){if(arguments[0]instanceof A){const t=arguments[0];return new ei(t).isValid()}else if(arguments[0]instanceof w){const t=arguments[0];return!(j.isNaN(t.x)||j.isInfinite(t.x)||j.isNaN(t.y)||j.isInfinite(t.y))}}checkInvalidCoordinates(){if(arguments[0]instanceof Array){const t=arguments[0];for(let e=0;e<t.length;e++)if(!ei.isValid(t[e]))return this._validErr=new pt(pt.INVALID_COORDINATE,t[e]),null}else if(arguments[0]instanceof jt){const t=arguments[0];if(this.checkInvalidCoordinates(t.getExteriorRing().getCoordinates()),this._validErr!==null)return null;for(let e=0;e<t.getNumInteriorRing();e++)if(this.checkInvalidCoordinates(t.getInteriorRingN(e).getCoordinates()),this._validErr!==null)return null}}checkHolesNotNested(t,e){if(t.getNumInteriorRing()<=0)return null;const n=new du(e);for(let s=0;s<t.getNumInteriorRing();s++){const o=t.getInteriorRingN(s);o.isEmpty()||n.add(o)}n.isNonNested()||(this._validErr=new pt(pt.NESTED_HOLES,n.getNestedPoint()))}checkConsistentArea(t){const e=new gu(t);if(!e.isNodeConsistentArea())return this._validErr=new pt(pt.SELF_INTERSECTION,e.getInvalidPoint()),null;e.hasDuplicateRings()&&(this._validErr=new pt(pt.DUPLICATE_RINGS,e.getInvalidPoint()))}isValid(){return this.checkValid(this._parentGeometry),this._validErr===null}checkShellInsideHole(t,e,n){const i=t.getCoordinates(),s=e.getCoordinates(),o=ei.findPtNotNode(i,e,n);if(o!==null&&!wn.isInRing(o,s))return o;const a=ei.findPtNotNode(s,t,n);return a!==null?wn.isInRing(a,i)?a:null:(et.shouldNeverReachHere("points in shell and hole appear to be equal"),null)}checkNoSelfIntersectingRings(t){for(let e=t.getEdgeIterator();e.hasNext();){const n=e.next();if(this.checkNoSelfIntersectingRing(n.getEdgeIntersectionList()),this._validErr!==null)return null}}checkConnectedInteriors(t){const e=new tl(t);e.isInteriorsConnected()||(this._validErr=new pt(pt.DISCONNECTED_INTERIOR,e.getCoordinate()))}checkNoSelfIntersectingRing(t){const e=new zs;let n=!0;for(let i=t.iterator();i.hasNext();){const s=i.next();if(n){n=!1;continue}if(e.contains(s.coord))return this._validErr=new pt(pt.RING_SELF_INTERSECTION,s.coord),null;e.add(s.coord)}}checkHolesInShell(t,e){if(t.getNumInteriorRing()<=0)return null;const n=t.getExteriorRing(),i=n.isEmpty(),s=new Zr(n);for(let o=0;o<t.getNumInteriorRing();o++){const a=t.getInteriorRingN(o);let l=null;if(a.isEmpty())continue;if(l=ei.findPtNotNode(a.getCoordinates(),n,e),l===null)return null;if(i||y.EXTERIOR===s.locate(l))return this._validErr=new pt(pt.HOLE_OUTSIDE_SHELL,l),null}}checkTooFewPoints(t){if(t.hasTooFewPoints())return this._validErr=new pt(pt.TOO_FEW_POINTS,t.getInvalidPoint()),null}getValidationError(){return this.checkValid(this._parentGeometry),this._validErr}checkValid(){if(arguments[0]instanceof ee){const t=arguments[0];this.checkInvalidCoordinates(t.getCoordinates())}else if(arguments[0]instanceof Wn){const t=arguments[0];this.checkInvalidCoordinates(t.getCoordinates())}else if(arguments[0]instanceof ve){const t=arguments[0];if(this.checkInvalidCoordinates(t.getCoordinates()),this._validErr!==null||(this.checkClosedRing(t),this._validErr!==null))return null;const e=new un(0,t);if(this.checkTooFewPoints(e),this._validErr!==null)return null;const n=new Me;e.computeSelfNodes(n,!0,!0),this.checkNoSelfIntersectingRings(e)}else if(arguments[0]instanceof vt){const t=arguments[0];if(this.checkInvalidCoordinates(t.getCoordinates()),this._validErr!==null)return null;const e=new un(0,t);this.checkTooFewPoints(e)}else if(arguments[0]instanceof jt){const t=arguments[0];if(this.checkInvalidCoordinates(t),this._validErr!==null||(this.checkClosedRings(t),this._validErr!==null))return null;const e=new un(0,t);if(this.checkTooFewPoints(e),this._validErr!==null||(this.checkConsistentArea(e),this._validErr!==null)||!this._isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(e),this._validErr!==null)||(this.checkHolesInShell(t,e),this._validErr!==null)||(this.checkHolesNotNested(t,e),this._validErr!==null))return null;this.checkConnectedInteriors(e)}else if(arguments[0]instanceof nn){const t=arguments[0];for(let n=0;n<t.getNumGeometries();n++){const i=t.getGeometryN(n);if(this.checkInvalidCoordinates(i),this._validErr!==null||(this.checkClosedRings(i),this._validErr!==null))return null}const e=new un(0,t);if(this.checkTooFewPoints(e),this._validErr!==null||(this.checkConsistentArea(e),this._validErr!==null)||!this._isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(e),this._validErr!==null))return null;for(let n=0;n<t.getNumGeometries();n++){const i=t.getGeometryN(n);if(this.checkHolesInShell(i,e),this._validErr!==null)return null}for(let n=0;n<t.getNumGeometries();n++){const i=t.getGeometryN(n);if(this.checkHolesNotNested(i,e),this._validErr!==null)return null}if(this.checkShellsNotNested(t,e),this._validErr!==null)return null;this.checkConnectedInteriors(e)}else if(arguments[0]instanceof St){const t=arguments[0];for(let e=0;e<t.getNumGeometries();e++){const n=t.getGeometryN(e);if(this.checkValid(n),this._validErr!==null)return null}}else if(arguments[0]instanceof A){const t=arguments[0];if(this._validErr=null,t.isEmpty())return null;if(t instanceof ee)this.checkValid(t);else if(t instanceof Wn)this.checkValid(t);else if(t instanceof ve)this.checkValid(t);else if(t instanceof vt)this.checkValid(t);else if(t instanceof jt)this.checkValid(t);else if(t instanceof nn)this.checkValid(t);else if(t instanceof St)this.checkValid(t);else throw new _i(t.getGeometryType())}}setSelfTouchingRingFormingHoleValid(t){this._isSelfTouchingRingFormingHoleValid=t}checkShellNotNested(t,e,n){const i=t.getCoordinates(),s=e.getExteriorRing();if(s.isEmpty())return null;const o=s.getCoordinates(),a=ei.findPtNotNode(i,s,n);if(a===null||!wn.isInRing(a,o))return null;if(e.getNumInteriorRing()<=0)return this._validErr=new pt(pt.NESTED_SHELLS,a),null;let c=null;for(let h=0;h<e.getNumInteriorRing();h++){const u=e.getInteriorRingN(h);if(c=this.checkShellInsideHole(t,u,n),c===null)return null}this._validErr=new pt(pt.NESTED_SHELLS,c)}checkClosedRings(t){if(this.checkClosedRing(t.getExteriorRing()),this._validErr!==null)return null;for(let e=0;e<t.getNumInteriorRing();e++)if(this.checkClosedRing(t.getInteriorRingN(e)),this._validErr!==null)return null}checkClosedRing(t){if(t.isEmpty())return null;if(!t.isClosed()){let e=null;t.getNumPoints()>=1&&(e=t.getCoordinateN(0)),this._validErr=new pt(pt.RING_NOT_CLOSED,e)}}checkShellsNotNested(t,e){for(let n=0;n<t.getNumGeometries();n++){const s=t.getGeometryN(n).getExteriorRing();for(let o=0;o<t.getNumGeometries();o++){if(n===o)continue;const a=t.getGeometryN(o);if(this.checkShellNotNested(s,a,e),this._validErr!==null)return null}}}}class ki{constructor(){ki.constructor_.apply(this,arguments)}static constructor_(){this._interiorPoint=null,this._maxWidth=-1;const t=arguments[0];this.process(t)}static getInteriorPoint(t){return new ki(t).getInteriorPoint()}static avg(t,e){return(t+e)/2}getInteriorPoint(){return this._interiorPoint}process(t){if(t.isEmpty())return null;if(t instanceof jt)this.processPolygon(t);else if(t instanceof St){const e=t;for(let n=0;n<e.getNumGeometries();n++)this.process(e.getGeometryN(n))}}processPolygon(t){const e=new Mi(t);e.process();const n=e.getWidth();n>this._maxWidth&&(this._maxWidth=n,this._interiorPoint=e.getInteriorPoint())}}class Mi{constructor(){Mi.constructor_.apply(this,arguments)}static constructor_(){this._polygon=null,this._interiorPointY=null,this._interiorSectionWidth=0,this._interiorPoint=null;const t=arguments[0];this._polygon=t,this._interiorPointY=vo.getScanLineY(t)}static isEdgeCrossingCounted(t,e,n){const i=t.getY(),s=e.getY();return!(i===s||i===n&&s<n||s===n&&i<n)}static intersectsHorizontalLine(){if(arguments.length===2){const t=arguments[0],e=arguments[1];return!(e<t.getMinY()||e>t.getMaxY())}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];return!(t.getY()>n&&e.getY()>n||t.getY()<n&&e.getY()<n)}}static intersection(t,e,n){const i=t.getX(),s=e.getX();if(i===s)return i;const o=s-i,l=(e.getY()-t.getY())/o;return i+(n-t.getY())/l}findBestMidpoint(t){if(t.size()===0)return null;et.isTrue(t.size()%2===0,"Interior Point robustness failure: odd number of scanline crossings"),t.sort(new Lf);for(let e=0;e<t.size();e+=2){const n=t.get(e),i=t.get(e+1),s=i-n;if(s>this._interiorSectionWidth){this._interiorSectionWidth=s;const o=ki.avg(n,i);this._interiorPoint=new w(o,this._interiorPointY)}}}process(){if(this._polygon.isEmpty())return null;this._interiorPoint=new w(this._polygon.getCoordinate());const t=new F;this.scanRing(this._polygon.getExteriorRing(),t);for(let e=0;e<this._polygon.getNumInteriorRing();e++)this.scanRing(this._polygon.getInteriorRingN(e),t);this.findBestMidpoint(t)}scanRing(t,e){if(!Mi.intersectsHorizontalLine(t.getEnvelopeInternal(),this._interiorPointY))return null;const n=t.getCoordinateSequence();for(let i=1;i<n.size();i++){const s=n.getCoordinate(i-1),o=n.getCoordinate(i);this.addEdgeCrossing(s,o,this._interiorPointY,e)}}getWidth(){return this._interiorSectionWidth}getInteriorPoint(){return this._interiorPoint}addEdgeCrossing(t,e,n,i){if(!Mi.intersectsHorizontalLine(t,e,n)||!Mi.isEdgeCrossingCounted(t,e,n))return null;const s=Mi.intersection(t,e,n);i.add(s)}}class Lf{compare(t,e){return t<e?-1:t>e?1:0}get interfaces_(){return[gs]}}Mi.DoubleComparator=Lf;class vo{constructor(){vo.constructor_.apply(this,arguments)}static constructor_(){this._poly=null,this._centreY=null,this._hiY=j.MAX_VALUE,this._loY=-j.MAX_VALUE;const t=arguments[0];this._poly=t,this._hiY=t.getEnvelopeInternal().getMaxY(),this._loY=t.getEnvelopeInternal().getMinY(),this._centreY=ki.avg(this._loY,this._hiY)}static getScanLineY(t){return new vo(t).getScanLineY()}updateInterval(t){t<=this._centreY?t>this._loY&&(this._loY=t):t>this._centreY&&t<this._hiY&&(this._hiY=t)}getScanLineY(){this.process(this._poly.getExteriorRing());for(let e=0;e<this._poly.getNumInteriorRing();e++)this.process(this._poly.getInteriorRingN(e));return ki.avg(this._hiY,this._loY)}process(t){const e=t.getCoordinateSequence();for(let n=0;n<e.size();n++){const i=e.getY(n);this.updateInterval(i)}}}ki.InteriorPointPolygon=Mi;ki.ScanLineYOrdinateFinder=vo;class Os{constructor(){Os.constructor_.apply(this,arguments)}static constructor_(){this._areaBasePt=null,this._triangleCent3=new w,this._areasum2=0,this._cg3=new w,this._lineCentSum=new w,this._totalLength=0,this._ptCount=0,this._ptCentSum=new w;const t=arguments[0];this._areaBasePt=null,this.add(t)}static area2(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}static centroid3(t,e,n,i){return i.x=t.x+e.x+n.x,i.y=t.y+e.y+n.y,null}static getCentroid(t){return new Os(t).getCentroid()}setAreaBasePoint(t){this._areaBasePt=t}addPoint(t){this._ptCount+=1,this._ptCentSum.x+=t.x,this._ptCentSum.y+=t.y}addLineSegments(t){let e=0;for(let n=0;n<t.length-1;n++){const i=t[n].distance(t[n+1]);if(i===0)continue;e+=i;const s=(t[n].x+t[n+1].x)/2;this._lineCentSum.x+=i*s;const o=(t[n].y+t[n+1].y)/2;this._lineCentSum.y+=i*o}this._totalLength+=e,e===0&&t.length>0&&this.addPoint(t[0])}addHole(t){const e=J.isCCW(t);for(let n=0;n<t.length-1;n++)this.addTriangle(this._areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)}getCentroid(){const t=new w;if(Math.abs(this._areasum2)>0)t.x=this._cg3.x/3/this._areasum2,t.y=this._cg3.y/3/this._areasum2;else if(this._totalLength>0)t.x=this._lineCentSum.x/this._totalLength,t.y=this._lineCentSum.y/this._totalLength;else if(this._ptCount>0)t.x=this._ptCentSum.x/this._ptCount,t.y=this._ptCentSum.y/this._ptCount;else return null;return t}addShell(t){t.length>0&&this.setAreaBasePoint(t[0]);const e=!J.isCCW(t);for(let n=0;n<t.length-1;n++)this.addTriangle(this._areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)}addTriangle(t,e,n,i){const s=i?1:-1;Os.centroid3(t,e,n,this._triangleCent3);const o=Os.area2(t,e,n);this._cg3.x+=s*o*this._triangleCent3.x,this._cg3.y+=s*o*this._triangleCent3.y,this._areasum2+=s*o}add(){if(arguments[0]instanceof jt){const t=arguments[0];this.addShell(t.getExteriorRing().getCoordinates());for(let e=0;e<t.getNumInteriorRing();e++)this.addHole(t.getInteriorRingN(e).getCoordinates())}else if(arguments[0]instanceof A){const t=arguments[0];if(t.isEmpty())return null;if(t instanceof ee)this.addPoint(t.getCoordinate());else if(t instanceof vt)this.addLineSegments(t.getCoordinates());else if(t instanceof jt){const e=t;this.add(e)}else if(t instanceof St){const e=t;for(let n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))}}}}class el{constructor(){el.constructor_.apply(this,arguments)}static constructor_(){this._centroid=null,this._minDistance=j.MAX_VALUE,this._interiorPoint=null;const t=arguments[0];t.isEmpty()?this._centroid=null:(this._centroid=Os.getCentroid(t),t.getPrecisionModel().makePrecise(this._centroid)),this.addInterior(t),this._interiorPoint===null&&this.addEndpoints(t)}static getInteriorPoint(t){return new el(t).getInteriorPoint()}addEndpoints(){if(arguments[0]instanceof A){const t=arguments[0];if(t instanceof vt)this.addEndpoints(t.getCoordinates());else if(t instanceof St){const e=t;for(let n=0;n<e.getNumGeometries();n++)this.addEndpoints(e.getGeometryN(n))}}else if(arguments[0]instanceof Array){const t=arguments[0];this.add(t[0]),this.add(t[t.length-1])}}getInteriorPoint(){return this._interiorPoint}addInterior(){if(arguments[0]instanceof A){const t=arguments[0];if(t instanceof vt)this.addInterior(t.getCoordinates());else if(t instanceof St){const e=t;for(let n=0;n<e.getNumGeometries();n++)this.addInterior(e.getGeometryN(n))}}else if(arguments[0]instanceof Array){const t=arguments[0];for(let e=1;e<t.length-1;e++)this.add(t[e])}}add(t){const e=t.distance(this._centroid);e<this._minDistance&&(this._interiorPoint=new w(t),this._minDistance=e)}}class Nr{constructor(){Nr.constructor_.apply(this,arguments)}static constructor_(){if(this._inputGeom=null,this._isClosedEndpointsInInterior=!0,this._nonSimpleLocation=null,arguments.length===1){const t=arguments[0];this._inputGeom=t}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._inputGeom=t,this._isClosedEndpointsInInterior=!e.isInBoundary(2)}}static isSimple(){if(arguments.length===1){const t=arguments[0];return new Nr(t).isSimple()}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Nr(t,e).isSimple()}}isSimpleMultiPoint(t){if(t.isEmpty())return!0;const e=new zs;for(let n=0;n<t.getNumGeometries();n++){const s=t.getGeometryN(n).getCoordinate();if(e.contains(s))return this._nonSimpleLocation=s,!1;e.add(s)}return!0}isSimplePolygonal(t){const e=je.getLines(t);for(let n=e.iterator();n.hasNext();){const i=n.next();if(!this.isSimpleLinearGeometry(i))return!1}return!0}hasClosedEndpointIntersection(t){const e=new fi;for(let n=t.getEdgeIterator();n.hasNext();){const i=n.next(),s=i.isClosed(),o=i.getCoordinate(0);this.addEndpoint(e,o,s);const a=i.getCoordinate(i.getNumPoints()-1);this.addEndpoint(e,a,s)}for(let n=e.values().iterator();n.hasNext();){const i=n.next();if(i.isClosed&&i.degree!==2)return this._nonSimpleLocation=i.getCoordinate(),!0}return!1}getNonSimpleLocation(){return this._nonSimpleLocation}isSimpleLinearGeometry(t){if(t.isEmpty())return!0;const e=new un(0,t),n=new Me,i=e.computeSelfNodes(n,!0);return i.hasIntersection()?i.hasProperIntersection()?(this._nonSimpleLocation=i.getProperIntersectionPoint(),!1):!(this.hasNonEndpointIntersection(e)||this._isClosedEndpointsInInterior&&this.hasClosedEndpointIntersection(e)):!0}hasNonEndpointIntersection(t){for(let e=t.getEdgeIterator();e.hasNext();){const n=e.next(),i=n.getMaximumSegmentIndex();for(let s=n.getEdgeIntersectionList().iterator();s.hasNext();){const o=s.next();if(!o.isEndPoint(i))return this._nonSimpleLocation=o.getCoordinate(),!0}}return!1}addEndpoint(t,e,n){let i=t.get(e);i===null&&(i=new kl(e),t.put(e,i)),i.addEndpoint(n)}computeSimple(t){return this._nonSimpleLocation=null,t.isEmpty()?!0:t instanceof vt?this.isSimpleLinearGeometry(t):t instanceof Nn?this.isSimpleLinearGeometry(t):t instanceof Wn?this.isSimpleMultiPoint(t):H(t,qs)?this.isSimplePolygonal(t):t instanceof St?this.isSimpleGeometryCollection(t):!0}isSimple(){return this._nonSimpleLocation=null,this.computeSimple(this._inputGeom)}isSimpleGeometryCollection(t){for(let e=0;e<t.getNumGeometries();e++){const n=t.getGeometryN(e);if(!this.computeSimple(n))return!1}return!0}}class kl{constructor(){kl.constructor_.apply(this,arguments)}static constructor_(){this.pt=null,this.isClosed=null,this.degree=null;const t=arguments[0];this.pt=t,this.isClosed=!1,this.degree=0}addEndpoint(t){this.degree++,this.isClosed|=t}getCoordinate(){return this.pt}}Nr.EndpointInfo=kl;class Mo{constructor(){Mo.constructor_.apply(this,arguments)}static constructor_(){this._coordSet=new Wo,this._list=new F}static filterCoordinates(t){const e=new Mo;for(let n=0;n<t.length;n++)e.filter(t[n]);return e.getCoordinates()}filter(t){this._coordSet.add(t)&&this._list.add(t)}getCoordinates(){const t=new Array(this._list.size()).fill(null);return this._list.toArray(t)}get interfaces_(){return[Wr]}}class Sr{constructor(){Sr.constructor_.apply(this,arguments)}static constructor_(){if(this._geomFactory=null,this._inputPts=null,arguments.length===1){const t=arguments[0];Sr.constructor_.call(this,Sr.extractCoordinates(t),t.getFactory())}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._inputPts=Mo.filterCoordinates(t),this._geomFactory=e}}static extractCoordinates(t){const e=new Mo;return t.apply(e),e.getCoordinates()}preSort(t){let e=null;for(let n=1;n<t.length;n++)(t[n].y<t[0].y||t[n].y===t[0].y&&t[n].x<t[0].x)&&(e=t[0],t[0]=t[n],t[n]=e);return as.sort(t,1,t.length,new Oo(t[0])),t}computeOctRing(t){const e=this.computeOctPts(t),n=new Yn;return n.add(e,!1),n.size()<3?null:(n.closeRing(),n.toCoordinateArray())}lineOrPolygon(t){if(t=this.cleanRing(t),t.length===3)return this._geomFactory.createLineString([t[0],t[1]]);const e=this._geomFactory.createLinearRing(t);return this._geomFactory.createPolygon(e)}cleanRing(t){et.equals(t[0],t[t.length-1]);const e=new F;let n=null;for(let s=0;s<=t.length-2;s++){const o=t[s],a=t[s+1];o.equals(a)||n!==null&&this.isBetween(n,o,a)||(e.add(o),n=o)}e.add(t[t.length-1]);const i=new Array(e.size()).fill(null);return e.toArray(i)}isBetween(t,e,n){return J.index(t,e,n)!==0?!1:t.x!==n.x&&(t.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=t.x)||t.y!==n.y&&(t.y<=e.y&&e.y<=n.y||n.y<=e.y&&e.y<=t.y)}reduce(t){const e=this.computeOctRing(t);if(e===null)return t;const n=new zs;for(let s=0;s<e.length;s++)n.add(e[s]);for(let s=0;s<t.length;s++)wn.isInRing(t[s],e)||n.add(t[s]);const i=kt.toCoordinateArray(n);return i.length<3?this.padArray3(i):i}getConvexHull(){if(this._inputPts.length===0)return this._geomFactory.createGeometryCollection();if(this._inputPts.length===1)return this._geomFactory.createPoint(this._inputPts[0]);if(this._inputPts.length===2)return this._geomFactory.createLineString(this._inputPts);let t=this._inputPts;this._inputPts.length>50&&(t=this.reduce(this._inputPts));const e=this.preSort(t),n=this.grahamScan(e),i=this.toCoordinateArray(n);return this.lineOrPolygon(i)}padArray3(t){const e=new Array(3).fill(null);for(let n=0;n<e.length;n++)n<t.length?e[n]=t[n]:e[n]=t[0];return e}computeOctPts(t){const e=new Array(8).fill(null);for(let n=0;n<e.length;n++)e[n]=t[0];for(let n=1;n<t.length;n++)t[n].x<e[0].x&&(e[0]=t[n]),t[n].x-t[n].y<e[1].x-e[1].y&&(e[1]=t[n]),t[n].y>e[2].y&&(e[2]=t[n]),t[n].x+t[n].y>e[3].x+e[3].y&&(e[3]=t[n]),t[n].x>e[4].x&&(e[4]=t[n]),t[n].x-t[n].y>e[5].x-e[5].y&&(e[5]=t[n]),t[n].y<e[6].y&&(e[6]=t[n]),t[n].x+t[n].y<e[7].x+e[7].y&&(e[7]=t[n]);return e}toCoordinateArray(t){const e=new Array(t.size()).fill(null);for(let n=0;n<t.size();n++){const i=t.get(n);e[n]=i}return e}grahamScan(t){let e=null;const n=new Tf;n.push(t[0]),n.push(t[1]),n.push(t[2]);for(let i=3;i<t.length;i++){for(e=n.pop();!n.empty()&&J.index(n.peek(),e,t[i])>0;)e=n.pop();n.push(e),n.push(t[i])}return n.push(t[0]),n}}class Oo{constructor(){Oo.constructor_.apply(this,arguments)}static constructor_(){this._origin=null;const t=arguments[0];this._origin=t}static polarCompare(t,e,n){const i=e.x-t.x,s=e.y-t.y,o=n.x-t.x,a=n.y-t.y,l=J.index(t,e,n);if(l===J.COUNTERCLOCKWISE)return 1;if(l===J.CLOCKWISE)return-1;const c=i*i+s*s,h=o*o+a*a;return c<h?-1:c>h?1:0}compare(t,e){const n=t,i=e;return Oo.polarCompare(this._origin,n,i)}get interfaces_(){return[gs]}}Sr.RadialComparator=Oo;class nl{constructor(){nl.constructor_.apply(this,arguments)}static constructor_(){this._centroid=null,this._minDistance=j.MAX_VALUE,this._interiorPoint=null;const t=arguments[0];this._centroid=t.getCentroid().getCoordinate(),this.add(t)}static getInteriorPoint(t){return new nl(t).getInteriorPoint()}getInteriorPoint(){return this._interiorPoint}add(){if(arguments[0]instanceof A){const t=arguments[0];if(t instanceof ee)this.add(t.getCoordinate());else if(t instanceof St){const e=t;for(let n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))}}else if(arguments[0]instanceof w){const t=arguments[0],e=t.distance(this._centroid);e<this._minDistance&&(this._interiorPoint=new w(t),this._minDistance=e)}}}class Ze{constructor(){Ze.constructor_.apply(this,arguments)}static constructor_(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){const t=arguments[0],e=arguments[1];Ze.constructor_.call(this,t,Ze.INSIDE_AREA,e)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._component=t,this._segIndex=e,this._pt=n}}getSegmentIndex(){return this._segIndex}getCoordinate(){return this._pt}isInsideArea(){return this._segIndex===Ze.INSIDE_AREA}toString(){return this._component.getGeometryType()+"["+this._segIndex+"]-"+di.toPoint(this._pt)}getGeometryComponent(){return this._component}}Ze.INSIDE_AREA=-1;class il{constructor(){il.constructor_.apply(this,arguments)}static constructor_(){this._locations=null;const t=arguments[0];this._locations=t}static getLocations(t){const e=new F;return t.apply(new il(e)),e}filter(t){if(t.isEmpty())return null;(t instanceof ee||t instanceof vt||t instanceof jt)&&this._locations.add(new Ze(t,0,t.getCoordinate()))}get interfaces_(){return[ds]}}class es{constructor(){es.constructor_.apply(this,arguments)}static constructor_(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ks,this._minDistanceLocation=null,this._minDistance=j.MAX_VALUE,arguments.length===2){const t=arguments[0],e=arguments[1];es.constructor_.call(this,t,e,0)}else if(arguments.length===3){const t=arguments[0],e=arguments[1],n=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e,this._terminateDistance=n}}static distance(t,e){return new es(t,e).distance()}static isWithinDistance(t,e,n){return t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>n?!1:new es(t,e,n).distance()<=n}static nearestPoints(t,e){return new es(t,e).nearestPoints()}computeContainmentDistance(){if(arguments.length===0){const t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){const t=arguments[0],e=arguments[1],n=this._geom[t];if(n.getDimension()<2)return null;const i=1-t,s=Er.getPolygons(n);if(s.size()>0){const o=il.getLocations(this._geom[i]);if(this.computeContainmentDistance(o,s,e),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=e[0],this._minDistanceLocation[t]=e[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&H(arguments[0],dn)&&H(arguments[1],dn)){const t=arguments[0],e=arguments[1],n=arguments[2];for(let i=0;i<t.size();i++){const s=t.get(i);for(let o=0;o<e.size();o++)if(this.computeContainmentDistance(s,e.get(o),n),this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ze&&arguments[1]instanceof jt){const t=arguments[0],e=arguments[1],n=arguments[2],i=t.getCoordinate();if(y.EXTERIOR!==this._ptLocator.locate(i,e))return this._minDistance=0,n[0]=t,n[1]=new Ze(e,i),null}}}computeMinDistanceLinesPoints(t,e,n){for(let i=0;i<t.size();i++){const s=t.get(i);for(let o=0;o<e.size();o++){const a=e.get(o);if(this.computeMinDistance(s,a,n),this._minDistance<=this._terminateDistance)return null}}}computeFacetDistance(){const t=new Array(2).fill(null),e=je.getLines(this._geom[0]),n=je.getLines(this._geom[1]),i=xr.getPoints(this._geom[0]),s=xr.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,s,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(i,s,t),this.updateMinDistance(t,!1)}nearestLocations(){return this.computeMinDistance(),this._minDistanceLocation}updateMinDistance(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])}nearestPoints(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]}computeMinDistance(){if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof vt&&arguments[1]instanceof ee){const t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;const i=t.getCoordinates(),s=e.getCoordinate();for(let o=0;o<i.length-1;o++){const a=ge.pointToSegment(s,i[o],i[o+1]);if(a<this._minDistance){this._minDistance=a;const c=new At(i[o],i[o+1]).closestPoint(s);n[0]=new Ze(t,o,c),n[1]=new Ze(e,0,s)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof vt&&arguments[1]instanceof vt){const t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;const i=t.getCoordinates(),s=e.getCoordinates();for(let o=0;o<i.length-1;o++){const a=new ct(i[o],i[o+1]);if(!(a.distance(e.getEnvelopeInternal())>this._minDistance))for(let l=0;l<s.length-1;l++){const c=new ct(s[l],s[l+1]);if(a.distance(c)>this._minDistance)continue;const h=ge.segmentToSegment(i[o],i[o+1],s[l],s[l+1]);if(h<this._minDistance){this._minDistance=h;const u=new At(i[o],i[o+1]),d=new At(s[l],s[l+1]),f=u.closestPoints(d);n[0]=new Ze(t,o,f[0]),n[1]=new Ze(e,l,f[1])}if(this._minDistance<=this._terminateDistance)return null}}}}}computeMinDistancePoints(t,e,n){for(let i=0;i<t.size();i++){const s=t.get(i);for(let o=0;o<e.size();o++){const a=e.get(o),l=s.getCoordinate().distance(a.getCoordinate());if(l<this._minDistance&&(this._minDistance=l,n[0]=new Ze(s,0,s.getCoordinate()),n[1]=new Ze(a,0,a.getCoordinate())),this._minDistance<=this._terminateDistance)return null}}}distance(){if(this._geom[0]===null||this._geom[1]===null)throw new ht("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)}computeMinDistanceLines(t,e,n){for(let i=0;i<t.size();i++){const s=t.get(i);for(let o=0;o<e.size();o++){const a=e.get(o);if(this.computeMinDistance(s,a,n),this._minDistance<=this._terminateDistance)return null}}}}class Ps{constructor(){Ps.constructor_.apply(this,arguments)}static constructor_(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){const t=arguments[0];Ps.constructor_.call(this,t,Re.MOD2_BOUNDARY_RULE)}else if(arguments.length===2){const t=arguments[0],e=arguments[1];this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}}static getBoundary(){if(arguments.length===1){const t=arguments[0];return new Ps(t).getBoundary()}else if(arguments.length===2){const t=arguments[0],e=arguments[1];return new Ps(t,e).getBoundary()}}boundaryMultiLineString(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();const e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)}getBoundary(){return this._geom instanceof vt?this.boundaryLineString(this._geom):this._geom instanceof Nn?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()}boundaryLineString(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])}getEmptyMultiPoint(){return this._geomFact.createMultiPoint()}computeBoundaryCoordinates(t){const e=new F;this._endpointMap=new fi;for(let n=0;n<t.getNumGeometries();n++){const i=t.getGeometryN(n);i.getNumPoints()!==0&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(let n=this._endpointMap.entrySet().iterator();n.hasNext();){const i=n.next(),o=i.getValue().count;this._bnRule.isInBoundary(o)&&e.add(i.getKey())}return kt.toCoordinateArray(e)}addEndpoint(t){let e=this._endpointMap.get(t);e===null&&(e=new fu,this._endpointMap.put(t,e)),e.count++}}class fu{constructor(){fu.constructor_.apply(this,arguments)}static constructor_(){this.count=null}}vt.prototype.getBoundary=function(){return Ps.getBoundary(this)};Nn.prototype.getBoundary=function(){return Ps.getBoundary(this)};A.prototype.equalsTopo=function(r){return Bt.equalsTopo(this,r)};A.prototype.equals=function(r){return r===null?!1:Bt.equalsTopo(this,r)};A.prototype.union=function(){if(arguments.length===0)return Ms.union(this);if(arguments.length===1){const r=arguments[0];return No.union(this,r)}};A.prototype.isValid=function(){return ei.isValid(this)};A.prototype.intersection=function(r){return K.intersection(this,r)};A.prototype.covers=function(r){return Bt.covers(this,r)};A.prototype.coveredBy=function(r){return Bt.covers(r,this)};A.prototype.touches=function(r){return Bt.touches(this,r)};A.prototype.intersects=function(r){return Bt.intersects(this,r)};A.prototype.within=function(r){return Bt.contains(r,this)};A.prototype.overlaps=function(r){return Bt.overlaps(this,r)};A.prototype.disjoint=function(r){return Bt.disjoint(this,r)};A.prototype.crosses=function(r){return Bt.crosses(this,r)};A.prototype.buffer=function(){if(arguments.length===1){const r=arguments[0];return Jt.bufferOp(this,r)}else if(arguments.length===2){const r=arguments[0],t=arguments[1];return Jt.bufferOp(this,r,t)}else if(arguments.length===3){const r=arguments[0],t=arguments[1],e=arguments[2];return Jt.bufferOp(this,r,t,e)}};A.prototype.convexHull=function(){return new Sr(this).getConvexHull()};A.prototype.relate=function(){if(arguments.length===1){const r=arguments[0];return Bt.relate(this,r)}else if(arguments.length===2){const r=arguments[0],t=arguments[1];return Bt.relate(this,r).matches(t)}};A.prototype.getCentroid=function(){if(this.isEmpty())return this._factory.createPoint();const r=Os.getCentroid(this);return this.createPointFromInternalCoord(r,this)};A.prototype.getInteriorPoint=function(){if(this.isEmpty())return this._factory.createPoint();let r=null;const t=this.getDimension();t===0?r=new nl(this):t===1?r=new el(this):r=new ki(this);const e=r.getInteriorPoint();return this.createPointFromInternalCoord(e,this)};A.prototype.symDifference=function(r){return K.symDifference(this,r)};A.prototype.createPointFromInternalCoord=function(r,t){return t.getPrecisionModel().makePrecise(r),t.getFactory().createPoint(r)};A.prototype.toText=function(){return new di().write(this)};A.prototype.toString=function(){this.toText()};A.prototype.contains=function(r){return Bt.contains(this,r)};A.prototype.difference=function(r){return K.difference(this,r)};A.prototype.isSimple=function(){return new Nr(this).isSimple()};A.prototype.isWithinDistance=function(r,t){return this.getEnvelopeInternal().distance(r.getEnvelopeInternal())>t?!1:es.isWithinDistance(this,r,t)};A.prototype.distance=function(r){return es.distance(this,r)};const _r=new Cl;_r.inject(Fe,Rn,vr,de,Yr,rs,De);class yI{constructor(t,e){this.levelNumber=t,this.features=[],this.outerWallWidth=.4,this.wallRebuildRequired=!0,this.wall=new _c({"generated-wall":"yes"}),this.unhandledEntrances=[],this.intersects=n=>this.geometry.getEnvelopeInternal().intersects(n.getEnvelopeInternal())&&Bt.intersects(this.geometry,n),this.mergeIn=n=>(this.geometry=No.union(this.geometry,n.geometry),this.features.push(...n.features),this),this.addFeature=(n,i)=>{this.features.push(n);const s=n.getGeometry();(s instanceof de||s instanceof De)&&(this.geometry=No.union(this.geometry,Jt.bufferOp(i,this.outerWallWidth))),this.wallRebuildRequired=!0;const o=n.get("entrance");s instanceof Fe&&["yes","main","secondary","staircase"].includes(o)&&this.unhandledEntrances.push(n)},this.getWallSourceAreas=()=>{const n=[];for(const i of this.features.filter(s=>s.get("indoor")==="room")){const s=i.getGeometry();s instanceof de?n.push(s):s instanceof De&&n.push(...s.getPolygons())}return n},this.rebuildWall=()=>{if(!this.wallRebuildRequired)return;const n=new rs([]),i=new De([]),s=this.getWallSourceAreas();for(const x of s)i.appendPolygon(x);for(const x of s.flatMap(E=>E.getLinearRings()))n.appendLineString(new Rn(x.getCoordinates()));for(const x of this.features.filter(E=>E.get("indoor")==="wall")){const E=x.getGeometry();E instanceof Rn&&n.appendLineString(E)}const o=new Cl;o.inject(Fe,Rn,vr,de,Yr,rs,De);let a=o.read(n);const l=[];for(const x of this.features.filter(E=>E.get("door")||E.get("indoor")==="door"||E.get("entrance"))){const E=x.getGeometry(),R=parseFloat(x.get("width")),T=isNaN(R)?1.2:R;l.push(Jt.bufferOp(o.read(E),T/2-.5))}const c=Ms.union(new St(l,new Qt)),h=K.intersection(a,c),u=Jt.bufferOp(h,.5,new nt(8,nt.CAP_SQUARE,nt.JOIN_MITRE,5)),d=.4,f=.2;let p=Jt.bufferOp(o.read(i),d-f/2,new nt(8,nt.CAP_FLAT,nt.JOIN_MITRE,5));const m=this.features.find(x=>x.get("indoor")==="level");m&&(p=p.union(o.read(m.getGeometry())));const I=[...i.getPolygons().map(x=>({walled:!0,poly:x,area:x.getArea()})),...this.features.filter(x=>["area","corridor"].includes(x.get("indoor"))).map(x=>x.getGeometry()).filter(x=>x instanceof de||x instanceof De).map(x=>({walled:!1,poly:x,area:x.getArea()}))];I.sort((x,E)=>E.area-x.area);for(const x of I){const E=o.read(x.poly);x.walled&&!Bt.contains(p,E)&&(p=p.union(Jt.bufferOp(E,f/2,new nt(8,nt.CAP_FLAT,nt.JOIN_MITRE,5)))),p=K.difference(p,Jt.bufferOp(E,-f/2,new nt(8,nt.CAP_FLAT,nt.JOIN_MITRE,5)))}for(const x of this.features.filter(E=>E.get("indoor")==="wall")){const E=x.getGeometry();if(E instanceof de||E instanceof De)p=p.union(o.read(E));else if(E instanceof Rn||E instanceof rs){const R=Jt.bufferOp(o.read(E),f/2,new nt(8,nt.CAP_SQUARE,nt.JOIN_MITRE,5));p=p.union(R)}}p=K.difference(p,u),this.wall.setGeometry(o.write(p)),this.wallRebuildRequired=!1,this.cutWallFromAreas(p)},this.cutWallFromAreas=n=>{for(const i of this.features){const s=i.getGeometry();if(s instanceof de||s instanceof De){const o=_r.read(s),a=K.difference(o,n);i.setGeometry(_r.write(a))}}},this.generateEntranceWalkways=()=>{const n=[];if(this.unhandledEntrances.length>0){new rs([]);const i=this.getWallSourceAreas();for(const s of this.unhandledEntrances){const o=s.getGeometry();for(const a of i){const l=a.getClosestPoint(o.getFirstCoordinate());if(q_(o.getFirstCoordinate(),l)<1){const h=_r.read(o).buffer(.5),d=a.getLinearRings().map(f=>_r.read(f).intersection(h))[0].getCoordinates();if(d.length>1){const f=[d[0].x,d[0].y],p=[d[d.length-1].x,d[d.length-1].y],m=Math.atan2(p[1]-f[1],p[0]-f[0]),I=[(f[0]+p[0])/2,(f[1]+p[1])/2],x=1,E=[I[0]+x*Math.cos(m+Math.PI/2),I[1]+x*Math.sin(m+Math.PI/2)];if(a.containsXY(E[0],E[1])){const N=I[0]-E[0],S=I[1]-E[1];E[0]=I[0]+2*N,E[1]=I[1]+2*S}const T=new _c(new Rn([E,I]));T.setProperties({"generated-walkway":"yes",level:String(this.levelNumber),name:s.get("name"),entrance:s.get("entrance")}),this.features.push(T),n.push(T);break}}}}this.unhandledEntrances=[]}return n},this.wall.set("level",String(t)),this.geometry=e}}function Na(r){const t=r.get("level");if(t)return t.split(";").map(e=>{const n=e.split(/(?<!^)\s*(?<!\-)\-\s*/);if(n.length===1)return{from:parseFloat(n[0]),to:parseFloat(n[0])};if(n.length===2)return{from:parseFloat(n[0]),to:parseFloat(n[1])};console.log(`Level of feature ${r.getId()} cannot be parsed: ${t}`)}).filter(Boolean)}class xI extends Eo{constructor(t){super({features:[]}),this.resultingFeatures=new Eo,this.levels=[],this.setActiveLevel=e=>{this.activeLevel=e,this.changed()},this.levelsOfFeature=e=>{const n=Na(e);return n?n.flatMap(i=>i.from===i.to?[i.from]:[i.from,i.to]):[]},this.getLevels=(e,n)=>{const i=this.levels.filter(s=>s.levelNumber===e&&s.intersects(n));if(i.length>0)return i;{const s=new yI(e,n);return this.levels.push(s),this.resultingFeatures.addFeature(s.wall),[s]}},this.addFeature=e=>{const n=this.levelsOfFeature(e);for(const i of n){const s=_r.read(e.getGeometry()),o=this.getLevels(i,s);let a;if(o.length>1){a=o.reduce((l,c)=>l.mergeIn(c)),this.levels=this.levels.filter(l=>!o.includes(l)||l===a);for(const l of o.filter(c=>c!==a))this.resultingFeatures.removeFeature(l.wall)}else a=o[0];a.addFeature(e,s)}this.resultingFeatures.addFeature(e),this.changed()},this.getFeaturesInExtent=(e,n)=>{const i=new ct(e[0],e[2],e[1],e[3]),s=new Date().getTime();for(const o of this.levels){const a=o.levelNumber===this.activeLevel&&i.intersects(o.geometry.getEnvelopeInternal());if(a&&o.wallRebuildRequired)if(new Date().getTime()-s<100)o.rebuildWall();else{setTimeout(()=>{this.changed()},500);break}a&&o.unhandledEntrances.length>0&&this.resultingFeatures.addFeatures(o.generateEntranceWalkways())}return this.resultingFeatures.getFeaturesInExtent(e,n).filter(o=>{if(o.get("building"))return!0;const a=Na(o);return a&&a.some(l=>l&&l.from<=this.activeLevel&&l.to>=this.activeLevel)})},this.getPresentLevels=(e,n,i)=>{const s=this.resultingFeatures.getFeaturesInExtent(e,n).filter(i);return Array.from(new Set(s.flatMap(o=>{const a=Na(o);return a?a.flatMap(l=>[l.from,l.to]):[]}))).sort((o,a)=>o-a)},this.activeLevel=t.activeLevel}}const EI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMjkwLjY1KSI+PHJlY3Qgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiNhOWE5YTk7c3Ryb2tlLXdpZHRoOi4yNjQ1ODMzMjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIHdpZHRoPSI2LjA4NSIgaGVpZ2h0PSI2LjA4NSIgeD0iLjEzMiIgeT0iMjkwLjc4MiIgcnk9IjAiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6Ljc5Mzc1MDA1O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTEuMDU4IDI5NC42MTloLjUyOXYxLjMyM2gtLjUyOXoiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6Ljc5Mzc0OTk5O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgdHJhbnNmb3JtPSJyb3RhdGUoLTkwKSIgZD0iTS0yOTIuNTAyIDMuOTY5aC41Mjl2MS44NTJoLS41Mjl6TS0yOTMuODI1IDIuMzgxaC41Mjl2Mi4zODFoLS41Mjl6TS0yOTUuMTQ4Ljc5NGguNTI5djIuMzgxaC0uNTI5eiIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNzkzNzUwMDU7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiBkPSJNMi42NDYgMjkzLjI5NmguNTI5djEuODUyaC0uNTI5ek00LjIzMyAyOTEuOTczaC41Mjl2MS44NTJoLS41Mjl6Ii8+PC9nPjwvc3ZnPg==",II="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PGRlZnM+PG1hcmtlciBvcmllbnQ9ImF1dG8iIHJlZlk9IjAiIHJlZlg9IjAiIGlkPSJhIiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZSI+PHBhdGggZD0ibTUuNzcgMC04LjY1IDVWLTVsOC42NSA1eiIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDoxcHQ7c3Ryb2tlLW9wYWNpdHk6MTtmaWxsOiMwMDA7ZmlsbC1vcGFjaXR5OjEiIHRyYW5zZm9ybT0ic2NhbGUoLjQpIi8+PC9tYXJrZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiPjxyZWN0IHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojYTlhOWE5O3N0cm9rZS13aWR0aDouMjY0NTgzMzI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiB3aWR0aD0iNi4wODUiIGhlaWdodD0iNi4wODUiIHg9Ii4xMzIiIHk9IjI5MC43ODIiIHJ5PSIwIi8+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiMwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOi43OTM3NTAwNTtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0xLjMyMyAyOTUuNDEyaC41Mjl2MS4zMjNoLS41Mjl6Ii8+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiMwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOi43OTM3NDk5OTtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIHRyYW5zZm9ybT0icm90YXRlKC05MCkiIGQ9Ik0tMjkzLjI5NiA0LjIzM2guNTI5djEuODUyaC0uNTI5ek0tMjk0LjYxOSAyLjY0NmguNTI5djIuMzgxaC0uNTI5ek0tMjk1Ljk0MiAxLjA1OGguNTI5djIuMzgxaC0uNTI5eiIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNzkzNzUwMDU7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiBkPSJNMi45MSAyOTQuMDloLjUyOXYxLjg1MkgyLjkxek00LjQ5OCAyOTIuNzY3aC41Mjl2MS44NTJoLS41Mjl6Ii8+PHBhdGggc3R5bGU9ImZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6LjUyOTE2Njc7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MTttYXJrZXItZW5kOnVybCgjYSkiIGQ9Im0uNjM5IDI5NC4zOTQgMi4xNS0yLjE1Ii8+PC9nPjwvc3ZnPg==",CI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PGRlZnM+PG1hcmtlciBvcmllbnQ9ImF1dG8iIHJlZlk9IjAiIHJlZlg9IjAiIGlkPSJhIiBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZSI+PHBhdGggZD0ibTUuNzcgMC04LjY1IDVWLTVsOC42NSA1eiIgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDoxcHQ7c3Ryb2tlLW9wYWNpdHk6MTtmaWxsOiMwMDA7ZmlsbC1vcGFjaXR5OjEiIHRyYW5zZm9ybT0ic2NhbGUoLS40KSIvPjwvbWFya2VyPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC0yOTAuNjUpIj48cmVjdCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZjtmaWxsLW9wYWNpdHk6MTtzdHJva2U6I2E5YTlhOTtzdHJva2Utd2lkdGg6LjI2NDU4MzMyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgd2lkdGg9IjYuMDg1IiBoZWlnaHQ9IjYuMDg1IiB4PSIuMTMyIiB5PSIyOTAuNzgyIiByeT0iMCIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNzkzNzUwMDU7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiBkPSJNMS4zMjMgMjk1LjQxMmguNTI5djEuMzIzaC0uNTI5eiIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNzkzNzQ5OTk7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiB0cmFuc2Zvcm09InJvdGF0ZSgtOTApIiBkPSJNLTI5My4yOTYgNC4yMzNoLjUyOXYxLjg1MmgtLjUyOXpNLTI5NC42MTkgMi42NDZoLjUyOXYyLjM4MWgtLjUyOXpNLTI5NS45NDIgMS4wNThoLjUyOXYyLjM4MWgtLjUyOXoiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6Ljc5Mzc1MDA1O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTIuOTEgMjk0LjA5aC41Mjl2MS44NTJIMi45MXpNNC40OTggMjkyLjc2N2guNTI5djEuODUyaC0uNTI5eiIvPjxwYXRoIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOi41MjkxNjY3O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjE7bWFya2VyLXN0YXJ0OnVybCgjYSkiIGQ9Im0xLjUwNCAyOTMuMzE4IDIuMTUtMi4xNSIvPjwvZz48L3N2Zz4=",RI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMjkwLjY1KSI+PHJlY3Qgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiNhOWE5YTk7c3Ryb2tlLXdpZHRoOi4yNjQ1ODMzMjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIHdpZHRoPSI2LjA4NSIgaGVpZ2h0PSI2LjA4NSIgeD0iLjEzMiIgeT0iMjkwLjc4MiIgcnk9IjAiLz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjgxOCAtLjMzOCkiPjxyZWN0IHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDouNTI5MTY2NztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIHdpZHRoPSIxLjMyMyIgaGVpZ2h0PSIxLjMyMyIgeD0iMjA5LjY4OSIgeT0iMjA1LjI2OCIgcnk9IjAiIHRyYW5zZm9ybT0icm90YXRlKDQ1KSIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNTI5MTY2NjQ7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiBkPSJNMi4xNSAyOTQuMDloMi4zODF2LjUyOUgyLjE1eiIvPjwvZz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6IzAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6LjUyOTE2NjY0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTIuOTEgMjkzLjk3MWguNTI5di43OTRIMi45MXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuOCAtLjM1KSIvPjxyZWN0IHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDouNTI5MTY2NztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIHdpZHRoPSIyLjY0NiIgaGVpZ2h0PSI0LjIzMyIgeD0iMS4wNTgiIHk9IjI5MS45NzMiIHJ4PSIuNTI5IiByeT0iLjUyOSIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDouNTI5MTY2NjQ7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIiBkPSJNMi4xMTcgMjkxLjIxNGguNTI5di43OTRoLS41Mjl6Ii8+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNhOWE5YTk7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOi41MjkxNjY2NDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik02LjA4NSAyOTAuNjVoLjI2NVYyOTdoLS4yNjV6Ii8+PC9nPjwvc3ZnPg==",wI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiNhOWE5YTk7c3Ryb2tlLXdpZHRoOi4yNjQ1ODMzMjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0uMTMyIDI5MC43ODJoNi4wODZ2Ni4wODZILjEzMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2E5YTlhOTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6LjUyOTE2NjY0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTYuMDg1IDI5MC42NWguMjY1VjI5N2gtLjI2NXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48ZyBzdHlsZT0iZmlsbDojMDAwO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoyLjQ5MjEyNDU2IiB0cmFuc2Zvcm09Im1hdHJpeCguNDAxMjYgMCAwIC40MDEyNiAtLjk1MyAtLjYzNCkiPjxjaXJjbGUgc3R5bGU9InN0cm9rZS13aWR0aDoxIiBjeD0iNi45OTUiIGN5PSIzLjk2OSIgcj0iMS4wNTgiLz48cGF0aCBzdHlsZT0ic3Ryb2tlLXdpZHRoOjEiIGQ9Ik02Ljc0NiAxMy4yNnYyLjIxOGMwIC43MDUtMS4wNTguNzA1LTEuMDU4IDBWMTMuMjZINC4xNjFsMS43NzYtNi4zOGgtLjYxNEw0LjIwOCA5LjY1NmMtLjE5LjU5Mi0xLjA3Ny4zMzktLjkyNi0uMjY0TDQuNTMgNi4yMThjLjE2NS0uNTQxIDEuMTE0LS45MjMgMS44MDUtLjkyNmgxLjMyM2MuNjkuMDAzIDEuNjEuMzg1IDEuNzc1LjkyNmwxLjIxOCAzLjE3NWMuMTUxLjYwMy0uNzM2Ljg1Ni0uOTI2LjI2NEw4LjYzOSA2Ljg4aC0uNTg1bDEuODYzIDYuMzgxSDguMzl2Mi4yMThjMCAuNzA1LTEuMDU5LjcwNS0xLjA1OCAwVjEzLjI2eiIvPjxjaXJjbGUgc3R5bGU9InN0cm9rZS13aWR0aDoxIiBjeD0iMTMuODkxIiBjeT0iMy45NjkiIHI9IjEuMDU4Ii8+PHBhdGggc3R5bGU9InN0cm9rZS13aWR0aDoxIiBkPSJNMTAuOTcgNi42MTV2My40NGMwIC42MTcuOTI1LjYxNy45MjUgMFY3LjAxaC42NzNsLS4yMzMgOC40MDFjLS4wMjIuNzkzIDEuMTkuNzk0IDEuMTkgMHYtNC45NjFoLjY0NHY0Ljk2MWMwIC43OTQgMS4yMDQuNzk0IDEuMTkgMGwtLjE0NS04LjRoLjY0M3YzLjA0MmMwIC42MTguOTI2LjYxOC45MjYgMHYtMy40NGMwLS43My0uOTcxLTEuMzIyLTEuNzAyLTEuMzIySDEyLjdjLS43MyAwLTEuNzMuNTkyLTEuNzMgMS4zMjN6Ii8+PC9nPjwvc3ZnPg==",TI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiNhOWE5YTk7c3Ryb2tlLXdpZHRoOi4yNjQ1ODMzMjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0uMTMyIDI5MC43ODJoNi4wODZ2Ni4wODZILjEzMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2E5YTlhOTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6LjUyOTE2NjY0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTYuMDg1IDI5MC42NWguMjY1VjI5N2gtLjI2NXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48ZyBzdHlsZT0iZmlsbDojMDAwO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoyLjQ5MjEyNDU2IiB0cmFuc2Zvcm09Im1hdHJpeCguNDAxMjYgMCAwIC40MDEyNiAtMi4zOTMgLS42MzQpIj48Y2lyY2xlIHN0eWxlPSJzdHJva2Utd2lkdGg6MSIgY3g9IjEzLjg5MSIgY3k9IjMuOTY5IiByPSIxLjA1OCIvPjxwYXRoIHN0eWxlPSJzdHJva2Utd2lkdGg6MSIgZD0iTTEwLjk3IDYuNjE1djMuNDRjMCAuNjE3LjkyNS42MTcuOTI1IDBWNy4wMWguNjczbC0uMjMzIDguNDAxYy0uMDIyLjc5MyAxLjE5Ljc5NCAxLjE5IDB2LTQuOTYxaC42NDR2NC45NjFjMCAuNzk0IDEuMjA0Ljc5NCAxLjE5IDBsLS4xNDUtOC40aC42NDN2My4wNDJjMCAuNjE4LjkyNi42MTguOTI2IDB2LTMuNDRjMC0uNzMtLjk3MS0xLjMyMi0xLjcwMi0xLjMyMkgxMi43Yy0uNzMgMC0xLjczLjU5Mi0xLjczIDEuMzIzeiIvPjwvZz48L3N2Zz4=",NI="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDYuMzUgNi4zNSI+PHBhdGggc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOiNhOWE5YTk7c3Ryb2tlLXdpZHRoOi4yNjQ1ODMzMjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0uMTMyIDI5MC43ODJoNi4wODZ2Ni4wODZILjEzMnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48cGF0aCBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2E5YTlhOTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6LjUyOTE2NjY0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTYuMDg1IDI5MC42NWguMjY1VjI5N2gtLjI2NXoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTI5MC42NSkiLz48ZyBzdHlsZT0iZmlsbDojMDAwO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoyLjQ5MjEyNDU2IiB0cmFuc2Zvcm09Im1hdHJpeCguNDAxMjYgMCAwIC40MDEyNiAuMzggLS42MzQpIj48Y2lyY2xlIHN0eWxlPSJzdHJva2Utd2lkdGg6MSIgY3g9IjYuOTk1IiBjeT0iMy45NjkiIHI9IjEuMDU4Ii8+PHBhdGggc3R5bGU9InN0cm9rZS13aWR0aDoxIiBkPSJNNi43NDYgMTMuMjZ2Mi4yMThjMCAuNzA1LTEuMDU4LjcwNS0xLjA1OCAwVjEzLjI2SDQuMTYxbDEuNzc2LTYuMzhoLS42MTRMNC4yMDggOS42NTZjLS4xOS41OTItMS4wNzcuMzM5LS45MjYtLjI2NEw0LjUzIDYuMjE4Yy4xNjUtLjU0MSAxLjExNC0uOTIzIDEuODA1LS45MjZoMS4zMjNjLjY5LjAwMyAxLjYxLjM4NSAxLjc3NS45MjZsMS4yMTggMy4xNzVjLjE1MS42MDMtLjczNi44NTYtLjkyNi4yNjRMOC42MzkgNi44OGgtLjU4NWwxLjg2MyA2LjM4MUg4LjM5djIuMjE4YzAgLjcwNS0xLjA1OS43MDUtMS4wNTggMFYxMy4yNnoiLz48L2c+PC9zdmc+",bf=new Cl;bf.inject(Fe,Rn,vr,de,Yr,rs,De);window.showInfo=r=>{document.querySelector("#info").style.display=r?"block":"none"};window.toggleFullscreen=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(r=>{console.error(r),alert("Fullscreen mode not permitted by browser.")})};const Ge=new Cx({target:"map",layers:[new Wx({source:new cE})],view:new ts({center:va([9.8942147,47.9101541],"EPSG:4326","EPSG:3857"),zoom:16})}),Yl=15;let vf=!1;window.showOutlines=r=>{vf=r.checked,Ge.getAllLayers().filter(t=>t.getSource()instanceof Eo).forEach(t=>t.changed())};let Gn=0;function Mf(r){const t=Na(r);return t&&t.some(e=>e&&e.from<=Gn&&e.to>=Gn)}const Bs=new xI({activeLevel:Gn}),Of=new aI({strategy:Qy(ef({minZoom:13,maxZoom:13,tileSize:2*256}))});Of.addEventListener(En.ADDFEATURE,r=>{Bs.addFeature(r.feature)});Ge.addLayer(new Gd({source:Of,minZoom:Yl,style:null}));const sl=document.getElementById("levelPicker"),Pf=r=>{Array.from(sl.children).forEach(t=>t.classList.remove("active")),Gn=r,Bs.setActiveLevel(Gn),Ge.getAllLayers().filter(t=>t.getSource()instanceof Eo).forEach(t=>t.changed()),Df()};let zg;const Af=()=>{clearTimeout(zg),zg=setTimeout(()=>{const r=Ge.getView().calculateExtent(),t=Bs.getPresentLevels(r,Ge.getView().getProjection(),e=>e.get("level")&&(e.get("generated-wall")==="yes"||["room","corridor","area"].includes(e.get("indoor"))||e.get("room")||e.get("indoor")==="stairs"||e.get("stais")||e.get("highway")==="steps"||e.get("name")));sl.replaceChildren([]);for(const e of t){const n=document.createElement("button");n.innerText=String(e),n.dataset.floorLevel=String(e),e===Gn&&n.classList.add("active"),n.onclick=()=>{Pf(e)},sl.append(n)}},500)};Ge.getView().addEventListener("change",Af);Bs.addEventListener("change",Af);const SI=document.querySelector("#zoomCloserInfo");Ge.getView().addEventListener("change:resolution",()=>{const r=Ge.getView().getZoom()<Yl;SI.style.display=r?"block":"none"});window.showView=r=>{if(r.value.includes(",")){const[t,e,n,i]=r.value.split(/,/).map(parseFloat),s=va([t,e],"EPSG:4326","EPSG:3857");Ge.getView().setCenter(s),Ge.getView().setZoom(n),Pf(i)}else{const t=Ge.getView().getCenter(),e=va(t,"EPSG:3857","EPSG:4326");console.log(e.concat(Ge.getView().getZoom()).join(","))}r.value=""};const LI=[new Xn({stroke:new hs({color:"magenta",width:15})}),new Xn({stroke:new hs({color:"white",width:10}),fill:new us({color:"white"})})],Rs=new Xn({fill:new us({color:"white"})}),bI=new hs({color:"darkgray",lineDash:[5],width:1});new Xn({geometry:r=>{const t=r.getGeometry();if(t instanceof de)return t.getInteriorPoint()}});const vI=new Xn({fill:new us({color:"lightgray"}),stroke:new hs({color:"darkgray",width:2})}),lr=new Xn({image:null,text:new Nd({fill:new us({color:"green"}),stroke:new hs({width:3,color:"white"})})}),MI=new Go({src:EI}),Ea=new Go({src:II}),Ia=new Go({src:CI}),vn=new Xn({image:null}),mc=[new Xn({stroke:new hs({color:"darkgray",lineCap:"butt"})}),vn];Ge.addLayer(new Gd({source:Bs,minZoom:Yl,renderOrder:(r,t)=>{const e=r.get("building"),n=t.get("building");if(e&&!n)return-1;if(!e&&n)return 1;const i=r.get("generated-wall")==="yes",s=t.get("generated-wall")==="yes";if(i&&!s)return 1;if(s&&!i)return-1;const o=r.getGeometry(),a=o instanceof de||o instanceof De,l=t.getGeometry(),c=l instanceof de||l instanceof De;return a&&!c?-1:c&&!a?1:a&&c?l.getArea()-o.getArea():yh(r,t)},style:(r,t)=>{if(r.get("building"))return vf?LI:null;if(Mf(r)){if(["room","corridor","area"].includes(r.get("indoor"))||r.get("room"))return Rs.getFill().setColor("white"),Rs.setStroke(r.get("indoor")==="area"?bI:void 0),r.get("indoor")==="corridor"&&Rs.getFill().setColor("#dfc"),["stairs","corridor","lobby","hall","elevator"].includes(r.get("room"))||r.get("stairs")==="yes"||r.get("highway")==="elevator"?(Rs.getFill().setColor("#dfc"),Rs):(["toilet","toilets"].includes(r.get("room"))&&Rs.getFill().setColor("lightblue"),Rs);if(r.get("generated-wall"))return vI;if(r.get("generated-walkway")){const e=r.getGeometry(),n=e.getFirstCoordinate(),i=e.getLastCoordinate(),s=i[0]-n[0],o=i[1]-n[1];let a=Math.atan2(o,s);a<0&&(a=a+2*Math.PI),lr.setGeometry(new Fe(i));const l=ce(2/t,6,18);l!==lr.getImage()?.getRadius()&&lr.setImage(new fh({points:3,radius:l,displacement:[0,-1.5*l],fill:new us({color:"green"}),rotateWithView:!0})),lr.getImage().setRotation(-a-1.5*Math.PI);const c=lr.getText();return c.setText(r.get("name")),c.setOffsetX(-2.5*l*Math.cos(a)),c.setOffsetY(2.5*l*Math.sin(a)),a>=5.5||a<=.79?c.setTextAlign("right"):a>=.79&&a<=2.36?(c.setTextAlign("center"),c.setOffsetY(1.25*c.getOffsetY())):a>=2.36&&a<=3.93?c.setTextAlign("left"):(c.setTextAlign("center"),c.setOffsetY(1.5*c.getOffsetY())),[lr]}if(r.get("indoor")==="stairs"||r.get("stais")||r.get("highway")==="steps"){const e=r.getGeometry();if(e instanceof Rn){mc[0].getStroke().setWidth(2/t);const n=.3/t;mc[0].getStroke().setLineDash([n,n]);const i=r.get("conveying"),s=r.get("level");return vn.setGeometry(null),r.get("incline")==="down"?s?.startsWith(Gn+";")?(vn.setGeometry(new Fe(e.getLastCoordinate())),vn.setImage(i==="forward"?null:Ea)):s?.endsWith(";"+Gn)&&(vn.setGeometry(new Fe(e.getFirstCoordinate())),vn.setImage(i==="forward"?Ia:i==="backward"?null:Ia)):s?.startsWith(Gn+";")?(vn.setGeometry(new Fe(e.getFirstCoordinate())),vn.setImage(i==="forward"?Ea:i==="backward"?null:Ea)):s?.endsWith(";"+Gn)&&(vn.setGeometry(new Fe(e.getLastCoordinate())),vn.setImage(i==="forward"?null:Ia)),Ge.getView().getResolution()>=.4&&vn.setImage(null),mc}}}}}));Ge.addLayer(new QE({source:Bs,minZoom:Yl,filter:r=>r.get("indoor")!=="level"&&Mf(r),occupiedSpaces:(r,t,e,n)=>Bs.getFeaturesInExtent(t.extent,t.viewState.projection).filter(i=>i.get("generated-wall")==="yes").map(i=>{const s=i.getGeometry().clone();return s.applyTransform((o,a,l)=>Pi(o,0,o.length,l,e,a)),bf.read(s)}),labelProvider:(r,t,e)=>{t.style.textAlign="center";const n=r.get("shop")||r.get("amenity")||r.get("vending"),i=r.get("name"),s=r.get("ref"),o=[["typeName",n],["name",i],["reference",s]].filter(([c,h])=>Boolean(h)).sort((c,h)=>c[1].length-h[1].length).map(([c])=>c)[0];if(n&&(e==="default"||e==="shortest-only"&&o==="typeName")){const c=document.createElement("div");c.style.margin="0",c.style.fontSize="11px",c.style.color="#666",c.append(n.replaceAll("_"," ").replaceAll(";",", ")),t.append(c)}if(i&&(e==="default"||e==="shortest-only"&&o==="name")){const c=document.createElement("p");c.style.font="bold 12px sans-serif",c.style.margin="0",c.append(i),t.append(c)}if(s&&(e==="default"||e==="shortest-only"&&o==="reference")){const c=document.createElement("p");c.style.font="12px sans-serif",c.style.margin="0",c.append(s),t.append(c)}if(["toilet","toilets"].includes(r.get("room"))||r.get("amenity")==="toilets"){const c=r.get("male")==="yes",h=r.get("female")==="yes",u=document.createElement("img");return c&&!h?u.src=TI:!c&&h?u.src=NI:u.src=wI,t.prepend(u),e==="icon-only"?{allowExtendingGeometry:!0}:{allowExtendingGeometry:!1,fallbackVariant:"icon-only"}}else if(t.firstElementChild){const c=r.get("male")==="yes",h=r.get("female")==="yes";c&&!h?t.firstElementChild.prepend(" "):!c&&h?t.firstElementChild.prepend(" "):(r.get("unisex")==="yes"||c&&h)&&t.firstElementChild.prepend(" ")}const a=r.get("room")==="stairs"||r.get("stairs")==="yes",l=r.get("room")==="elevator"||r.get("highway")==="elevator";if((a||l)&&Ge.getView().getResolution()<.4){const c=document.createElement("img");return c.src=a?MI.getSrc():RI,t.firstElementChild?(c.style.marginRight="0.5ex",c.style.verticalAlign="middle",t.firstElementChild.prepend(c)):t.prepend(c),e==="icon-only"?{allowExtendingGeometry:!0}:{allowExtendingGeometry:!1,fallbackVariant:"icon-only"}}if(e==="default"&&o)return{fallbackVariant:"shortest-only"}}}));Df();function Df(){Array.from(sl.children).filter(r=>r.dataset.floorLevel===String(Gn)).forEach(r=>r.classList.add("active"))}
